define("plugins/halo/mail/register",["io.ox/core/extensions","io.ox/mail/api","gettext!plugins/halo"],function(e,n,t){"use strict";e.point("io.ox/halo/contact:renderer").extend({id:"mail",handles:function(e){return"com.openexchange.halo.mail"===e},draw:function(e){if(0===e.data.length)return $.when();var a=[],i=[],o=$.Deferred(),l=this;return _(e.data).each(function(e){/INBOX$/i.test(e.folder_id)?i.push(e):a.push(e)}),this.append($('<h2 class="widget-title clear-title">').text(t("Recent conversations"))),require(["io.ox/core/tk/dialogs","io.ox/mail/listview"],function(s,c){function d(t,a){var i="halo:"+t+":"+e.contact.email1;return new c({collection:n.pool.add(i,a),pagination:!1,selection:!1,scrollable:!1,useButtonMarkup:!0}).render().$el.addClass("compact")}l.append($('<div class="io-ox-left-column">').append($('<h3 class="io-ox-subheader">').text(t("Received mails")),0===i.length?$("<div>").text(t("Cannot find any messages this contact sent to you.")):d("received",i)),$('<div class="io-ox-right-column">').append($('<h3 class="io-ox-subheader">').text(t("Sent mails")),0===a.length?$("<div>").text(t("Cannot find any messages you sent to this contact.")):d("sent",a)),$("<div>").css("clear","both")),(new s.SidePopup).delegate(l,".list-item",function(e,t,a){var i=String(a.attr("data-cid")).replace(/^thread\./,"");n.get(_.cid(i)).done(function(n){require(["io.ox/mail/detail/view"],function(t){var a=new t.View({data:n});e.append(a.render().expand().$el.addClass("no-padding")),n=null})})}),o.resolve()}),o}}),e.point("io.ox/halo/contact:requestEnhancement").extend({id:"request-mail",enhances:function(e){return"com.openexchange.halo.mail"===e},enhance:function(e){e.appendColumns=!0,e.columnModule="mail",e.params.limit=10,e.params.columns="102,600,601,602,603,604,605,606,607,608,609,610,611,612,614,652"}})});