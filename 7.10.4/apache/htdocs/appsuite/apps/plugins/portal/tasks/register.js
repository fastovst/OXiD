define("plugins/portal/tasks/register",["io.ox/core/extensions","io.ox/tasks/api","gettext!plugins/portal","io.ox/tasks/util"],function(t,e,a,s){"use strict";t.point("io.ox/portal/widget/tasks").extend({title:a("My tasks"),initialize:function(t){e.on("update create delete",function(){require(["io.ox/portal/main"],function(e){var a=e.getApp(),s=a.getWidgetCollection()._byId[t.model.id];s&&a.refreshWidget(s,0)})})},load:function(t){return e.getAllMyTasks().done(function(e){t.data=e})},summary:function(t){if(!this.find(".summary").length){this.addClass("with-summary show-summary");var e=_(t.data).filter(function(t){return null!==t.end_time&&3!==t.status}),i=$('<div class="summary">');if(0===e.length)i.text(a("You don't have any tasks that are either due soon or overdue."));else{var n=s.interpretTask(_(e).first());i.append($('<li class="item" tabindex="0">').data("item",n).append($('<span class="flex-wrapper">').append($('<span class="bold">').text(_.ellipsis(n.title,{max:50})),$.txt(" "),""===n.end_time?$():$('<span class="accent">').text(a("Due on %1$s",n.end_time)),$.txt(" ")),$('<span class="status pull-right">').text(n.status).addClass(n.badge))),this.on("tap","h2",function(t){$(t.delegateTarget).toggleClass("show-summary")})}this.append(i)}},preview:function(t){var e,i=$('<ul class="content list-unstyled">');0!==(e=_(t.data).filter(function(t){return null!==t.end_time&&3!==t.status})).length?(_(e.slice(0,10)).each(function(t){t=s.interpretTask(t),i.append($('<li class="item" tabindex="0">').data("item",t).append($('<span class="flex-wrapper">').append($('<span class="bold">').text(_.ellipsis(t.title,{max:50})),$.txt(" "),""===t.end_time?$():$('<span class="accent">').text(a("Due on %1$s",t.end_time)),$.txt(" ")),$("<span>").text(t.status).addClass(t.badge)))}),this.append(i)):this.append(i.append($("<li>").text(a("You don't have any tasks that are either due soon or overdue."))))},draw:function(t){var e=this.busy();require(["io.ox/tasks/view-detail","io.ox/tasks/api"],function(a,s){var i=s.reduce(t.item);s.get(i).done(function(t){e.idle().append(a.draw(t))})})}}),t.point("io.ox/portal/widget/tasks/settings").extend({title:a("My tasks"),type:"tasks",editable:!1,unique:!0})});