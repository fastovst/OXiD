!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.Env"),a={getSeparatorHtml:function(e){return e.getParam("pagebreak_separator","\x3c!-- pagebreak --\x3e")},shouldSplitBlock:function(e){return e.getParam("pagebreak_split_block",!1)}},r=function(){return"mce-pagebreak"},n=function(){return'<img src="'+t.transparentSrc+'" class="mce-pagebreak" data-mce-resize="false" data-mce-placeholder />'},o={setup:function(e){var t=a.getSeparatorHtml(e),r=new RegExp(t.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(e){return"\\"+e}),"gi");e.on("BeforeSetContent",function(e){e.content=e.content.replace(r,n())}),e.on("PreInit",function(){e.serializer.addNodeFilter("img",function(r){for(var n,o,c=r.length;c--;)if(n=r[c],(o=n.attr("class"))&&-1!==o.indexOf("mce-pagebreak")){var i=n.parent;if(e.schema.getBlockElements()[i.name]&&a.shouldSplitBlock(e)){i.type=3,i.value=t,i.raw=!0,n.remove();continue}n.type=3,n.value=t,n.raw=!0}})})},getPlaceholderHtml:n,getPageBreakClass:r},c={register:function(e){e.addCommand("mcePageBreak",function(){e.settings.pagebreak_split_block?e.insertContent("<p>"+o.getPlaceholderHtml()+"</p>"):e.insertContent(o.getPlaceholderHtml())})}},i={setup:function(e){e.on("ResolveName",function(t){"IMG"===t.target.nodeName&&e.dom.hasClass(t.target,o.getPageBreakClass())&&(t.name="pagebreak")})}},l={register:function(e){e.addButton("pagebreak",{title:"Page break",cmd:"mcePageBreak"}),e.addMenuItem("pagebreak",{text:"Page break",icon:"pagebreak",cmd:"mcePageBreak",context:"insert"})}};e.add("pagebreak",function(e){c.register(e),l.register(e),o.setup(e),i.setup(e)})}();