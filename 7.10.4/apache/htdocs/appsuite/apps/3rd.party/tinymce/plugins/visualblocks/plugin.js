!function(){"use strict";var e=function(t){var o=t,n=function(){return o};return{get:n,set:function(e){o=e},clone:function(){return e(n())}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager"),o={fireVisualBlocks:function(e,t){e.fire("VisualBlocks",{state:t})}},n={isEnabledByDefault:function(e){return e.getParam("visualblocks_default_state",!1)},getContentCss:function(e){return e.settings.visualblocks_content_css}},s=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),l=s.DOM.uniqueId(),c={load:function(e,t){var o=i.toArray(e.getElementsByTagName("link"));if(0===i.grep(o,function(e){return e.id===l}).length){var n=s.DOM.create("link",{id:l,rel:"stylesheet",href:t});e.getElementsByTagName("head")[0].appendChild(n)}}},a={toggleVisualBlocks:function(e,t,s){var i=e.dom,l=n.getContentCss(e);c.load(e.getDoc(),l||t+"/css/visualblocks.css"),i.toggleClass(e.getBody(),"mce-visualblocks"),s.set(!s.get()),o.fireVisualBlocks(e,s.get())}},u={register:function(e,t,o){e.addCommand("mceVisualBlocks",function(){a.toggleVisualBlocks(e,t,o)})}},r={setup:function(e,t,o){e.on("PreviewFormats AfterPreviewFormats",function(t){o.get()&&e.dom.toggleClass(e.getBody(),"mce-visualblocks","afterpreviewformats"===t.type)}),e.on("init",function(){n.isEnabledByDefault(e)&&a.toggleVisualBlocks(e,t,o)}),e.on("remove",function(){e.dom.removeClass(e.getBody(),"mce-visualblocks")})}},g=function(e,t){return function(o){var n=o.control;n.active(t.get()),e.on("VisualBlocks",function(e){n.active(e.state)})}},f={register:function(e,t){e.addButton("visualblocks",{active:!1,title:"Show blocks",cmd:"mceVisualBlocks",onPostRender:g(e,t)}),e.addMenuItem("visualblocks",{text:"Show blocks",cmd:"mceVisualBlocks",onPostRender:g(e,t),selectable:!0,context:"view",prependToContext:!0})}};t.add("visualblocks",function(t,o){var n=e(!1);u.register(t,o,n),f.register(t,n),r.setup(t,o,n)})}();