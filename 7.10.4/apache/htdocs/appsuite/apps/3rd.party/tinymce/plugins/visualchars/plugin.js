!function(n){"use strict";var e=function(n){var t=n,r=function(){return t};return{get:r,set:function(n){t=n},clone:function(){return e(r())}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager"),r={get:function(n){return{isEnabled:function(){return n.get()}}}},o={fireVisualChars:function(n,e){return n.fire("VisualChars",{state:e})}},i={" ":"nbsp","­":"shy"},u=function(n,e){var t,r="";for(t in n)r+=t;return new RegExp("["+r+"]",e?"g":"")},a=function(n){var e,t="";for(e in n)t&&(t+=","),t+="span.mce-"+n[e];return t},c={charMap:i,regExp:u(i),regExpGlobal:u(i,!0),selector:a(i),charMapToRegExp:u,charMapToSelector:a},f=function(n){return function(){return n}},s=f(!1),l=f(!0),d=function(){return m},m=function(){var n=function(n){return n.isNone()},e=function(n){return n()},t=function(n){return n},r={fold:function(n,e){return n()},is:s,isSome:s,isNone:l,getOr:t,getOrThunk:e,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:t,orThunk:e,map:d,ap:d,each:function(){},bind:d,flatten:d,exists:s,forall:l,filter:d,equals:n,equals_:n,toArray:function(){return[]},toString:f("none()")};return Object.freeze&&Object.freeze(r),r}(),g=function(n){var e=function(){return n},t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:l,isNone:s,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return g(e(n))},ap:function(e){return e.fold(d,function(e){return g(e(n))})},each:function(e){e(n)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(n)?o:m},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(s,function(e){return t(n,e)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},h={some:g,none:d,from:function(n){return null===n||void 0===n?m:g(n)}},N=function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e},p=function(n){return function(e){return N(e)===n}}("function"),v=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o,n)}return r},E=function(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t,n)},T=Array.prototype.slice,O=(p(Array.from)&&Array.from,function(n){if(null===n||void 0===n)throw new Error("Node cannot be null or undefined");return{dom:f(n)}}),y={fromHtml:function(e,t){var r=(t||n.document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||r.childNodes.length>1)throw n.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return O(r.childNodes[0])},fromTag:function(e,t){var r=(t||n.document).createElement(e);return O(r)},fromText:function(e,t){var r=(t||n.document).createTextNode(e);return O(r)},fromDom:O,fromPoint:function(n,e,t){var r=n.dom();return h.from(r.elementFromPoint(e,t)).map(O)}},D=(n.Node.ATTRIBUTE_NODE,n.Node.CDATA_SECTION_NODE,n.Node.COMMENT_NODE,n.Node.DOCUMENT_NODE,n.Node.DOCUMENT_TYPE_NODE,n.Node.DOCUMENT_FRAGMENT_NODE,n.Node.ELEMENT_NODE,n.Node.TEXT_NODE),C=(n.Node.PROCESSING_INSTRUCTION_NODE,n.Node.ENTITY_REFERENCE_NODE,n.Node.ENTITY_NODE,n.Node.NOTATION_NODE,function(n){return n.dom().nodeType}),_=function(n){return n.dom().nodeValue},b=function(n){return function(e){return C(e)===n}}(D),w={wrapCharWithSpan:function(n){return'<span data-mce-bogus="1" class="mce-'+c.charMap[n]+'">'+n+"</span>"}},M=function(n,e){var t=[],r=n.dom(),o=v(r.childNodes,y.fromDom);return E(o,function(n){e(n)&&(t=t.concat([n])),t=t.concat(M(n,e))}),t},S={isMatch:function(n){return b(n)&&void 0!==_(n)&&c.regExp.test(_(n))},filterDescendants:M,findParentElm:function(n,e){for(;n.parentNode;){if(n.parentNode===e)return n;n=n.parentNode}},replaceWithSpans:function(n){return n.replace(c.regExpGlobal,w.wrapCharWithSpan)}},k=function(n,e){var t,r,o=S.filterDescendants(y.fromDom(e),S.isMatch);E(o,function(e){var o=S.replaceWithSpans(_(e));for(r=n.dom.create("div",null,o);t=r.lastChild;)n.dom.insertAfter(t,e.dom());n.dom.remove(e.dom())})},x=function(n,e){var t=n.dom.select(c.selector,e);E(t,function(e){n.dom.remove(e,1)})},A={show:k,hide:x,toggle:function(n){var e=n.getBody(),t=n.selection.getBookmark(),r=S.findParentElm(n.selection.getNode(),e);x(n,r=void 0!==r?r:e),k(n,r),n.selection.moveToBookmark(t)}},P={toggleVisualChars:function(n,e){var t,r=n.getBody(),i=n.selection;e.set(!e.get()),o.fireVisualChars(n,e.get()),t=i.getBookmark(),!0===e.get()?A.show(n,r):A.hide(n,r),i.moveToBookmark(t)}},V={register:function(n,e){n.addCommand("mceVisualChars",function(){P.toggleVisualChars(n,e)})}},B=tinymce.util.Tools.resolve("tinymce.util.Delay"),R={setup:function(n,e){var t=B.debounce(function(){A.toggle(n)},300);!1!==n.settings.forced_root_block&&n.on("keydown",function(r){!0===e.get()&&(13===r.keyCode?A.toggle(n):t())})}},I={isEnabledByDefault:function(n){return n.getParam("visualchars_default_state",!1)}},U={setup:function(n,e){n.on("init",function(){var t=!I.isEnabledByDefault(n);e.set(t),P.toggleVisualChars(n,e)})}},j=function(n){return function(e){var t=e.control;n.on("VisualChars",function(n){t.active(n.state)})}},q=function(n){n.addButton("visualchars",{active:!1,title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:j(n)}),n.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:j(n),selectable:!0,context:"view",prependToContext:!0})};t.add("visualchars",function(n){var t=e(!1);return V.register(n,t),q(n),R.setup(n,t),U.setup(n,t),r.get(t)})}(window);