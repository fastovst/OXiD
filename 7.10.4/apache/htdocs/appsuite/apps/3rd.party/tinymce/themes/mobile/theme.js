!function(n){"use strict";function e(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=e.concat(t);return n.apply(null,o)}}function t(n,e,t,r,o){return n(t,r)?Q.some(t):P(o)&&o(t)?Q.none():e(t,r,o)}function r(n,e){var t=function(t){var r=e(t);if(r<=0||null===r){var o=Qu(t,n);return parseFloat(o)||0}return r},r=function(n,e){return jn(e,function(e,t){var r=Qu(n,t),o=void 0===r?0:parseInt(r,10);return isNaN(o)?e:e+o},0)};return{set:function(e,t){if(!U(t)&&!t.match(/^[0-9]+$/))throw new Error(n+".set accepts only positive integer values. Value was "+t);var r=e.dom();qu(r)&&(r.style[n]=t+"px")},get:t,getOuter:t,aggregate:r,max:function(n,e,t){var o=r(n,t);return e>o?e-o:0}}}function o(n){return void 0!==n.uid}function i(e,t){return c(n.document.createElement("canvas"),e,t)}function u(n){return n.getContext("2d")}function c(n,e,t){return n.width=e,n.height=t,n}function a(n,e){return new(tt.getOrDie("Blob"))(n,e)}function f(){return new(tt.getOrDie("FileReader"))}function s(n){return new(tt.getOrDie("Uint8Array"))(n)}function l(e){return new Ql(function(t,r){function o(){a(),t(c)}function i(){a(),r("Unable to load data of type "+e.type+": "+u)}var u=n.URL.createObjectURL(e),c=new n.Image,a=function(){c.removeEventListener("load",o),c.removeEventListener("error",i)};c.addEventListener("load",o),c.addEventListener("error",i),c.src=u,c.complete&&o()})}function d(e){return new Ql(function(t,r){var o=new n.XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=function(){200==this.status&&t(this.response)},o.onerror=function(){var n=this;r(0===this.status?function(){var n=new Error("No access to download image");return n.code=18,n.name="SecurityError",n}():new Error("Error "+n.status+" downloading image"))},o.send()})}function m(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return Q.none();for(var r=t[1],o=e[1],i=Zl.atob(o),u=i.length,c=Math.ceil(u/1024),f=new Array(c),l=0;l<c;++l){for(var d=1024*l,m=Math.min(d+1024,u),g=new Array(m-d),v=d,p=0;v<m;++p,++v)g[p]=i[v].charCodeAt(0);f[l]=s(g)}return Q.some(a(f,{type:r}))}function g(n){return new Ql(function(e,t){m(n).fold(function(){t("uri is not base64: "+n)},e)})}function v(n){return new Ql(function(e){var t=f();t.onloadend=function(){e(t.result)},t.readAsDataURL(n)})}function p(e){n.URL.revokeObjectURL(e.src)}function h(e,t){var r=null;return{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},schedule:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];r=n.setTimeout(function(){e.apply(null,o),r=null},t)}}}function b(){var n=function(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:Ws('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:fi([xd("adhoc-scrollable-toolbar",!0===n.scrollable?[Vo(function(n,e){Xu(n.element(),"overflow-x","auto"),yh.markAsHorizontal(n.element()),Wg.register(n.element())})]:[])]),components:[kd.sketch({components:[dh.parts().items({})]})],markers:{itemClass:Lu.resolve("toolbar-group-item")},items:n.items}},e=ig(fh.sketch({dom:Ws('<div class="${prefix}-toolbar"></div>'),components:[fh.parts().groups({})],toolbarBehaviours:fi([zu.config({toggleClass:Lu.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),Tf.config({mode:"cyclic"})]),shell:!0})),t=ig(kd.sketch({dom:{classes:[Lu.resolve("toolstrip")]},components:[ug(e)],containerBehaviours:fi([zu.config({toggleClass:Lu.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),r=function(){fh.setGroups(e,o.get()),zu.off(e)},o=Hi([]);return{wrapper:D(t),toolbar:D(e),createGroups:function(e){return Fn(e,E(dh.sketch,n))},setGroups:function(n){o.set(n),r()},setContextToolbar:function(n){zu.on(e),fh.setGroups(e,n)},restoreToolbar:function(){zu.isOn(e)&&r()},refresh:function(){},focus:function(){Tf.focusIn(e)}}}function y(){var n={},e=function(n,e){return Es(e).fold(function(){return Q.none()},function(t){var r=fr(t);return n.bind(r).map(function(n){return rb(e,n)})})};return{registerId:function(e,t,r){nn(r,function(r,o){var i=void 0!==n[o]?n[o]:{};i[t]=Dm(r,e),n[o]=i})},unregisterId:function(e){nn(n,function(n,t){n.hasOwnProperty(e)&&delete n[e]})},filterByType:function(e){return lr(n,e).map(function(n){return rn(n,function(n,e){return ob(e,n)})}).getOr([])},find:function(t,r,o){var i=fr(r)(n);return tb(o,function(n){return e(i,n)},t)}}}function w(){var n=y(),e={},t=function(n){var e=n.element();return Es(e).fold(function(){return ks("uid-",n.element())},function(n){return n})},r=function(n,t){var r=e[t];if(r!==n)throw new Error('The tagId "'+t+'" is already used by: '+ou(r.element())+"\nCannot use it for: "+ou(n.element())+"\nThe conflicting element is"+(Pe(r.element())?" ":" not ")+"already in the DOM");o(n)},o=function(t){Es(t.element()).each(function(t){e[t]=void 0,n.unregisterId(t)})};return{find:function(e,t,r){return n.find(e,t,r)},filter:function(e){return n.filterByType(e)},register:function(o){var i=t(o);vr(e,i)&&r(o,i);var u=[o];n.registerId(u,i,o.events()),e[i]=o},unregister:o,getById:function(n){return fr(n)(e)}}}function x(n){var e=ig(kd.sketch({dom:{classes:[Lu.resolve("outer-container")].concat(n.classes)},containerBehaviours:fi([Vi.config({alpha:ub(),omega:cb()})])}));return ib(e)}function S(n){var e=x({classes:[Lu.resolve("android-container")]}),t=b(),r=rm(),o=Sh.makeEditSwitch(r),i=Sh.makeSocket(),u=jh(C,n);e.add(t.wrapper()),e.add(i),e.add(u.component());return{system:D(e),element:e.element,init:function(n){r.set(uh.produce(n))},exit:function(){r.run(function(n){n.exit(),Tg.remove(i,o)})},setToolbarGroups:function(n){var e=t.createGroups(n);t.setGroups(e)},setContextToolbar:function(n){var e=t.createGroups(n);t.setContextToolbar(e)},focusToolbar:function(){t.focus()},restoreToolbar:function(){t.restoreToolbar()},updateMode:function(n){Sh.updateMode(i,o,n,e.root())},socket:D(i),dropup:D(u)}}function T(n,e){var t=n.document,r=Ae.fromTag("div");Di(r,Lu.resolve("unfocused-selections")),kt(Ae.fromDom(t.documentElement),r);var o=mv(r,"touchstart",function(t){t.prevent(),sb.resume(n,e),u()}),i=function(n){var e=Ae.fromTag("span");return Wm(e,[Lu.resolve("layer-editor"),Lu.resolve("unfocused-selection")]),Ju(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e},u=function(){Et(r)};return{update:function(){u();var e=Bp.getRectangles(n),t=Fn(e,i);Ct(r,t)},isActive:function(){return yt(r).length>0},destroy:function(){o.unbind(),Dt(r)},clear:u}}function O(n){var e=Hi(gb.pure({}));return{start:function(t){var r=gb.nu(function(e){return n(t).get(e)});e.set(r)},idle:function(n){e.get().get(function(){n()})}}}function k(n){var e=x({classes:[Lu.resolve("ios-container")]}),t=b(),r=rm(),o=Sh.makeEditSwitch(r),i=Sh.makeSocket(),u=jh(function(){r.run(function(n){n.refreshStructure()})},n);e.add(t.wrapper()),e.add(i),e.add(u.component());return{system:D(e),element:e.element,init:function(n){r.set(ry.produce(n))},exit:function(){r.run(function(n){Tg.remove(i,o),n.exit()})},setToolbarGroups:function(n){var e=t.createGroups(n);t.setGroups(e)},setContextToolbar:function(n){var e=t.createGroups(n);t.setContextToolbar(e)},focusToolbar:function(){t.focus()},restoreToolbar:function(){t.restoreToolbar()},updateMode:function(n){Sh.updateMode(i,o,n,e.root())},socket:D(i),dropup:D(u)}}var C=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]},E=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n(e.apply(null,t))}},D=function(n){return function(){return n}},B=function(n){return n},I=function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!n.apply(null,e)}},M=function(n){return function(){throw new Error(n)}},A=function(n){return n()},R=D(!1),F=D(!0),N=function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e},V=function(n){return function(e){return N(e)===n}},H=V("string"),z=V("object"),j=V("array"),L=V("boolean"),P=V("function"),U=V("number"),W=Object.prototype.hasOwnProperty,G=function(n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<e.length;o++){var i=e[o];for(var u in i)W.call(i,u)&&(r[u]=n(r[u],i[u]))}return r}},$=G(function(n,e){return z(n)&&z(e)?$(n,e):e}),_=G(function(n,e){return e}),q=R,Y=F,K=function(){return X},X=function(){var n=function(n){return n.isNone()},e=function(n){return n()},t=function(n){return n},r={fold:function(n,e){return n()},is:q,isSome:q,isNone:Y,getOr:t,getOrThunk:e,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:t,orThunk:e,map:K,ap:K,each:function(){},bind:K,flatten:K,exists:q,forall:Y,filter:K,equals:n,equals_:n,toArray:function(){return[]},toString:D("none()")};return Object.freeze&&Object.freeze(r),r}(),J=function(n){var e=function(){return n},t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:Y,isNone:q,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return J(e(n))},ap:function(e){return e.fold(K,function(e){return J(e(n))})},each:function(e){e(n)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(n)?o:X},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(q,function(e){return t(n,e)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},Q={some:J,none:K,from:function(n){return null===n||void 0===n?X:J(n)}},Z=Object.keys,nn=function(n,e){for(var t=Z(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i,n)}},en=function(n,e){return tn(n,function(n,t,r){return{k:t,v:e(n,t,r)}})},tn=function(n,e){var t={};return nn(n,function(r,o){var i=e(r,o,n);t[i.k]=i.v}),t},rn=function(n,e){var t=[];return nn(n,function(n,r){t.push(e(n,r))}),t},on=D("touchstart"),un=D("touchmove"),cn=D("touchend"),an=D("mousedown"),fn=D("mousemove"),sn=D("mouseup"),ln=D("mouseover"),dn=D("keydown"),mn=D("input"),gn=D("change"),vn=D("click"),pn=D("transitionend"),hn=D("selectstart"),bn=function(n){var e,t=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return t||(t=!0,e=n.apply(null,r)),e}},yn=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}},wn=function(n,e){var t=yn(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return Sn(r(1),r(2))},xn=function(){return Sn(0,0)},Sn=function(n,e){return{major:n,minor:e}},Tn={nu:Sn,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?xn():wn(n,t)},unknown:xn},On=function(n,e){return function(){return e===n}},kn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:On("Edge",e),isChrome:On("Chrome",e),isIE:On("IE",e),isOpera:On("Opera",e),isFirefox:On("Firefox",e),isSafari:On("Safari",e)}},Cn={unknown:function(){return kn({current:void 0,version:Tn.unknown()})},nu:kn,edge:D("Edge"),chrome:D("Chrome"),ie:D("IE"),opera:D("Opera"),firefox:D("Firefox"),safari:D("Safari")},En=function(n,e){return function(){return e===n}},Dn=function(n){var e=n.current;return{current:e,version:n.version,isWindows:En("Windows",e),isiOS:En("iOS",e),isAndroid:En("Android",e),isOSX:En("OSX",e),isLinux:En("Linux",e),isSolaris:En("Solaris",e),isFreeBSD:En("FreeBSD",e)}},Bn={unknown:function(){return Dn({current:void 0,version:Tn.unknown()})},nu:Dn,windows:D("Windows"),ios:D("iOS"),android:D("Android"),linux:D("Linux"),osx:D("OSX"),solaris:D("Solaris"),freebsd:D("FreeBSD")},In=function(n,e,t){var r=n.isiOS()&&!0===/ipad/i.test(t),o=n.isiOS()&&!r,i=n.isAndroid()&&3===n.version.major,u=n.isAndroid()&&4===n.version.major,c=r||i||u&&!0===/mobile/i.test(t),a=n.isiOS()||n.isAndroid(),f=a&&!c,s=e.isSafari()&&n.isiOS()&&!1===/safari/i.test(t);return{isiPad:D(r),isiPhone:D(o),isTablet:D(c),isPhone:D(f),isTouch:D(a),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:D(s)}},Mn=function(){var n=Array.prototype.indexOf;return void 0===n?function(n,e){return Un(n,e)}:function(e,t){return n.call(e,t)}}(),An=function(n,e){return Mn(n,e)>-1},Rn=function(n,e){return Pn(n,e).isSome()},Fn=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o,n)}return r},Nn=function(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t,n)},Vn=function(n,e){for(var t=n.length-1;t>=0;t--)e(n[t],t,n)},Hn=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r,n)&&t.push(i)}return t},zn=function(n,e,t){return Vn(n,function(n){t=e(t,n)}),t},jn=function(n,e,t){return Nn(n,function(n){t=e(t,n)}),t},Ln=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t,n))return Q.some(o)}return Q.none()},Pn=function(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t],t,n))return Q.some(t);return Q.none()},Un=function(n,e){for(var t=0,r=n.length;t<r;++t)if(n[t]===e)return t;return-1},Wn=Array.prototype.push,Gn=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!Array.prototype.isPrototypeOf(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);Wn.apply(e,n[t])}return e},$n=function(n,e){var t=Fn(n,e);return Gn(t)},_n=function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t,n))return!1;return!0},qn=Array.prototype.slice,Yn=function(n){var e=qn.call(n,0);return e.reverse(),e},Kn=function(n,e){return Hn(n,function(n){return!An(e,n)})},Xn=function(n){return[n]},Jn=(P(Array.from)&&Array.from,function(n,e){var t=String(e).toLowerCase();return Ln(n,function(n){return n.search(t)})}),Qn={detectBrowser:function(n,e){return Jn(n,e).map(function(n){var t=Tn.detect(n.versionRegexes,e);return{current:n.name,version:t}})},detectOs:function(n,e){return Jn(n,e).map(function(n){var t=Tn.detect(n.versionRegexes,e);return{current:n.name,version:t}})}},Zn=function(n,e,t){return""===e||!(n.length<e.length)&&n.substr(t,t+e.length)===e},ne=function(n,e){var t=function(n){var e=typeof n;return"string"===e||"number"===e};return n.replace(/\$\{([^{}]*)\}/g,function(n,r){var o=e[r];return t(o)?o.toString():n})},ee=function(n,e){return-1!==n.indexOf(e)},te=function(n,e){return Zn(n,e,n.length-e.length)},re=function(n){return n.replace(/^\s+|\s+$/g,"")},oe=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,ie=function(n){return function(e){return ee(e,n)}},ue=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return ee(n,"edge/")&&ee(n,"chrome")&&ee(n,"safari")&&ee(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,oe],search:function(n){return ee(n,"chrome")&&!ee(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return ee(n,"msie")||ee(n,"trident")}},{name:"Opera",versionRegexes:[oe,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:ie("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:ie("firefox")},{name:"Safari",versionRegexes:[oe,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(ee(n,"safari")||ee(n,"mobile/"))&&ee(n,"applewebkit")}}],ce=[{name:"Windows",search:ie("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return ee(n,"iphone")||ee(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:ie("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:ie("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:ie("linux"),versionRegexes:[]},{name:"Solaris",search:ie("sunos"),versionRegexes:[]},{name:"FreeBSD",search:ie("freebsd"),versionRegexes:[]}],ae={browsers:D(ue),oses:D(ce)},fe={detect:function(n){var e=ae.browsers(),t=ae.oses(),r=Qn.detectBrowser(e,n).fold(Cn.unknown,Cn.nu),o=Qn.detectOs(t,n).fold(Bn.unknown,Bn.nu);return{browser:r,os:o,deviceType:In(o,r,n)}}},se={detect:bn(function(){var e=n.navigator.userAgent;return fe.detect(e)})},le={tap:D("alloy.tap")},de=D("alloy.focus"),me=D("alloy.blur.post"),ge=D("alloy.receive"),ve=D("alloy.execute"),pe=D("alloy.focus.item"),he=le.tap,be=se.detect().deviceType.isTouch()?le.tap:vn,ye=D("alloy.longpress"),we=D("alloy.system.init"),xe=D("alloy.system.scroll"),Se=D("alloy.system.attached"),Te=D("alloy.system.detached"),Oe=function(n,e){De(n,n.element(),e,{})},ke=function(n,e,t){De(n,n.element(),e,t)},Ce=function(n){Oe(n,ve())},Ee=function(n,e,t){De(n,e,t,{})},De=function(n,e,t,r){var o=$({target:e},r);n.getSystem().triggerEvent(t,e,en(o,D))},Be=function(n,e,t,r){n.getSystem().triggerEvent(t,e,r.event())},Ie=function(n,e){n.getSystem().triggerFocus(e,n.element())},Me=function(n){if(null===n||void 0===n)throw new Error("Node cannot be null or undefined");return{dom:D(n)}},Ae={fromHtml:function(e,t){var r=(t||n.document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||r.childNodes.length>1)throw n.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return Me(r.childNodes[0])},fromTag:function(e,t){var r=(t||n.document).createElement(e);return Me(r)},fromText:function(e,t){var r=(t||n.document).createTextNode(e);return Me(r)},fromDom:Me,fromPoint:function(n,e,t){var r=n.dom();return Q.from(r.elementFromPoint(e,t)).map(Me)}},Re=(n.Node.ATTRIBUTE_NODE,n.Node.CDATA_SECTION_NODE,n.Node.COMMENT_NODE,n.Node.DOCUMENT_NODE),Fe=(n.Node.DOCUMENT_TYPE_NODE,n.Node.DOCUMENT_FRAGMENT_NODE,n.Node.ELEMENT_NODE),Ne=n.Node.TEXT_NODE,Ve=(n.Node.PROCESSING_INSTRUCTION_NODE,n.Node.ENTITY_REFERENCE_NODE,n.Node.ENTITY_NODE,n.Node.NOTATION_NODE,function(n){return n.dom().nodeName.toLowerCase()}),He=function(n){return n.dom().nodeType},ze=function(n){return function(e){return He(e)===n}},je=ze(Fe),Le=ze(Ne),Pe=function(n){var e=Le(n)?n.dom().parentNode:n.dom();return void 0!==e&&null!==e&&e.ownerDocument.body.contains(e)},Ue=bn(function(){return We(Ae.fromDom(n.document))}),We=function(n){var e=n.dom().body;if(null===e||void 0===e)throw new Error("Body is not available yet");return Ae.fromDom(e)},Ge=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(n.length!==e.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+e.length+" arguments");var r={};return Nn(n,function(n,t){r[n]=D(e[t])}),r}},$e=function(n){return n.slice(0).sort()},_e=function(n,e){throw new Error("All required keys ("+$e(n).join(", ")+") were not specified. Specified keys were: "+$e(e).join(", ")+".")},qe=function(n){throw new Error("Unsupported keys for object: "+$e(n).join(", "))},Ye=function(n,e){if(!j(e))throw new Error("The "+n+" fields must be an array. Was: "+e+".");Nn(e,function(e){if(!H(e))throw new Error("The value "+e+" in the "+n+" fields was not a string.")})},Ke=function(n,e){throw new Error("All values need to be of type: "+e+". Keys ("+$e(n).join(", ")+") were not.")},Xe=function(n){var e=$e(n);Ln(e,function(n,t){return t<e.length-1&&n===e[t+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+e.join(", ")+"].")})},Je=function(n,e){var t=n.concat(e);if(0===t.length)throw new Error("You must specify at least one required or optional field.");return Ye("required",n),Ye("optional",e),Xe(t),function(r){var o=Z(r);_n(n,function(n){return An(o,n)})||_e(n,o);var i=Hn(o,function(n){return!An(t,n)});i.length>0&&qe(i);var u={};return Nn(n,function(n){u[n]=D(r[n])}),Nn(e,function(n){u[n]=D(Object.prototype.hasOwnProperty.call(r,n)?Q.some(r[n]):Q.none())}),u}},Qe=void 0!==n.window?n.window:Function("return this;")(),Ze=function(n,e){for(var t=void 0!==e&&null!==e?e:Qe,r=0;r<n.length&&void 0!==t&&null!==t;++r)t=t[n[r]];return t},nt=function(n,e){var t=n.split(".");return Ze(t,e)},et=function(n,e){return nt(n,e)},tt={getOrDie:function(n,e){var t=et(n,e);if(void 0===t||null===t)throw n+" not available on this browser";return t}},rt=function(){return tt.getOrDie("Node")},ot=function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)},it={documentPositionPreceding:function(n,e){return ot(n,e,rt().DOCUMENT_POSITION_PRECEDING)},documentPositionContainedBy:function(n,e){return ot(n,e,rt().DOCUMENT_POSITION_CONTAINED_BY)}},ut=Fe,ct=Re,at=function(n,e){var t=n.dom();if(t.nodeType!==ut)return!1;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},ft=function(n){return n.nodeType!==ut&&n.nodeType!==ct||0===n.childElementCount},st=function(e,t){var r=void 0===t?n.document:t.dom();return ft(r)?[]:Fn(r.querySelectorAll(e),Ae.fromDom)},lt=function(e,t){var r=void 0===t?n.document:t.dom();return ft(r)?Q.none():Q.from(r.querySelector(e)).map(Ae.fromDom)},dt=function(n,e){return n.dom()===e.dom()},mt=(se.detect().browser.isIE(),function(n){return Ae.fromDom(n.dom().ownerDocument)}),gt=function(n){var e=n.dom().ownerDocument.defaultView;return Ae.fromDom(e)},vt=function(n){var e=n.dom();return Q.from(e.parentNode).map(Ae.fromDom)},pt=function(n,e){for(var t=P(e)?e:D(!1),r=n.dom(),o=[];null!==r.parentNode&&void 0!==r.parentNode;){var i=r.parentNode,u=Ae.fromDom(i);if(o.push(u),!0===t(u))break;r=i}return o},ht=function(n){return vt(n).map(yt).map(function(e){return Hn(e,function(e){return!dt(n,e)})}).getOr([])},bt=function(n){var e=n.dom();return Q.from(e.nextSibling).map(Ae.fromDom)},yt=function(n){var e=n.dom();return Fn(e.childNodes,Ae.fromDom)},wt=function(n,e){var t=n.dom().childNodes;return Q.from(t[e]).map(Ae.fromDom)},xt=function(n){return wt(n,0)},St=(Ge("element","offset"),function(n,e){vt(n).each(function(t){t.dom().insertBefore(e.dom(),n.dom())})}),Tt=function(n,e){bt(n).fold(function(){vt(n).each(function(n){kt(n,e)})},function(n){St(n,e)})},Ot=function(n,e){xt(n).fold(function(){kt(n,e)},function(t){n.dom().insertBefore(e.dom(),t.dom())})},kt=function(n,e){n.dom().appendChild(e.dom())},Ct=function(n,e){Nn(e,function(e){kt(n,e)})},Et=function(n){n.dom().textContent="",Nn(yt(n),function(n){Dt(n)})},Dt=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Bt=function(n){Oe(n,Te());var e=n.components();Nn(e,Bt)},It=function(n){var e=n.components();Nn(e,It),Oe(n,Se())},Mt=function(n,e){At(n,e,kt)},At=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),Pe(n.element())&&It(e),n.syncComponents()},Rt=function(n){Bt(n),Dt(n.element()),n.getSystem().removeFromWorld(n)},Ft=function(n){var e=vt(n.element()).bind(function(e){return n.getSystem().getByDom(e).fold(Q.none,Q.some)});Rt(n),e.each(function(n){n.syncComponents()})},Nt=function(n){var e=n.components();Nn(e,Rt),Et(n.element()),n.syncComponents()},Vt=function(n,e){kt(n,e.element());var t=yt(e.element());Nn(t,function(n){e.getByDom(n).each(It)})},Ht=function(n){var e=yt(n.element());Nn(e,function(e){n.getByDom(e).each(Bt)}),Dt(n.element())},zt=function(n){return{is:function(e){return n===e},isValue:F,isError:R,getOr:D(n),getOrThunk:D(n),getOrDie:D(n),or:function(e){return zt(n)},orThunk:function(e){return zt(n)},fold:function(e,t){return t(n)},map:function(e){return zt(e(n))},mapError:function(e){return zt(n)},each:function(e){e(n)},bind:function(e){return e(n)},exists:function(e){return e(n)},forall:function(e){return e(n)},toOption:function(){return Q.some(n)}}},jt=function(n){return{is:R,isValue:R,isError:F,getOr:B,getOrThunk:function(n){return n()},getOrDie:function(){return M(String(n))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(e,t){return e(n)},map:function(e){return jt(n)},mapError:function(e){return jt(e(n))},each:C,bind:function(e){return jt(n)},exists:R,forall:F,toOption:Q.none}},Lt={value:zt,error:jt},Pt={generate:function(e){if(!j(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");var t=[],r={};return Nn(e,function(o,i){var u=Z(o);if(1!==u.length)throw new Error("one and only one name per case");var c=u[0],a=o[c];if(void 0!==r[c])throw new Error("duplicate key detected:"+c);if("cata"===c)throw new Error("cannot have a case named cata (sorry)");if(!j(a))throw new Error("case arguments must be an array");t.push(c),r[c]=function(){var r=arguments.length;if(r!==a.length)throw new Error("Wrong number of arguments to case "+c+". Expected "+a.length+" ("+a+"), got "+r);for(var o=new Array(r),u=0;u<o.length;u++)o[u]=arguments[u];return{fold:function(){if(arguments.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+arguments.length);return arguments[i].apply(null,o)},match:function(n){var e=Z(n);if(t.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+e.join(","));if(!_n(t,function(n){return An(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+t.join(", "));return n[c].apply(null,o)},log:function(e){n.console.log(e,{constructors:t,constructor:c,params:o})}}}}),r}},Ut=Pt.generate([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),Wt=function(n){return Ut.defaultedThunk(D(n))},Gt=function(n){return Ut.mergeWithThunk(D(n))},$t=Ut.strict,_t=Ut.asOption,qt=Ut.defaultedThunk,Yt=Ut.mergeWithThunk,Kt=(Pt.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var e=[],t=[];return Nn(n,function(n){n.fold(function(n){e.push(n)},function(n){t.push(n)})}),{errors:e,values:t}}),Xt=function(n,e){return Lt.value($.apply(void 0,[e].concat(n)))},Jt=function(n){return E(Lt.error,Gn)(n)},Qt={consolidateObj:function(n,e){var t=Kt(n);return t.errors.length>0?Jt(t.errors):Xt(t.values,e)},consolidateArr:function(n){var e=Kt(n);return e.errors.length>0?Jt(e.errors):Lt.value(e.values)}},Zt=function(n,e){var t={};return Nn(e,function(e){void 0!==n[e]&&n.hasOwnProperty(e)&&(t[e]=n[e])}),t},nr=function(n,e){var t={};return nn(n,function(n,r){An(e,r)||(t[r]=n)}),t},er=function(n){return function(e){return e.hasOwnProperty(n)?Q.from(e[n]):Q.none()}},tr=function(n,e){return function(t){return er(n)(t).getOr(e)}},rr=function(n,e){return er(e)(n)},or=function(n,e){return n.hasOwnProperty(e)&&void 0!==n[e]&&null!==n[e]},ir=function(n,e){var t={};return t[n]=e,t},ur=function(n){var e={};return Nn(n,function(n){e[n.key]=n.value}),e},cr=function(n,e){return Zt(n,e)},ar=function(n,e){return nr(n,e)},fr=function(n){return er(n)},sr=function(n,e){return tr(n,e)},lr=function(n,e){return rr(n,e)},dr=function(n,e){return ir(n,e)},mr=function(n){return ur(n)},gr=function(n,e){return Qt.consolidateObj(n,e)},vr=function(n,e){return or(n,e)},pr=Pt.generate([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),hr=Pt.generate([{field:["name","presence","type"]},{state:["name"]}]),br=function(){return tt.getOrDie("JSON")},yr={parse:function(n){return br().parse(n)},stringify:function(n,e,t){return br().stringify(n,e,t)}},wr=function(n){return z(n)&&Z(n).length>100?" removed due to size":yr.stringify(n,null,2)},xr=function(n){var e=n.length>10?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n;return Fn(e,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()})},Sr=function(n,e){return Lt.error([{path:n,getErrorInfo:e}])},Tr=function(n,e,t){return Sr(n,function(){return'Could not find valid *strict* value for "'+e+'" in '+wr(t)})},Or=function(n,e){return Sr(n,function(){return'Choice schema did not contain choice key: "'+e+'"'})},kr=function(n,e,t){return Sr(n,function(){return'The chosen schema: "'+t+'" did not exist in branches: '+wr(e)})},Cr=function(n,e){return Sr(n,function(){return"There are unsupported fields: ["+e.join(", ")+"] specified"})},Er=function(n,e){return Sr(n,function(){return e})},Dr=Pt.generate([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Br=function(n,e,t){return rr(e,t).fold(function(){return Tr(n,t,e)},Lt.value)},Ir=function(n,e,t){var r=rr(n,e).fold(function(){return t(n)},B);return Lt.value(r)},Mr=function(n,e){return Lt.value(rr(n,e))},Ar=function(n,e,t){var r=rr(n,e).map(function(e){return!0===e?t(n):e});return Lt.value(r)},Rr=function(n,e,t,r){return t.fold(function(t,o,i,u){var c=function(e){return u.extract(n.concat([t]),r,e).map(function(n){return ir(o,r(n))})},a=function(e){return e.fold(function(){var n=ir(o,r(Q.none()));return Lt.value(n)},function(e){return u.extract(n.concat([t]),r,e).map(function(n){return ir(o,r(Q.some(n)))})})};return i.fold(function(){return Br(n,e,t).bind(c)},function(n){return Ir(e,t,n).bind(c)},function(){return Mr(e,t).bind(a)},function(n){return Ar(e,t,n).bind(a)},function(n){var r=n(e);return Ir(e,t,D({})).map(function(n){return $(r,n)}).bind(c)})},function(n,t){var o=t(e);return Lt.value(ir(n,r(o)))})},Fr=function(n,e,t,r){var o=Fn(t,function(t){return Rr(n,e,t,r)});return Qt.consolidateObj(o,{})},Nr=function(n){return{extract:function(e,t,r){return n(r,t).fold(function(n){return Er(e,n)},Lt.value)},toString:function(){return"val"},toDsl:function(){return pr.itemOf(n)}}},Vr=function(n){var e=Z(n);return Hn(e,function(e){return vr(n,e)})},Hr=function(n){var e=zr(n),t=zn(n,function(n,e){return e.fold(function(e){return $(n,dr(e,!0))},D(n))},{});return{extract:function(n,r,o){var i=L(o)?[]:Vr(o),u=Hn(i,function(n){return!vr(t,n)});return 0===u.length?e.extract(n,r,o):Cr(n,u)},toString:e.toString,toDsl:e.toDsl}},zr=function(n){return{extract:function(e,t,r){return Fr(e,r,n,t)},toString:function(){return"obj{\n"+Fn(n,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return pr.objOf(Fn(n,function(n){return n.fold(function(n,e,t,r){return hr.field(n,t,r)},function(n,e){return hr.state(n)})}))}}},jr=function(n){return{extract:function(e,t,r){var o=Fn(r,function(r,o){return n.extract(e.concat(["["+o+"]"]),t,r)});return Qt.consolidateArr(o)},toString:function(){return"array("+n.toString()+")"},toDsl:function(){return pr.arrOf(n)}}},Lr=function(n,e){var t=function(e,t){return jr(Nr(n)).extract(e,B,t)};return{extract:function(n,r,o){var i=Z(o);return t(n,i).bind(function(t){var i=Fn(t,function(n){return Dr.field(n,n,$t(),e)});return zr(i).extract(n,r,o)})},toString:function(){return"setOf("+e.toString()+")"},toDsl:function(){return pr.setOf(n,e)}}},Pr=D(Nr(Lt.value)),Ur=Dr.state,Wr=Dr.field,Gr=function(n,e,t,r,o){return lr(r,o).fold(function(){return kr(n,r,o)},function(r){return zr(r).extract(n.concat(["branch: "+o]),e,t)})},$r=function(n,e){return{extract:function(t,r,o){return lr(o,n).fold(function(){return Or(t,n)},function(n){return Gr(t,r,o,e,n)})},toString:function(){return"chooseOn("+n+"). Possible values: "+Z(e)},toDsl:function(){return pr.choiceOf(n,e)}}},_r=Nr(Lt.value),qr=function(n){return Nr(function(e){return n(e)})},Yr=function(n,e,t,r){return e.extract([n],t,r).fold(function(n){return Lt.error({input:r,errors:n})},Lt.value)},Kr=function(n,e,t){return Yr(n,e,D,t)},Xr=function(n,e,t){return Yr(n,e,B,t)},Jr=function(n){return n.fold(function(n){throw new Error(no(n))},B)},Qr=function(n,e,t){return Jr(Xr(n,e,t))},Zr=function(n,e,t){return Jr(Kr(n,e,t))},no=function(n){return"Errors: \n"+xr(n.errors)+"\n\nInput object: "+wr(n.input)},eo=function(n,e){return $r(n,e)},to=D(_r),ro=function(n,e){return Nr(function(t){var r=typeof t;return n(t)?Lt.value(t):Lt.error("Expected type: "+e+" but got: "+r)})}(P,"function"),oo=function(n){return Wr(n,n,$t(),Pr())},io=function(n,e){return Wr(n,n,$t(),e)},uo=function(n){return io(n,ro)},co=function(n,e){return Wr(n,n,_t(),Nr(function(t){return Lt.error("The field: "+n+" is forbidden. "+e)}))},ao=function(n,e){return Wr(n,n,$t(),zr(e))},fo=function(n){return Wr(n,n,_t(),Pr())},so=function(n,e){return Wr(n,n,_t(),e)},lo=function(n,e){return Wr(n,n,_t(),zr(e))},mo=function(n,e){return Wr(n,n,_t(),Hr(e))},go=function(n,e){return Wr(n,n,Wt(e),Pr())},vo=function(n,e,t){return Wr(n,n,Wt(e),t)},po=function(n,e,t){return Wr(n,n,Wt(e),zr(t))},ho=function(n,e){return Ur(n,e)},bo=function(n,e){return dt(n.element(),e.event().target())},yo=function(n){if(!vr(n,"can")&&!vr(n,"abort")&&!vr(n,"run"))throw new Error("EventHandler defined by: "+yr.stringify(n,null,2)+" does not have can, abort, or run!");return Qr("Extracting event.handler",Hr([go("can",D(!0)),go("abort",D(!1)),go("run",C)]),n)},wo=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return jn(n,function(n,r){return n&&e(r).apply(void 0,t)},!0)}},xo=function(n,e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return jn(n,function(n,r){return n||e(r).apply(void 0,t)},!1)}},So=function(n){return P(n)?{can:D(!0),abort:D(!1),run:n}:n},To=function(n){var e=wo(n,function(n){return n.can}),t=xo(n,function(n){return n.abort});return yo({can:e,abort:t,run:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Nn(n,function(n){n.run.apply(void 0,e)})}})},Oo=function(n){return mr(n)},ko=function(n,e){return{key:n,value:yo({abort:e})}},Co=function(n,e){return{key:n,value:yo({run:e})}},Eo=function(n,e,t){return{key:n,value:yo({run:function(n){e.apply(void 0,[n].concat(t))}})}},Do=function(n){return function(e){return{key:n,value:yo({run:function(n,t){bo(n,t)&&e(n,t)}})}}},Bo=function(n,e){return Co(n,function(t,r){t.getSystem().getByUid(e).each(function(e){Be(e,e.element(),n,r)})})},Io=function(n,e,t){var r=e.partUids()[t];return Bo(n,r)},Mo=function(n,e){return Co(n,function(n,t){var r=t.event();n.getSystem().getByDom(r.target()).each(function(r){e(n,r,t)})})},Ao=function(n){return Co(n,function(n,e){e.cut()})},Ro=function(n){return Co(n,function(n,e){e.stop()})},Fo=Do(Se()),No=Do(Te()),Vo=Do(we()),Ho=function(n){return function(e){return Co(n,e)}}(ve()),zo=function(n,e,t){var r=t.toString(),o=r.indexOf(")")+1,i=r.indexOf("("),u=r.substring(i+1,o-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:jo(u.slice(0,1).concat(u.slice(3)))}},n},jo=function(n){return Fn(n,function(n){return te(n,"/*")?n.substring(0,n.length-"/*".length):n})},Lo=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:jo(i)}},n},Po=function(n,e){var t=e.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:jo(i.slice(1))}},n},Uo=Je(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),Wo=function(n){var e=Go(n);return yr.stringify(e,null,2)},Go=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().fold(function(){return"<none>"},function(n){return yr.stringify(n,null,2)}),domChildren:n.domChildren().fold(function(){return"<none>"},function(n){return 0===n.length?"0 children, but still specified":String(n.length)})}},$o=Je([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),_o=function(n,e,t){return e.fold(function(){return t.fold(function(){return{}},function(e){return dr(n,e)})},function(e){return t.fold(function(){return dr(n,e)},function(e){return dr(n,e)})})},qo=function(n,e){var t=$({tag:n.tag(),classes:e.classes().getOr([]).concat(n.classes().getOr([])),attributes:_(n.attributes().getOr({}),e.attributes().getOr({})),styles:_(n.styles().getOr({}),e.styles().getOr({}))},e.innerHtml().or(n.innerHtml()).map(function(n){return dr("innerHtml",n)}).getOr({}),_o("domChildren",e.domChildren(),n.domChildren()),_o("defChildren",e.defChildren(),n.defChildren()),e.value().or(n.value()).map(function(n){return dr("value",n)}).getOr({}));return Uo(t)},Yo=function(n,e,t){return Ho(function(r){t(r,n,e)})},Ko=function(n,e,t){return Vo(function(r,o){t(r,n,e)})},Xo=function(n,e,t,r,o,i){var u=Hr(n),c=lo(e,[mo("config",n)]);return ni(u,c,e,t,r,o,i)},Jo=function(n,e,t,r,o,i){var u=n,c=lo(e,[so("config",n)]);return ni(u,c,e,t,r,o,i)},Qo=function(n,e,t){return zo(function(r){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var u=[r].concat(o);return r.config({name:D(n)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+n+". Using API: "+t)},function(n){var t=Array.prototype.slice.call(u,1);return e.apply(void 0,[r,n.config,n.state].concat(t))})},t,e)},Zo=function(n){return{key:n,value:void 0}},ni=function(n,t,r,o,i,u,c){var a=function(n){return vr(n,r)?n[r]():Q.none()},f=en(i,function(n,e){return Qo(r,n,e)}),s=en(u,function(n,e){return Lo(n,e)}),l=$(s,f,{revoke:e(Zo,r),config:function(e){var t=Zr(r+"-config",n,e);return{key:r,value:{config:t,me:l,configAsRaw:bn(function(){return Qr(r+"-config",n,e)}),initialConfig:e,state:c}}},schema:function(){return t},exhibit:function(n,e){return a(n).bind(function(n){return lr(o,"exhibit").map(function(t){return t(e,n.config,n.state)})}).getOr($o({}))},name:function(){return r},handlers:function(n){return a(n).bind(function(n){return lr(o,"events").map(function(e){return e(n.config,n.state)})}).getOr({})}});return l},ei=function(n,e){return ti(n,e,{validate:P,label:"function"})},ti=function(n,e,t){if(0===e.length)throw new Error("You must specify at least one required field.");return Ye("required",e),Xe(e),function(r){var o=Z(r);_n(e,function(n){return An(o,n)})||_e(e,o),n(e,o);var i=Hn(e,function(n){return!t.validate(r[n],n)});return i.length>0&&Ke(i,t.label),r}},ri=function(n,e){var t=Hn(e,function(e){return!An(n,e)});t.length>0&&qe(t)},oi=C,ii=function(n){return ei(ri,n)},ui=function(n){return ei(oi,n)},ci={init:function(){return ai({readState:function(){return"No State required"}})}},ai=function(n){return ui(["readState"])(n),n},fi=function(n){return mr(n)},si=Hr([oo("fields"),oo("name"),go("active",{}),go("apis",{}),go("state",ci),go("extra",{})]),li=function(n){var e=Qr("Creating behaviour: "+n.name,si,n);return Xo(e.fields,e.name,e.active,e.apis,e.extra,e.state)},di=Hr([oo("branchKey"),oo("branches"),oo("name"),go("active",{}),go("apis",{}),go("state",ci),go("extra",{})]),mi=D(void 0),gi=function(e,t,r){if(!(H(r)||L(r)||U(r)))throw n.console.error("Invalid call to Attr.set. Key ",t,":: Value ",r,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,r+"")},vi=function(n,e,t){gi(n.dom(),e,t)},pi=function(n,e){var t=n.dom();nn(e,function(n,e){gi(t,e,n)})},hi=function(n,e){var t=n.dom().getAttribute(e);return null===t?void 0:t},bi=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},yi=function(n,e){n.dom().removeAttribute(e)},wi=function(n,e){var t=hi(n,e);return void 0===t||""===t?[]:t.split(" ")},xi=function(n,e,t){var r=wi(n,e).concat([t]);return vi(n,e,r.join(" ")),!0},Si=function(n,e,t){var r=Hn(wi(n,e),function(n){return n!==t});return r.length>0?vi(n,e,r.join(" ")):yi(n,e),!1},Ti=function(n){return void 0!==n.dom().classList},Oi=function(n){return wi(n,"class")},ki=function(n,e){return xi(n,"class",e)},Ci=function(n,e){return Si(n,"class",e)},Ei=function(n,e){return An(Oi(n),e)?Ci(n,e):ki(n,e)},Di=function(n,e){Ti(n)?n.dom().classList.add(e):ki(n,e)},Bi=function(n){0===(Ti(n)?n.dom().classList:Oi(n)).length&&yi(n,"class")},Ii=function(n,e){Ti(n)?n.dom().classList.remove(e):Ci(n,e),Bi(n)},Mi=function(n,e){return Ti(n)?n.dom().classList.toggle(e):Ei(n,e)},Ai=function(n,e){return Ti(n)&&n.dom().classList.contains(e)},Ri=function(n,e,t){Ii(n,t),Di(n,e)},Fi=Object.freeze({toAlpha:function(n,e,t){Ri(n.element(),e.alpha(),e.omega())},toOmega:function(n,e,t){Ri(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e,t){return Ai(n.element(),e.alpha())},isOmega:function(n,e,t){return Ai(n.element(),e.omega())},clear:function(n,e,t){Ii(n.element(),e.alpha()),Ii(n.element(),e.omega())}}),Ni=[oo("alpha"),oo("omega")],Vi=li({fields:Ni,name:"swapping",apis:Fi}),Hi=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return Hi(t())}}},zi=function(n,e,t){for(var r=n.dom(),o=P(t)?t:D(!1);r.parentNode;){r=r.parentNode;var i=Ae.fromDom(r);if(e(i))return Q.some(i);if(o(i))break}return Q.none()},ji=function(n,e,r){return t(function(n){return e(n)},zi,n,e,r)},Li=function(n,e){var t=function(n){for(var r=0;r<n.childNodes.length;r++){if(e(Ae.fromDom(n.childNodes[r])))return Q.some(Ae.fromDom(n.childNodes[r]));var o=t(n.childNodes[r]);if(o.isSome())return o}return Q.none()};return t(n.dom())},Pi=function(n){n.dom().focus()},Ui=function(n){n.dom().blur()},Wi=function(n){var e=mt(n).dom();return n.dom()===e.activeElement},Gi=function(e){var t=void 0!==e?e.dom():n.document;return Q.from(t.activeElement).map(Ae.fromDom)},$i=function(n){return Gi(mt(n)).filter(function(e){return n.dom().contains(e.dom())})},_i=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),qi=tinymce.util.Tools.resolve("tinymce.ThemeManager"),Yi={openLink:function(e){var t=n.document.createElement("a");t.target="_blank",t.href=e.href,t.rel="noreferrer noopener";var r=n.document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,n.window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.document.body.appendChild(t),t.dispatchEvent(r),n.document.body.removeChild(t)}},Ki=function(n){return!1===n.settings.skin},Xi={formatChanged:D("formatChanged"),orientationChanged:D("orientationChanged"),dropupDismissed:D("dropupDismissed")},Ji=function(e,t){var r=(t||n.document).createElement("div");return r.innerHTML=e,yt(Ae.fromDom(r))},Qi=function(n){return n.dom().innerHTML},Zi=function(n,e){var t=mt(n).dom(),r=Ae.fromDom(t.createDocumentFragment()),o=Ji(e,t);Ct(r,o),Et(n),kt(n,r)},nu=function(n){var e=Ae.fromTag("div"),t=Ae.fromDom(n.dom().cloneNode(!0));return kt(e,t),Qi(e)},eu=function(n,e){return Ae.fromDom(n.dom().cloneNode(e))},tu=function(n){return eu(n,!1)},ru=function(n){var e=tu(n);return nu(e)},ou=function(n){return ru(n)},iu=function(n,e){return e.universal()?n:Hn(n,function(n){return An(e.channels(),n)})},uu=Object.freeze({events:function(n){return Oo([Co(ge(),function(e,t){var r=n.channels(),o=Z(r),i=iu(o,t);Nn(i,function(n){var o=r[n](),i=o.schema(),u=Zr("channel["+n+"] data\nReceiver: "+ou(e.element()),i,t.data());o.onReceive()(e,u)})})])}}),cu=function(n){for(var e=[],t=0;t<n.length;t++)n[t].each(function(n){e.push(n)});return e},au=function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t],t);if(r.isSome())return r}return Q.none()},fu=[],su=["alloy/data/Fields","alloy/debugging/Debugging"],lu=function(){var n=new Error;if(void 0!==n.stack){var e=n.stack.split("\n");return Ln(e,function(n){return n.indexOf("alloy")>0&&!Rn(su,function(e){return n.indexOf(e)>-1})}).getOr("unknown")}return"unknown"},du={logEventCut:C,logEventStopped:C,logNoParent:C,logEventNoHandlers:C,logEventResponse:C,write:C},mu=function(e,t,r){var o="*"===fu||An(fu,e)?function(){var r=[];return{logEventCut:function(n,e,t){r.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){r.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){r.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){r.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){r.push({outcome:"response",purpose:t,target:e})},write:function(){An(["mousemove","mouseover","mouseout",we()],e)||n.console.log(e,{event:e,target:t.dom(),sequence:Fn(r,function(n){return An(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+ou(n.target)+")":n.outcome})})}}}():du,i=r(o);return o.write(),i},gu=D([oo("menu"),oo("selectedMenu")]),vu=D([oo("item"),oo("selectedItem")]),pu=(D(Hr(vu().concat(gu()))),D(Hr(vu()))),hu=ao("initSize",[oo("numColumns"),oo("numRows")]),bu=function(n,e,t){lu();return Wr(e,e,t,qr(function(n){return Lt.value(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.apply(void 0,e)})}))},yu=function(n){return bu(0,n,Wt(C))},wu=function(n){return bu(0,n,Wt(Q.none))},xu=function(n){return bu(0,n,$t())},Su=function(n){return bu(0,n,$t())},Tu=function(n,e){return ho(n,D(e))},Ou=function(n){return ho(n,B)},ku=D(hu),Cu=[io("channels",Lr(Lt.value,Hr([xu("onReceive"),go("schema",to())])))],Eu=li({fields:Cu,name:"receiving",active:uu}),Du=function(n,e){var t=Au(n,e),r=e.aria();r.update()(n,r,t)},Bu=function(n,e,t){Mi(n.element(),e.toggleClass()),Du(n,e)},Iu=function(n,e,t){Di(n.element(),e.toggleClass()),Du(n,e)},Mu=function(n,e,t){Ii(n.element(),e.toggleClass()),Du(n,e)},Au=function(n,e){return Ai(n.element(),e.toggleClass())},Ru=function(n,e,t){(e.selected()?Iu:Mu)(n,e,t)},Fu=Object.freeze({onLoad:Ru,toggle:Bu,isOn:Au,on:Iu,off:Mu}),Nu=Object.freeze({exhibit:function(n,e,t){return $o({})},events:function(n,e){var t=Yo(n,e,Bu),r=Ko(n,e,Ru);return Oo(Gn([n.toggleOnExecute()?[t]:[],[r]]))}}),Vu=function(n,e,t){vi(n.element(),"aria-expanded",t)},Hu=[go("selected",!1),oo("toggleClass"),go("toggleOnExecute",!0),vo("aria",{mode:"none"},eo("mode",{pressed:[go("syncWithExpanded",!1),Tu("update",function(n,e,t){vi(n.element(),"aria-pressed",t),e.syncWithExpanded()&&Vu(n,e,t)})],checked:[Tu("update",function(n,e,t){vi(n.element(),"aria-checked",t)})],expanded:[Tu("update",Vu)],selected:[Tu("update",function(n,e,t){vi(n.element(),"aria-selected",t)})],none:[Tu("update",C)]}))],zu=li({fields:Hu,name:"toggling",active:Nu,apis:Fu}),ju={format:function(n,e){return Eu.config({channels:dr(Xi.formatChanged(),{onReceive:function(t,r){r.command===n&&e(t,r.state)}})})},orientation:function(n){return Eu.config({channels:dr(Xi.orientationChanged(),{onReceive:n})})},receive:function(n,e){return{key:n,value:{onReceive:e}}}},Lu={resolve:function(n){return"tinymce-mobile-"+n},prefix:D("tinymce-mobile")},Pu=function(n){var e=function(n,e){e.stop(),Ce(n)},t=se.detect().deviceType.isTouch()?[Co(he(),e)]:[Co(vn(),e),Co(an(),function(n,e){e.cut()})];return Oo(Gn([n.map(function(n){return Co(ve(),function(e,t){n(e),t.stop()})}).toArray(),t]))},Uu=function(n,e){e.ignore()||(Pi(n.element()),e.onFocus()(n))},Wu=Object.freeze({focus:Uu,blur:function(n,e){e.ignore()||Ui(n.element())},isFocused:function(n){return Wi(n.element())}}),Gu=Object.freeze({exhibit:function(n,e){return $o(e.ignore()?{}:{attributes:{tabindex:"-1"}})},events:function(n){return Oo([Co(de(),function(e,t){Uu(e,n),t.stop()})])}}),$u=[yu("onFocus"),go("ignore",!1)],_u=li({fields:$u,name:"focusing",active:Gu,apis:Wu}),qu=function(n){return void 0!==n.style},Yu=function(e,t,r){if(!H(r))throw n.console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",e),new Error("CSS value must be a string: "+r);qu(e)&&e.style.setProperty(t,r)},Ku=function(n,e){qu(n)&&n.style.removeProperty(e)},Xu=function(n,e,t){var r=n.dom();Yu(r,e,t)},Ju=function(n,e){var t=n.dom();nn(e,function(n,e){Yu(t,e,n)})},Qu=function(e,t){var r=e.dom(),o=n.window.getComputedStyle(r).getPropertyValue(t),i=""!==o||Pe(e)?o:Zu(r,t);return null===i?void 0:i},Zu=function(n,e){return qu(n)?n.style.getPropertyValue(e):""},nc=function(n,e){var t=n.dom(),r=Zu(t,e);return Q.from(r).filter(function(n){return n.length>0})},ec=function(n,e){var t=n.dom();Ku(t,e),bi(n,"style")&&""===re(hi(n,"style"))&&yi(n,"style")},tc=function(n){return n.dom().offsetWidth},rc=r("height",function(n){var e=n.dom();return Pe(n)?e.getBoundingClientRect().height:e.offsetHeight}),oc=function(n){return rc.get(n)},ic=function(n,e,t){return Hn(pt(n,t),e)},uc=function(n,e){return Hn(ht(n),e)},cc=function(n){return st(n)},ac=function(n,e,t){return ic(n,function(n){return at(n,e)},t)},fc=function(n,e){return uc(n,function(n){return at(n,e)})},sc=function(n,e){return st(e,n)},lc=function(n){return lt(n)},dc=function(n,e,t){return zi(n,function(n){return at(n,e)},t)},mc=function(n,e){return lt(e,n)},gc=function(n,e,r){return t(at,dc,n,e,r)},vc=function(n,e,t){var r=Yn(n.slice(0,e)),o=Yn(n.slice(e+1));return Ln(r.concat(o),t)},pc=function(n,e,t){var r=Yn(n.slice(0,e));return Ln(r,t)},hc=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return Ln(o.concat(r),t)},bc=function(n,e,t){var r=n.slice(e+1);return Ln(r,t)},yc=function(n){return function(e){var t=e.raw();return An(n,t.which)}},wc=function(n){return function(e){return _n(n,function(n){return n(e)})}},xc=function(n){return!0===n.raw().shiftKey},Sc=function(n){return!0===n.raw().ctrlKey},Tc=I(xc),Oc=function(n,e){return{matches:n,classification:e}},kc=function(n,e){return Ln(n,function(n){return n.matches(e)}).map(function(n){return n.classification})},Cc=function(n,e,t,r){var o=n+e;return o>r?t:o<t?r:o},Ec=function(n,e,t){return n<=e?e:n>=t?t:n},Dc=function(n,e,t){var r=sc(n.element(),"."+e.highlightClass());Nn(r,function(t){Ii(t,e.highlightClass()),n.getSystem().getByDom(t).each(function(t){e.onDehighlight()(n,t)})})},Bc=function(n,e,t,r){var o=Ic(n,e,t,r);Dc(n,e),Di(r.element(),e.highlightClass()),o||e.onHighlight()(n,r)},Ic=function(n,e,t,r){return Ai(r.element(),e.highlightClass())},Mc=function(n,e,t,r){var o=sc(n.element(),"."+e.itemClass());return Q.from(o[r]).fold(function(){return Lt.error("No element found with index "+r)},n.getSystem().getByDom)},Ac=function(n,e,t){return mc(n.element(),"."+e.itemClass()).bind(function(e){return n.getSystem().getByDom(e).toOption()})},Rc=function(n,e,t){var r=sc(n.element(),"."+e.itemClass());return(r.length>0?Q.some(r[r.length-1]):Q.none()).bind(function(e){return n.getSystem().getByDom(e).toOption()})},Fc=function(n,e,t,r){var o=sc(n.element(),"."+e.itemClass());return Pn(o,function(n){return Ai(n,e.highlightClass())}).bind(function(e){var t=Cc(e,r,0,o.length-1);return n.getSystem().getByDom(o[t]).toOption()})},Nc=Object.freeze({dehighlightAll:Dc,dehighlight:function(n,e,t,r){var o=Ic(n,e,t,r);Ii(r.element(),e.highlightClass()),o&&e.onDehighlight()(n,r)},highlight:Bc,highlightFirst:function(n,e,t){Ac(n,e,t).each(function(r){Bc(n,e,t,r)})},highlightLast:function(n,e,t){Rc(n,e,t).each(function(r){Bc(n,e,t,r)})},highlightAt:function(n,e,t,r){Mc(n,e,t,r).fold(function(n){throw new Error(n)},function(r){Bc(n,e,t,r)})},highlightBy:function(n,e,t,r){var o=sc(n.element(),"."+e.itemClass()),i=cu(Fn(o,function(e){return n.getSystem().getByDom(e).toOption()}));Ln(i,r).each(function(r){Bc(n,e,t,r)})},isHighlighted:Ic,getHighlighted:function(n,e,t){return mc(n.element(),"."+e.highlightClass()).bind(function(e){return n.getSystem().getByDom(e).toOption()})},getFirst:Ac,getLast:Rc,getPrevious:function(n,e,t){return Fc(n,e,0,-1)},getNext:function(n,e,t){return Fc(n,e,0,1)}}),Vc=[oo("highlightClass"),oo("itemClass"),yu("onHighlight"),yu("onDehighlight")],Hc=li({fields:Vc,name:"highlighting",apis:Nc}),zc=function(){return{get:function(n){return $i(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}},jc=function(){return{get:function(n){return Hc.getHighlighted(n).map(function(n){return n.element()})},set:function(n,e){n.getSystem().getByDom(e).fold(C,function(e){Hc.highlight(n,e)})}}},Lc=function(n,e,t,r,o,i){var u=function(n,e,r,o){var i=t(n,e,r,o);return kc(i,e.event()).bind(function(t){return t(n,e,r,o)})},c={schema:function(){return n.concat([go("focusManager",zc()),Tu("handler",c),Tu("state",e)])},processKey:u,toEvents:function(n,e){var t=r(n,e),o=Oo(i.map(function(t){return Co(de(),function(r,o){t(r,n,e,o),o.stop()})}).toArray().concat([Co(dn(),function(t,r){u(t,r,n,e).each(function(n){r.stop()})})]));return $(t,o)},toApis:o};return c},Pc=function(n){var t=[fo("onEscape"),fo("onEnter"),go("selector",'[data-alloy-tabstop="true"]'),go("firstTabstop",0),go("useTabstopAt",D(!0)),fo("visibilitySelector")].concat([n]),r=function(n,e){var t=n.visibilitySelector().bind(function(n){return gc(e,n)}).getOr(e);return oc(t)>0},o=function(n,e){var t=sc(n.element(),e.selector()),o=Hn(t,function(n){return r(e,n)});return Q.from(o[e.firstTabstop()])},i=function(n,e){return e.focusManager().get(n).bind(function(n){return gc(n,e.selector())})},u=function(n,e){return r(n,e)&&n.useTabstopAt()(e)},c=function(n,e,t,r,o){return o(e,t,function(n){return u(r,n)}).fold(function(){return r.cyclic()?Q.some(!0):Q.none()},function(e){return r.focusManager().set(n,e),Q.some(!0)})},a=function(n,t,r,o){var u=sc(n.element(),r.selector());return i(n,r).bind(function(t){return Pn(u,e(dt,t)).bind(function(e){return c(n,u,e,r,o)})})},f=D([Oc(wc([xc,yc([9])]),function(n,e,t,r){var o=t.cyclic()?vc:pc;return a(n,0,t,o)}),Oc(yc([9]),function(n,e,t,r){var o=t.cyclic()?hc:bc;return a(n,0,t,o)}),Oc(yc([27]),function(n,e,t,r){return t.onEscape().bind(function(t){return t(n,e)})}),Oc(wc([Tc,yc([13])]),function(n,e,t,r){return t.onEnter().bind(function(t){return t(n,e)})})]),s=D({}),l=D({});return Lc(t,ci.init,f,s,l,Q.some(function(n,e){o(n,e).each(function(t){e.focusManager().set(n,t)})}))},Uc=Pc(ho("cyclic",D(!1))),Wc=Pc(ho("cyclic",D(!0))),Gc=function(n){return"input"===Ve(n)&&"radio"!==hi(n,"type")||"textarea"===Ve(n)},$c=function(n,e,t){return Ee(n,t,ve()),Q.some(!0)},_c=function(n,e,t){return Gc(t)&&yc([32])(e.event())?Q.none():$c(n,0,t)},qc=[go("execute",_c),go("useSpace",!1),go("useEnter",!0),go("useControlEnter",!1),go("useDown",!1)],Yc=function(n,e,t){return t.execute()(n,e,n.element())},Kc=D({}),Xc=D({}),Jc=Lc(qc,ci.init,function(n,e,t,r){var o=t.useSpace()&&!Gc(n.element())?[32]:[],i=t.useEnter()?[13]:[],u=t.useDown()?[40]:[],c=o.concat(i).concat(u);return[Oc(yc(c),Yc)].concat(t.useControlEnter()?[Oc(wc([Sc,yc([13])]),Yc)]:[])},Kc,Xc,Q.none()),Qc=function(n){var e=Hi(Q.none());return ai({readState:D({}),setGridSize:function(n,t){e.set(Q.some({numRows:D(n),numColumns:D(t)}))},getNumRows:function(){return e.get().map(function(n){return n.numRows()})},getNumColumns:function(){return e.get().map(function(n){return n.numColumns()})}})},Zc=Object.freeze({flatgrid:Qc,init:function(n){return n.state()(n)}}),na=function(n,e){return function(t){return"rtl"===ea(t)?e:n}},ea=function(n){return"rtl"===Qu(n,"direction")?"rtl":"ltr"},ta=function(n){return function(e,t,r,o){var i=n(e.element());return ua(i,e,t,r,o)}},ra=function(n,e){var t=na(n,e);return ta(t)},oa=function(n,e){var t=na(e,n);return ta(t)},ia=function(n){return function(e,t,r,o){return ua(n,e,t,r,o)}},ua=function(n,e,t,r,o){return r.focusManager().get(e).bind(function(t){return n(e.element(),t,r,o)}).map(function(n){return r.focusManager().set(e,n),!0})},ca=ia,aa=ia,fa=ia,sa=function(n){return n.offsetWidth<=0&&n.offsetHeight<=0},la=function(n){var e=n.dom();return!sa(e)},da=Je(["index","candidates"],[]),ma=function(n,e){return Pn(n,e).map(function(e){return da({index:e,candidates:n})})},ga=function(n,e,t){return va(n,e,t,la)},va=function(n,t,r,o){var i=e(dt,t),u=sc(n,r),c=Hn(u,la);return ma(c,i)},pa=function(n,e){return Pn(n,function(n){return dt(e,n)})},ha=function(n,e,t,r){return r(Math.floor(e/t),e%t).bind(function(e){var r=e.row()*t+e.column();return r>=0&&r<n.length?Q.some(n[r]):Q.none()})},ba=function(n,e,t,r,o){return ha(n,e,r,function(e,i){var u=e===t-1?n.length-e*r:r,c=Cc(i,o,0,u-1);return Q.some({row:D(e),column:D(c)})})},ya=function(n,e,t,r,o){return ha(n,e,r,function(e,i){var u=Cc(e,o,0,t-1),c=u===t-1?n.length-u*r:r,a=Ec(i,0,c-1);return Q.some({row:D(u),column:D(a)})})},wa=[oo("selector"),go("execute",_c),wu("onEscape"),go("captureTab",!1),ku()],xa=function(n,e){return e.focusManager().get(n).bind(function(n){return gc(n,e.selector())})},Sa=function(n){return function(e,t,r,o){return ga(e,t,r.selector()).bind(function(e){return n(e.candidates(),e.index(),o.getNumRows().getOr(r.initSize().numRows()),o.getNumColumns().getOr(r.initSize().numColumns()))})}},Ta=function(n,e,t,r){return t.captureTab()?Q.some(!0):Q.none()},Oa=Sa(function(n,e,t,r){return ba(n,e,t,r,-1)}),ka=Sa(function(n,e,t,r){return ba(n,e,t,r,1)}),Ca=Sa(function(n,e,t,r){return ya(n,e,t,r,-1)}),Ea=Sa(function(n,e,t,r){return ya(n,e,t,r,1)}),Da=D([Oc(yc([37]),ra(Oa,ka)),Oc(yc([39]),oa(Oa,ka)),Oc(yc([38]),ca(Ca)),Oc(yc([40]),aa(Ea)),Oc(wc([xc,yc([9])]),Ta),Oc(wc([Tc,yc([9])]),Ta),Oc(yc([27]),function(n,e,t,r){return t.onEscape()(n,e)}),Oc(yc([32].concat([13])),function(n,e,t,r){return xa(n,t).bind(function(r){return t.execute()(n,e,r)})})]),Ba=D({}),Ia=Lc(wa,Qc,Da,Ba,{},Q.some(function(n,e,t){mc(n.element(),e.selector()).each(function(t){e.focusManager().set(n,t)})})),Ma=function(n,e,t,r){return ga(n,t,e).bind(function(n){var e=n.index(),t=n.candidates(),o=Cc(e,r,0,t.length-1);return Q.from(t[o])})},Aa=[oo("selector"),go("getInitial",Q.none),go("execute",_c),go("executeOnMove",!1),go("allowVertical",!0)],Ra=function(n,e){return e.focusManager().get(n).bind(function(n){return gc(n,e.selector())})},Fa=function(n,e,t){return Ra(n,t).bind(function(r){return t.execute()(n,e,r)})},Na=function(n,e,t){return Ma(n,t.selector(),e,-1)},Va=function(n,e,t){return Ma(n,t.selector(),e,1)},Ha=function(n){return function(e,t,r){return n(e,t,r).bind(function(){return r.executeOnMove()?Fa(e,t,r):Q.some(!0)})}},za=D({}),ja=D({}),La=Lc(Aa,ci.init,function(n,e,t,r){var o=[37].concat(t.allowVertical()?[38]:[]),i=[39].concat(t.allowVertical()?[40]:[]);return[Oc(yc(o),Ha(ra(Na,Va))),Oc(yc(i),Ha(oa(Na,Va))),Oc(yc([13]),Fa),Oc(yc([32]),Fa)]},za,ja,Q.some(function(n,e){e.getInitial()(n).or(mc(n.element(),e.selector())).each(function(t){e.focusManager().set(n,t)})})),Pa=Je(["rowIndex","columnIndex","cell"],[]),Ua=function(n,e,t){return Q.from(n[e]).bind(function(n){return Q.from(n[t]).map(function(n){return Pa({rowIndex:e,columnIndex:t,cell:n})})})},Wa=function(n,e,t,r){var o=n[e].length,i=Cc(t,r,0,o-1);return Ua(n,e,i)},Ga=function(n,e,t,r){var o=Cc(t,r,0,n.length-1),i=n[o].length,u=Ec(e,0,i-1);return Ua(n,o,u)},$a=function(n,e,t,r){var o=n[e].length,i=Ec(t+r,0,o-1);return Ua(n,e,i)},_a=function(n,e,t,r){var o=Ec(t+r,0,n.length-1),i=n[o].length,u=Ec(e,0,i-1);return Ua(n,o,u)},qa=[ao("selectors",[oo("row"),oo("cell")]),go("cycles",!0),go("previousSelector",Q.none),go("execute",_c)],Ya=function(n,e){return Fn(n,function(n){return sc(n,e.selectors().cell())})},Ka=function(n,e){return function(t,r,o){var i=o.cycles()?n:e;return gc(r,o.selectors().row()).bind(function(n){var e=sc(n,o.selectors().cell());return pa(e,r).bind(function(e){var r=sc(t,o.selectors().row());return pa(r,n).bind(function(n){var t=Ya(r,o);return i(t,n,e).map(function(n){return n.cell()})})})})}},Xa=Ka(function(n,e,t){return Wa(n,e,t,-1)},function(n,e,t){return $a(n,e,t,-1)}),Ja=Ka(function(n,e,t){return Wa(n,e,t,1)},function(n,e,t){return $a(n,e,t,1)}),Qa=Ka(function(n,e,t){return Ga(n,t,e,-1)},function(n,e,t){return _a(n,t,e,-1)}),Za=Ka(function(n,e,t){return Ga(n,t,e,1)},function(n,e,t){return _a(n,t,e,1)}),nf=D([Oc(yc([37]),ra(Xa,Ja)),Oc(yc([39]),oa(Xa,Ja)),Oc(yc([38]),ca(Qa)),Oc(yc([40]),aa(Za)),Oc(yc([32].concat([13])),function(n,e,t){return $i(n.element()).bind(function(r){return t.execute()(n,e,r)})})]),ef=D({}),tf=D({}),rf=Lc(qa,ci.init,nf,ef,tf,Q.some(function(n,e){e.previousSelector()(n).orThunk(function(){var t=e.selectors();return mc(n.element(),t.cell())}).each(function(t){e.focusManager().set(n,t)})})),of=[oo("selector"),go("execute",_c),go("moveOnTab",!1)],uf=function(n,e,t){return t.focusManager().get(n).bind(function(r){return t.execute()(n,e,r)})},cf=function(n,e,t){return Ma(n,t.selector(),e,-1)},af=function(n,e,t){return Ma(n,t.selector(),e,1)},ff=D([Oc(yc([38]),fa(cf)),Oc(yc([40]),fa(af)),Oc(wc([xc,yc([9])]),function(n,e,t){return t.moveOnTab()?fa(cf)(n,e,t):Q.none()}),Oc(wc([Tc,yc([9])]),function(n,e,t){return t.moveOnTab()?fa(af)(n,e,t):Q.none()}),Oc(yc([13]),uf),Oc(yc([32]),uf)]),sf=D({}),lf=D({}),df=Lc(of,ci.init,ff,sf,lf,Q.some(function(n,e){mc(n.element(),e.selector()).each(function(t){e.focusManager().set(n,t)})})),mf=[wu("onSpace"),wu("onEnter"),wu("onShiftEnter"),wu("onLeft"),wu("onRight"),wu("onTab"),wu("onShiftTab"),wu("onUp"),wu("onDown"),wu("onEscape"),fo("focusIn")],gf=Lc(mf,ci.init,function(n,e,t){return[Oc(yc([32]),t.onSpace()),Oc(wc([Tc,yc([13])]),t.onEnter()),Oc(wc([xc,yc([13])]),t.onShiftEnter()),Oc(wc([xc,yc([9])]),t.onShiftTab()),Oc(wc([Tc,yc([9])]),t.onTab()),Oc(yc([38]),t.onUp()),Oc(yc([40]),t.onDown()),Oc(yc([37]),t.onLeft()),Oc(yc([39]),t.onRight()),Oc(yc([32]),t.onSpace()),Oc(yc([27]),t.onEscape())]},function(){return{}},function(){return{}},Q.some(function(n,e){return e.focusIn().bind(function(t){return t(n,e)})})),vf=Uc.schema(),pf=Wc.schema(),hf=La.schema(),bf=Ia.schema(),yf=rf.schema(),wf=Jc.schema(),xf=df.schema(),Sf=gf.schema(),Tf=function(n){var e=Qr("Creating behaviour: "+n.name,di,n);return Jo(eo(e.branchKey,e.branches),e.name,e.active,e.apis,e.extra,e.state)}({branchKey:"mode",branches:Object.freeze({acyclic:vf,cyclic:pf,flow:hf,flatgrid:bf,matrix:yf,execution:wf,menu:xf,special:Sf}),name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(e,t,r,o,i){vr(r,"setGridSize")?r.setGridSize(o,i):n.console.error("Layout does not support setGridSize")}},state:Zc}),Of=function(n,e){return po(n,{},Fn(e,function(e){return co(e.name(),"Cannot configure "+e.name()+" for "+n)}).concat([ho("dump",B)]))},kf=function(n){return n.dump()},Cf=Pt.generate([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Ef=function(n,e,t,r){return n.exists(function(n){return n!==t.owner})?Cf.single(!0,D(t)):lr(r,t.name).fold(function(){throw new Error("Unknown placeholder component: "+t.name+"\nKnown: ["+Z(r)+"]\nNamespace: "+n.getOr("none")+"\nSpec: "+yr.stringify(t,null,2))},function(n){return n.replace()})},Df=function(n,e,t,r){return"placeholder"===t.uiType?Ef(n,0,t,r):Cf.single(!1,D(t))},Bf=function(n,e,t,r){return Df(n,0,t,r).fold(function(o,i){var u=i(e,t.config,t.validated),c=lr(u,"components").getOr([]),a=$n(c,function(t){return Bf(n,e,t,r)});return[$(u,{components:a})]},function(n,r){return r(e,t.config,t.validated)})},If=function(n,e,t,r){return $n(t,function(t){return Bf(n,e,t,r)})},Mf=function(n,e){var t=!1;return{name:D(n),required:function(){return e.fold(function(n,e){return n},function(n,e){return n})},used:function(){return t},replace:function(){if(!0===t)throw new Error("Trying to use the same placeholder more than once: "+n);return t=!0,e}}},Af=function(n,e,t,r){var o=en(r,function(n,e){return Mf(e,n)}),i=If(n,e,t,o);return nn(o,function(t){if(!1===t.used()&&t.required())throw new Error("Placeholder: "+t.name()+" was not found in components list\nNamespace: "+n.getOr("none")+"\nComponents: "+yr.stringify(e.components(),null,2))}),i},Rf=Cf.single,Ff=Cf.multiple,Nf=D("placeholder"),Vf=0,Hf=function(n){var e=(new Date).getTime(),t=Math.floor(1e9*Math.random());return Vf++,n+"_"+t+Vf+String(e)},zf=Pt.generate([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),jf=go("factory",{sketch:B}),Lf=go("schema",[]),Pf=oo("name"),Uf=Wr("pname","pname",qt(function(n){return"<alloy."+Hf(n.name)+">"}),to()),Wf=go("defaults",D({})),Gf=go("overrides",D({})),$f=zr([jf,Lf,Pf,Uf,Wf,Gf]),_f=zr([jf,Lf,Pf,Uf,Wf,Gf]),qf=zr([jf,Lf,Pf,oo("unit"),Uf,Wf,Gf]),Yf=function(n){return n.fold(Q.some,Q.none,Q.some,Q.some)},Kf=function(n){var e=function(n){return n.name()};return n.fold(e,e,e,e)},Xf=function(n,e){return function(t){var r=Zr("Converting part type",e,t);return n(r)}},Jf=Xf(zf.required,$f),Qf=Xf(zf.optional,_f),Zf=Xf(zf.group,qf),ns=D("entirety"),es=function(n,e,t,r){var o=t;return $(e.defaults()(n,t,r),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,r),{"debug.sketcher":dr("part-"+e.name(),o)})},ts=function(n,e,t){var r={},o={};return Nn(t,function(n){n.fold(function(n){r[n.pname()]=Rf(!0,function(e,t,r){return n.factory().sketch(es(e,n,t,r))})},function(n){var t=e.parts()[n.name()]();o[n.name()]=D(es(e,n,t[ns()]()))},function(n){r[n.pname()]=Rf(!1,function(e,t,r){return n.factory().sketch(es(e,n,t,r))})},function(n){r[n.pname()]=Ff(!0,function(e,t,r){var o=e[n.name()]();return Fn(o,function(t){return n.factory().sketch($(n.defaults()(e,t),t,n.overrides()(e,t)))})})})}),{internals:D(r),externals:D(o)}},rs=function(n,e){var t={};return Nn(e,function(e){Yf(e).each(function(e){var r=os(n,e.pname());t[e.name()]=function(t){var o=Qr("Part: "+e.name()+" in "+n,zr(e.schema()),t);return $(r,{config:t,validated:o})}})}),t},os=function(n,e){return{uiType:Nf(),owner:n,name:e}},is=function(n,e,t){return{uiType:Nf(),owner:n,name:e,config:t,validated:{}}},us=function(n){return $n(n,function(n){return n.fold(Q.none,Q.some,Q.none,Q.none).map(function(n){return ao(n.name(),n.schema().concat([Ou(ns())]))}).toArray()})},cs=function(n){return Fn(n,Kf)},as=function(n,e,t){return ts(0,e,t)},fs=function(n,e,t){return Af(Q.some(n),e,e.components(),t)},ss=function(n,e,t){var r=e.partUids()[t];return n.getSystem().getByUid(r).toOption()},ls=function(n,e,t){return ss(n,e,t).getOrDie("Could not find part: "+t)},ds=function(n,e){var t=n.getSystem();return en(e.partUids(),function(n,e){return D(t.getByUid(n))})},ms=function(n,e){var t=cs(e);return mr(Fn(t,function(e){return{key:e,value:n+"-"+e}}))},gs=function(n){return Wr("partUids","partUids",Yt(function(e){return ms(e.uid,n)}),to())},vs=Hf("alloy-premade"),ps=Hf("api"),hs=function(n){return dr(vs,n)},bs=function(n){return lr(n,vs)},ys=function(n){return Po(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=e.config(ps);return n.apply(void 0,[o].concat([e].concat(t)))},n)},ws=D(ps),xs=D("alloy-id-"),Ss=D("data-alloy-id"),Ts=xs(),Os=Ss(),ks=function(n,e){var t=Hf(Ts+n);return vi(e,Os,t),t},Cs=function(n,e){vi(n,Os,e)},Es=function(n){var e=je(n)?hi(n,Os):null;return Q.from(e)},Ds=function(n){return Hf(n)},Bs=function(n,e,t,r){return(e.length>0?[ao("parts",e)]:[]).concat([oo("uid"),go("dom",{}),go("components",[]),Ou("originalSpec"),go("debug.sketcher",{})]).concat(t)},Is=function(n,e,t,r,o){var i=Bs(0,r,o);return Zr(n+" [SpecSchema]",Hr(i.concat(e)),t)},Ms=function(n,e,t,r){var o=Rs(r),i=Is(n,e,o,[],[]);return $(t(i,o),{"debug.sketcher":dr(n,r)})},As=function(n,e,t,r,o){var i=Rs(o),u=us(t),c=gs(t),a=Is(n,e,i,u,[c]),f=as(0,a,t),s=fs(n,a,f.internals());return $(r(a,s,i,f.externals()),{"debug.sketcher":dr(n,o)})},Rs=function(n){return $({uid:Ds("uid")},n)},Fs=Hr([oo("name"),oo("factory"),oo("configFields"),go("apis",{}),go("extraApis",{})]),Ns=Hr([oo("name"),oo("factory"),oo("configFields"),oo("partFields"),go("apis",{}),go("extraApis",{})]),Vs=function(n){var e=Qr("Sketcher for "+n.name,Fs,n),t=en(e.apis,ys),r=en(e.extraApis,function(n,e){return Lo(n,e)});return $({name:D(e.name),partFields:D([]),configFields:D(e.configFields),sketch:function(n){return Ms(e.name,e.configFields,e.factory,n)}},t,r)},Hs=function(n){var e=Qr("Sketcher for "+n.name,Ns,n),t=rs(e.name,e.partFields),r=en(e.apis,ys),o=en(e.extraApis,function(n,e){return Lo(n,e)});return $({name:D(e.name),partFields:D(e.partFields),configFields:D(e.configFields),sketch:function(n){return As(e.name,e.configFields,e.partFields,e.factory,n)},parts:D(t)},r,o)},zs=Vs({name:"Button",factory:function(n){var e=Pu(n.action()),t=lr(n.dom(),"attributes").bind(fr("type")),r=lr(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:e,behaviours:$(fi([_u.config({}),Tf.config({mode:"execution",useSpace:!0,useEnter:!0})]),kf(n.buttonBehaviours())),domModification:{attributes:$(t.fold(function(){return r.is("button")?{type:"button"}:{}},function(n){return{}}),{role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[go("uid",void 0),oo("dom"),go("components",[]),Of("buttonBehaviours",[_u,Tf]),fo("action"),fo("role"),go("eventOrder",{})]}),js=li({fields:[],name:"unselecting",active:Object.freeze({events:function(n){return Oo([ko(hn(),D(!0))])},exhibit:function(n,e){return $o({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}})}),Ls=function(n){var e=void 0!==n.dom().attributes?n.dom().attributes:[];return jn(e,function(n,e){return"class"===e.name?n:$(n,dr(e.name,e.value))},{})},Ps=function(n){return Array.prototype.slice.call(n.dom().classList,0)},Us=function(n){var e=Ae.fromHtml(n),t=yt(e),r=Ls(e),o=Ps(e),i=0===t.length?{}:{innerHtml:Qi(e)};return $({tag:Ve(e),classes:o,attributes:r},i)},Ws=function(n){var e=ne(n,{prefix:Lu.prefix()});return Us(e)},Gs=function(n){return{dom:Ws(n)}},$s=function(n){return fi([zu.config({toggleClass:Lu.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),ju.format(n,function(n,e){(e?zu.on:zu.off)(n)})])},_s=function(n,e,t){return zs.sketch({dom:Ws('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:$(fi([js.config({})]),t)})},qs={forToolbar:_s,forToolbarCommand:function(n,e){return _s(e,function(){n.execCommand(e)},{})},forToolbarStateAction:function(n,e,t,r){var o=$s(t);return _s(e,r,o)},forToolbarStateCommand:function(n,e){var t=$s(e);return _s(e,function(){n.execCommand(e)},t)}},Ys=function(n,e){return{left:D(n),top:D(e),translate:function(t,r){return Ys(n+t,e+r)}}},Ks=Ys,Xs=function(n,e,t,r){return n<e?n:n>t?t:n===e?e-1:Math.max(e,n-r)},Js=function(n,e,t,r){return n>t?n:n<e?e:n===t?t+1:Math.min(t,n+r)},Qs=function(n,e,t){return Math.max(e,Math.min(t,n))},Zs=function(n,e,t,r,o,i){return i.fold(function(){var n=e-t,i=Math.round(n/o)*o;return Qs(t+i,t-1,r+1)},function(n){var t=(e-n)%o,i=Math.round(t/o),u=Math.floor((e-n)/o),c=Math.floor((r-n)/o),a=n+Math.min(c,u+i)*o;return Math.max(n,a)})},nl=function(n,e,t,r,o,i,u){var c=t-e;if(r<n.left)return e-1;if(r>n.right)return t+1;var a=Math.min(n.right,Math.max(r,n.left))-n.left,f=Qs(a/n.width*c+e,e-1,t+1),s=Math.round(f);return i&&f>=e&&f<=t?Zs(0,f,e,t,o,u):s},el=se.detect().deviceType.isTouch(),tl=function(n){var e=n.event().raw();if(el){var t=e;return void 0!==t.touches&&1===t.touches.length?Q.some(t.touches[0]).map(function(n){return Ks(n.clientX,n.clientY)}):Q.none()}var r=e;return void 0!==r.clientX?Q.some(r).map(function(n){return Ks(n.clientX,n.clientY)}):Q.none()},rl=function(n){return tl(n).map(function(n){return n.left()})},ol=function(n,e){ke(n,"slider.change.value",{value:e})},il=function(n,e,t,r){var o=nl(e,t.min(),t.max(),r,t.stepSize(),t.snapToGrid(),t.snapStart());ol(n,o)},ul=function(n,e,t,r){return rl(r).map(function(r){return il(n,t,e,r),r})},cl=function(n,e){var t=Xs(e.value().get(),e.min(),e.max(),e.stepSize());ol(n,t)},al=function(n,e){var t=Js(e.value().get(),e.min(),e.max(),e.stepSize());ol(n,t)},fl=se.detect().deviceType.isTouch(),sl=function(n,e){return Qf({name:n+"-edge",overrides:function(n){var t=Oo([Eo(on(),e,[n])]),r=Oo([Eo(an(),e,[n]),Eo(fn(),function(n,t){t.mouseIsDown().get()&&e(n,t)},[n])]);return{events:fl?t:r}}})},ll=[sl("left",function(n,e){ol(n,e.min()-1)}),sl("right",function(n,e){ol(n,e.max()+1)}),Jf({name:"thumb",defaults:D({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:Oo([Io(on(),n,"spectrum"),Io(un(),n,"spectrum"),Io(cn(),n,"spectrum")])}}}),Jf({schema:[ho("mouseIsDown",function(){return Hi(!1)})],name:"spectrum",overrides:function(n){var e=function(e,t){var r=e.element().dom().getBoundingClientRect();ul(e,n,r,t)},t=Oo([Co(on(),e),Co(un(),e)]),r=Oo([Co(an(),e),Co(fn(),function(t,r){n.mouseIsDown().get()&&e(t,r)})]);return{behaviours:fi(fl?[]:[Tf.config({mode:"special",onLeft:function(e){return cl(e,n),Q.some(!0)},onRight:function(e){return al(e,n),Q.some(!0)}}),_u.config({})]),events:fl?t:r}}})],dl=function(n,e,t){e.store().manager().onLoad(n,e,t)},ml=function(n,e,t){e.store().manager().onUnload(n,e,t)},gl=Object.freeze({onLoad:dl,onUnload:ml,setValue:function(n,e,t,r){e.store().manager().setValue(n,e,t,r)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}}),vl=Object.freeze({events:function(n,e){var t=n.resetOnDom()?[Fo(function(t,r){dl(t,n,e)}),No(function(t,r){ml(t,n,e)})]:[Ko(n,e,dl)];return Oo(t)}}),pl=function(){var n=Hi(null);return ai({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},hl=function(){var n=Hi({});return ai({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},bl=Object.freeze({memory:pl,dataset:hl,manual:function(){return ai({readState:function(){}})},init:function(n){return n.store().manager().state(n)}}),yl=function(n,e,t,r){e.store().getDataKey();t.set({}),e.store().setData()(n,r),e.onSetValue()(n,r)},wl=[fo("initialValue"),oo("getFallbackEntry"),oo("getDataKey"),oo("setData"),Tu("manager",{setValue:yl,getValue:function(n,e,t){var r=e.store().getDataKey()(n),o=t.get();return lr(o,r).fold(function(){return e.store().getFallbackEntry()(r)},function(n){return n})},onLoad:function(n,e,t){e.store().initialValue().each(function(r){yl(n,e,t,r)})},onUnload:function(n,e,t){t.set({})},state:hl})],xl=[oo("getValue"),go("setValue",C),fo("initialValue"),Tu("manager",{setValue:function(n,e,t,r){e.store().setValue()(n,r),e.onSetValue()(n,r)},getValue:function(n,e,t){return e.store().getValue()(n)},onLoad:function(n,e,t){e.store().initialValue().each(function(t){e.store().setValue()(n,t)})},onUnload:C,state:ci.init})],Sl=[fo("initialValue"),Tu("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue()(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:pl})],Tl=[vo("store",{mode:"memory"},eo("mode",{memory:Sl,manual:xl,dataset:wl})),yu("onSetValue"),go("resetOnDom",!1)],Ol=li({fields:Tl,name:"representing",active:vl,apis:gl,extra:{setValueFrom:function(n,e){var t=Ol.getValue(e);Ol.setValue(n,t)}},state:bl}),kl=se.detect().deviceType.isTouch(),Cl=[oo("min"),oo("max"),go("stepSize",1),go("onChange",C),go("onInit",C),go("onDragStart",C),go("onDragEnd",C),go("snapToGrid",!1),fo("snapStart"),oo("getInitialValue"),Of("sliderBehaviours",[Tf,Ol]),ho("value",function(n){return Hi(n.min)})].concat(kl?[]:[ho("mouseIsDown",function(){return Hi(!1)})]),El=r("width",function(n){return n.dom().offsetWidth}),Dl=function(n,e){El.set(n,e)},Bl=function(n){return El.get(n)},Il=se.detect().deviceType.isTouch(),Ml=Hs({name:"Slider",configFields:Cl,partFields:ll,factory:function(n,e,t,r){var o=n.max()-n.min(),i=function(n){var e=n.element().dom().getBoundingClientRect();return(e.left+e.right)/2},u=function(e){return ls(e,n,"thumb")},c=function(n,e,t){var r=t.value().get();return r<t.min()?ss(n,t,"left-edge").fold(function(){return 0},function(n){return i(n)-e.left}):r>t.max()?ss(n,t,"right-edge").fold(function(){return e.width},function(n){return i(n)-e.left}):(t.value().get()-t.min())/o*e.width},a=function(e){var t=ls(e,n,"spectrum").element().dom().getBoundingClientRect(),r=e.element().dom().getBoundingClientRect(),o=c(e,t,n);return t.left-r.left+o},f=function(n){var e=a(n),t=u(n),r=Bl(t.element())/2;Xu(t.element(),"left",e-r+"px")},s=function(e,t){var r=n.value().get(),o=u(e);return r!==t||nc(o.element(),"left").isNone()?(n.value().set(t),f(e),n.onChange()(e,o,t),Q.some(!0)):Q.none()},l=Il?[Co(on(),function(e,t){n.onDragStart()(e,u(e))}),Co(cn(),function(e,t){n.onDragEnd()(e,u(e))})]:[Co(an(),function(e,t){t.stop(),n.onDragStart()(e,u(e)),n.mouseIsDown().set(!0)}),Co(sn(),function(e,t){n.onDragEnd()(e,u(e)),n.mouseIsDown().set(!1)})];return{uid:n.uid(),dom:n.dom(),components:e,behaviours:$(fi(Gn([Il?[]:[Tf.config({mode:"special",focusIn:function(e){return ss(e,n,"spectrum").map(Tf.focusIn).map(D(!0))}})],[Ol.config({store:{mode:"manual",getValue:function(e){return n.value().get()}}})]])),kf(n.sliderBehaviours())),events:Oo([Co("slider.change.value",function(n,e){s(n,e.event().value())}),Fo(function(e,t){n.value().set(n.getInitialValue()());var r=u(e);f(e),n.onInit()(e,r,n.value().get())})].concat(l)),apis:{resetToMin:function(e){s(e,n.min())},resetToMax:function(e){s(e,n.max())},refresh:f},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),Al=function(n,e,t){return qs.forToolbar(e,function(){var r=t();n.setContextToolbar([{label:e+" group",items:r}])},{})},Rl=function(n){var e=function(n){return n<0?"black":n>360?"white":"hsl("+n+", 100%, 50%)"};return Ml.sketch({dom:Ws('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[Ml.parts()["left-edge"](Gs('<div class="${prefix}-hue-slider-black"></div>')),Ml.parts().spectrum({dom:Ws('<div class="${prefix}-slider-gradient-container"></div>'),components:[Gs('<div class="${prefix}-slider-gradient"></div>')],behaviours:fi([zu.config({toggleClass:Lu.resolve("thumb-active")})])}),Ml.parts()["right-edge"](Gs('<div class="${prefix}-hue-slider-white"></div>')),Ml.parts().thumb({dom:Ws('<div class="${prefix}-slider-thumb"></div>'),behaviours:fi([zu.config({toggleClass:Lu.resolve("thumb-active")})])})],onChange:function(t,r,o){var i=e(o);Xu(r.element(),"background-color",i),n.onChange(t,r,i)},onDragStart:function(n,e){zu.on(e)},onDragEnd:function(n,e){zu.off(e)},onInit:function(n,t,r){var o=e(r);Xu(t.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:n.getInitialValue,sliderBehaviours:fi([ju.orientation(Ml.refresh)])})},Fl=function(n){return[Rl(n)]},Nl={makeItems:Fl,sketch:function(n,e){var t={onChange:function(n,t,r){e.undoManager.transact(function(){e.formatter.apply("forecolor",{value:r}),e.nodeChanged()})},getInitialValue:function(){return-1}};return Al(n,"color",function(){return Fl(t)})}},Vl=Hr([oo("getInitialValue"),oo("onChange"),oo("category"),oo("sizes")]),Hl={sketch:function(n){var e=Qr("SizeSlider",Vl,n),t=function(n){return n>=0&&n<e.sizes.length};return Ml.sketch({dom:{tag:"div",classes:[Lu.resolve("slider-"+e.category+"-size-container"),Lu.resolve("slider"),Lu.resolve("slider-size-container")]},onChange:function(n,r,o){t(o)&&e.onChange(o)},onDragStart:function(n,e){zu.on(e)},onDragEnd:function(n,e){zu.off(e)},min:0,max:e.sizes.length-1,stepSize:1,getInitialValue:e.getInitialValue,snapToGrid:!0,sliderBehaviours:fi([ju.orientation(Ml.refresh)]),components:[Ml.parts().spectrum({dom:Ws('<div class="${prefix}-slider-size-container"></div>'),components:[Gs('<div class="${prefix}-slider-size-line"></div>')]}),Ml.parts().thumb({dom:Ws('<div class="${prefix}-slider-thumb"></div>'),behaviours:fi([zu.config({toggleClass:Lu.resolve("thumb-active")})])})]})}},zl=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],jl=function(n){return Q.from(zl[n])},Ll=function(n){return Pn(zl,function(e){return e===n})},Pl=function(n,e){return(je(e)?Q.some(e):vt(e)).map(function(e){return ji(e,function(n){return nc(n,"font-size").isSome()},n).bind(function(n){return nc(n,"font-size")}).getOrThunk(function(){return Qu(e,"font-size")})}).getOr("")},Ul=function(n){var e=n.selection.getStart(),t=Ae.fromDom(e),r=Ae.fromDom(n.getBody()),o=Pl(function(n){return dt(r,n)},t);return Ln(zl,function(n){return o===n}).getOr("medium")},Wl=function(n,e){Ul(n)!==e&&n.execCommand("fontSize",!1,e)},Gl={candidates:D(zl),get:function(n){var e=Ul(n);return Ll(e).getOr(2)},apply:function(n,e){jl(e).each(function(e){Wl(n,e)})}},$l=Gl.candidates(),_l=function(n){return Hl.sketch({onChange:n.onChange,sizes:$l,category:"font",getInitialValue:n.getInitialValue})},ql=function(n){return[Gs('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),_l(n),Gs('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')]},Yl=function(n,e){var t={onChange:function(n){Gl.apply(e,n)},getInitialValue:function(){return Gl.get(e)}};return Al(n,"font-size",function(){return ql(t)})},Kl=function(n){var e=o(n)&&vr(n,"uid")?n.uid:Ds("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(Q.none,Q.some)},asSpec:function(){return $(n,{uid:e})}}},Xl={create:i,clone:function(n){var e;return e=i(n.width,n.height),u(e).drawImage(n,0,0),e},resize:c,get2dContext:u,get3dContext:function(n){var e=null;try{e=n.getContext("webgl")||n.getContext("experimental-webgl")}catch(n){}return e||(e=null),e}},Jl={getWidth:function(n){return n.naturalWidth||n.width},getHeight:function(n){return n.naturalHeight||n.height}},Ql=window.Promise?window.Promise:function(){function e(n,e){return function(){n.apply(e,arguments)}}function t(n){var e=this;null!==this._state?f(function(){var t=e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void n.reject(e)}n.resolve(r)}else(e._state?n.resolve:n.reject)(e._value)}):this._deferreds.push(n)}function r(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void c(e(t,n),e(r,this),e(o,this))}this._state=!0,this._value=n,i.call(this)}catch(n){o.call(this,n)}}function o(n){this._state=!1,this._value=n,i.call(this)}function i(){for(var n=0,e=this._deferreds.length;n<e;n++)t.call(this,this._deferreds[n]);this._deferreds=null}function u(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}function c(n,e,t){var r=!1;try{n(function(n){r||(r=!0,e(n))},function(n){r||(r=!0,t(n))})}catch(n){if(r)return;r=!0,t(n)}}var a=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(n,e(r,this),e(o,this))},f=a.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){n.setTimeout(e,1)},s=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};return a.prototype.catch=function(n){return this.then(null,n)},a.prototype.then=function(n,e){var r=this;return new a(function(o,i){t.call(r,new u(n,e,o,i))})},a.all=function(){var n=Array.prototype.slice.call(1===arguments.length&&s(arguments[0])?arguments[0]:arguments);return new a(function(e,t){function r(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,function(n){r(i,n)},t)}n[i]=u,0==--o&&e(n)}catch(n){t(n)}}if(0===n.length)return e([]);for(var o=n.length,i=0;i<n.length;i++)r(i,n[i])})},a.resolve=function(n){return n&&"object"==typeof n&&n.constructor===a?n:new a(function(e){e(n)})},a.reject=function(n){return new a(function(e,t){t(n)})},a.race=function(n){return new a(function(e,t){for(var r=0,o=n.length;r<o;r++)n[r].then(e,t)})},a}(),Zl={atob:function(n){return tt.getOrDie("atob")(n)},requestAnimationFrame:function(n){tt.getOrDie("requestAnimationFrame")(n)}},nd={blobToImage:l,imageToBlob:function(n){var e=n.src;return 0===e.indexOf("data:")?g(e):d(e)},blobToArrayBuffer:function(n){return new Ql(function(e){var t=f();t.onloadend=function(){e(t.result)},t.readAsArrayBuffer(n)})},blobToDataUri:v,blobToBase64:function(n){return v(n).then(function(n){return n.split(",")[1]})},dataUriToBlobSync:m,canvasToBlob:function(e,t,r){return t=t||"image/png",n.HTMLCanvasElement.prototype.toBlob?new Ql(function(n){e.toBlob(function(e){n(e)},t,r)}):g(e.toDataURL(t,r))},canvasToDataURL:function(n,e,t){return e=e||"image/png",n.then(function(n){return n.toDataURL(e,t)})},blobToCanvas:function(n){return l(n).then(function(n){p(n);var e;return e=Xl.create(Jl.getWidth(n),Jl.getHeight(n)),Xl.get2dContext(e).drawImage(n,0,0),e})},uriToBlob:function(n){return 0===n.indexOf("blob:")?d(n):0===n.indexOf("data:")?g(n):null}},ed={blobToImage:function(n){return nd.blobToImage(n)},imageToBlob:function(n){return nd.imageToBlob(n)},blobToDataUri:function(n){return nd.blobToDataUri(n)},blobToBase64:function(n){return nd.blobToBase64(n)},dataUriToBlobSync:function(n){return nd.dataUriToBlobSync(n)},uriToBlob:function(n){return Q.from(nd.uriToBlob(n))}},td=function(n,e){ed.blobToBase64(e).then(function(t){n.undoManager.transact(function(){var r=n.editorUpload.blobCache,o=r.create(Hf("mceu"),e,t);r.add(o);var i=n.dom.createHTML("img",{src:o.blobUri()});n.insertContent(i)})})},rd=function(n){var e=n.event(),t=e.raw().target.files||e.raw().dataTransfer.files;return Q.from(t[0])},od=function(n){var e=Kl({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:Oo([Ao(vn()),Co(gn(),function(e,t){rd(t).each(function(e){td(n,e)})})])});return zs.sketch({dom:Ws('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})},id=function(n){return n.dom().textContent},ud=function(n,e){n.dom().textContent=e},cd=function(n){return n.length>0},ad=function(n){return void 0===n||null===n?"":n},fd=function(n){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:Q.none()}},sd=function(n){var e=id(n),t=hi(n,"href"),r=hi(n,"title"),o=hi(n,"target");return{url:ad(t),text:e!==t?ad(e):"",title:ad(r),target:ad(o),link:Q.some(n)}},ld=function(n){return hi(n,"href")===id(n)},dd=function(n,e,t){return t.text.filter(cd).fold(function(){return ld(n)?Q.some(e):Q.none()},Q.some)},md=function(n,e){e.link.bind(B).each(function(e){n.execCommand("unlink")})},gd=function(n,e){var t={};return t.href=n,e.title.filter(cd).each(function(n){t.title=n}),e.target.filter(cd).each(function(n){t.target=n}),t},vd=function(n){var e=Ae.fromDom(n.selection.getStart());return gc(e,"a")},pd={getInfo:function(n){return vd(n).fold(function(){return fd(n)},function(n){return sd(n)})},applyInfo:function(n,e){e.url.filter(cd).fold(function(){md(n,e)},function(t){var r=gd(t,e);e.link.bind(B).fold(function(){var o=e.text.filter(cd).getOr(t);n.insertContent(n.dom.createHTML("a",r,n.dom.encode(o)))},function(n){var o=dd(n,t,e);pi(n,r),o.each(function(e){ud(n,e)})})})},query:vd},hd=se.detect(),bd=function(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)},yd={forAndroid:function(n,e){(hd.os.isAndroid()?bd:A)(e,n)}},wd=function(n,e){var t=Oo(e);return li({fields:[oo("enabled")],name:n,active:{events:D(t)}})},xd=function(n,e){return{key:n,value:{config:{},me:wd(n,e),configAsRaw:D({}),initialConfig:{},state:ci}}},Sd=Object.freeze({getCurrent:function(n,e,t){return e.find()(n)}}),Td=[oo("find")],Od=li({fields:Td,name:"composing",apis:Sd}),kd=Vs({name:"Container",factory:function(n){return{uid:n.uid(),dom:$({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:kf(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[go("components",[]),Of("containerBehaviours",[]),go("events",{}),go("domModification",{}),go("eventOrder",{})]}),Cd=Vs({name:"DataField",factory:function(n){return{uid:n.uid(),dom:n.dom(),behaviours:$(fi([Ol.config({store:{mode:"memory",initialValue:n.getInitialValue()()}}),Od.config({find:Q.some})]),kf(n.dataBehaviours())),events:Oo([Fo(function(e,t){Ol.setValue(e,n.getInitialValue()())})])}},configFields:[oo("uid"),oo("dom"),oo("getInitialValue"),Of("dataBehaviours",[Ol,Od])]}),Ed=function(n){return n.dom().value},Dd=function(n,e){if(void 0===e)throw new Error("Value.set was undefined");n.dom().value=e},Bd=function(n){return fi([_u.config({onFocus:!1===n.selectOnFocus()?C:function(n){var e=n.element(),t=Ed(e);e.dom().setSelectionRange(0,t.length)}})])},Id=function(n){return $(fi([Ol.config({store:{mode:"manual",initialValue:n.data().getOr(void 0),getValue:function(n){return Ed(n.element())},setValue:function(n,e){Ed(n.element())!==e&&Dd(n.element(),e)}},onSetValue:n.onSetValue()})]),Bd(n),kf(n.inputBehaviours()))},Md=function(n){return{tag:n.tag(),attributes:$(mr([{key:"type",value:n.type()}].concat(n.placeholder().map(function(n){return{key:"placeholder",value:n}}).toArray())),n.inputAttributes()),styles:n.inputStyles(),classes:n.inputClasses()}},Ad=Vs({name:"Input",configFields:D([fo("data"),go("inputAttributes",{}),go("inputStyles",{}),go("type","input"),go("tag","input"),go("inputClasses",[]),yu("onSetValue"),go("styles",{}),fo("placeholder"),go("eventOrder",{}),Of("inputBehaviours",[Ol,_u]),go("selectOnFocus",!0)])(),factory:function(n,e){return{uid:n.uid(),dom:Md(n),components:[],behaviours:Id(n),eventOrder:n.eventOrder()}}}),Rd=Object.freeze({exhibit:function(n,e){return $o({attributes:mr([{key:e.tabAttr(),value:"true"}])})}}),Fd=[go("tabAttr","data-alloy-tabstop")],Nd=li({fields:Fd,name:"tabstopping",active:Rd}),Vd=function(n,e){var t=Kl(Ad.sketch({placeholder:e,onSetValue:function(n,e){Oe(n,mn())},inputBehaviours:fi([Od.config({find:Q.some}),Nd.config({}),Tf.config({mode:"execution"})]),selectOnFocus:!1})),r=Kl(zs.sketch({dom:Ws('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var e=t.get(n);Ol.setValue(e,"")}}));return{name:n,spec:kd.sketch({dom:Ws('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),r.asSpec()],containerBehaviours:fi([zu.config({toggleClass:Lu.resolve("input-container-empty")}),Od.config({find:function(n){return Q.some(t.get(n))}}),xd("input-clearing",[Co(mn(),function(n){var e=t.get(n);(Ol.getValue(e).length>0?zu.off:zu.on)(n)})])])})}},Hd=function(n){return{name:n,spec:Cd.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return Q.none()}})}},zd=["input","button","textarea"],jd=function(n,e,t){e.disabled()&&qd(n,e,t)},Ld=function(n){return An(zd,Ve(n.element()))},Pd=function(n){return bi(n.element(),"disabled")},Ud=function(n){vi(n.element(),"disabled","disabled")},Wd=function(n){yi(n.element(),"disabled")},Gd=function(n){return"true"===hi(n.element(),"aria-disabled")},$d=function(n){vi(n.element(),"aria-disabled","true")},_d=function(n){vi(n.element(),"aria-disabled","false")},qd=function(n,e,t){e.disableClass().each(function(e){Di(n.element(),e)}),(Ld(n)?Ud:$d)(n)},Yd=function(n){return Ld(n)?Pd(n):Gd(n)},Kd=Object.freeze({enable:function(n,e,t){e.disableClass().each(function(e){Ii(n.element(),e)}),(Ld(n)?Wd:_d)(n)},disable:qd,isDisabled:Yd,onLoad:jd}),Xd=Object.freeze({exhibit:function(n,e,t){return $o({classes:e.disabled()?e.disableClass().map(Xn).getOr([]):[]})},events:function(n,e){return Oo([ko(ve(),function(n,e){return Yd(n)}),Ko(n,e,jd)])}}),Jd=[go("disabled",!1),fo("disableClass")],Qd=li({fields:Jd,name:"disabling",active:Xd,apis:Kd}),Zd=[Of("formBehaviours",[Ol])],nm=function(n){return"<alloy.field."+n+">"},em=function(n,e,t){return $({"debug.sketcher":{Form:t},uid:n.uid(),dom:n.dom(),components:e,behaviours:$(fi([Ol.config({store:{mode:"manual",getValue:function(e){var t=ds(e,n);return en(t,function(n,e){return n().bind(Od.getCurrent).map(Ol.getValue)})},setValue:function(e,t){nn(t,function(t,r){ss(e,n,r).each(function(n){Od.getCurrent(n).each(function(n){Ol.setValue(n,t)})})})}}})]),kf(n.formBehaviours())),apis:{getField:function(e,t){return ss(e,n,t).bind(Od.getCurrent)}}})},tm={getField:ys(function(n,e,t){return n.getField(e,t)}),sketch:function(n){var e=function(){var n=[];return{field:function(e,t){return n.push(e),is("form",nm(e),t)},record:function(){return n}}}(),t=n(e),r=e.record(),o=Fn(r,function(n){return Jf({name:n,pname:nm(n)})});return As("form",Zd,o,em,t)}},rm=function(){var n=Hi(Q.none()),e=function(){n.get().each(function(n){n.destroy()})};return{clear:function(){e(),n.set(Q.none())},isSet:function(){return n.get().isSome()},set:function(t){e(),n.set(Q.some(t))},run:function(e){n.get().each(e)}}},om=function(){var n=Hi(Q.none());return{clear:function(){n.set(Q.none())},set:function(e){n.set(Q.some(e))},isSet:function(){return n.get().isSome()},on:function(e){n.get().each(e)}}},im={init:function(n){return{xValue:n,points:[]}},move:function(n,e){if(e===n.xValue)return n;var t=e-n.xValue>0?1:-1,r={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([r])}},complete:function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,t=n.points[n.points.length-1].direction;return-1===e&&-1===t?-1:1===e&&1===t?1:0}},um=function(n){var e=zr([oo("fields"),go("maxFieldIndex",n.fields.length-1),oo("onExecute"),oo("getInitialValue"),ho("state",function(){return{dialogSwipeState:om(),currentScreen:Hi(0)}})]),t=Qr("SerialisedDialog",e,n),r=function(n,e,t){return zs.sketch({dom:Ws('<span class="${prefix}-icon-'+e+' ${prefix}-icon"></span>'),action:function(e){ke(e,"navigateEvent",{direction:n})},buttonBehaviours:fi([Qd.config({disableClass:Lu.resolve("toolbar-navigation-disabled"),disabled:!t})])})},o=function(n,e){mc(n.element(),"."+Lu.resolve("serialised-dialog-chain")).each(function(n){Xu(n,"left",-t.state.currentScreen.get()*e.width+"px")})},i=function(n,e){var r=sc(n.element(),"."+Lu.resolve("serialised-dialog-screen"));mc(n.element(),"."+Lu.resolve("serialised-dialog-chain")).each(function(n){t.state.currentScreen.get()+e>=0&&t.state.currentScreen.get()+e<r.length&&(nc(n,"left").each(function(t){var o=parseInt(t,10),i=Bl(r[0]);Xu(n,"left",o-e*i+"px")}),t.state.currentScreen.set(t.state.currentScreen.get()+e))})},u=function(n){var e=sc(n.element(),"input");Q.from(e[t.state.currentScreen.get()]).each(function(e){n.getSystem().getByDom(e).each(function(e){Ie(n,e.element())})});var r=f.get(n);Hc.highlightAt(r,t.state.currentScreen.get())},c=function(){t.state.currentScreen.set(0),t.state.dialogSwipeState.clear()},a=Kl(tm.sketch(function(n){return{dom:Ws('<div class="${prefix}-serialised-dialog"></div>'),components:[kd.sketch({dom:Ws('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:Fn(t.fields,function(e,o){return o<=t.maxFieldIndex?kd.sketch({dom:Ws('<div class="${prefix}-serialised-dialog-screen"></div>'),components:Gn([[r(-1,"previous",o>0)],[n.field(e.name,e.spec)],[r(1,"next",o<t.maxFieldIndex)]])}):n.field(e.name,e.spec)})})],formBehaviours:fi([ju.orientation(function(n,e){o(n,e)}),Tf.config({mode:"special",focusIn:function(n){u(n)},onTab:function(n){return i(n,1),Q.some(!0)},onShiftTab:function(n){return i(n,-1),Q.some(!0)}}),xd("form-events",[Fo(function(n,e){c();var r=f.get(n);Hc.highlightFirst(r),t.getInitialValue(n).each(function(e){Ol.setValue(n,e)})}),Ho(t.onExecute),Co(pn(),function(n,e){"left"===e.event().raw().propertyName&&u(n)}),Co("navigateEvent",function(n,e){var t=e.event().direction();i(n,t)})])])}})),f=Kl({dom:Ws('<div class="${prefix}-dot-container"></div>'),behaviours:fi([Hc.config({highlightClass:Lu.resolve("dot-active"),itemClass:Lu.resolve("dot-item")})]),components:$n(t.fields,function(n,e){return e<=t.maxFieldIndex?[Gs('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:Ws('<div class="${prefix}-serializer-wrapper"></div>'),components:[a.asSpec(),f.asSpec()],behaviours:fi([Tf.config({mode:"special",focusIn:function(n){var e=a.get(n);Tf.focusIn(e)}}),xd("serializer-wrapper-events",[Co(on(),function(n,e){var r=e.event();t.state.dialogSwipeState.set(im.init(r.touches[0].clientX))}),Co(un(),function(n,e){var r=e.event();t.state.dialogSwipeState.on(function(n){e.event().prevent(),t.state.dialogSwipeState.set(im.move(n,r.raw().touches[0].clientX))})}),Co(cn(),function(n){t.state.dialogSwipeState.on(function(e){var t=a.get(n),r=-1*im.complete(e);i(t,r)})})])])}},cm=bn(function(n,e){return[{label:"the link group",items:[um({fields:[Vd("url","Type or paste URL"),Vd("text","Link text"),Vd("title","Link title"),Vd("target","Link target"),Hd("link")],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return Q.some(pd.getInfo(e))},onExecute:function(t){var r=Ol.getValue(t);pd.applyInfo(e,r),n.restoreToolbar(),e.focus()}})]}]}),am=function(n,e){return qs.forToolbarStateAction(e,"link","link",function(){var t=cm(n,e);n.setContextToolbar(t),yd.forAndroid(e,function(){n.focusToolbar()}),pd.query(e).each(function(n){e.selection.select(n.dom())})})},fm=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],sm=function(n,e,t){return dt(e,n.element())&&!dt(e,t)},lm=Oo([function(n,e){return{key:n,value:yo({can:e})}}(de(),function(e,t){var r=t.event().originator(),o=t.event().target();return!sm(e,r,o)||(n.console.warn(de()+" did not get interpreted by the desired target. \nOriginator: "+ou(r)+"\nTarget: "+ou(o)+"\nCheck the "+de()+" event handlers"),!1)})]),dm=Object.freeze({events:lm}),mm=B,gm=ii(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),vm=function(n){var e=function(e){return function(){throw new Error("The component must be in a context to send: "+e+"\n"+ou(n().element())+" is not in context.")}};return gm({debugInfo:D("fake"),triggerEvent:e("triggerEvent"),triggerFocus:e("triggerFocus"),triggerEscape:e("triggerEscape"),build:e("build"),addToWorld:e("addToWorld"),removeFromWorld:e("removeFromWorld"),addToGui:e("addToGui"),removeFromGui:e("removeFromGui"),getByUid:e("getByUid"),getByDom:e("getByDom"),broadcast:e("broadcast"),broadcastOn:e("broadcastOn"),isConnected:D(!1)})},pm=function(n,e){var t=Fn(e,function(n){return lo(n.name(),[oo("config"),go("state",ci)])}),r=Kr("component.behaviours",zr(t),n.behaviours).fold(function(e){throw new Error(no(e)+"\nComplete spec:\n"+yr.stringify(n,null,2))},function(n){return n});return{list:e,data:en(r,function(n){var e=n().map(function(n){return{config:n.config(),state:n.state().init(n.config())}});return function(){return e}})}},hm=function(n){return n.list},bm=function(n){return n.data},ym=function(n,e){var t={};return nn(n,function(n,r){nn(n,function(n,o){var i=sr(o,[])(t);t[o]=i.concat([e(r,n)])})}),t},wm=function(n,e){return n.length>1?Lt.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+yr.stringify(Fn(n,function(n){return n.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Lt.value({}):Lt.value(n[0].modification().fold(function(){return{}},function(n){return dr(e,n)}))},xm=function(n,e,t,r){return Lt.error("Mulitple behaviours have tried to change the _"+e+'_ "'+n+'". The guilty behaviours are: '+yr.stringify($n(r,function(n){return void 0!==n.modification().getOr({})[e]?[n.name()]:[]}),null,2)+". This is not currently supported.")},Sm=function(n,e){return jn(n,function(t,r){var o=r.modification().getOr({});return t.bind(function(t){var r=rn(o,function(r,o){return void 0!==t[o]?xm(e,o,0,n):Lt.value(dr(o,r))});return gr(r,t)})},Lt.value({})).map(function(n){return dr(e,n)})},Tm={classes:function(n,e){var t=$n(n,function(n){return n.modification().getOr([])});return Lt.value(dr(e,t))},attributes:Sm,styles:Sm,domChildren:wm,defChildren:wm,innerHtml:wm,value:wm},Om=function(n,e,t,r){var o=$({},e);Nn(t,function(e){o[e.name()]=e.exhibit(n,r)});var i=ym(o,function(n,e){return{name:function(){return n},modification:e}}),u=en(i,function(n,e){return $n(n,function(n){return n.modification().fold(function(){return[]},function(e){return[n]})})}),c=rn(u,function(n,e){return lr(Tm,e).fold(function(){return Lt.error("Unknown field type: "+e)},function(t){return t(n,e)})});return gr(c,{}).map($o)},km=function(n,e,t,r){var o=t.slice(0);try{var i=o.sort(function(t,o){var i=t[e](),u=o[e](),c=r.indexOf(i),a=r.indexOf(u);if(-1===c)throw new Error("The ordering for "+n+" does not have an entry for "+i+".\nOrder specified: "+yr.stringify(r,null,2));if(-1===a)throw new Error("The ordering for "+n+" does not have an entry for "+u+".\nOrder specified: "+yr.stringify(r,null,2));return c<a?-1:a<c?1:0});return Lt.value(i)}catch(n){return Lt.error([n])}},Cm=function(n,e){return{handler:n,purpose:D(e)}},Em=function(n,e){return{cHandler:n,purpose:D(e)}},Dm=function(n,t){return Em(e.apply(void 0,[n.handler].concat(t)),n.purpose())},Bm=function(n){return n.cHandler},Im=function(n,e){return{name:D(n),handler:D(e)}},Mm=function(n,e){var t={};return Nn(n,function(n){t[n.name()]=n.handlers(e)}),t},Am=function(n,e,t){var r=$(t,Mm(e,n));return ym(r,Im)},Rm=function(n,e,t,r){var o=Am(n,t,r);return Hm(o,e)},Fm=function(n){var e=So(n);return function(n,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i=[n,t].concat(r);e.abort.apply(void 0,i)?t.stop():e.can.apply(void 0,i)&&e.run.apply(void 0,i)}},Nm=function(n,e){return Lt.error(["The event ("+n+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+yr.stringify(Fn(e,function(n){return n.name()}),null,2)])},Vm=function(n,e,t){var r=e[t];return r?km("Event: "+t,"name",n,r).map(function(n){var e=Fn(n,function(n){return n.handler()});return To(e)}):Nm(t,n)},Hm=function(n,e){var t=rn(n,function(n,t){return(1===n.length?Lt.value(n[0].handler()):Vm(n,e,t)).map(function(r){var o=Fm(r),i=n.length>1?Hn(e,function(e){return An(n,function(n){return n.name()===e})}).join(" > "):n[0].name();return dr(t,Cm(o,i))})});return gr(t,{})},zm=function(n){return Kr("custom.definition",Hr([Wr("dom","dom",$t(),Hr([oo("tag"),go("styles",{}),go("classes",[]),go("attributes",{}),fo("value"),fo("innerHtml")])),oo("components"),oo("uid"),go("events",{}),go("apis",D({})),Wr("eventOrder","eventOrder",Gt({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]}),to()),fo("domModification"),Ou("originalSpec"),go("debug.sketcher","unknown")]),n)},jm=function(n){return dr(Ss(),n.uid())},Lm=function(n){var e={tag:n.dom().tag(),classes:n.dom().classes(),attributes:$(jm(n),n.dom().attributes()),styles:n.dom().styles(),domChildren:Fn(n.components(),function(n){return n.element()})};return Uo($(e,n.dom().innerHtml().map(function(n){return dr("innerHtml",n)}).getOr({}),n.dom().value().map(function(n){return dr("value",n)}).getOr({})))},Pm=function(n){return n.domModification().fold(function(){return $o({})},$o)},Um=function(n){return n.events()},Wm=function(n,e){Nn(e,function(e){Di(n,e)})},Gm=function(n,e){Nn(e,function(e){Ii(n,e)})},$m=function(n){if(n.domChildren().isSome()&&n.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+Wo(n));return n.domChildren().fold(function(){var e=n.defChildren().getOr([]);return Fn(e,qm)},function(n){return n})},_m=function(n){var e=Ae.fromTag(n.tag());pi(e,n.attributes().getOr({})),Wm(e,n.classes().getOr([])),Ju(e,n.styles().getOr({})),Zi(e,n.innerHtml().getOr(""));var t=$m(n);return Ct(e,t),n.value().each(function(n){Dd(e,n)}),e},qm=function(n){var e=Uo(n);return _m(e)},Ym=function(n){var e=lr(n,"behaviours").getOr({}),t=Hn(Z(e),function(n){return void 0!==e[n]});return Fn(t,function(n){return e[n].me})},Km=function(n,e){return pm(n,e)},Xm=function(n){var e=Ym(n);return Km(n,e)},Jm=ii(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),Qm=function(n,e,t){var r=Lm(n),o={"alloy.base.modification":Pm(n)},i=Om(t,o,e,r).getOrDie();return qo(r,i)},Zm=function(n,e,t){var r={"alloy.base.behaviour":Um(n)};return Rm(t,n.eventOrder(),e,r).getOrDie()},ng=function(n){var e=function(){return l},t=Hi(vm(e)),r=Jr(zm($(n,{behaviours:void 0}))),o=Xm(n),i=hm(o),u=bm(o),c=Qm(r,i,u),a=_m(c),f=Zm(r,i,u),s=Hi(r.components()),l=Jm({getSystem:t.get,config:function(e){if(e===ws())return r.apis();if(H(e))throw new Error("Invalid input: only API constant is allowed");var t=u;return(P(t[e.name()])?t[e.name()]:function(){throw new Error("Could not find "+e.name()+" in "+yr.stringify(n,null,2))})()},hasConfigured:function(n){return P(u[n.name()])},spec:D(n),readState:function(n){return u[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},connect:function(n){t.set(n)},disconnect:function(){t.set(vm(e))},element:D(a),syncComponents:function(){var n=yt(a),e=$n(n,function(n){return t.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});s.set(e)},components:s.get,events:D(f)});return l},eg=function(n){var e=sr("components",[])(n);return Fn(e,ig)},tg=function(n){var e=mm(n),t=eg(e),r=$(dm,e,dr("components",t));return Lt.value(ng(r))},rg=function(n){var e=Ae.fromText(n);return og({element:e})},og=function(n){var e=Zr("external.component",Hr([oo("element"),fo("uid")]),n),t=Hi(vm());e.uid().each(function(n){Cs(e.element(),n)});var r=Jm({getSystem:t.get,config:Q.none,hasConfigured:D(!1),connect:function(n){t.set(n)},disconnect:function(){t.set(vm(function(){return r}))},element:D(e.element()),spec:D(n),readState:D("No state"),syncComponents:C,components:D([]),events:D({})});return hs(r)},ig=function(n){return bs(n).fold(function(){var e=$({uid:Ds("")},n);return tg(e).getOrDie()},function(n){return n})},ug=hs,cg=function(n){($i(n.element()).isNone()||_u.isFocused(n))&&(_u.isFocused(n)||_u.focus(n),ke(n,"alloy.item-hover",{item:n}))},ag=function(n){ke(n,"alloy.item-focus",{item:n})},fg=D("alloy.item-hover"),sg=D("alloy.item-focus"),lg=[oo("data"),oo("components"),oo("dom"),fo("toggling"),go("itemBehaviours",{}),go("ignoreFocus",!1),go("domModification",{}),Tu("builder",function(n){return{dom:$(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:$(fi([n.toggling().fold(zu.revoke,function(n){return zu.config($({aria:{mode:"checked"}},n))}),_u.config({ignore:n.ignoreFocus(),onFocus:function(n){ag(n)}}),Tf.config({mode:"execution"}),Ol.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:Oo([Mo(be(),Ce),Ao(an()),Co(ln(),cg),Co(pe(),_u.focus)]),components:n.components(),domModification:n.domModification(),eventOrder:n.eventOrder()}}),go("eventOrder",{})],dg=[oo("dom"),oo("components"),Tu("builder",function(n){return{dom:n.dom(),components:n.components(),events:Oo([Ro(pe())])}})],mg=D([Jf({name:"widget",overrides:function(n){return{behaviours:fi([Ol.config({store:{mode:"manual",getValue:function(e){return n.data()},setValue:function(){}}})])}}})]),gg=[oo("uid"),oo("data"),oo("components"),oo("dom"),go("autofocus",!1),go("domModification",{}),gs(mg()),Tu("builder",function(n){var e=as(0,n,mg()),t=fs("item-widget",n,e.internals()),r=function(e){return ss(e,n,"widget").map(function(n){return Tf.focusIn(n),n})},o=function(e,t){return Gc(t.event().target())?Q.none():n.autofocus()?(t.setSource(e.element()),Q.none()):Q.none()};return $({dom:n.dom(),components:t,domModification:n.domModification(),events:Oo([Ho(function(n,e){r(n).each(function(n){e.stop()})}),Co(ln(),cg),Co(pe(),function(e,t){n.autofocus()?r(e):_u.focus(e)})]),behaviours:fi([Ol.config({store:{mode:"memory",initialValue:n.data()}}),_u.config({onFocus:function(n){ag(n)}}),Tf.config({mode:"special",focusIn:n.autofocus()?function(n){r(n)}:mi(),onLeft:o,onRight:o,onEscape:function(e,t){return _u.isFocused(e)||n.autofocus()?n.autofocus()?(t.setSource(e.element()),Q.none()):Q.none():(_u.focus(e),Q.some(!0))}})])})})],vg=eo("type",{widget:gg,item:lg,separator:dg}),pg=D([Zf({factory:{sketch:function(n){var e=Zr("menu.spec item",vg,n);return e.builder()(e)}},name:"items",unit:"item",defaults:function(n,e){var t=Ds("");return $({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})]),hg=D([oo("value"),oo("items"),oo("dom"),oo("components"),go("eventOrder",{}),Of("menuBehaviours",[Hc,Ol,Od,Tf]),vo("movement",{mode:"menu",moveOnTab:!0},eo("mode",{grid:[ku(),Tu("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}})],menu:[go("moveOnTab",!0),Tu("config",function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}})]})),io("markers",pu()),go("fakeFocus",!1),go("focusManager",zc()),yu("onHighlight")]),bg=D("alloy.menu-focus"),yg=Hs({name:"Menu",configFields:hg(),partFields:pg(),factory:function(n,e,t,r){return $({dom:$(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:$(fi([Hc.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),Ol.config({store:{mode:"memory",initialValue:n.value()}}),Od.config({find:Q.some}),Tf.config(n.movement().config()(n,n.movement()))]),kf(n.menuBehaviours())),events:Oo([Co(sg(),function(n,e){var t=e.event();n.getSystem().getByDom(t.target()).each(function(t){Hc.highlight(n,t),e.stop(),ke(n,bg(),{menu:n,item:t})})}),Co(fg(),function(n,e){var t=e.event().item();Hc.highlight(n,t)})]),components:e,eventOrder:n.eventOrder()})}}),wg=function(n,e){var t=mt(e),r=Gi(t).bind(function(n){var t=function(e){return dt(n,e)};return t(e)?Q.some(e):Li(e,t)}),o=n(e);return r.each(function(n){Gi(t).filter(function(e){return dt(e,n)}).fold(function(){Pi(n)},C)}),o},xg=function(n,e,t,r){var o=n.getSystem().build(r);At(n,o,t)},Sg=function(n,e){return n.components()},Tg=li({fields:[],name:"replacing",apis:Object.freeze({append:function(n,e,t,r){xg(n,0,kt,r)},prepend:function(n,e,t,r){xg(n,0,Ot,r)},remove:function(n,e,t,r){var o=Sg(n,e);Ln(o,function(n){return dt(r.element(),n.element())}).each(Ft)},set:function(n,e,t,r){Nt(n),wg(function(){var e=Fn(r,n.getSystem().build);Nn(e,function(e){Mt(n,e)})},n.element())},contents:Sg})}),Og=function(n){return tn(n,function(n,e){return{k:n,v:e}})},kg=function(n,e,t,r){return lr(t,r).bind(function(r){return lr(n,r).bind(function(r){var o=kg(n,e,t,r);return Q.some([r].concat(o))})}).getOr([])},Cg=function(n,e){var t={};nn(n,function(n,e){Nn(n,function(n){t[n]=e})});var r=e,o=Og(e),i=en(o,function(n,e){return[e].concat(kg(t,r,o,e))});return en(t,function(n){return lr(i,n).getOr([n])})},Eg={init:function(){var n=Hi({}),e=Hi({}),t=Hi({}),r=Hi(Q.none()),o=Hi({}),i=function(n){return lr(e.get(),n)};return{setContents:function(i,u,c,a){r.set(Q.some(i)),n.set(c),e.set(u),o.set(a);var f=Cg(a,c);t.set(f)},expand:function(e){return lr(n.get(),e).map(function(n){var r=lr(t.get(),e).getOr([]);return[n].concat(r)})},refresh:function(n){return lr(t.get(),n)},collapse:function(n){return lr(t.get(),n).bind(function(n){return n.length>1?Q.some(n.slice(1)):Q.none()})},lookupMenu:i,otherMenus:function(n){var e=o.get();return Kn(Z(e),n)},getPrimary:function(){return r.get().bind(i)},getMenus:function(){return e.get()},clear:function(){n.set({}),e.set({}),t.set({}),r.set(Q.none())},isClear:function(){return r.get().isNone()}}}},Dg=D("collapse-item"),Bg=Vs({name:"TieredMenu",configFields:[Su("onExecute"),Su("onEscape"),xu("onOpenMenu"),xu("onOpenSubmenu"),yu("onCollapseMenu"),go("openImmediately",!0),ao("data",[oo("primary"),oo("menus"),oo("expansions")]),go("fakeFocus",!1),yu("onHighlight"),yu("onHover"),ao("markers",[oo("backgroundMenu")].concat(gu()).concat(vu())),oo("dom"),go("navigateOnHover",!0),go("stayInDom",!1),Of("tmenuBehaviours",[Tf,Hc,Od,Tg]),go("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:function(n,e){var t=function(t,r){return en(r,function(r,o){var i=yg.sketch($(r,{value:o,items:r.items,markers:cr(e.markers,["item","selectedItem"]),fakeFocus:n.fakeFocus(),onHighlight:n.onHighlight(),focusManager:n.fakeFocus()?jc():zc()}));return t.getSystem().build(i)})},r=Eg.init(),o=function(e){var o=t(e,n.data().menus()),i=u(e);return r.setContents(n.data().primary(),o,n.data().expansions(),i),r.getPrimary()},i=function(n){return Ol.getValue(n).value},u=function(e){return en(n.data().menus(),function(n,e){return $n(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},c=function(n,e){Hc.highlight(n,e),Hc.getHighlighted(e).orThunk(function(){return Hc.getFirst(e)}).each(function(e){Ee(n,e.element(),pe())})},a=function(n,e){return cu(Fn(e,n.lookupMenu))},f=function(e,t,r){return Q.from(r[0]).bind(t.lookupMenu).map(function(o){var i=a(t,r.slice(1));Nn(i,function(e){Di(e.element(),n.markers().backgroundMenu())}),Pe(o.element())||Tg.append(e,ug(o)),Gm(o.element(),[n.markers().backgroundMenu()]),c(e,o);var u=a(t,t.otherMenus(r));return Nn(u,function(t){Gm(t.element(),[n.markers().backgroundMenu()]),n.stayInDom()||Tg.remove(e,t)}),o})},s=function(e,t){var o=i(t);return r.expand(o).bind(function(o){return Q.from(o[0]).bind(r.lookupMenu).each(function(r){Pe(r.element())||Tg.append(e,ug(r)),n.onOpenSubmenu()(e,t,r),Hc.highlightFirst(r)}),f(e,r,o)})},l=function(e,t){var o=i(t);return r.collapse(o).bind(function(o){return f(e,r,o).map(function(r){return n.onCollapseMenu()(e,t,r),r})})},d=function(n,e){var t=i(e);return r.refresh(t).bind(function(e){return f(n,r,e)})},m=function(e){return function(t,r){return gc(r.getSource(),"."+n.markers().item()).bind(function(n){return t.getSystem().getByDom(n).toOption().bind(function(n){return e(t,n).map(function(){return!0})})})}},g=Oo([Co(bg(),function(n,e){var t=e.event().menu();Hc.highlight(n,t)}),Ho(function(e,t){var r=t.event().target();e.getSystem().getByDom(r).each(function(t){0===i(t).indexOf("collapse-item")&&l(e,t),s(e,t).fold(function(){n.onExecute()(e,t)},function(){})})}),Fo(function(e,t){o(e).each(function(t){Tg.append(e,ug(t)),n.openImmediately()&&(c(e,t),n.onOpenMenu()(e,t))})})].concat(n.navigateOnHover()?[Co(fg(),function(e,t){var r=t.event().item();d(e,r),s(e,r),n.onHover()(e,r)})]:[]));return{uid:n.uid(),dom:n.dom(),behaviours:$(fi([Tf.config({mode:"special",onRight:m(function(n,e){return Gc(e.element())?Q.none():s(n,e)}),onLeft:m(function(n,e){return Gc(e.element())?Q.none():l(n,e)}),onEscape:m(function(e,t){return l(e,t).orThunk(function(){return n.onEscape()(e,t).map(function(){return e})})}),focusIn:function(n,e){r.getPrimary().each(function(e){Ee(n,e.element(),pe())})}}),Hc.config({highlightClass:n.markers().selectedMenu(),itemClass:n.markers().menu()}),Od.config({find:function(n){return Hc.getHighlighted(n)}}),Tg.config({})]),kf(n.tmenuBehaviours())),eventOrder:n.eventOrder(),apis:{collapseMenu:function(n){Hc.getHighlighted(n).each(function(e){Hc.getHighlighted(e).each(function(e){l(n,e)})})}},events:g}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:dr(n,e),expansions:{}}},collapseItem:function(n){return{value:Hf(Dg()),text:n}}}}),Ig=function(n,e,t,r){return lr(e.routes(),r.start()).map(A).bind(function(n){return lr(n,r.destination()).map(A)})},Mg=function(n,e,t){return Ng(n,e,t).bind(function(r){return Ag(n,e,t,r)})},Ag=function(n,e,t,r){return Ig(0,e,0,r).bind(function(n){return n.transition().map(function(e){return{transition:D(e),route:D(n)}})})},Rg=function(n,e,t){Mg(n,e,t).each(function(t){var r=t.transition();Ii(n.element(),r.transitionClass()),yi(n.element(),e.destinationAttr())})},Fg=function(n,e,t,r){return{start:D(hi(n.element(),e.stateAttr())),destination:D(r)}},Ng=function(n,e,t){var r=n.element();return bi(r,e.destinationAttr())?Q.some({start:D(hi(n.element(),e.stateAttr())),destination:D(hi(n.element(),e.destinationAttr()))}):Q.none()},Vg=function(n,e,t,r){Rg(n,e,t),bi(n.element(),e.stateAttr())&&hi(n.element(),e.stateAttr())!==r&&e.onFinish()(n,r),vi(n.element(),e.stateAttr(),r)},Hg=function(n,e,t,r){bi(n.element(),e.destinationAttr())&&(vi(n.element(),e.stateAttr(),hi(n.element(),e.destinationAttr())),yi(n.element(),e.destinationAttr()))},zg=Object.freeze({findRoute:Ig,disableTransition:Rg,getCurrentRoute:Ng,jumpTo:Vg,progressTo:function(n,e,t,r){Hg(n,e);var o=Fg(n,e,0,r);Ag(n,e,t,o).fold(function(){Vg(n,e,t,r)},function(o){Rg(n,e,t);var i=o.transition();Di(n.element(),i.transitionClass()),vi(n.element(),e.destinationAttr(),r)})},getState:function(n,e,t){var r=n.element();return bi(r,e.stateAttr())?Q.some(hi(r,e.stateAttr())):Q.none()}}),jg=Object.freeze({events:function(n,e){return Oo([Co(pn(),function(t,r){var o=r.event().raw();Ng(t,n,e).each(function(r){Ig(0,n,0,r).each(function(i){i.transition().each(function(i){o.propertyName===i.property()&&(Vg(t,n,e,r.destination()),n.onTransition()(t,r))})})})}),Fo(function(t,r){Vg(t,n,e,n.initialState())})])}}),Lg=[go("destinationAttr","data-transitioning-destination"),go("stateAttr","data-transitioning-state"),oo("initialState"),yu("onTransition"),yu("onFinish"),io("routes",Lr(Lt.value,Lr(Lt.value,Hr([mo("transition",[oo("property"),oo("transitionClass")])]))))],Pg=li({fields:Lg,name:"transitioning",active:jg,apis:zg,extra:{createRoutes:function(n){var e={};return nn(n,function(n,t){var r=t.split("<->");e[r[0]]=dr(r[1],n),e[r[1]]=dr(r[0],n)}),e},createBistate:function(n,e,t){return mr([{key:n,value:dr(e,t)},{key:e,value:dr(n,t)}])},createTristate:function(n,e,t,r){return mr([{key:n,value:mr([{key:e,value:r},{key:t,value:r}])},{key:e,value:mr([{key:n,value:r},{key:t,value:r}])},{key:t,value:mr([{key:n,value:r},{key:e,value:r}])}])}}}),Ug=Lu.resolve("scrollable"),Wg={register:function(n){Di(n,Ug)},deregister:function(n){Ii(n,Ug)},scrollable:D(Ug)},Gg=function(n){return lr(n,"format").getOr(n.title)},$g=function(n,e){var t=qg("Styles",[].concat(Fn(n.items,function(e){return _g(Gg(e),e.title,e.isSelected(),e.getPreview(),vr(n.expansions,Gg(e)))})),e,!1),r=en(n.menus,function(t,r){var o=Fn(t,function(e){return _g(Gg(e),e.title,void 0!==e.isSelected&&e.isSelected(),void 0!==e.getPreview?e.getPreview():"",vr(n.expansions,Gg(e)))});return qg(r,o,e,!0)}),o=$(r,dr("styles",t));return{tmenu:Bg.tieredData("styles",o,n.expansions)}},_g=function(n,e,t,r,o){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:o?[Lu.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:Lu.resolve("format-matches"),selected:t},itemBehaviours:fi(o?[]:[ju.format(n,function(n,e){(e?zu.on:zu.off)(n)})]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:e}}]}},qg=function(n,e,t,r){return{value:n,dom:{tag:"div"},components:[zs.sketch({dom:{tag:"div",classes:[Lu.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[Lu.resolve("styles-collapse-icon")]}},rg(n)]:[rg(n)],action:function(n){if(r){var e=t().get(n);Bg.collapseMenu(e)}}}),{dom:{tag:"div",classes:[Lu.resolve("styles-menu-items-container")]},components:[yg.parts().items({})],behaviours:fi([xd("adhoc-scrollable-menu",[Fo(function(n,e){Xu(n.element(),"overflow-y","auto"),Xu(n.element(),"-webkit-overflow-scrolling","touch"),Wg.register(n.element())}),No(function(n){ec(n.element(),"overflow-y"),ec(n.element(),"-webkit-overflow-scrolling"),Wg.deregister(n.element())})])])}],items:e,menuBehaviours:fi([Pg.config({initialState:"after",routes:Pg.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},Yg={sketch:function(n){var e=$g(n.formats,function(){return t}),t=Kl(Bg.sketch({dom:{tag:"div",classes:[Lu.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(e,t){var r=Ol.getValue(t);return n.handle(t,r.value),Q.none()},onEscape:function(){return Q.none()},onOpenMenu:function(n,e){var t=Bl(n.element());Dl(e.element(),t),Pg.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var r=Bl(n.element()),o=dc(e.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();Dl(t.element(),r),Pg.progressTo(i,"before"),Pg.jumpTo(t,"after"),Pg.progressTo(t,"current")},onCollapseMenu:function(n,e,t){var r=dc(e.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();Pg.progressTo(o,"after"),Pg.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:e.tmenu,markers:{backgroundMenu:Lu.resolve("styles-background-menu"),menu:Lu.resolve("styles-menu"),selectedMenu:Lu.resolve("styles-selected-menu"),item:Lu.resolve("styles-item"),selectedItem:Lu.resolve("styles-selected-item")}}));return t.asSpec()}},Kg=function(n){var e=$(ar(n,["items"]),{menu:!0}),t=Jg(n.items);return{item:e,menus:$(t.menus,dr(n.title,t.items)),expansions:$(t.expansions,dr(n.title,n.title))}},Xg=function(n){return vr(n,"items")?Kg(n):{item:n,menus:{},expansions:{}}},Jg=function(n){return zn(n,function(n,e){var t=Xg(e);return{menus:$(n.menus,t.menus),items:[t.item].concat(n.items),expansions:$(n.expansions,t.expansions)}},{menus:{},expansions:{},items:[]})},Qg={expand:Jg},Zg=function(n,e){var t=function(e){return $n(e,function(e){return void 0!==e.items?t(e.items).length>0?[e]:[]:!vr(e,"format")||n.formatter.canApply(e.format)?[e]:[]})},r=t(e);return Qg.expand(r)},nv={register:function(n,e){var t=function(e){return function(){return n.formatter.match(e)}},r=function(e){return function(){return n.formatter.getCssText(e)}},o=function(n){return $(n,{isSelected:t(n.format),getPreview:r(n.format)})},i=function(n){return $(n,{isSelected:D(!1),getPreview:D("")})},u=function(e){var o=Hf(e.title),i=$(e,{format:o,isSelected:t(o),getPreview:r(o)});return n.formatter.register(o,i),i},c=lr(e,"style_formats").getOr(fm),a=function(n){return Fn(n,function(n){if(vr(n,"items")){var e=a(n.items);return $(i(n),{items:e})}return vr(n,"format")?o(n):u(n)})};return a(c)},ui:function(n,e,t){var r=Zg(n,e);return Yg.sketch({formats:r,handle:function(e,r){n.undoManager.transact(function(){zu.isOn(e)?n.formatter.remove(r):n.formatter.apply(r)}),t()}})}},ev=["undo","bold","italic","link","image","bullist","styleselect"],tv=function(n){var e=n.replace(/\|/g," ").trim();return e.length>0?e.split(/\s+/):[]},rv=function(n){return $n(n,function(n){return j(n)?rv(n):tv(n)})},ov=function(n){var e=void 0!==n.toolbar?n.toolbar:ev;return j(e)?rv(e):tv(e)},iv={identify:ov,setup:function(n,e){var t=function(n){return function(){return qs.forToolbarCommand(e,n)}},r=function(n){return function(){return qs.forToolbarStateCommand(e,n)}},o=function(n,t,r){return function(){return qs.forToolbarStateAction(e,n,t,r)}},i=t("undo"),u=t("redo"),c=r("bold"),a=r("italic"),f=r("underline"),s=t("removeformat"),l=o("unlink","link",function(){e.execCommand("unlink",null,!1)}),d=o("unordered-list","ul",function(){e.execCommand("InsertUnorderedList",null,!1)}),m=o("ordered-list","ol",function(){e.execCommand("InsertOrderedList",null,!1)}),g=nv.register(e,e.settings),v=function(){return nv.ui(e,g,function(){e.fire("scrollIntoView")})},p=function(n,t){return{isSupported:function(){return n.forall(function(n){return vr(e.buttons,n)})},sketch:t}};return{undo:p(Q.none(),i),redo:p(Q.none(),u),bold:p(Q.none(),c),italic:p(Q.none(),a),underline:p(Q.none(),f),removeformat:p(Q.none(),s),link:p(Q.none(),function(){return am(n,e)}),unlink:p(Q.none(),l),image:p(Q.none(),function(){return od(e)}),bullist:p(Q.some("bullist"),d),numlist:p(Q.some("numlist"),m),fontsizeselect:p(Q.none(),function(){return Yl(n,e)}),forecolor:p(Q.none(),function(){return Nl.sketch(n,e)}),styleselect:p(Q.none(),function(){return qs.forToolbar("style-formats",function(t){e.fire("toReading"),n.dropup().appear(v,zu.on,t)},fi([zu.config({toggleClass:Lu.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Eu.config({channels:mr([ju.receive(Xi.orientationChanged(),zu.off),ju.receive(Xi.dropupDismissed(),zu.off)])})]))})}},detect:function(n,e){var t=ov(n),r={};return $n(t,function(n){var t=!vr(r,n)&&vr(e,n)&&e[n].isSupported()?[e[n].sketch()]:[];return r[n]=!0,t})}},uv=function(n,e,t,r,o,i,u){return{target:D(n),x:D(e),y:D(t),stop:r,prevent:o,kill:i,raw:D(u)}},cv=function(n,e){return function(t){if(n(t)){var r=Ae.fromDom(t.target),o=function(){t.stopPropagation()},i=function(){t.preventDefault()},u=E(i,o),c=uv(r,t.clientX,t.clientY,o,i,u,t);e(c)}}},av=function(n,t,r,o,i){var u=cv(r,o);return n.dom().addEventListener(t,u,i),{unbind:e(lv,n,t,u,i)}},fv=function(n,e,t,r){return av(n,e,t,r,!1)},sv=function(n,e,t,r){return av(n,e,t,r,!0)},lv=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},dv=D(!0),mv=function(n,e,t){return fv(n,e,dv,t)},gv=function(n,e,t){return sv(n,e,dv,t)},vv=function(n){var e=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:D(e)}},pv={get:vv,onChange:function(n,e){var t=Ae.fromDom(n),r=null,o=mv(t,"orientationchange",function(){clearInterval(r);var t=vv(n);e.onChange(t),i(function(){e.onReady(t)})}),i=function(e){clearInterval(r);var t=n.innerHeight,o=0;r=setInterval(function(){t!==n.innerHeight?(clearInterval(r),e(Q.some(n.innerHeight))):o>20&&(clearInterval(r),e(Q.none())),o++},50)};return{onAdjustment:i,destroy:function(){o.unbind()}}},getActualWidth:function(n){var e=se.detect().os.isiOS(),t=vv(n).isPortrait();return e&&!t?n.screen.height:n.screen.width}},hv=function(n){var e=n.raw();return void 0===e.touches||1!==e.touches.length?Q.none():Q.some(e.touches[0])},bv=function(n,e){var t=Math.abs(n.clientX-e.x()),r=Math.abs(n.clientY-e.y());return t>5||r>5},yv=function(n){var e=Hi(Q.none()),t=h(function(t){e.set(Q.none()),n.triggerEvent(ye(),t)},400),r=mr([{key:on(),value:function(n){return hv(n).each(function(r){t.cancel();var o={x:D(r.clientX),y:D(r.clientY),target:n.target};t.schedule(n),e.set(Q.some(o))}),Q.none()}},{key:un(),value:function(n){return t.cancel(),hv(n).each(function(n){e.get().each(function(t){bv(n,t)&&e.set(Q.none())})}),Q.none()}},{key:cn(),value:function(r){t.cancel();return e.get().filter(function(n){return dt(n.target(),r.target())}).map(function(e){return n.triggerEvent(he(),r)})}}]);return{fireIfReady:function(n,e){return lr(r,e).bind(function(e){return e(n)})}}},wv={monitor:function(n){var e=yv({triggerEvent:function(e,t){n.onTapContent(t)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return mv(n.body(),"touchend",function(n){e.fireIfReady(n,"touchend")})},onTouchmove:function(){return mv(n.body(),"touchmove",function(n){e.fireIfReady(n,"touchmove")})}}}},xv=se.detect().os.version.major>=6,Sv={initEvents:function(n,e,t){var r=wv.monitor(n),o=mt(e),i=function(n){return!dt(n.start(),n.finish())||n.soffset()!==n.foffset()},u=function(){return Gi(o).filter(function(n){return"input"===Ve(n)}).exists(function(n){return n.dom().selectionStart!==n.dom().selectionEnd})},c=function(){var r=n.doc().dom().hasFocus()&&n.getSelection().exists(i);t.getByDom(e).each(!0===(r||u())?zu.on:zu.off)},a=[mv(n.body(),"touchstart",function(e){n.onTouchContent(),r.fireTouchstart(e)}),r.onTouchmove(),r.onTouchend(),mv(e,"touchstart",function(e){n.onTouchToolstrip()}),n.onToReading(function(){Ui(n.body())}),n.onToEditing(C),n.onScrollToCursor(function(e){e.preventDefault(),n.getCursorBox().each(function(e){var t=n.win(),r=e.top()>t.innerHeight||e.bottom()>t.innerHeight?e.bottom()-t.innerHeight+50:0;0!==r&&t.scrollTo(t.pageXOffset,t.pageYOffset+r)})})].concat(!0===xv?[]:[mv(Ae.fromDom(n.win()),"blur",function(){t.getByDom(e).each(zu.off)}),mv(o,"select",c),mv(n.doc(),"selectionchange",c)]);return{destroy:function(){Nn(a,function(n){n.unbind()})}}}},Tv={safeParse:function(n,e){var t=parseInt(hi(n,e),10);return isNaN(t)?0:t}},Ov=function(n,e){var t=function(e){return n(e)?Q.from(e.dom().nodeValue):Q.none()},r=se.detect().browser,o=r.isIE()&&10===r.version.major?function(n){try{return t(n)}catch(n){return Q.none()}}:t;return{get:function(t){if(!n(t))throw new Error("Can only get "+e+" value of a "+e+" node");return o(t).getOr("")},getOption:o,set:function(t,r){if(!n(t))throw new Error("Can only set raw "+e+" value of a "+e+" node");t.dom().nodeValue=r}}}(Le,"text"),kv=function(n){return Ov.get(n)},Cv=function(n){return Ov.getOption(n)},Ev=function(n){return"img"===Ve(n)?1:Cv(n).fold(function(){return yt(n).length},function(n){return n.length})},Dv=function(n){return Cv(n).filter(function(n){return 0!==n.trim().length||n.indexOf(" ")>-1}).isSome()},Bv=["img","br"],Iv=function(n){return Dv(n)||An(Bv,Ve(n))},Mv=Pt.generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Av={before:Mv.before,on:Mv.on,after:Mv.after,cata:function(n,e,t,r){return n.fold(e,t,r)},getStart:function(n){return n.fold(B,B,B)}},Rv=Pt.generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Fv=Ge("start","soffset","finish","foffset"),Nv=Rv.relative,Vv=Rv.exact,Hv=function(n,e,t,r){var o=mt(n).dom().createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},zv=function(n,e,t,r){var o=Hv(n,e,t,r),i=dt(n,t)&&e===r;return o.collapsed&&!i},jv=function(n,e){e.fold(function(e){n.setStartBefore(e.dom())},function(e,t){n.setStart(e.dom(),t)},function(e){n.setStartAfter(e.dom())})},Lv=function(n,e){e.fold(function(e){n.setEndBefore(e.dom())},function(e,t){n.setEnd(e.dom(),t)},function(e){n.setEndAfter(e.dom())})},Pv=function(n,e,t){var r=n.document.createRange();return jv(r,e),Lv(r,t),r},Uv=function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},Wv=function(n){return{left:D(n.left),top:D(n.top),right:D(n.right),bottom:D(n.bottom),width:D(n.width),height:D(n.height)}},Gv=function(n){var e=n.getClientRects(),t=e.length>0?e[0]:n.getBoundingClientRect();return t.width>0||t.height>0?Q.some(t).map(Wv):Q.none()},$v=Pt.generate([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),_v=function(n,e,t){return e(Ae.fromDom(t.startContainer),t.startOffset,Ae.fromDom(t.endContainer),t.endOffset)},qv=function(n,e){return e.match({domRange:function(n){return{ltr:D(n),rtl:Q.none}},relative:function(e,t){return{ltr:bn(function(){return Pv(n,e,t)}),rtl:bn(function(){return Q.some(Pv(n,t,e))})}},exact:function(e,t,r,o){return{ltr:bn(function(){return Uv(n,e,t,r,o)}),rtl:bn(function(){return Q.some(Uv(n,r,o,e,t))})}}})},Yv=function(n,e){var t=e.ltr();return t.collapsed?e.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return $v.rtl(Ae.fromDom(n.endContainer),n.endOffset,Ae.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return _v(0,$v.ltr,t)}):_v(0,$v.ltr,t)},Kv=function(n,e){var t=qv(n,e);return Yv(0,t)},Xv=function(n,e){return Kv(n,e).match({ltr:function(e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},rtl:function(e,t,r,o){var i=n.document.createRange();return i.setStart(r.dom(),o),i.setEnd(e.dom(),t),i}})},Jv=function(n,e,t,r,o){if(0===o)return 0;if(e===r)return o-1;for(var i=r,u=1;u<o;u++){var c=n(u),a=Math.abs(e-c.left);if(t<=c.bottom){if(t<c.top||a>i)return u-1;i=a}}return 0},Qv=function(n,e,t){return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom},Zv=function(n,e,t,r,o){var i=function(t){var r=n.dom().createRange();return r.setStart(e.dom(),t),r.collapse(!0),r},u=kv(e).length,c=Jv(function(n){return i(n).getBoundingClientRect()},t,r,o.right,u);return i(c)},np=function(n,e,t,r){var o=n.dom().createRange();o.selectNode(e.dom());var i=o.getClientRects();return au(i,function(n){return Qv(n,t,r)?Q.some(n):Q.none()}).map(function(o){return Zv(n,e,t,r,o)})},ep=function(n,e,t,r){var o=n.dom().createRange(),i=yt(e);return au(i,function(e){return o.selectNode(e.dom()),Qv(o.getBoundingClientRect(),t,r)?tp(n,e,t,r):Q.none()})},tp=function(n,e,t,r){return(Le(e)?np:ep)(n,e,t,r)},rp=function(n,e,t,r){var o=n.dom().createRange();o.selectNode(e.dom());var i=o.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,t)),c=Math.max(i.top,Math.min(i.bottom,r));return tp(n,e,u,c)},op=function(n){return Li(n,Iv)},ip=function(n){return up(n,Iv)},up=function(n,e){var t=function(n){for(var r=yt(n),o=r.length-1;o>=0;o--){var i=r[o];if(e(i))return Q.some(i);var u=t(i);if(u.isSome())return u}return Q.none()};return t(n)},cp=function(n,e){return e-n.left<n.right-e},ap=function(n,e,t){var r=n.dom().createRange();return r.selectNode(e.dom()),r.collapse(t),r},fp=function(n,e,t){var r=n.dom().createRange();r.selectNode(e.dom());var o=r.getBoundingClientRect(),i=cp(o,t);return(!0===i?op:ip)(e).map(function(e){return ap(n,e,i)})},sp=function(n,e,t){var r=e.dom().getBoundingClientRect(),o=cp(r,t);return Q.some(ap(n,e,o))},lp=function(n,e,t){return(0===yt(e).length?sp:fp)(n,e,t)},dp=function(n,e,t,r){var o=n.dom().createRange();o.selectNode(e.dom());var i=o.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,t)),c=Math.max(i.top,Math.min(i.bottom,r));return rp(n,e,u,c)},mp=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,e){var t=Ve(n);return"input"===t?Av.after(n):An(["br","img"],t)?0===e?Av.before(n):Av.after(n):Av.on(n,e)}),gp=function(n,e,t,r){var o=mp(n,e),i=mp(t,r);return Nv(o,i)},vp=function(n,e){Q.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(e)})},pp=function(n,e,t,r,o){var i=Uv(n,e,t,r,o);vp(n,i)},hp=function(n,e,t,r,o,i){e.collapse(t.dom(),r),e.extend(o.dom(),i)},bp=function(n,e){return Kv(n,e).match({ltr:function(e,t,r,o){pp(n,e,t,r,o)},rtl:function(e,t,r,o){var i=n.getSelection();if(i.setBaseAndExtent)i.setBaseAndExtent(e.dom(),t,r.dom(),o);else if(i.extend)try{hp(0,i,e,t,r,o)}catch(i){pp(n,r,o,e,t)}else pp(n,r,o,e,t)}})},yp=function(n,e,t,r,o){var i=gp(e,t,r,o);bp(n,i)},wp=function(n){if(n.rangeCount>0){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return Q.some(Fv(Ae.fromDom(e.startContainer),e.startOffset,Ae.fromDom(t.endContainer),t.endOffset))}return Q.none()},xp=function(n){var e=Ae.fromDom(n.anchorNode),t=Ae.fromDom(n.focusNode);return zv(e,n.anchorOffset,t,n.focusOffset)?Q.some(Fv(e,n.anchorOffset,t,n.focusOffset)):wp(n)},Sp=function(n){return Q.from(n.getSelection()).filter(function(n){return n.rangeCount>0}).bind(xp)},Tp=function(n){return Sp(n).map(function(n){return Vv(n.start(),n.soffset(),n.finish(),n.foffset())})},Op=function(n,e){var t=Xv(n,e);return Gv(t)},kp=function(n){n.getSelection().removeAllRanges()},Cp=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:D(2),height:n.height}},Ep=function(n){return{left:D(n.left),top:D(n.top),right:D(n.right),bottom:D(n.bottom),width:D(n.width),height:D(n.height)}},Dp=function(n){if(n.collapsed){var e=Ae.fromDom(n.startContainer);return vt(e).bind(function(t){var r=Vv(e,n.startOffset,t,Ev(t));return Op(n.startContainer.ownerDocument.defaultView,r).map(Cp).map(Xn)}).getOr([])}return Fn(n.getClientRects(),Ep)},Bp={getRectangles:function(n){var e=n.getSelection();return void 0!==e&&e.rangeCount>0?Dp(e.getRangeAt(0)):[]}},Ip=function(){return function(n){setTimeout(function(){n()},0)}},Mp={resume:function(n){n.focus();var e=Ae.fromDom(n.document.body);(Gi().exists(function(n){return An(["input","textarea"],Ve(n))})?Ip():A)(function(){Gi().each(Ui),Pi(e)})}},Ap="data-"+Lu.resolve("last-outer-height"),Rp=function(n,e){vi(n,Ap,e)},Fp=function(n){return Tv.safeParse(n,Ap)},Np=function(n){return{top:D(n.top()),bottom:D(n.top()+n.height())}},Vp=function(n){var e=Bp.getRectangles(n);return e.length>0?Q.some(e[0]).map(Np):Q.none()},Hp=function(n,e){var t=Fp(e),r=n.innerHeight;return t>r?Q.some(t-r):Q.none()},zp=function(n,e,t){return e.top()>n.innerHeight||e.bottom()>n.innerHeight?Math.min(t,e.bottom()-n.innerHeight+50):0},jp={setup:function(n,e){var t=Ae.fromDom(e.document.body),r=mv(Ae.fromDom(n),"resize",function(){Hp(n,t).each(function(n){Vp(e).each(function(t){var r=zp(e,t,n);0!==r&&e.scrollTo(e.pageXOffset,e.pageYOffset+r)})}),Rp(t,n.innerHeight)});Rp(t,n.innerHeight);return{toEditing:function(){Mp.resume(e)},destroy:function(){r.unbind()}}}},Lp=function(n){return Q.some(Ae.fromDom(n.dom().contentWindow.document.body))},Pp=function(n){return Q.some(Ae.fromDom(n.dom().contentWindow.document))},Up=function(n){return Q.from(n.dom().contentWindow)},Wp=function(n){return Up(n).bind(Sp)},Gp=function(n){return n.getFrame()},$p=function(n,e){return function(t){return t[n].getOrThunk(function(){var n=Gp(t);return function(){return e(n)}})()}},_p=function(n,e,t,r){return n[t].getOrThunk(function(){return function(n){return mv(e,r,n)}})},qp=function(n){return{left:D(n.left),top:D(n.top),right:D(n.right),bottom:D(n.bottom),width:D(n.width),height:D(n.height)}},Yp={getBody:$p("getBody",Lp),getDoc:$p("getDoc",Pp),getWin:$p("getWin",Up),getSelection:$p("getSelection",Wp),getFrame:Gp,getActiveApi:function(n){var t=Gp(n),r=function(n){return Sp(n).filter(function(n){return dt(n.start(),n.finish())&&n.soffset()===n.foffset()}).bind(function(n){var e=n.start().dom().getBoundingClientRect();return e.width>0||e.height>0?Q.some(e).map(qp):Q.none()})};return Lp(t).bind(function(o){return Pp(t).bind(function(i){return Up(t).map(function(u){var c=Ae.fromDom(i.dom().documentElement),a=n.getCursorBox.getOrThunk(function(){return function(){return Tp(u).bind(function(n){return Op(u,n).orThunk(function(){return r(u)})})}}),f=n.setSelection.getOrThunk(function(){return function(n,e,t,r){yp(u,n,e,t,r)}}),s=n.clearSelection.getOrThunk(function(){return function(){kp(u)}});return{body:D(o),doc:D(i),win:D(u),html:D(c),getSelection:e(Wp,t),setSelection:f,clearSelection:s,frame:D(t),onKeyup:_p(n,i,"onKeyup","keyup"),onNodeChanged:_p(n,i,"onNodeChanged","selectionchange"),onDomChanged:n.onDomChanged,onScrollToCursor:n.onScrollToCursor,onScrollToElement:n.onScrollToElement,onToReading:n.onToReading,onToEditing:n.onToEditing,onToolbarScrollStart:n.onToolbarScrollStart,onTouchContent:n.onTouchContent,onTapContent:n.onTapContent,onTouchToolstrip:n.onTouchToolstrip,getCursorBox:a}})})})}},Kp="data-ephox-mobile-fullscreen-style",Xp="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;",Jp=se.detect().os.isAndroid(),Qp=function(n){var e=Qu(n,"background-color");return void 0!==e&&""!==e?"background-color:"+e+"!important":"background-color:rgb(255,255,255)!important;"},Zp={clobberStyles:function(n,e){var t=function(n){return function(e){var t=hi(e,"style"),r=void 0===t?"no-styles":t.trim();r!==n&&(vi(e,Kp,r),vi(e,"style",n))}},r=ac(n,"*"),o=$n(r,function(n){return fc(n,"*")}),i=Qp(e);Nn(o,t("display:none!important;")),Nn(r,t("position:absolute!important;"+Xp+i)),t((!0===Jp?"":"position:absolute!important;")+Xp+i)(n)},restoreStyles:function(){var n=cc("["+Kp+"]");Nn(n,function(n){var e=hi(n,Kp);"no-styles"!==e?vi(n,"style",e):yi(n,"style"),yi(n,Kp)})}},nh={tag:function(){var n=lc("head").getOrDie(),e=lc('meta[name="viewport"]').getOrThunk(function(){var e=Ae.fromTag("meta");return vi(e,"name","viewport"),kt(n,e),e}),t=hi(e,"content");return{maximize:function(){vi(e,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){void 0!==t&&null!==t&&t.length>0?vi(e,"content",t):vi(e,"content","user-scalable=yes")}}}},eh={create:function(n,e){var t=nh.tag(),r=rm(),o=rm();return{enter:function(){e.hide(),Di(n.container,Lu.resolve("fullscreen-maximized")),Di(n.container,Lu.resolve("android-maximized")),t.maximize(),Di(n.body,Lu.resolve("android-scroll-reload")),r.set(jp.setup(n.win,Yp.getWin(n.editor).getOrDie("no"))),Yp.getActiveApi(n.editor).each(function(e){Zp.clobberStyles(n.container,e.body()),o.set(Sv.initEvents(e,n.toolstrip,n.alloy))})},exit:function(){t.restore(),e.show(),Ii(n.container,Lu.resolve("fullscreen-maximized")),Ii(n.container,Lu.resolve("android-maximized")),Zp.restoreStyles(),Ii(n.body,Lu.resolve("android-scroll-reload")),o.clear(),r.clear()}}}},th=function(e,t){var r=null;return{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},throttle:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null===r&&(r=n.setTimeout(function(){e.apply(null,o),r=null},t))}}},rh=function(e,t){var r=null;return{cancel:function(){null!==r&&(n.clearTimeout(r),r=null)},throttle:function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];null!==r&&n.clearTimeout(r),r=n.setTimeout(function(){e.apply(null,o),r=null},t)}}},oh={sketch:function(n,e){var t=Kl(kd.sketch({dom:Ws('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:fi([zu.config({toggleClass:Lu.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),r=th(n,200);return kd.sketch({dom:Ws('<div class="${prefix}-disabled-mask"></div>'),components:[kd.sketch({dom:Ws('<div class="${prefix}-content-container"></div>'),components:[zs.sketch({dom:Ws('<div class="${prefix}-content-tap-section"></div>'),components:[t.asSpec()],action:function(n){r.throttle()},buttonBehaviours:fi([zu.config({toggleClass:Lu.resolve("mask-tap-icon-selected")})])})]})]})}},ih=zr([ao("editor",[oo("getFrame"),fo("getBody"),fo("getDoc"),fo("getWin"),fo("getSelection"),fo("setSelection"),fo("clearSelection"),fo("cursorSaver"),fo("onKeyup"),fo("onNodeChanged"),fo("getCursorBox"),oo("onDomChanged"),go("onTouchContent",C),go("onTapContent",C),go("onTouchToolstrip",C),go("onScrollToCursor",D({unbind:C})),go("onScrollToElement",D({unbind:C})),go("onToEditing",D({unbind:C})),go("onToReading",D({unbind:C})),go("onToolbarScrollStart",B)]),oo("socket"),oo("toolstrip"),oo("dropup"),oo("toolbar"),oo("container"),oo("alloy"),ho("win",function(n){return mt(n.socket).dom().defaultView}),ho("body",function(n){return Ae.fromDom(n.socket.dom().ownerDocument.body)}),go("translate",B),go("setReadOnly",C),go("readOnlyOnInit",D(!0))]),uh={produce:function(n){var e=Qr("Getting AndroidWebapp schema",ih,n);Xu(e.toolstrip,"width","100%");var t=ig(oh.sketch(function(){e.setReadOnly(e.readOnlyOnInit()),o.enter()},e.translate));e.alloy.add(t);var r={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}};kt(e.container,t.element());var o=eh.create(e,r);return{setReadOnly:e.setReadOnly,refreshStructure:C,enter:o.enter,exit:o.exit,destroy:C}}},ch=D([go("shell",!0),Of("toolbarBehaviours",[Tg])]),ah=D([Qf({name:"groups",overrides:function(n){return{behaviours:fi([Tg.config({})])}}})]),fh=Hs({name:"Toolbar",configFields:ch(),partFields:ah(),factory:function(e,t,r,o){var i=function(n){return e.shell()?Q.some(n):ss(n,e,"groups")},u=e.shell()?{behaviours:[Tg.config({})],components:[]}:{behaviours:[],components:t};return{uid:e.uid(),dom:e.dom(),components:u.components,behaviours:$(fi(u.behaviours),kf(e.toolbarBehaviours())),apis:{setGroups:function(e,t){i(e).fold(function(){throw n.console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(n){Tg.set(n,t)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}}),sh=D([oo("items"),function(n){return ao("markers",Fn(n,oo))}(["itemClass"]),Of("tgroupBehaviours",[Tf])]),lh=D([Zf({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})]),dh=Hs({name:"ToolbarGroup",configFields:sh(),partFields:lh(),factory:function(n,e,t,r){return $({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:$(fi([Tf.config({mode:"flow",selector:"."+n.markers().itemClass()})]),kf(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}}),mh="data-"+Lu.resolve("horizontal-scroll"),gh=function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e},vh=function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e},ph=function(n){return n.dom().scrollTop>0||gh(n)},hh=function(n){return n.dom().scrollLeft>0||vh(n)},bh=function(n){return"true"===hi(n,mh)?hh(n):ph(n)},yh={exclusive:function(n,e){return mv(n,"touchmove",function(n){gc(n.target(),e).filter(bh).fold(function(){n.raw().preventDefault()},C)})},markAsHorizontal:function(n){vi(n,mh,"true")}},wh=function(n,e){Tg.append(n,ug(e))},xh=function(n,e){Tg.remove(n,e)},Sh={makeEditSwitch:function(n){return ig(zs.sketch({dom:Ws('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run(function(n){n.setReadOnly(!1)})}}))},makeSocket:function(){return ig(kd.sketch({dom:Ws('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:fi([Tg.config({})])}))},updateMode:function(n,e,t,r){(!0===t?Vi.toAlpha:Vi.toOmega)(r),(t?wh:xh)(n,e)}},Th=function(n,e){return e.getAnimationRoot().fold(function(){return n.element()},function(e){return e(n)})},Oh=function(n){return n.dimension().property()},kh=function(n,e){return n.dimension().getDimension()(e)},Ch=function(n,e){var t=Th(n,e);Gm(t,[e.shrinkingClass(),e.growingClass()])},Eh=function(n,e){Ii(n.element(),e.openClass()),Di(n.element(),e.closedClass()),Xu(n.element(),Oh(e),"0px"),tc(n.element())},Dh=function(n,e){Bh(n,e);var t=kh(e,n.element());return Eh(n,e),t},Bh=function(n,e){Ii(n.element(),e.closedClass()),Di(n.element(),e.openClass()),ec(n.element(),Oh(e))},Ih=function(n,e,t){t.setCollapsed(),Xu(n.element(),Oh(e),kh(e,n.element())),tc(n.element()),Ch(n,e),Eh(n,e),e.onStartShrink()(n),e.onShrunk()(n)},Mh=function(n,e,t){t.setCollapsed(),Xu(n.element(),Oh(e),kh(e,n.element())),tc(n.element());var r=Th(n,e);Di(r,e.shrinkingClass()),Eh(n,e),e.onStartShrink()(n)},Ah=function(n,e,t){var r=Dh(n,e),o=Th(n,e);Di(o,e.growingClass()),Bh(n,e),Xu(n.element(),Oh(e),r),t.setExpanded(),e.onStartGrow()(n)},Rh=function(n,e,t){var r=Th(n,e);return!0===Ai(r,e.growingClass())},Fh=function(n,e,t){var r=Th(n,e);return!0===Ai(r,e.shrinkingClass())},Nh=Object.freeze({grow:function(n,e,t){t.isExpanded()||Ah(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&Mh(n,e,t)},immediateShrink:function(n,e,t){t.isExpanded()&&Ih(n,e,t)},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:Rh,isShrinking:Fh,isTransitioning:function(n,e,t){return!0===Rh(n,e)||!0===Fh(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?Mh:Ah)(n,e,t)},disableTransitions:Ch}),Vh=Object.freeze({exhibit:function(n,e){var t=e.expanded();return $o(t?{classes:[e.openClass()],styles:{}}:{classes:[e.closedClass()],styles:dr(e.dimension().property(),"0px")})},events:function(n,e){return Oo([Co(pn(),function(t,r){r.event().raw().propertyName===n.dimension().property()&&(Ch(t,n),e.isExpanded()&&ec(t.element(),n.dimension().property()),(e.isExpanded()?n.onGrown():n.onShrunk())(t))})])}}),Hh=[oo("closedClass"),oo("openClass"),oo("shrinkingClass"),oo("growingClass"),fo("getAnimationRoot"),yu("onShrunk"),yu("onStartShrink"),yu("onGrown"),yu("onStartGrow"),go("expanded",!1),io("dimension",eo("property",{width:[Tu("property","width"),Tu("getDimension",function(n){return Bl(n)+"px"})],height:[Tu("property","height"),Tu("getDimension",function(n){return oc(n)+"px"})]}))],zh=li({fields:Hh,name:"sliding",active:Vh,apis:Nh,state:Object.freeze({init:function(n){var t=Hi(n.expanded());return ai({isExpanded:function(){return!0===t.get()},isCollapsed:function(){return!1===t.get()},setCollapsed:e(t.set,!1),setExpanded:e(t.set,!0),readState:function(){return"expanded: "+t.get()}})}})}),jh=function(e,t){var r=ig(kd.sketch({dom:{tag:"div",classes:[Lu.resolve("dropup")]},components:[],containerBehaviours:fi([Tg.config({}),zh.config({closedClass:Lu.resolve("dropup-closed"),openClass:Lu.resolve("dropup-open"),shrinkingClass:Lu.resolve("dropup-shrinking"),growingClass:Lu.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(n){e(),t(),Tg.set(n,[])},onGrown:function(n){e(),t()}}),ju.orientation(function(n,e){o(C)})])})),o=function(e){n.window.requestAnimationFrame(function(){e(),zh.shrink(r)})};return{appear:function(e,t,o){!0===zh.hasShrunk(r)&&!1===zh.isTransitioning(r)&&n.window.requestAnimationFrame(function(){t(o),Tg.set(r,[e()]),zh.grow(r)})},disappear:o,component:D(r),element:r.element}},Lh=function(n){return n.raw().which===[8][0]&&!An(["input","textarea"],Ve(n.target()))},Ph=se.detect().browser.isFirefox(),Uh=Hr([uo("triggerEvent"),uo("broadcastEvent"),go("stopBackspace",!0)]),Wh=function(n,e){return Ph?gv(n,"focus",e):mv(n,"focusin",e)},Gh=function(n,e){return Ph?gv(n,"blur",e):mv(n,"focusout",e)},$h=function(e,t){var r=Qr("Getting GUI events settings",Uh,t),o=se.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],i=yv(r),u=Fn(o.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),function(n){return mv(e,n,function(e){i.fireIfReady(e,n).each(function(n){n&&e.kill()}),r.triggerEvent(n,e)&&e.kill()})}),c=mv(e,"keydown",function(n){r.triggerEvent("keydown",n)?n.kill():!0===r.stopBackspace&&Lh(n)&&n.prevent()}),a=Wh(e,function(n){r.triggerEvent("focusin",n)&&n.kill()}),f=Gh(e,function(e){r.triggerEvent("focusout",e)&&e.kill(),n.setTimeout(function(){r.triggerEvent(me(),e)},0)}),s=gt(e),l=mv(s,"scroll",function(n){r.broadcastEvent(xe(),n)&&n.kill()});return{unbind:function(){Nn(u,function(n){n.unbind()}),c.unbind(),a.unbind(),f.unbind(),l.unbind()}}},_h=function(n,e){var t=lr(n,"target").map(function(n){return n()}).getOr(e);return Hi(t)},qh=function(n,e){var t=Hi(!1),r=Hi(!1);return{stop:function(){t.set(!0)},cut:function(){r.set(!0)},isStopped:t.get,isCut:r.get,event:D(n),setSource:e.set,getSource:e.get}},Yh=function(n){var e=Hi(!1);return{stop:function(){e.set(!0)},cut:C,isStopped:e.get,isCut:D(!1),event:D(n),setSource:M("Cannot set source of a broadcasted event"),getSource:M("Cannot get source of a broadcasted event")}},Kh=Pt.generate([{stopped:[]},{resume:["element"]},{complete:[]}]),Xh=function(n,e,t,r,o,i){var u=n(e,r),c=qh(t,o);return u.fold(function(){return i.logEventNoHandlers(e,r),Kh.complete()},function(n){var t=n.descHandler();return Bm(t)(c),c.isStopped()?(i.logEventStopped(e,n.element(),t.purpose()),Kh.stopped()):c.isCut()?(i.logEventCut(e,n.element(),t.purpose()),Kh.complete()):vt(n.element()).fold(function(){return i.logNoParent(e,n.element(),t.purpose()),Kh.complete()},function(r){return i.logEventResponse(e,n.element(),t.purpose()),Kh.resume(r)})})},Jh=function(n,e,t,r,o,i){return Xh(n,e,t,r,o,i).fold(function(){return!0},function(r){return Jh(n,e,t,r,o,i)},function(){return!1})},Qh=function(n,e,t,r,o){var i=_h(t,r);return Xh(n,e,t,r,i,o)},Zh=function(n,e,t){var r=Yh(e);return Nn(n,function(n){var e=n.descHandler();Bm(e)(r)}),r.isStopped()},nb=function(n,e,t,r){var o=t.target();return eb(n,e,t,o,r)},eb=function(n,e,t,r,o){var i=_h(t,r);return Jh(n,e,t,r,i,o)},tb=function(n,e,t){return ji(n,function(n){return e(n).isSome()},t).bind(e)},rb=Ge("element","descHandler"),ob=function(n,e){return{id:D(n),descHandler:D(e)}},ib=function(n){var e=function(e){return vt(n.element()).fold(function(){return!0},function(n){return dt(e,n)})},t=w(),r=function(n,r){return t.find(e,n,r)},o=$h(n.element(),{triggerEvent:function(n,e){return mu(n,e.target(),function(t){return nb(r,n,e,t)})},broadcastEvent:function(n,e){var r=t.filter(n);return Zh(r,e)}}),i=gm({debugInfo:D("real"),triggerEvent:function(n,e,t){mu(n,e,function(o){eb(r,n,t,e,o)})},triggerFocus:function(n,e){Es(n).fold(function(){Pi(n)},function(t){mu(de(),n,function(t){Qh(r,de(),{originator:D(e),kill:C,prevent:C,target:D(n)},n,t)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return m(n)},getByDom:function(n){return g(n)},build:ig,addToGui:function(n){a(n)},removeFromGui:function(n){f(n)},addToWorld:function(n){u(n)},removeFromWorld:function(n){c(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},isConnected:D(!0)}),u=function(n){n.connect(i),Le(n.element())||(t.register(n),Nn(n.components(),u),i.triggerEvent(we(),n.element(),{target:D(n.element())}))},c=function(n){Le(n.element())||(Nn(n.components(),c),t.unregister(n)),n.disconnect()},a=function(e){Mt(n,e)},f=function(n){Ft(n)},s=function(n){var e=t.filter(ge());Nn(e,function(e){var t=e.descHandler();Bm(t)(n)})},l=function(n){s({universal:D(!0),data:D(n)})},d=function(n,e){s({universal:D(!1),channels:D(n),data:D(e)})},m=function(n){return t.getById(n).fold(function(){return Lt.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Lt.value)},g=function(n){var e=Es(n).getOr("not found");return m(e)};return u(n),{root:D(n),element:n.element,destroy:function(){o.unbind(),Dt(n.element())},add:a,remove:f,getByUid:m,getByDom:g,addToWorld:u,removeFromWorld:c,broadcast:l,broadcastOn:d}},ub=D(Lu.resolve("readonly-mode")),cb=D(Lu.resolve("edit-mode")),ab={input:function(n,e){var t=Ae.fromTag("input");Ju(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),kt(n,t),Pi(t),e(t),Dt(t)}},fb={refreshInput:function(n){var e=n.dom().selectionStart,t=n.dom().selectionEnd,r=n.dom().selectionDirection;setTimeout(function(){n.dom().setSelectionRange(e,t,r),Pi(n)},50)},refresh:function(n){var e=n.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0),r=n.document.createRange();r.setStart(t.startContainer,t.startOffset),r.setEnd(t.endContainer,t.endOffset),e.removeAllRanges(),e.addRange(r)}}},sb={resume:function(n,e){Gi().each(function(n){dt(n,e)||Ui(n)}),n.focus(),Pi(Ae.fromDom(n.document.body)),fb.refresh(n)}},lb={stubborn:function(n,e,t,r){var o=function(){sb.resume(e,r)},i=mv(t,"keydown",function(n){An(["input","textarea"],Ve(n.target()))||o()});return{toReading:function(){ab.input(n,Ui)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,e,t,r){var o=function(){Ui(r)};return{toReading:function(){o()},toEditing:function(){sb.resume(e,r)},onToolbarTouch:function(){o()},destroy:C}}},db={initEvents:function(n,e,t,r,o){var i=function(){e.run(function(n){n.highlightSelection()})},u=function(){e.run(function(n){n.refreshSelection()})},c=function(n,t){var o=n-r.dom().scrollTop;e.run(function(n){n.scrollIntoView(o,o+t)})},a=function(n){c(e,r)},f=function(){n.getCursorBox().each(function(n){c(n.top(),n.height())})},s=function(){e.run(function(n){n.clearSelection()})},l=function(){f(),e.run(function(n){n.syncHeight()})},d=function(){var n=oc(t);e.run(function(e){e.setViewportOffset(n)}),u(),l()},m=function(n){e.run(function(e){e.onToolbarTouch(n)})},g=wv.monitor(n),v=rh(l,300),p=[n.onKeyup(function(){s(),v.throttle()}),n.onNodeChanged(u),n.onDomChanged(v.throttle),n.onDomChanged(u),n.onScrollToCursor(function(n){n.preventDefault(),v.throttle()}),n.onScrollToElement(function(n){a(n.element())}),n.onToEditing(function(){e.run(function(n){n.toEditing()})}),n.onToReading(function(){e.run(function(n){n.toReading()})}),mv(n.doc(),"touchend",function(e){dt(n.html(),e.target())||dt(n.body(),e.target())}),mv(t,"transitionend",function(n){"height"===n.raw().propertyName&&d()}),gv(t,"touchstart",function(e){i(),m(e),n.onTouchToolstrip()}),mv(n.body(),"touchstart",function(e){s(),n.onTouchContent(),g.fireTouchstart(e)}),g.onTouchmove(),g.onTouchend(),mv(n.body(),"click",function(n){n.kill()}),mv(t,"touchmove",function(){n.onToolbarScrollStart()})];return{destroy:function(){Nn(p,function(n){n.unbind()})}}}},mb=function(e){var t=Q.none(),r=[],o=function(n){i()?c(n):r.push(n)},i=function(){return t.isSome()},u=function(n){Nn(n,c)},c=function(e){t.each(function(t){n.setTimeout(function(){e(t)},0)})};return e(function(n){t=Q.some(n),u(r),r=[]}),{get:o,map:function(n){return mb(function(e){o(function(t){e(n(t))})})},isReady:i}},gb={nu:mb,pure:function(n){return mb(function(e){e(n)})}},vb=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=this;n.setTimeout(function(){e.apply(o,t)},0)}},pb=function(n){var e=function(e){n(vb(e))},t=function(){return gb.nu(e)};return{map:function(n){return pb(function(t){e(function(e){var r=n(e);t(r)})})},bind:function(n){return pb(function(t){e(function(e){n(e).get(t)})})},anonBind:function(n){return pb(function(t){e(function(e){n.get(t)})})},toLazy:t,toCached:function(){var n=null;return pb(function(e){null===n&&(n=t()),n.get(e)})},get:e}},hb={nu:pb,pure:function(n){return pb(function(e){e(n)})}},bb=function(n,e,t){return Math.abs(n-e)<=t?Q.none():n<e?Q.some(n+t):Q.some(n-t)},yb={create:function(){var n=null;return{animate:function(e,t,r,o,i,u){var c=!1,a=function(n){c=!0,i(n)};clearInterval(n);var f=function(e){clearInterval(n),a(e)};n=setInterval(function(){var i=e();bb(i,t,r).fold(function(){clearInterval(n),a(t)},function(r){if(o(r,f),!c){var u=e();(u!==r||Math.abs(u-t)>Math.abs(i-t))&&(clearInterval(n),a(t))}})},u)}}},adjust:bb},wb={findDevice:function(n,e){return au([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(t){return n<=t.width&&e<=t.height?Q.some(t.keyboard):Q.none()}).getOr({portrait:e/5,landscape:n/4})}},xb=function(n){return wb.findDevice(n.screen.width,n.screen.height)},Sb=function(n){var e=pv.get(n).isPortrait(),t=xb(n),r=e?t.portrait:t.landscape;return(e?n.screen.height:n.screen.width)-n.innerHeight>r?0:r},Tb=function(n,e){var t=mt(n).dom().defaultView;return oc(n)+oc(e)-Sb(t)},Ob={getGreenzone:Tb,updatePadding:function(n,e,t){var r=Tb(e,t),o=oc(e)+oc(t)-r;Xu(n,"padding-bottom",o+"px")}},kb=Pt.generate([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),Cb="data-"+Lu.resolve("position-y-fixed"),Eb="data-"+Lu.resolve("y-property"),Db="data-"+Lu.resolve("scrolling"),Bb="data-"+Lu.resolve("last-window-height"),Ib=function(n){return Tv.safeParse(n,Cb)},Mb=function(n){return hi(n,Eb)},Ab=function(n){return Tv.safeParse(n,Bb)},Rb=function(n,e){var t=Mb(n);return kb.fixed(n,t,e)},Fb=function(n,e){return kb.scroller(n,e)},Nb=function(n){var e=Ib(n);return("true"===hi(n,Db)?Fb:Rb)(n,e)},Vb=function(n){var e=hi(n,"style");Ju(n,{position:"absolute",top:"0px"}),vi(n,Cb,"0px"),vi(n,Eb,"top");return{restore:function(){vi(n,"style",e||""),yi(n,Cb),yi(n,Eb)}}},Hb=function(n,e,t){var r=hi(t,"style");Wg.register(t),Ju(t,{position:"absolute",height:e+"px",width:"100%",top:n+"px"}),vi(t,Cb,n+"px"),vi(t,Db,"true"),vi(t,Eb,"top");return{restore:function(){Wg.deregister(t),vi(t,"style",r||""),yi(t,Cb),yi(t,Db),yi(t,Eb)}}},zb=function(n,e,t){var r=hi(n,"style");Ju(n,{position:"absolute",bottom:"0px"}),vi(n,Cb,"0px"),vi(n,Eb,"bottom");return{restore:function(){vi(n,"style",r||""),yi(n,Cb),yi(n,Eb)}}},jb=function(n,e,t){var r=mt(n).dom().defaultView.innerHeight;return vi(n,Bb,r+"px"),r-e-t},Lb={findFixtures:function(n){var e=sc(n,"["+Cb+"]");return Fn(e,Nb)},takeover:function(n,e,t,r){var o=mt(n).dom().defaultView,i=Vb(t),u=oc(t),c=oc(r),a=jb(n,u,c),f=Hb(u,a,n),s=zb(r),l=!0,d=function(){return o.innerHeight>Ab(n)},m=function(){if(l){var o=oc(t),i=oc(r),u=jb(n,o,i);vi(n,Cb,o+"px"),Xu(n,"height",u+"px"),Xu(r,"bottom",-(o+u+i)+"px"),Ob.updatePadding(e,n,r)}};return Ob.updatePadding(e,n,r),{setViewportOffset:function(e){vi(n,Cb,e+"px"),m()},isExpanding:d,isShrinking:I(d),refresh:m,restore:function(){l=!1,i.restore(),f.restore(),s.restore()}}},getYFixedData:Ib},Pb=yb.create(),Ub="data-"+Lu.resolve("last-scroll-top"),Wb=function(n){var e=nc(n,"top").getOr("0");return parseInt(e,10)},Gb=function(n){return parseInt(n.dom().scrollTop,10)},$b=function(n,e){var t=e+Lb.getYFixedData(n)+"px";Xu(n,"top",t)},_b={moveScrollAndTop:function(n,t,r){return hb.nu(function(o){var i=e(Gb,n);Pb.animate(i,t,15,function(e){n.dom().scrollTop=e,Xu(n,"top",Wb(n)+15+"px")},function(){n.dom().scrollTop=t,Xu(n,"top",r+"px"),o(t)},10)})},moveOnlyScroll:function(n,t){return hb.nu(function(r){var o=e(Gb,n);vi(n,Ub,o());var i=Math.abs(t-o()),u=Math.ceil(i/10);Pb.animate(o,t,u,function(e,t){Tv.safeParse(n,Ub)!==n.dom().scrollTop?t(n.dom().scrollTop):(n.dom().scrollTop=e,vi(n,Ub,e))},function(){n.dom().scrollTop=t,vi(n,Ub,t),r(t)},10)})},moveOnlyTop:function(n,t){return hb.nu(function(r){var o=e(Wb,n),i=function(e){Xu(n,"top",e+"px")},u=Math.abs(t-o()),c=Math.ceil(u/10);Pb.animate(o,t,c,i,function(){i(t),r(t)},10)})},moveWindowScroll:function(n,e,t){var r=mt(n).dom().defaultView;return hb.nu(function(o){$b(n,t),$b(e,t),r.scrollTo(0,t),o(t)})}},qb={scrollIntoView:function(n,t,r,o,i){var u=Ob.getGreenzone(t,r),c=e(fb.refresh,n);o>u||i>u?_b.moveOnlyScroll(t,t.dom().scrollTop-u+i).get(c):o<0&&_b.moveOnlyScroll(t,t.dom().scrollTop+o).get(c)}},Yb=function(n,e){return e(function(e){var t=[],r=0,o=function(o){return function(i){t[o]=i,++r>=n.length&&e(t)}};0===n.length?e([]):Nn(n,function(n,e){n.get(o(e))})})},Kb=function(n){return Yb(n,hb.nu)},Xb=function(n,e,t,r){return Xu(n,e,t+r+"px"),hb.pure(r)},Jb=function(n,e,t){var r=e+t,o=nc(n,"top").getOr(t),i=r-parseInt(o,10),u=n.dom().scrollTop+i;return _b.moveScrollAndTop(n,u,r)},Qb=function(n,e){return n.fold(function(n,t,r){return Xb(n,t,e,r)},function(n,t){return Jb(n,e,t)})},Zb={updatePositions:function(n,e){var t=Lb.findFixtures(n),r=Fn(t,function(n){return Qb(n,e)});return Kb(r)}},ny=function(n,e,t,r,o,i){var u=O(function(t){return _b.moveWindowScroll(n,e,t)}),c=function(){var n=Bp.getRectangles(i);return Q.from(n[0]).bind(function(n){var t=n.top()-e.dom().scrollTop;return t>r.innerHeight+5||t<-5?Q.some({top:D(t),bottom:D(t+n.height())}):Q.none()})},a=rh(function(){u.idle(function(){Zb.updatePositions(t,r.pageYOffset).get(function(){c().each(function(n){e.dom().scrollTop=e.dom().scrollTop+n.top()}),u.start(0),o.refresh()})})},1e3),f=mv(Ae.fromDom(r),"scroll",function(){r.pageYOffset<0||a.throttle()});return Zb.updatePositions(t,r.pageYOffset).get(B),{unbind:f.unbind}},ey={setup:function(n){var e=n.cWin(),t=n.ceBody(),r=n.socket(),o=n.toolstrip(),i=n.toolbar(),u=n.contentElement(),c=n.keyboardType(),a=n.outerWindow(),f=n.dropup(),s=Lb.takeover(r,t,o,f),l=c(n.outerBody(),e,Ue(),u,o,i),d=pv.onChange(a,{onChange:C,onReady:s.refresh});d.onAdjustment(function(){s.refresh()});var m=mv(Ae.fromDom(a),"resize",function(){s.isExpanding()&&s.refresh()}),g=ny(o,r,n.outerBody(),a,s,e),v=T(e,u),p=function(){v.clear()};return{toEditing:function(){l.toEditing(),p()},toReading:function(){l.toReading()},onToolbarTouch:function(n){l.onToolbarTouch(n)},refreshSelection:function(){v.isActive()&&v.update()},clearSelection:p,highlightSelection:function(){v.update()},scrollIntoView:function(n,t){qb.scrollIntoView(e,r,f,n,t)},updateToolbarPadding:C,setViewportOffset:function(n){s.setViewportOffset(n),_b.moveOnlyTop(r,n).get(B)},syncHeight:function(){Xu(u,"height",u.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:s.refresh,destroy:function(){s.restore(),d.destroy(),g.unbind(),m.unbind(),l.destroy(),v.destroy(),ab.input(Ue(),Ui)}}}},ty={create:function(e,t){var r=nh.tag(),o=om(),i=om(),u=rm(),c=rm();return{enter:function(){t.hide();var a=Ae.fromDom(n.document);Yp.getActiveApi(e.editor).each(function(t){o.set({socketHeight:nc(e.socket,"height"),iframeHeight:nc(t.frame(),"height"),outerScroll:n.document.body.scrollTop}),i.set({exclusives:yh.exclusive(a,"."+Wg.scrollable())}),Di(e.container,Lu.resolve("fullscreen-maximized")),Zp.clobberStyles(e.container,t.body()),r.maximize(),Xu(e.socket,"overflow","scroll"),Xu(e.socket,"-webkit-overflow-scrolling","touch"),Pi(t.body());var f=Je(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);u.set(ey.setup(f({cWin:t.win(),ceBody:t.body(),socket:e.socket,toolstrip:e.toolstrip,toolbar:e.toolbar,dropup:e.dropup.element(),contentElement:t.frame(),cursor:C,outerBody:e.body,outerWindow:e.win,keyboardType:lb.stubborn,isScrolling:function(){return i.get().exists(function(n){return n.socket.isScrolling()})}}))),u.run(function(n){n.syncHeight()}),c.set(db.initEvents(t,u,e.toolstrip,e.socket,e.dropup))})},refreshStructure:function(){u.run(function(n){n.refreshStructure()})},exit:function(){r.restore(),c.clear(),u.clear(),t.show(),o.on(function(t){t.socketHeight.each(function(n){Xu(e.socket,"height",n)}),t.iframeHeight.each(function(n){Xu(e.editor.getFrame(),"height",n)}),n.document.body.scrollTop=t.scrollTop}),o.clear(),i.on(function(n){n.exclusives.unbind()}),i.clear(),Ii(e.container,Lu.resolve("fullscreen-maximized")),Zp.restoreStyles(),Wg.deregister(e.toolbar),ec(e.socket,"overflow"),ec(e.socket,"-webkit-overflow-scrolling"),Ui(e.editor.getFrame()),Yp.getActiveApi(e.editor).each(function(n){n.clearSelection()})}}}},ry={produce:function(n){var e=Qr("Getting IosWebapp schema",ih,n);Xu(e.toolstrip,"width","100%"),Xu(e.container,"position","relative");var t=ig(oh.sketch(function(){e.setReadOnly(e.readOnlyOnInit()),o.enter()},e.translate));e.alloy.add(t);var r={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}},o=ty.create(e,r);return{setReadOnly:e.setReadOnly,refreshStructure:o.refreshStructure,enter:o.enter,exit:o.exit,destroy:C}}},oy=tinymce.util.Tools.resolve("tinymce.EditorManager"),iy={derive:function(n){var e=lr(n.settings,"skin_url").fold(function(){return oy.baseURL+"/skins/lightgray"},function(n){return n});return{content:e+"/content.mobile.min.css",ui:e+"/skin.mobile.min.css"}}},uy=function(n,e,t){n.system().broadcastOn([Xi.formatChanged()],{command:e,state:t})},cy={init:function(n,e){var t=Z(e.formatter.get());Nn(t,function(t){e.formatter.formatChanged(t,function(e){uy(n,t,e)})}),Nn(["ul","ol"],function(t){e.selection.selectorChanged(t,function(e,r){uy(n,t,e)})})},fontSizes:D(["x-small","small","medium","large","x-large"])},ay={fireSkinLoaded:function(n){var e=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?e():n.on("init",e)}}},fy=D("toReading"),sy=D("toEditing");qi.add("mobile",function(n){return{getNotificationManagerImpl:function(){return{open:D({progressBar:{value:C},close:C}),close:C,reposition:C,getArgs:B}},renderUI:function(e){var t=iy.derive(n);!1===Ki(n)?(n.contentCSS.push(t.content),_i.DOM.styleSheetLoader.load(t.ui,ay.fireSkinLoaded(n))):ay.fireSkinLoaded(n)();var r=function(){n.fire("scrollIntoView")},o=Ae.fromTag("div"),i=se.detect().os.isAndroid()?S(r):k(r),u=Ae.fromDom(e.targetNode);Tt(u,o),Vt(o,i.system());var c=function(n){return $i(n).bind(function(n){return i.system().getByDom(n).toOption()})},a=e.targetNode.ownerDocument.defaultView,f=pv.onChange(a,{onChange:function(){i.system().broadcastOn([Xi.orientationChanged()],{width:pv.getActualWidth(a)})},onReady:C}),s=function(e,t,r,o){!1===o&&n.selection.collapse();var u=l(e,t,r);i.setToolbarGroups(!0===o?u.readOnly:u.main),n.setMode(!0===o?"readonly":"design"),n.fire(!0===o?fy():sy()),i.updateMode(o)},l=function(n,e,t){var r=n.get();return{readOnly:r.backToMask.concat(e.get()),main:r.backToMask.concat(t.get())}},d=function(e,t){return n.on(e,t),{unbind:function(){n.off(e)}}};return n.on("init",function(){i.init({editor:{getFrame:function(){return Ae.fromDom(n.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:C}},onToReading:function(n){return d(fy(),n)},onToEditing:function(n){return d(sy(),n)},onScrollToCursor:function(e){return n.on("scrollIntoView",function(n){e(n)}),{unbind:function(){n.off("scrollIntoView"),f.destroy()}}},onTouchToolstrip:function(){e()},onTouchContent:function(){var t=Ae.fromDom(n.editorContainer.querySelector("."+Lu.resolve("toolbar")));c(t).each(Ce),i.restoreToolbar(),e()},onTapContent:function(e){var t=e.target();"img"===Ve(t)?(n.selection.select(t.dom()),e.kill()):"a"===Ve(t)&&i.system().getByDom(Ae.fromDom(n.editorContainer)).each(function(n){Vi.isAlpha(n)&&Yi.openLink(t.dom())})}},container:Ae.fromDom(n.editorContainer),socket:Ae.fromDom(n.contentAreaContainer),toolstrip:Ae.fromDom(n.editorContainer.querySelector("."+Lu.resolve("toolstrip"))),toolbar:Ae.fromDom(n.editorContainer.querySelector("."+Lu.resolve("toolbar"))),dropup:i.dropup(),alloy:i.system(),translate:C,setReadOnly:function(n){s(v,g,m,n)},readOnlyOnInit:function(){return!1}});var e=function(){i.dropup().disappear(function(){i.system().broadcastOn([Xi.dropupDismissed()],{})})},t={label:"The first group",scrollable:!1,items:[qs.forToolbar("back",function(){n.selection.collapse(),i.exit()},{})]},r={label:"Back to read only",scrollable:!1,items:[qs.forToolbar("readonly-back",function(){s(v,g,m,!0)},{})]},o={label:"The read only mode group",scrollable:!0,items:[]},u=iv.setup(i,n),a=iv.detect(n.settings,u),l={label:"The extra group",scrollable:!1,items:[]},m=Hi([{label:"the action group",scrollable:!0,items:a},l]),g=Hi([o,l]),v=Hi({backToMask:[t],backToReadOnly:[r]});cy.init(i,n)}),n.on("remove",function(){i.exit()}),n.on("detach",function(){Ht(i.system()),i.system().destroy(),Dt(o)}),{iframeContainer:i.socket().element().dom(),editorContainer:i.element().dom()}}}})}(window);