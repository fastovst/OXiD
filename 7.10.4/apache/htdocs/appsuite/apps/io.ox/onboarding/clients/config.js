define("io.ox/onboarding/clients/config",["io.ox/onboarding/clients/api","io.ox/core/api/user","io.ox/onboarding/clients/codes","gettext!io.ox/core/onboarding"],function(e,i,t,a){"use strict";function n(){return Array.prototype.join.call(arguments,"/")}function o(e){var i=_.clone(e);return _.each(i,function(e,t){_.isSet(e)||delete i[t]}),i}function r(e){return s.order[e.id]||1e3}var s={stores:function(){var e=ox.language.slice(0,2).toUpperCase(),i=_.contains(["EN","DE","ES","FR"],e)?e:"EN";return{macappstore:{name:a("Mac App Store"),description:a("Get the App from %1$s.",a("Mac App Store")),image:"apps/themes/icons/default/appstore/Mac_App_Store_Badge_"+i+"_165x40.svg"},appstore:{name:a("App Store"),description:a("Get the App from %1$s.",a("App Store")),image:"apps/themes/icons/default/appstore/App_Store_Badge_"+i+"_135x40.svg"},playstore:{name:a("Google Play"),description:a("Get the App from %1$s",a("Google Play")),image:"apps/themes/icons/default/googleplay/google-play-badge_"+i+".svg"},common:{description:a("Download the application.")}}}(),actiontypes:{email:{description:a("Get your device configured by email.")},download:{description:a("iOS devices can be automatically configured by installing the configuration profile.")}},actions:{"link/mailappinstall":{imageplaceholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="},"link/driveappinstall":{imageplaceholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="}},order:{windows:101,android:102,apple:103,"windows.desktop":101,"android.phone":201,"android.tablet":202,"apple.iphone":301,"apple.ipad":302,"apple.mac":303,caldav_url:401,caldav_login:402,carddav_url:403,carddav_login:404,imapServer:411,imapPort:412,imapLogin:413,imapSecure:414,smtpServer:421,smtpPort:422,smtpLogin:423,smtpSecure:424,eas_url:431,eas_login:432},labels:{caldav:a("CalDAV"),caldav_url:a("URL"),caldav_login:a("Login"),carddav:a("CardDAV"),carddav_url:a("URL"),carddav_login:a("Login"),imap:a("IMAP"),imapServer:a("Server Name"),imapPort:a("Port"),imapLogin:a("User Name"),imapSecure:a("Connection"),smtp:a("SMTP"),smtpServer:a("Server Name"),smtpPort:a("Port"),smtpLogin:a("User Name"),smtpSecure:a("Connection"),eas:a("EAS"),eas_url:a("URL"),eas_login:a("Login")},defaults:{platforms:{android:{icon:"fa-android"},apple:{icon:"fa-apple"},windows:{icon:"fa-windows"}},devices:{"android.phone":{icon:"fa-mobile"},"android.tablet":{icon:"fa-tablet"},"apple.iphone":{icon:"fa-mobile"},"apple.ipad":{icon:"fa-tablet"},"apple.mac":{icon:"fa-laptop"},"windows.phone":{icon:"fa-mobile"},"windows.desktop":{icon:"fa-laptop"}},scenarios:{eassync:{icon:["fa-envelope-o","fa-calendar","fa-users"]},emclientinstall:{icon:["fa-envelope-o","fa-calendar","fa-users"]},mailappinstall:{icon:"fa-envelope-o"},mailsync:{icon:"fa-envelope-o"},mailmanual:{icon:"fa-envelope-o"},davsync:{icon:["fa-calendar","fa-users"]},syncappinstall:{icon:["fa-calendar","fa-users"]},davmanual:{icon:"fa-wrench"},drivewindowsclientinstall:{icon:"fa-cloud"},driveappinstall:{icon:"fa-cloud"},drivemacinstall:{icon:"fa-cloud"}}}},c=_.device("android")?_.device("smartphone")?"android.phone":"android.tablet":_.device("ios")?_.device("smartphone")?"apple.iphone":"apple.ipad":void 0,l={hash:{},load:function(){return e.config(c).then(function(e){return e.platforms=_.sortBy(e.platforms,r),e.devices=_.sortBy(e.devices,r),_.extend(this,e),this.model=new Backbone.Model,_("platforms,devices,scenarios,actions,matching".split(",")).each(function(i){var t=this.hash[i]=_.toHash(e[i],"id");_.each(s.defaults[i],function(e,i){_.extend(t[i],e,o(t[i]))})},this),i.getCurrentUser().then(function(e){l.user=e.attributes}),this}.bind(this))},getState:function(){return _.extend({},this.model.attributes)},getScenarioCID:function(){return n(l.getDevice().id,this.model.get("scenario"))},getPlatform:function(){return 1===this.platforms.length?this.platforms[0]:this.hash.platforms[this.model.get("platform")]},getDevice:function(){return 1===this.devices.length?this.devices[0]:this.hash.devices[this.model.get("device")]},getScenario:function(){return this.hash.scenarios[this.model.get("scenario")]},getAction:function(){return this.hash.actions[this.model.get("action")]},getPlatforms:function(){return this.platforms},getDevices:function(){var e=this.devices,i=this.getPlatform();return i?_.filter(e,function(e){return e.id.split(".")[0]===i.id}):e},getScenarios:function(){var e=this.getDevice();return e?_.map(e.scenarios,function(e){var i=e.split("/")[1];return l.hash.scenarios[i]}):this.scenarios},getActions:function(e){var i,t=n(l.getDevice().id,e||this.model.get("scenario")),a=this.hash.matching[t];{if(a)return _.chain(this.actions).filter(function(e){return a.actions.indexOf(e.id)>=0}).sortBy(function(e){return a.actions.indexOf(e.id)}).map(function(e){var i=_.extend(_.pick(e,"id","default","data"),{scenario:t},e[l.getDevice().id]||{});return i.type&&(i.store={type:i.type}),i.type=e.id.split("/")[0],i}).each(function(e){"link"===e.type&&_.extend(e.store,s.stores[e.store.type]||{}),_.extend(e,s.actiontypes[e.type],s.actions[e.id]),"display"===e.type&&(e.data=_(Object.keys(e.data)).chain().sortBy(function(e){return s.order[e]||1e3}).map(function(t){var a=t.indexOf("_")>=0?t.split("_")[0]:t.substr(0,4),n=i!==a;return i=a,[n?{name:s.labels[a]||a}:void 0,{name:s.labels[t]||t,value:/imapSecure|smtpSecure/.test(t)?e.data[t]?"SSL/TLS":"STARTTLS":e.data[t],type:a}]}).flatten().compact().value())}).value();ox.debug&&console.error("undefined onboarding scenario: "+t)}},getUserMail:function(){var e=this.user;if(e)return e.email1||e.email2||e.email3},getUserMobile:function(){var e=this.user;if(e)return e.cellular_telephone1||e.cellular_telephone2},getUserCountryCode:function(){var e=this.user;if(e)return e.locale.slice(3,5).toUpperCase()},isIncomplete:function(){var e=!0;return _.each(this.hash,function(i){e=e&&!_.isEmpty(i)}),!e},getCodes:t.get,find:t.find};return l});