define("io.ox/backbone/basicModel",["io.ox/core/extensions","gettext!io.ox/core"],function(i,t){"use strict";function r(){this.errors={},this.add=function(i,t){return(this.errors[i]||(this.errors[i]=[])).push(t),this},this.hasErrors=function(){return!_.isEmpty(this.errors)},this.errorsFor=function(i){return this.errors[i]},this.each=function(){var i=_(this.errors);return i.each.apply(i,$.makeArray(arguments))}}return Backbone.Model.extend({initialize:function(i){var t=this;this._valid=!0,this.attributeValidity={},this.id=i.id,this.on("change:id",function(){t.id=t.get("id")}),this.init&&this.init(),this.url=this.url||"invalidURL"},point:function(t){return/^\//.test(t)&&(t=t.substring(1)),i.point(this.ref+t)},validate:function(i,t,e){e=e||{};var n=this,s=n.errors=new r;if(i=i||this.toJSON(),this.point("validation").invoke("validate",s,i,s,this),e.isSave&&this.point("validation/save").invoke("validate",s,i,s,this),s.hasErrors()){var a={};_(i).chain().keys().each(function(i){a[i]=!0}),s.each(function(i,t){a[t]=!1,n.trigger("invalid:"+t,i,s,n)}),_(n.attributeValidity).each(function(i,t){!i&&a[t]&&n.trigger("valid:"+t,n)}),n.attributeValidity=a,n.trigger("invalid",s,n),n._valid=!1}else n._valid||(_(n.attributeValidity).each(function(i,t){i||n.trigger("valid:"+t,n)}),_(i).chain().keys().each(function(i){n.attributeValidity[i]=!0}),n._valid=!0,this.trigger("valid"))},parse:function(){return{}},sync:function(i,r,e){var n=this;if("delete"===i&&(i="destroy"),("update"===i||"create"===i)&&!this.isValid({isSave:!0})){var s=t("The dialog contains invalid data"),a=this.errors.errors;return 1===_(a).size()&&_.isString(a[_(a).keys()[0]][0])&&(s=a[_(a).keys()[0]]),$.Deferred().reject({error:s,model:this})}if(this.syncer)return this.trigger(i+":start"),this.trigger("sync:start"),this.syncer[i](r).done(function(t){e.success(r,t),n.trigger(i,t),n.trigger("sync",t)}).fail(function(s,a){!a||404!==a.status&&0!==a.status||(s.error=t("Server unreachable")),e.error(r,s),n.trigger("backendError",s,a),n.trigger(i+":fail",s),n.trigger("sync:fail",s)}).always(function(){n.trigger(i+":always"),n.trigger("sync:always")});throw new Error("No Syncer specified!")},isSet:function(){var i=this;return _(arguments).all(function(t){return i.has(t)&&""!==i.get(t)})},isAnySet:function(){var i=this;return _(arguments).any(function(t){return i.has(t)&&""!==i.get(t)})},isValid:function(i){return this.validate(this.toJSON(),null,i),this._valid},hasValidAttributes:function(){var i=this;return _(arguments).all(function(t){return i.attributeValidity[t]})},invalidAttributes:function(){var i=this;return _(this.attributeValidity).chain().keys().filter(function(t){return!i.attributeValidity[t]}).values()._wrapped}})});