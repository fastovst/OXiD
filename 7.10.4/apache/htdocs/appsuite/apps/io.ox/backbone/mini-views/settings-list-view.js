define("io.ox/backbone/mini-views/settings-list-view",["io.ox/backbone/views/disposable","io.ox/backbone/mini-views/listutils","gettext!io.ox/core","less!io.ox/backbone/mini-views/settings-list-view"],function(t,e,i){var r=t.extend({tagName:"li",className:"settings-list-item",initialize:function(t){this.opt=_.extend({titleAttribute:"title",customize:$.noop},t)},render:function(){return this.$el.empty().addClass(this.opt.sortable?"draggable":"").attr("draggable",this.opt.sortable).append(this.opt.sortable?e.dragHandle(i("Drag to reorder items")):null,e.makeTitle(this.model.get(this.opt.titleAttribute)),e.makeControls()),this.opt.customize.call(this,this.model),this}}),n=function(){function t(t,e,i){if(!i)return t.css(e);_.defer(function(){t.css(e)})}var e,i,r;return{events:{"dragstart li":"onDragStart","dragenter li":"onDragEnter",dragover:"onDragOver",dragend:"onDragEnd","drop li":"onDrop"},onDragStart:function(n){if(_.browser.ie&&$(n.target).closest(".list-item-controls").length)return n.preventDefault(),!1;var o=n.originalEvent;e=$(n.currentTarget),r=e.index();var s=e.offset();o.dataTransfer.setDragImage&&((i=e.clone()).css({position:"absolute",width:e.width()}),t(i,{top:"-100px","z-index":-1e3},!!_.browser.edge||!!_.browser.safari),e.after(i),o.dataTransfer.setDragImage(i.get(0),n.pageX-s.left,n.pageY-s.top)),o.dataTransfer.setData("text",""),t(e,{opacity:"0.2"},!!_.browser.ie),e.attr("aria-grabbed",!0),this.$("> li").attr("aria-dropeffect","copy")},onDragEnter:function(t){var i=$(t.currentTarget).closest("li.settings-list-item");0!==i.length&&(i.is(e)||(i.index()<e.index()?i.before(e):i.after(e)))},onDragOver:function(t){return t.originalEvent.dataTransfer.effectAllowed="move",t.preventDefault(),t.stopPropagation(),!1},onDragEnd:function(){i&&i.remove(),i=void 0,e.css("opacity","").attr("aria-grabbed",!1),this.$("> li").attr("aria-dropeffect",""),r!==e.index()&&this.trigger("order:changed")},onDrop:function(t){return t.preventDefault(),t.stopPropagation(),!1}}}();return t.extend(n).extend({tagName:"ol",className:"list-group list-unstyled settings-list-view",events:_.extend({"click *[data-action]":"onClickAction","keydown .drag-handle":"onKeydown","blur .drag-handle":"onBlurDragHandle"},n.events),initialize:function(t){this.opt=_.extend({sortable:!1,childView:r,childOptions:$.noop,containment:void 0,controls:[],notification:$(),filter:function(){return!0},update:$.noop,dataIdAttribute:"data-id"},t),this.collection||(this.collection=new Backbone.Collection),this.listenTo(this.collection,"set reset",this.render.bind(this)),this.listenTo(this.collection,"change sort",_.debounce(this.renderChildViews,20)),this.listenTo(this.collection,"add",this.onAdd.bind(this)),this.listenTo(this.collection,"remove",this.onRemove.bind(this))},createOrGetView:function(t,e){return this.views[t]||(this.views[t]=new this.opt.childView(e)),this.views[t]},render:function(){return this.$el.empty(),this.views={},this.renderChildViews(),this},getChildOptions:function(t){return _.isFunction(this.opt.childOptions)?this.opt.childOptions(t,self):this.opt.childOptions},renderChildViews:function(){if(!this.disposed){var t=this,e=this.collection.filter(this.opt.filter);_(e).each(function(e){var r=e.get(e.idAttribute),n=t.createOrGetView(r,_.extend({model:e,sortable:t.opt.sortable},t.getChildOptions(e)));if(t.$el.append(n.render().$el.attr(t.opt.dataIdAttribute,r)),t.opt.sortable){var o=_.uniqueId("aria-description-");n.$el.attr({tabindex:0,"aria-describedby":o}).prepend($('<div class="sr-only">').attr("id",o).text(i("Use cursor keys to reorder items")))}})}},onAdd:function(t){if(this.opt.filter(t)){var e=t.get(t.idAttribute),i=this.collection.indexOf(t),r=this.$el.find("> li:nth-child("+(i+1)+")"),n=this.createOrGetView(e,_.extend({model:t,sortable:this.opt.sortable},this.getChildOptions(t)));n.render().$el.attr(this.opt.dataIdAttribute,e),r.length>0?r.before(n.$el):this.$el.append(n.$el),this.trigger("add",n)}},onRemove:function(t){var e=t.get(t.idAttribute);this.views[e]&&(this.trigger("remove",this.views[e]),this.views[e].remove(),delete this.views[e])},onClickAction:function(t){var e=$(t.currentTarget).attr("data-action");this.trigger(e,t),t.preventDefault()},onKeydown:function(t){var e=$(t.target);if(13===t.which||32===t.which)return e.toggleClass("selected"),void e.attr("aria-pressed",e.hasClass("selected"));e.hasClass("selected")&&this.onKeydownDragHandle(t)},onKeydownDragHandle:function(t){function e(t){var e=i("%1$s moved to position %2$s of %3$s",o.find(".list-item-title").text(),t+1,s.length),a=r.opt.notification.text();r.trigger("order:changed"),n.hasClass("drag-handle")?r.$el.find("["+r.opt.dataIdAttribute+'="'+l+'"] .drag-handle').focus().addClass("selected"):r.$el.find("["+r.opt.dataIdAttribute+'="'+l+'"]').focus(),r.opt.notification.attr("aria-relevant",e===a?"all":"additions text").text(e)}var r=this,n=$(t.currentTarget),o=$(t.currentTarget).closest(".draggable"),s=r.$el.children(".draggable"),a=s.index(o),l=o.attr(this.opt.dataIdAttribute);switch(t.which){case 38:a>0&&(t.preventDefault(),o.insertBefore(o.prevAll(".draggable:first")),e(a-1));break;case 40:a<s.length&&(t.preventDefault(),o.insertAfter(o.nextAll(".draggable:first")),e(a+1))}},onBlurDragHandle:function(t){$(t.currentTarget).removeClass("selected")}})});