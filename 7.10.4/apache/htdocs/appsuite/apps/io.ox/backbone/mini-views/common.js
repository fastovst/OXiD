define("io.ox/backbone/mini-views/common",["io.ox/backbone/mini-views/abstract","io.ox/backbone/mini-views/dropdown","gettext!io.ox/core"],function(t,e,i){"use strict";var s=function(t){if(t.originalEvent.dataTransfer.getData("text")){var e=this;this.$el.one("input",function(){e.$el.trigger("change")})}},n=function(t){if(t&&"paste"===t.type&&-1!==t.originalEvent.clipboardData.types.indexOf("text/plain")){var e=this;this.$el.one("input",function(){e.$el.trigger("change")})}},o=t.extend({el:'<input type="text" class="form-control">',events:_.device("firefox")?{change:"onChange",drop:"onDrop",paste:"onPaste"}:{blur:"onChange",change:"onChange",paste:"onPaste"},onChange:function(){this.model.set(this.name,this.$el.val(),{validate:this.options.validate})},onDrop:s,onPaste:n,setup:function(){this.listenTo(this.model,"change:"+this.name,this.update)},update:function(){var t=_.isString(this.model.get(this.name))?this.model.get(this.name).replace(/^\s+/,""):this.model.get(this.name);this.$el.val(t),this.model.set(this.name,t),this.trigger("update",this.$el)},render:function(){return this.$el.attr({name:this.name}),this.id&&this.$el.attr("id",this.id),this.attributes&&this.$el.attr(this.attributes),this.options.maxlength&&this.$el.attr("maxlength",this.options.maxlength),this.options.mandatory&&this.$el.attr("aria-required",!0),_.isBoolean(this.options.autocomplete)&&!this.options.autocomplete&&this.$el.attr("autocomplete","off"),this.update(),this}}),a=t.extend({el:'<input type="password" class="form-control">',events:{change:"onChange",paste:"onPaste"},onChange:function(){var t=this.$el.val();/^\*$/.test(t)&&(t=null),this.model.set(this.name,t,{validate:this.options.validate,_event:"change"})},onPaste:n,setup:function(){this.listenTo(this.model,"change:"+this.name,this.update)},update:function(){var t=this.model.get(this.name);this.$el.val(null!==t?$.trim(t):"********")},toggle:function(t){t=_.isBoolean(t)?t:"password"===this.$el.attr("type"),this.$el.attr("type",t?"text":"password")},render:function(){return this.$el.attr({autocomplete:"off",autocorrect:"off",name:this.name,placeholder:this.options.placeholder}),this.id&&this.$el.attr("id",this.id),this.options.maxlength&&this.$el.attr("maxlength",this.options.maxlength),this.options.mandatory&&this.$el.attr("aria-required",!0),_.isBoolean(this.options.autocomplete)&&!this.options.autocomplete&&this.$el.attr("autocomplete","new-password").removeAttr("name"),this.update(),this}}),r=t.extend({el:'<div class="password-container has-feedback">',events:{"click .toggle-asterisks":"toggle",keydown:"onKeyPress",keyup:"onKeyPress",focusin:"onFocusChange",focusout:"onFocusChange"},icons:{password:"fa-eye",text:"fa-eye-slash"},initialize:function(t){this.passwordView=new a(t)},onFocusChange:_.debounce(function(){this.$el.toggleClass("has-focus",$(document.activeElement).closest(".password-container").length>0)},200),onKeyPress:function(t){(_.device("macos")?18===t.which:91===t.which)&&this.toggle(t,"keydown"===t.type)},toggle:function(t){t=_.isBoolean(t)?t:void 0,this.passwordView.toggle(t),this.$el.find("i.fa").removeClass("fa-eye fa-eye-slash").addClass(this.icons[this.passwordView.$el.attr("type")]),_.device("safari")&&this.$el.find(".toggle-asterisks").focus()},render:function(){return this.$el.empty().append(this.passwordView.render().$el,$('<button type="button" class="btn form-control-feedback toggle-asterisks center-childs">').attr({title:i("toggle password visibility")}).append($('<i class="fa" aria-hidden="true">').addClass(this.icons.password))),this}}),h=t.extend({el:'<textarea class="form-control">',events:_.device("firefox")?{change:"onChange",drop:"onDrop"}:{change:"onChange"},onChange:function(){this.model.set(this.name,this.$el.val(),{validate:this.options.validate})},onDrop:s,setup:function(t){this.rows=t.rows,this.listenTo(this.model,"change:"+this.name,this.update)},update:function(){this.$el.val(this.model.get(this.name))},render:function(){return this.$el.attr({name:this.name}),this.attributes&&this.$el.attr(this.attributes),this.options.id&&this.$el.attr("id",this.options.id),this.rows&&this.$el.attr("rows",this.rows),this.options.maxlength&&this.$el.attr("maxlength",this.options.maxlength),this.update(),this}}),l=t.extend({el:'<input type="checkbox">',events:{change:"onChange"},getValue:function(){return this.options.customValues&&this.options.customValues.true&&this.options.customValues.false?this.options.customValues[this.isChecked()]:this.isChecked()},setValue:function(){var t=this.model.get(this.name)||this.options.defaultVal;return t=this.options.customValues&&this.options.customValues.true&&this.options.customValues.false?_.isEqual(this.options.customValues.true,t):!!t},onChange:function(){this.model.set(this.name,this.getValue())},isChecked:function(){return!!this.$input.prop("checked")},setup:function(t){this.$input=this.$el,this.nodeName=t.nodeName,this.listenTo(this.model,"change:"+this.name,this.update)},update:function(){this.$input.prop("checked",this.setValue())},render:function(){return this.$input.attr({name:this.nodeName||this.name}),this.options.id&&this.$input.attr("id",this.options.id),this.update(),this}}),d=l.extend({el:'<div class="checkbox custom">',render:function(){var t=this.options.id||_.uniqueId("custom-");return this.$el.addClass(this.options.size||"small").append($("<label>").attr("for",t).append(this.$input=$('<input type="checkbox" class="sr-only">').attr({id:t,name:this.nodeName||this.name}),$('<i class="toggle" aria-hidden="true">'),$.txt(this.options.label||"Â "))),this.update(),this}}),u=d.extend({el:'<div class="checkbox switch">',events:{change:"onChange","swipeleft .toggle":"onSwipeLeft","swiperight .toggle":"onSwipeRight"},onSwipeLeft:function(){this.isChecked()&&this.$input.prop("checked",!1)},onSwipeRight:function(){this.isChecked()||this.$input.prop("checked",!0)}}),p=t.extend({tagName:"div",className:"controls",events:{change:"onChange"},onChange:function(){this.model.set(this.name,this.$('[name="'+this.name+'"]:checked').val())},setup:function(){this.listenTo(this.model,"change:"+this.name,this.update)},update:function(){var t=this.model.get(this.name);this.$('[name="'+this.name+'"]').each(function(){this.value===t&&$(this).prop("checked",!0)})},render:function(){return this.$el.append(_(this.options.list).map(this.renderOption,this)),this.update(),this},renderOption:function(t){return $('<div class="radio custom">').addClass(this.options.size||"small").append(this.renderLabel(t))},renderLabel:function(t){return $("<label>").append(this.renderInput(t),$.txt(t.label))},renderInput:function(t){return $('<input type="radio">').attr("name",this.name).val(t.value)}}),c=p.extend({renderLabel:function(t){var e=_.uniqueId("custom-");return $("<label>").attr("for",e).append(this.renderInput(t).attr("id",e),this.renderToggle(t),$.txt(t.label))},renderToggle:function(){return $('<i class="toggle" aria-hidden="true">')},renderInput:function(){return p.prototype.renderInput.apply(this,arguments).addClass("sr-only")}}),m=t.extend({tagName:"select",className:"form-control",events:{change:"onChange"},onChange:function(){var t=this.$el.val();this.model.set(this.name,this.options.integer?parseInt(t,10):t)},setup:function(){this.listenTo(this.model,"change:"+this.name,this.update)},update:function(){this.$el.val(this.model.get(this.name))},render:function(){return this.$el.attr({name:this.name}),this.id&&this.$el.attr({id:this.id}),this.rerender(),this},renderOptionGroups:function(t){return _(t).chain().map(function(t){return!1===t.label?this.renderOptions(t.options):$("<optgroup>").attr("label",t.label).append(this.renderOptions(t.options))},this).flatten(!0).value()},renderOptions:function(t){return _(t).map(function(t){return $("<option>").attr({value:t.value}).text(t.label)})},rerender:function(){this.$el.empty().append(this.options.groups?this.renderOptionGroups(this.options.list):this.renderOptions(this.options.list)),this.update()},setOptions:function(t){this.options.list=t,this.rerender()}}),f=_.device("smartphone")?o.extend({el:'<input type="date" class="form-control">'}):o.extend({format:"l",onChange:function(){var t=+moment(this.$el.val(),this.format);this.model.set(this.name,t)},update:function(){var t=this.model.get(this.name);this.$el.val(t||this.options.mandatory?this.getFormattedDate(t):"")},getFormattedDate:function(t){return moment(t).format(this.format)},render:function(){o.prototype.render.call(this);var t=this;return require(["io.ox/backbone/views/datepicker"],function(e){setTimeout(function(){new e({parent:t.$el.closest(".modal, #io-ox-core"),mandatory:t.options.mandatory}).attachTo(t.$el).on("select",function(e){t.model.set(t.name,e.valueOf())})})}),this}}),g=t.extend({tagName:"span",className:"help-block",setup:function(t){this.focusSelector=t.focusSelector||"input"},getContainer:function(){return this.options.selector?_.isString(this.options.selector)?this.$el.closest(this.options.selector):_.isObject(this.options.selector)?this.options.selector:void 0:this.$el.closest('.form-group, [class*="col-"]')},render:function(){var t=this;return _.defer(function(){var e=t.getContainer(),i=_.uniqueId("error-help_");e.on({invalid:function(s,n){$(this).hasClass("has-error")||($(this).addClass("has-error"),t.$el.attr({id:i}),t.$el.text(n).show().end(),$(this).find("input").attr({"aria-invalid":!0,"aria-describedby":i}),_.defer(function(){$(e).find(t.focusSelector).focus()}))},valid:function(){$(this).removeClass("has-error"),t.$el.removeAttr("id role"),t.$el.text("").hide().end(),$(this).find("input").removeAttr("aria-invalid aria-describedby")}})}),this.$el.attr({"aria-live":"assertive"}).hide(),this}}),v=t.extend({tagName:"form",setup:function(){this.listenTo(this.model,"change")},render:function(){return this.id&&this.$el.attr({id:this.id}),this}}),w=e.extend({tagName:"div",className:"dropdownlink",update:function(){this.updateLabel(),e.prototype.update.apply(this,arguments)},updateLabel:function(){this.$el.find(".dropdown-label").text(this.options.values[this.model.get(this.name)])},render:function(){var t=this;return e.prototype.render.apply(this,arguments),_(this.options.values).each(function(e,i){var s=t.options.tooltips&&t.options.tooltips[i]?t.options.tooltips[i]:e;t.option(t.name,i,e,{radio:!0,title:s})}),this.updateLabel(),this}});return{AbstractView:t,InputView:o,PasswordView:a,PasswordViewToggle:r,TextView:h,CheckboxView:l,CustomCheckboxView:d,SwitchView:u,RadioView:p,CustomRadioView:c,SelectView:m,DateView:f,ErrorView:g,FormView:v,DropdownLinkView:w,getInputWithLabel:function(t,e,i){var s=_.uniqueId("form-control-label-");return[$("<label>").attr("for",s).text(e),new o({name:t,model:i,id:s}).render().$el]}}});