define("io.ox/backbone/mini-views/timezonepicker",["io.ox/backbone/mini-views/common","settings!io.ox/calendar","settings!io.ox/core","settings!io.ox/core/settingOptions","gettext!io.ox/core"],function(e,t,i,n,o){"use strict";function r(e){var t=moment.tz(e);return(t.format("Z ")+t.zoneAbbr()+" "+e).replace(/_/g," ")}var a=_.memoize(function(){var e=n.get("availableTimeZones",{}),t=moment();return _(moment.tz.names()).chain().map(moment.tz.zone).filter(function(t){return t.displayName=r(t.name),!!e[t.name]}).sortBy(function(e){return-1*e.utcOffset(t)}).map(function(e){return{label:e.displayName,value:e.name}}).value()});return e.SelectView.extend({initialize:function(i){(i=i||{}).showFavorites&&t.get("favoriteTimezones")&&(i.favorites=_(t.get("favoriteTimezones")).map(function(e){return{label:r(e),value:e}})),i.list=a(),e.SelectView.prototype.initialize.call(this,i)},renderOptions:function(e,t){t.append(_(e).map(function(e){return $("<option>").attr({value:e.value}).text(e.label)}))},render:function(){var e=this;return this.$el.attr({name:this.name}),this.id&&this.$el.attr({id:this.id}),_.defer(function(){if(e.options.favorites){var t=$("<optgroup>").attr("label",o("Standard timezone")),n=$("<optgroup>").attr("label",o("Favorites")),a=$("<optgroup>").attr("label",o("All timezones"));e.renderOptions([{label:r(i.get("timezone")),value:i.get("timezone")}],t),e.renderOptions(e.options.favorites,n),e.renderOptions(e.options.list,a),e.$el.append(t,n,a)}else e.renderOptions(e.options.list,e.$el);e.update()}),this}})});