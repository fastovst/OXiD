define("io.ox/notes/api",["io.ox/files/api","io.ox/core/folder/api","io.ox/core/http","settings!io.ox/notes"],function(e,t,n,o){"use strict";function i(t){return e.pool.get("detail").get(t)}var r={get:function(t){return $.when(e.get(t),$.ajax({type:"GET",url:e.getUrl(t,"view")+"&"+_.now(),dataType:"text"})).then(function(e,t){return{data:e,content:t[0]}})},resolve:function(e,t){var n=_(e).chain().map(i).compact().value();return!1===t?n:_(n).invoke("toJSON")},getModel:function(t){return e.pool.get("detail").get(t)},addToPool:function(t){e.pool.get("detail").add(t)},create:function(t){var n=(t=_.extend({content:"",folder:this.getDefaultFolder(),title:"New note"},t)).title.toLowerCase()+".txt",o=new window.Blob([t.content],{type:"text/plain"});return e.upload({addVersion:!1,file:o,filename:n,folder:t.folder,title:t.title}).done(function(t){e.pool.get("detail").add(t)})},update:function(t,n){return _.isString(t)&&(t=_.cid(t)),e.update(t,n)},updateContent:function(t,n){var o=new window.Blob([n],{type:"text/plain"});return e.versions.upload({id:t.id,folder:t.folder_id,file:o,filename:t.filename,preview:t.preview})},createDefaultFolders:function(){var e,i,a=t.getDefaultFolder("infostore"),l=$.Deferred().notify(.2,"Creating root folder");return t.create(a,{title:"Notes"}).done(function(t){e=t.id,o.set("folder/root",e).save()}).then(function(){return l.notify(.4,"Creating default folder"),t.create(e,{title:"General"}).done(function(e){i=e.id,o.set("folder/default",i).save()})}).then(function(){return l.notify(.6,"Creating topics"),n.pause(),["Ideas","Meetings","Shopping","Todo lists","Work"].forEach(function(n){t.create(e,{title:n})}),n.resume()}).then(function(){return l.notify(.8,"Creating welcome note"),r.createWelcomeNote()}).then(function(){return l.notify(1),_.wait(300)}).then(function(){return i}).then(l.resolve,l.reject),l},createWelcomeNote:function(){return this.create({content:"With **OX Notes** you can create simple todo or shopping lists, easily take meetings minutes, or quickly write down your ideas.\n\n- [x] Make a list\n-Â [x] Have a break\n- [x] Mark the first two items as done\n- [x] Be proud to have finished three items yet\n- [ ] So much done. Have a beer!\n\nYou can create numbered lists: \n# First item\n# Second item\n\n_You can highlight important parts_ and you can ~cross out parts~.\n\nLinks are automatically detected, of course: http://www.open-xchange.com\n\nAnd, finally, you can integrate **images**:\n\n![](api/files?action=document&folder=13894&id=13894/63583&delivery=view&scaleType=contain&width=1024)",title:"Welcome to OX Notes"})},getRootFolder:function(){return o.get("folder/root")},getDefaultFolder:function(){return o.get("folder/default")}};return r});