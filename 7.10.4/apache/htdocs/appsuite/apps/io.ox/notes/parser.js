define("io.ox/notes/parser",[],function(){"use strict";var e={i:"*","/i":"*",b:"**","/b":"**",u:"_","/u":"_",strike:"~","/strike":"~",a:"","/a":"",div:"\n","/div":"",br:"\n",ul:"","/ul":"",ol:"","/ol":"",li:function(e){return/checkmark/.test(e)?/checked/.test(e)?"- [x] ":"- [ ] ":/number/.test(e)?"# ":"* "},"/li":"\n",img:function(e){var r=e.match(/src="(.*?)"/i);return r?"![]("+r[1]+") ":" "}};return{parsePlainText:function(e){e=$.trim(e);var r,t=_.escape(e).split(/\n/);return{html:(t=t.map(function(e){var t,n,i=e.match(/^(\*\s|#\s|-\s\[(?:\s|x)\])\s?(.+)$/);if(!i)return r?(t="</"+r+">"+e+"\n",r=!1):t=e+"\n",t;if(n=(/^-\s\[x]/.test(e)?'<li class="checked">':"<li>")+i[2]+"</li>",r)return n;switch(e[0]){case"#":t="<ol>",r="ol";break;case"-":t='<ul class="todo">',r="ul";break;default:t="<ul>",r="ul"}return t+n})).join("").replace(/!\[\]\((.*?)\)/g,'<img src="$1">').replace(/(^|[^\\])\*\*([^<*]+)\*\*/g,"$1<b>$2</b>").replace(/(^|[^\\])\*([^<*]+)\*/g,"$1<i>$2</i>").replace(/(^|[^\\])_([^<_]+)_/g,"$1<u>$2</u>").replace(/(^|[^\\])~([^<~]+)~/g,"$1<strike>$2</strike>").replace(/(https?:\/\/\S+)/gi,'<a href="$1" target="_blank" rel="noopener">$1</a>').replace(/\n/g,"<br>"),preview:this.getPreview(e),content:e}},parseHTML:function(r){r.find("ul.todo > li").addClass("checkmark"),r.find("ol > li").addClass("number");var t=r.html(),n=(t=(t=t.replace(/<div><br><\/div>/g,"<br>")).replace(/&\w+;/g,function(e){var r=document.createElement("span");return r.innerHTML=e,r.innerText})).replace(/<(\/?\w+)([^>]*)>/g,function(r,t,n){t=t.toLowerCase();var i=e[t];return void 0===i?"":_.isFunction(i)?i(n):i});return n=$.trim(n),{content:n,html:t,preview:this.getPreview(n)}},getPreview:function(e){return String(e||"").replace(/\s+/g," ").substr(0,200)}}});