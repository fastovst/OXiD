define("io.ox/tasks/common-extensions",["io.ox/backbone/mini-views/dropdown","io.ox/tasks/util","io.ox/mail/util","io.ox/tasks/api","io.ox/core/strings","gettext!io.ox/tasks"],function(t,e,a,n,o,d){"use strict";var i={date:function(t,e){var n=t.data,o=n.end_time||n.start_time||n.last_modified;_.isNumber(o)&&this.append($('<time class="date">').attr("datetime",moment(o).toISOString()).text(a.getDateTime(o,e)))},compactdate:function(t){i.date.call(this,t,{fulldate:!1,smart:!1})},title:function(t){this.append($('<div class="title">').text(t.data.title))},progress:function(t){this.append($('<div class="prog">').append(d("Progress")+": "+(t.data.percent_completed||0)+"%"))},dueDate:function(){function a(t){t.preventDefault();var a=t.data.data,o=$(t.target).val();ox.load(["io.ox/backbone/views/modal","io.ox/core/notifications"]).done(function(t,i){var s=e.computePopupTime(o).endDate,r={end_time:s,id:a.id,folder_id:a.folder_id||a.folder};a.start_time&&a.start_time>s?new t({title:d("Inconsistent dates"),description:d("The due date cannot be before start date. Adjust start date?")}).addCancelButton().addButton({label:d("Adjust start date"),action:"datechange"}).on("cancel",function(){i.yell("info",d("Canceled"))}).on("datechange",function(){r.start_time=r.end_time,n.update(r).done(function(){i.yell("success",d("Changed due date"))})}).open():n.update(r).done(function(){i.yell("success",d("Changed due date"))})})}return function(n){var o=n.first(),d=$('<ul class="dropdown-menu" role="menu">').append(e.buildDropdownMenu({bootstrapDropdown:!0,daysOnly:!0})).on("click",'li > a:not([data-action="close-menu"])',{data:o},a);this.attr({"aria-haspopup":"true","data-action":"change-due-date","data-toggle":"dropdown",tabindex:"0"}),this.append($('<i class="fa fa-caret-down" aria-hidden="true">')),new t({el:this.parent(),$toggle:this,$ul:d}).render(),this.parent().addClass("dropdown")}}()};return i});