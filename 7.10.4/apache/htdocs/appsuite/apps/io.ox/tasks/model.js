define("io.ox/tasks/model",["io.ox/tasks/api","io.ox/backbone/modelFactory","io.ox/backbone/validation","io.ox/core/extensions","io.ox/participants/model","settings!io.ox/core","io.ox/core/strings","gettext!io.ox/tasks"],function(t,e,a,i,o,s,n,d){"use strict";var r={title:"",status:1,percent_completed:0,folder_id:t.getDefaultFolder(),recurrence_type:0,full_time:!0,private_flag:!1,timezone:s.get("timezone"),notification:!0},l=new e({ref:"io.ox/tasks/model",api:t,model:{idAttribute:"id",defaults:r,getParticipants:function(){if(this._participants)return this._participants;var t=this,e=!1,a=!1;return this._participants=new o.Participants(this.get("participants"),{silent:!1,needsMail:!0}),this._participants.on("add remove reset",function(){a||(e=!0,t.set("participants",this.getAPIData(),{validate:!0}),e=!1)}),this.on("change:participants",function(){e||(a=!0,t._participants.reset(t.get("participants")),a=!1)}),this._participants},getDate:function(t,e){var a=this.get.apply(this,arguments);return e=e||{},e.fulltime=_.isBoolean(e.fulltime)?e.fulltime:this.get("full_time"),void 0!==a&&null!==a&&e.fulltime&&(a=moment.utc(a).local(!0).valueOf()),a},setDate:function(t,e,a){return a=a||{},a.fulltime=_.isBoolean(a.fulltime)?a.fulltime:this.get("full_time"),void 0!==e&&null!==e&&a.fulltime&&(e=moment(e),arguments[1]=e.utc(!0).valueOf()),this.set.apply(this,arguments)}}});a.validationFor("io.ox/tasks/model",{start_time:{format:"date"},end_time:{format:"date"},alarm:{format:"date"},title:{format:"string"},note:{format:"string"},companies:{format:"string"},billing_information:{format:"string"},trip_meter:{format:"string"},currency:{format:"string"},status:{format:"number"},percent_completed:{format:"number"},number_of_attachments:{format:"number"},actual_costs:{format:"anyFloat"},target_costs:{format:"anyFloat"},actual_duration:{format:"number"},target_duration:{format:"number"},private_flag:{format:"boolean"}}),i.point("io.ox/tasks/model/validation").extend({id:"start-date-before-end-date",validate:function(t){t.start_time&&t.end_time&&t.end_time<t.start_time&&(this.add("start_time",d("The start date must be before the due date.")),this.add("end_time",d("The due date must not be before the start date.")))}});var c=9999999999.99;return i.point("io.ox/tasks/model/validation").extend({id:"Actual-costs-out-of-limits",validate:function(t){t.actual_costs&&(t.actual_costs<-c||t.actual_costs>c)&&this.add("actual_costs",d("Costs must be between -%1$d and %1$d.",c,c))}}),i.point("io.ox/tasks/model/validation").extend({id:"target-costs-out-of-limits",validate:function(t){t.target_costs&&(t.target_costs<-c||t.target_costs>c)&&this.add("target_costs",d("Costs must be between -%1$d and %1$d.",c,c))}}),i.point("io.ox/tasks/model/validation").extend({id:"more than 2 decimal places",validate:function(t){var e=String(t.target_costs),a=String(t.actual_costs);e&&(e.substr(e.indexOf(".")).length>3||e.substr(e.indexOf(",")).length>3)&&this.add("target_costs",d("Costs must only have two decimal places.")),a&&(a.substr(a.indexOf(".")).length>3||a.substr(a.indexOf(",")).length>3)&&this.add("actual_costs",d("Costs must only have two decimal places."))}}),i.point("io.ox/tasks/model/validation").extend({id:"progress-not-between-0-and-100",validate:function(t){t.percent_completed&&(t.percent_completed<0||t.percent_completed>100)&&this.add("percent_completed",d("Progress must be a valid number between 0 and 100"))}}),i.point("io.ox/tasks/model/validation").extend({id:"recurrence-needs-start-date",validate:function(t){!t.recurrence_type||void 0!==t.start_time&&null!==t.start_time||this.add("start_time",d("Recurring tasks need a valid start date."))}}),i.point("io.ox/tasks/model/validation").extend({id:"recurrence-needs-end-date",validate:function(t){!t.recurrence_type||void 0!==t.end_time&&null!==t.end_time||this.add("end_time",d("Recurring tasks need a valid due date."))}}),i.point("io.ox/tasks/model/validation").extend({id:"upload-quota",validate:function(t){t.quotaExceeded&&this.add("quota_exceeded",d("Files can not be uploaded, because upload limit of %1$s is exceeded.",n.fileSize(t.quotaExceeded.attachmentMaxUploadSize,2)))}}),{defaults:r,factory:l,task:l.model,tasks:l.collection}});