define("io.ox/realtime/events",["io.ox/realtime/rt","io.ox/realtime/tab_id","io.ox/core/http"],function(e,n,o){"use strict";var t={backend:{on:function(t,c){return o.GET({module:"events",params:{action:"on",event:t,selector:c,resource:n,protocol:e.protocol}})},off:function(t){return o.GET({module:"events",params:{action:"off",event:t,resource:n,protocol:e.protocol}})},all:function(){return o.GET({module:"events",params:{action:"all",resource:n,protocol:e.protocol}})},events:function(){return t.backend.cachedEvents?t.backend.cachedEvents:(t.backend.cachedEvents=o.GET({module:"events",params:{action:"events"}}),t.backend.cachedEvents)}}},c={},a={},r=0,s={on:function(n,o){t.backend.events().done(function(s){if(_(s).contains(n))if(c[n])c[n].callbacks.push(o);else{var l="events"+r++;e.on("receive:"+l,function(e,n){var o=n.get("event","data").data,t=n.get("event","name").data;_(c[t].callbacks).each(function(e){e(o,t)})}),t.backend.on(n,l),c[n]={selector:l,callbacks:[o]},a[l]=n}else console.warn("Backend doesn't support event "+n)})},off:function(e,n){if(c[e]){var o=c[e];o.callbacks=_(o.callbacks).without(n),_.isEmptry(o.callbacks)&&(delete c[e],delete a[o.selector],t.backend.off(e))}},once:function(e,n){function o(){n.apply($.makeArray(arguments)),s.off(e,o)}s.on(e,o)}};return e.on("reset",function(){_(c).chain().keys().each(function(e){var n=c[e];t.backend.on(e,n.selector)})}),s.protectedMethods=t,s});