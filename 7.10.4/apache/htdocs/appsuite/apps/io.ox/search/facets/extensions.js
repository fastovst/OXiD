define("io.ox/search/facets/extensions",["io.ox/core/extensions","io.ox/search/util","gettext!io.ox/core"],function(e,t,a){function o(e,t){require(["io.ox/core/folder/picker","io.ox/core/folder/api"],function(a,o){var n=e.values.custom.custom,d=t.model.getModule(),r="files"===d?"infostore":d;a({async:!0,folder:n||o.getDefaultFolder(r),module:r,flat:o.isFlat(r),root:"files"===d?"9":"1",done:function(a,d){o.get(a).always(function(o){var r=(o||{}).title||a;t.model.update(e.id,n,{custom:a,name:r}),d.close()})},disable:function(e){return!o.can("read",e)}})})}var n={current:1,default:2,standard:3};return{facets:function(t){var a=this;t.model.ensure().then(function(){var o=t.model.get("poollist"),n=t.model.get("pool");a.append(_(o).map(function(o){var d,r=n[o.facet];d=r.values[o.value];var i=e.point("io.ox/search/facets/item/"+d.facet);i.list().length>0&&i.invoke("draw",a,t,d,r)}).reverse())})},optionsHandler:function(t){$("body").on("click tap",".facet-dropdown .option",function(a){a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault(),$("#io-ox-core").removeClass("menu-blur"),$(this).closest(".custom-dropdown").toggle(),ox.idle(),$(a.target).closest(".dropdown.open").toggle();var n=$(a.target).closest("a"),d=n.closest("ul"),r=n.attr("data-action")||n.attr("data-custom")||n.attr("data-option"),i=d.attr("data-facet"),l=d.attr("data-value");"dialog"===r?o(i=t.model.get("pool").folder,t):n.attr("data-point")?e.point("io.ox/search/facets/custom/"+n.attr("data-point")).invoke("draw",this,t,i,l,{option:n.attr("data-point")}):("folder"===i?t.model.update(i,l,{name:n.attr("title"),custom:r}):l?t.model.update(i,l,{option:r}):t.model.add(i,r,r),t.model.trigger("query",t.model.getApp(),"select option"))})},folderFacet:function(e,o){var d,r,i,l=this,s=$('<div class="col-xs-6 dropdown">'),c=o.custom,p=$('<ul class="dropdown dropdown-menu facet-dropdown" data-facet="folder" data-value="custom">');s.appendTo(l),s.append(d=$('<a href="#" type="button" class="dropdown-toggle pull-right disabled" data-toggle="dropdown" role="menuitemcheckbox" aria-haspopup="true" aria-expanded="false">').append($('<span class="name">').text(o.name||a("All folders")),$('<span class="caret">'))),e.model.isMandatory("folder")||e.model.isMandatory("account")||(p.prepend($('<li role="presentation">').append(i=$('<a href="#" class="option more" role="menuitemcheckbox" tabindex="-1" data-custom="custom">').append($('<i class="fa fa-fw" aria-hidden="true">'),$("<span>").text(a("All folders"))).attr("title",a("All folders")))),o.custom&&"custom"!==o.custom||(s.find(".name").text(a("All folders")),i.find("i").addClass("fa-check"),i.attr("aria-checked",!0))),t.getFolders(e.model).then(function(e){_.each(e,function(t,a){"0"!==a&&(t.list=t.list.slice(0,2)),t.list.sort(function(e,t){return n[e.type]-n[t.type]}),Object.keys(e).length>1&&p.append($('<li class="dropdown-header" role="presentation">').append(t.name)),_.each(t.list,function(e){/^virtual/.test(e.id)||(p.append(r=$('<li role="presentation">').append($('<a href="#" role="menuitemcheckbox" class="option" tabindex="-1">').attr({"data-custom":e.id,title:e.title}).append($('<i class="fa fa-fw fa-none" aria-hidden="true">'),$("<span>").text(e.title)))),c===e.id&&(r.find("a").attr("aria-checked",!0),r.find(".fa").removeClass("fa-none").addClass("fa-check")))}),p.append($('<li class="divider" role="separator">'))}),p.append($('<li role="presentation">').append($('<a href="#" class="option more" role="menuitemcheckbox" tabindex="-1" data-action="dialog">').append($('<i class="fa fa-fw fa-none" aria-hidden="true">'),$("<span>").text(a("More")+" ..."))))}).then(function(){s.append(p),d.removeClass("disabled")})}}});