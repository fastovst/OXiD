define("io.ox/search/main",["gettext!io.ox/search","settings!io.ox/core","io.ox/core/extensions","io.ox/search/model","io.ox/search/view","io.ox/search/apiproxy","less!io.ox/search/style"],function(e,i,o,t,n,a){"use strict";function r(e,i,t){var n=t.attr("data-id"),a=s.get("items").get(n),r={};r.data=a.get("data"),_.defer(function(){o.point("io.ox/search/items/"+s.getModule()).invoke("draw",e,r)})}o.point("io.ox/search/main").extend({index:100,id:"default",config:function(e){e.defaultApp=i.get("search/default","io.ox/mail")}}),o.point("io.ox/search/main").extend({index:300,id:"mandatory",config:function(e){e.mandatory=e.mandatory||i.get("search/mandatory",{})}}),o.point("io.ox/search/main").extend({index:400,id:"mapping",config:function(e){e.mapping={"io.ox/mail/compose":"io.ox/mail","com.voiceworks/ox-messenger":e.defaultApp,"io.ox/drive":"io.ox/files","io.ox/office/text":"io.ox/files","io.ox/office/portal":"io.ox/files","io.ox/office/spreadsheet":"io.ox/files","io.ox/office/presentation":"io.ox/files","io.ox/office/portal/text":"io.ox/files","io.ox/office/portal/spreadsheet":"io.ox/files","io.ox/office/portal/presentation":"io.ox/files","io.ox/portal":e.defaultApp,"io.ox/search":e.defaultApp,"io.ox/settings":e.defaultApp}}}),o.point("io.ox/search/main").extend({index:400,id:"folderfacet",config:function(i){i.sticky=i.sticky||[],i.sticky.push({id:"folder",name:e("Folder"),style:"custom",custom:!0,hidden:!0,flags:["conflicts:folder_type"],values:[{facet:"folder",id:"custom",custom:"",filter:{}}]})}});var s,c,p=ox.ui.createWindow({name:"io.ox/search",title:"Search",toolbar:!0,chromeless:!0,search:!1,facetedsearch:!1}),d=ox.ui.createApp({name:"io.ox/search",title:"Search",closable:!0,window:p});return p.on("show",function(){$("#io-ox-search-topbar").addClass("hidden").find(".search-field.widget").val("")}),p.on("hide",function(){$("#io-ox-search-topbar").removeClass("hidden")}),p.on("show",function(){ox.ui.apps.get(d)||ox.ui.apps.add(d)}),d.busy=function(){d.view.busy()},d.idle=function(){d.view.idle()},d.is=function(e){return d.get("state")===e},d.getModel=function(){return s},d.quit=function(){!d.getWindow()||!d.getWindow().state.visible||_.url.hash("app")&&d.getName()!==_.url.hash("app").split(":",1)[0]||_.url.hash({app:null,folder:null,perspective:null,id:null}),d.folder.destroy(),d.has("window")&&(p.trigger("quit"),ox.ui.windowManager.trigger("window.quit",p)),ox.ui.apps.remove(d),d.trigger("quit"),s.reset({silent:!0})},d.setLauncher(function(i){var o=$.extend({},i||{}),t=ox.ui.App.getCurrentApp();p.nodes.main.addClass("container io-ox-search f6-target empty").attr({tabindex:"0","aria-label":e("Search")}),d.setWindow(p),d.view=n.factory.create(d,s,p.nodes.main),d.view.on({"query:start":function(){d.view.repaint("apps"),d.busy()},"query:stop":function(){d.view.repaint("info"),d.idle()},"query:result":function(){d.view.repaint("items"),d.idle()},"button:app":function(){d.view.repaint("apps"),d.idle()}}),s.on({query:function(){d.apiproxy.query()},"change:start":function(){d.apiproxy.query()},"change:size":function(){d.apiproxy.query()},reset:function(){d.view.repaint("info items apps")}}),s.get("items").on({"needs-redraw":function(){this.render(d.view.getBaton())}}),s.set({query:o.query,app:t?t.get("name"):s.defaults.options.defaultApp}),d.setTitle(e("Search")),p.show(function(){require(["io.ox/core/tk/dialogs"],function(e){new e.SidePopup({tabTrap:!0}).delegate(d.view.$el,".item",r)})}),d.view.redraw().focus()}),s=t.factory.create(),d.apiproxy=a.init(d),o.point("io.ox/search").invoke("config",s,d),c=function(){var e;return d.is("ready")?d.launch():(s.reset({silent:!0}),"io.ox/search"!==(e=ox.ui.App.getCurrentApp().get("name"))&&s.set("app",e,{silent:!0}),d.set("state","running"),d.launch(),d.view.redraw({closeSidepanel:!0})),d.view.focus(),d.idle(),d},{getApp:d.getInstance,run:c,getView:function(){return d.view=n.factory.create(d,s)},model:s,apiproxy:d.apiproxy}});