define("io.ox/search/items/view-template",["gettext!io.ox/core","io.ox/core/extensions"],function(e,i){"use strict";function t(e,i,t,a){var o=this.busy();require([i,t],function(i,t){o.idle().append(i.draw(e.data,a)),t.get(t.reduce(e.data)).then(function(t){t=t.toJSON?t.toJSON():t,_.isEqual(e.data,t)||o.empty().append(i.draw(t,a))})})}var a={dependencies:{},points:{},classes:{}};i.point("io.ox/search/main/items").extend({id:"dependencies",config:function(e){var i={mail:["io.ox/mail/listview","io.ox/mail/api"],tasks:["io.ox/tasks/listview","io.ox/tasks/api"],contacts:["io.ox/contacts/listview","io.ox/contacts/api"],calendar:["io.ox/calendar/listview","io.ox/calendar/api"],files:["io.ox/files/listview","io.ox/files/api"]};$.extend(e.dependencies,i)}}),i.point("io.ox/search/main/items").extend({id:"points",config:function(e){var i={mail:"io.ox/mail/listview/item/default",tasks:"io.ox/tasks/listview/item",contacts:"io.ox/contacts/listview/item",calendar:"io.ox/calendar/listview/item",files:"io.ox/files/listview/item"};$.extend(e.points,i)}}),i.point("io.ox/search/main/items").extend({id:"classes",config:function(e){var i={mail:"list-item-content",tasks:"task-item",contacts:"contact-item",calendar:"calendar-item",files:"file-item"};$.extend(e.classes,i)}}),i.point("io.ox/search/main/items").invoke("config",$,a);var o=_.debounce(function(e){"io.ox/search"===ox.ui.App.getCurrentApp().get("name")&&(e&&e.data&&e.data.trigger?e.data.trigger("needs-refresh"):this.trigger("needs-refresh")),e&&e.type&&(e.type.indexOf("delete")>=0||e.type.indexOf("move")>=0)&&$(".io-ox-sidepopup","#io-ox-windowmanager-pane>.io-ox-search-window").detach()},100);i.point("io.ox/search/view/items").extend({id:"results",index:100,row:"0",draw:function(t){var n,s,d=this,l=t.model.get("items"),c=t.model.getModule(),r="refresh refresh.all refresh.list deleted-mails update delete change move",p=[];n=$('<div class="row result">').append(s=$('<ul class="col-xs-12 list-unstyled">'));var x=[].concat(a.dependencies[c]).concat("less!io.ox/search/items/style");require(x,function(n,d){var x=l.length>t.model.get("size")?l.length-t.model.get("extra"):l.length;d&&d._events?(d.off(r,o),d.on(r,o,l)):d&&d.events&&(d.off(r,o),d.on(r,l,o)),l.each(function(e,t){if(x!==t){var o=$('<li class="item">'),n=e.get("data"),l=new i.Baton({data:n});d.pool&&d.pool.Model&&(l.model=new d.pool.Model(n)),o.attr({"data-id":e.get("id"),"data-folder":e.get("folder"),"data-app":e.get("application")}),"mail"===c&&s.addClass("mail-item"),o.addClass(a.classes[c]||""),i.point(a.points[c]).invoke("draw",o,l),p.push(o)}}),l.timestamp&&!l.length&&p.push($('<list class="item">').append($('<div class="list-item-row">').append($('<div class="">').text(e("No items found"))))),s.append(p)});var m=d.find(".row.result");m.length?m.replaceWith(n):d.append(n),d.append(n)}}),i.point("io.ox/search/view/items").extend({id:"sidepanel",index:200,row:"0",draw:function(){i.point("io.ox/search/items/calendar").extend({draw:function(e){t.call(this,e,"io.ox/calendar/view-detail","io.ox/calendar/api",{deeplink:!0})}}),i.point("io.ox/search/items/contacts").extend({draw:function(e){t.call(this,e,"io.ox/contacts/view-detail","io.ox/contacts/api")}}),i.point("io.ox/search/items/tasks").extend({draw:function(e){t.call(this,e,"io.ox/tasks/view-detail","io.ox/tasks/api")}}),i.point("io.ox/search/items/files").extend({draw:function(e){$(".io-ox-sidepopup","#io-ox-windowmanager-pane>.io-ox-search-window").detach(),require(["io.ox/core/viewer/main"],function(i){(new i).launch({files:[].concat(e.data)})})}}),i.point("io.ox/search/items/mail").extend({draw:function(e){var i=this.busy();require(["io.ox/mail/detail/view","io.ox/mail/api"],function(t,a){var o=new t.View({data:e.data});i.idle().append(o.render().expand().$el.addClass("no-padding")),a.get(a.reduce(e.data)).then(function(a){if(!_.isEqual(e.data,a)){var o=new t.View({data:a},{deeplink:!0});i.idle().empty().append(o.render().expand().$el.addClass("no-padding"))}})})}})}})});