define("io.ox/calendar/week/print",["io.ox/calendar/api","io.ox/calendar/util","io.ox/core/print","settings!io.ox/calendar","io.ox/core/folder/api","gettext!io.ox/calendar"],function(e,t,n,a,o,r){"use strict";function m(e,n){return function(a){var o=t.getMomentInLocalTimezone(a.get("startDate")).valueOf();return!(t.getMomentInLocalTimezone(a.get("endDate")).valueOf()<=e)&&!(o>=n)}}function i(e){return t.isAllday(e)?-1:t.getMomentInLocalTimezone(e.get("startDate")).valueOf()}function u(e,n){var a=_(n).filter(function(n){var a=t.getMomentInLocalTimezone(e.get("startDate")).valueOf(),o=moment.max(moment(a).add(30,"minutes"),t.getMomentInLocalTimezone(e.get("endDate"))).valueOf(),r=t.getMomentInLocalTimezone(n.get("startDate")).valueOf(),m=moment.max(moment(r).add(30,"minutes"),t.getMomentInLocalTimezone(n.get("endDate"))).valueOf();return!t.isAllday(e)&&(!t.isAllday(n)&&(!(o<=r)&&!(a>=m)))});return{size:a.length,index:a.indexOf(e)}}function l(e,n,a){return function(r,m,i){var l=[],d=t.isAllday(r),s=u(r,i),c=moment.max(t.getMomentInLocalTimezone(r.get("startDate")),e),f=moment.max(c.clone().add(30,"minutes"),t.getMomentInLocalTimezone(r.get("endDate"))),g=Math.max(c.hour(),n),h=Math.max(c.hour()+1,c.hour()+f.diff(c,"hours")+1);return d&&(h=c.hour()+1),h>a&&(h=a),_.range(g,h).forEach(function(e){var n=c.minutes()+60*(g-e),a=o.pool.models[r.get("folder")],m=t.getAppointmentColor(a.attributes,r)||"#e8e8e8";l.push({isAllday:d,hour:d?"allDay":e,left:100*s.index/s.size,width:100/s.size,top:n,height:Math.min(60*(h-g),Math.max(15,f.diff(c,"minutes")-60*(g-c.hour()))),time:c.format("LT"),title:r.get("summary"),color:t.getForegroundColor(m),backgroundColor:m})}),l}}function d(e){return e.hour}function s(e){var n=t.getDateTimeIntervalMarkup(e,{output:"strings",zone:moment().tz()});return n.dateStr+" "+n.timeStr}return{open:function(o,u){n.smart({selection:[o.folders],get:function(){var n=e.getCollection({start:o.start,end:o.end,folders:o.folders,view:"week"});return n.sync().then(function(){var e=moment(o.start),r=moment(o.end),u=[],c=1e7,f=-1e7;for(n.forEach(function(e){c=Math.min(Math.min(c,t.getMomentInLocalTimezone(e.get("startDate")).hour()),t.getMomentInLocalTimezone(e.get("endDate")).hour()),f=Math.max(Math.max(f,t.getMomentInLocalTimezone(e.get("startDate")).hour()),t.getMomentInLocalTimezone(e.get("endDate")).hour())}),c=Math.max(0,Math.min(parseInt(a.get("startHour",8),10),c-1)),f=Math.min(24,Math.max(parseInt(a.get("endHour",18),10),f+2));r.diff(e)>0;e.add(1,"day")){var g=e.valueOf(),h=e.clone().add(1,"day").valueOf();u.push({start:c,end:f,date:e.date(),list:_(n.toJSON()).map(function(e){return{summary:e.summary,location:e.location,date:s(e)}}),slots:n.chain().filter(m(g,h)).sortBy(i).map(l(e,c,f)).flatten().groupBy(d).value()})}return u})},meta:{title:o.title+": "+moment(o.start).formatInterval(moment(o.end).subtract(1,"day"),"date"),timeLabels:_.range(24).map(function(e){return{value:e,label:moment().startOf("hour").hour(e).format("LT")}}),weekdays:_.range(0,o.numberOfColumns||7).map(function(e){return moment(o.start).startOf("day").add(e,"days").format("dddd")}),eventListLabel:r("Appointments")},selector:".calendar-week-view",window:u})}}});