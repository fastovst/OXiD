define("io.ox/calendar/actions/change-organizer",["io.ox/calendar/api","io.ox/backbone/views/modal","io.ox/calendar/util","gettext!io.ox/calendar","io.ox/backbone/mini-views/common","io.ox/core/tk/typeahead","io.ox/participants/model","io.ox/participants/chronos-views","io.ox/core/yell","less!io.ox/calendar/style","io.ox/participants/add"],function(e,t,n,i,a,o,r,l,d){"use strict";return{openDialog:function(c){c&&n.showRecurrenceDialog(c,{dontAllowExceptions:!0}).done(function(s){"cancel"!==s&&new t({title:i("Change organizer")}).build(function(){this.model=new Backbone.Model({newOrganizer:new Backbone.Model(_(c.attendees).findWhere({entity:c.organizer.entity})),comment:""});var e=this,t=n.getDateTimeIntervalMarkup(c,{output:"strings",zone:moment().tz()}),d=n.getRecurrenceString(c),s=_.uniqueId("alarms-dialog-description-"),u=_.uniqueId("label-"),m=new l.ParticipantEntryView({tagName:"div",model:this.model.get("newOrganizer"),halo:!1,closeButton:!1,asHtml:!0}),g=new o({apiOptions:{contacts:!1,users:!0,groups:!1,distributionlists:!1,resources:!1},extPoint:"io.ox/participants/add",harmonize:function(e){return e=_(e).map(function(e){return new r.Participant(e)}),_(e).filter(function(e){return"email1"===e.get("field")})},click:function(t,i,a){e.model.set("newOrganizer",new Backbone.Model(n.createAttendee(i))),a&&g.$el.typeahead("val",""),m.model=e.model.get("newOrganizer"),m.$el.empty(),m.render()}});this.$body.addClass("change-organizer-dialog").append($("<p>").attr("id",s).append($("<b>").text(c.summary),$.txt(", "),$.txt(t.dateStr),$.txt(""!==d?" â€“ "+d:""),$.txt(" "),$.txt(t.timeStr)),$("<label>").text(i("New organizer")).attr({for:u=_.uniqueId("label-")}),m.render().$el.attr({id:u}),$("<label>").text(i("Select new organizer")).attr({for:u=_.uniqueId("label-")}),g.$el.attr({id:u}),$("<label>").text(i("Add a message to the notification email for the other participants.")).attr({for:u=_.uniqueId("label-")}),new a.InputView({name:"comment",model:this.model,placeholder:i("Password"),autocomplete:!1}).render().$el.attr("id",u)),g.render()}).addAlternativeButton({action:"cancel",label:i("Cancel")}).addButton({action:"ok",label:i("Ok"),className:"btn-primary"}).on("ok",function(){var t={id:c.seriesId||c.id,folder:c.folder,organizer:this.model.get("newOrganizer").pick(["cn","email","entity","uri"])};t.organizer.entity!==c.organizer.entity&&("thisandfuture"===s&&(t.recurrenceId=c.recurrenceId),e.changeOrganizer(t,_.extend(n.getCurrentRangeOptions(),{comment:this.model.get("comment"),recurrenceRange:"thisandfuture"===s?"THISANDFUTURE":void 0})).then(function(){d("success",i("Organizer changed"))},d),this.model=null)}).open()})}}});