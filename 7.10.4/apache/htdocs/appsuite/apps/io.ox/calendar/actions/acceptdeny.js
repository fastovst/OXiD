define("io.ox/calendar/actions/acceptdeny",["io.ox/calendar/api","io.ox/backbone/views/modal","io.ox/core/folder/api","io.ox/calendar/util","io.ox/core/notifications","settings!io.ox/calendar","gettext!io.ox/calendar","less!io.ox/calendar/style"],function(e,t,n,a,o,i,r){"use strict";return function(i,c){function d(d){var s,l,u,f,m=$.Deferred(),p=c.api||e,h=$(),g=_.uniqueId("dialog"),x={folder:i.folder||i.folder_id,id:i.id};return c.taskmode||d||!i.recurrenceId||(x.recurrenceId=i.recurrenceId),!c.taskmode&&d&&x.id!==i.seriesId&&(x.id=i.seriesId),(c.noFolderCheck?$.when():n.get(x.folder)).always(function(e){e&&e.error&&(i.noFolderCheck=!0),p.get(x).then(function(m){l=c.taskmode?m:m.toJSON(),_.isArray(m)&&2===m.length&&_.isNumber(m[1])&&(l=m[0]),u=e;var x=!i.noFolderCheck&&n.is("shared",u)?u.created_by:ox.user_id;return s=a.getConfirmationMessage(i,x),new t({async:!0,help:"ox.appsuite.user.sect.calendar.manage.changestatus.html",focus:_.device("smartphone")?"":'[data-property="comment"]',title:r("Change confirmation status")}).build(function(){!d&&i.recurrenceId&&(l=p.removeRecurrenceInformation(l));var e=a.getRecurrenceString(l),t=$("<b>").text(l.title),n=_.uniqueId("confirmation-dialog-description-");if(!c.taskmode){var o=a.getDateTimeIntervalMarkup(l,{output:"strings",zone:moment().tz()});t=[$("<b>").text(l.summary),$.txt(", "),$.txt(o.dateStr),$.txt(""!==e?" â€“ "+e:""),$.txt(" "),$.txt(o.timeStr)]}this.$el.attr("aria-describedby",n),this.$body.append(x!==ox.user_id?$('<div class="alert alert-info">').text(r("You are currently acting on behalf of the calendar owner.")):"",$("<p>").text(r("You are about to change your confirmation status. Please leave a comment for other participants.")),$("<p>").attr("id",n).append(t),$('<div class="form-group">').css({"margin-top":"20px"}).append($('<label class="control-label">').attr("for",g).text(r("Comment")).append($('<span class="sr-only">').text((m.summary||m.title)+" "+r("Please comment your confirmation status."))),$('<input type="text" class="form-control" data-property="comment">').attr("id",g).val(s),h))}).addAlternativeButton({action:"cancel",label:r("Cancel")}).addButton({action:"declined",label:r("Decline"),className:"btn-danger"}).addButton({action:"tentative",label:r("Tentative"),className:"btn-warning"}).addButton({action:"accepted",label:r("Accept"),className:"btn-success"}).on("action",function(e){function t(e){p.confirm(n,_.extend({checkConflicts:e},a.getCurrentRangeOptions())).done(function(e){e&&e.conflicts?ox.load(["io.ox/calendar/conflicts/conflictList"]).done(function(n){n.dialog(e.conflicts).on("cancel",function(){r.idle()}).on("ignore",function(){t(!1)})}):(r.close(),c.callback&&c.callback())}).fail(function(e){r.idle(),o.yell(e)})}if("cancel"!==e){var n,r=this,s=$.trim(this.$body.find('[data-property="comment"]').val());if(c.taskmode)n={id:l.id,folder_id:l.folder_id,data:{confirmmessage:s,id:ox.user_id,confirmation:_(["","accepted","declined","tentative"]).indexOf(e)}},f=!1;else{var u=_(l.attendees).findWhere({entity:x});n={attendee:u,id:l.id,folder:l.folder},u&&"NEEDS-ACTION"!==u.partStat||(n.alarms=a.getDefaultAlarms(l)),n.attendee.partStat=e.toUpperCase(),s?n.attendee.comment=s:n.attendee.comment&&(n.attendee.comment=null),!d&&i.recurrenceId&&(n.recurrenceId=i.recurrenceId),f="declined"!==e&&"OPAQUE"===l.transp&&(!u||n.attendee.partStat!==u.partStat)}t(f)}}).open()})}),m}return!(c=c||{}).taskmode&&i.recurrenceId&&i.seriesId?new t({title:r("Change appointment status"),width:600}).build(function(){this.$body.append(r("This appointment is part of a series. Do you want to change your confirmation for the whole series or just for this appointment within the series?"))}).addCancelButton({left:!0}).addButton({className:"btn-default",label:r("Change appointment"),action:"appointment"}).addButton({action:"series",label:r("Change series")}).on("series",function(){_.defer(d,!0)}).on("appointment",function(){_.defer(d,!1)}).open():d()}});