define("io.ox/calendar/print",["io.ox/core/print","io.ox/calendar/api","io.ox/calendar/util","io.ox/contacts/util","io.ox/core/api/user","io.ox/core/api/group","io.ox/core/api/resource","io.ox/core/util","gettext!io.ox/calendar"],function(e,t,n,i,c,a,r,o,u){"use strict";function d(e,t){return _(e).each(function(e){var n=t[e.id]||{};e.status=n.status||0,e.comment=n.comment||"",e.display_name=i.getFullName(e)}),e}function s(e,t){return _(e).each(function(e){var n=t[e.mail]||{};e.status=n&&n.status||0,e.comment=n&&n.comment||"",e.display_name=e.display_name?e.display_name+" <"+e.mail+">":e.mail}),e}function l(e){return _(e).each(function(e){e.status=1,e.comment=""}),e}function m(e,t){var n={unconfirmed:[],accepted:[],declined:[],tentative:[]},i={"NEEDS-ACTION":"unconfirmed",ACCEPTED:"accepted",DECLINED:"declined",TENTATIVE:"tentative"};return _([].concat(e||[],t||[])).each(function(e){var t=i[e.partStat]||"unconfirmed";n[t].push(e)}),_(n).each(function(e,t){n[t]=_(e).sortBy("cn")}),n}function p(e,t,n){var i={unconfirmed:[],accepted:[],declined:[],tentative:[]},c={0:"unconfirmed",1:"accepted",2:"declined",3:"tentative"};return _([].concat(e||[],t||[],n||[])).each(function(e){var t=c[e.status]||"unconfirmed";i[t].push(e)}),_(i).each(function(e,t){i[t]=_(e).sortBy("display_name")}),i}function f(e){return _(e).map(function(e){return'<span class="person">'+_.escape(e.display_name||e.cn)+"</span>"+(e.comment?' <i class="comment">&quot;'+_.escape(e.comment)+"&quot;</i>":"")}).join("  •  ")}function h(e){return o.breakableText($.trim(e.description))}function v(e,t,i,a,r){if(e.startDate||e.endDate||e.attendees){var o=_(e.attendees).where({cuType:"INDIVIDUAL"}).concat(_(e.attendees).where({cuType:void 0})),u=_(e.attendees).where({cuType:"RESOURCE"}),h=m(o,u),v=_(h).reduce(function(e,t){return e+t.length},0);return{internal:o,resources:u,unconfirmed:h.unconfirmed,accepted:h.accepted,declined:h.declined,tentative:h.tentative,strings:{unconfirmed:f(h.unconfirmed),accepted:f(h.accepted),declined:f(h.declined),tentative:f(h.tentative)},numParticipants:v,hasUnconfirmed:h.unconfirmed.length>0,hasAccepted:h.accepted.length>0,hasDeclined:h.declined.length>0,hasTentative:h.tentative.length>0}}var g=_.chain(i).pluck("members").flatten().uniq().value();return c.getList(g).then(function(i){var c=n.getConfirmations(e),o=d([].concat(t||[],i||[]),c),u=s(r,c),m=l(a),h=p(o,u,m),v=_(h).reduce(function(e,t){return e+t.length},0);return{internal:o,external:u,resources:m,unconfirmed:h.unconfirmed,accepted:h.accepted,declined:h.declined,tentative:h.tentative,strings:{unconfirmed:f(h.unconfirmed),accepted:f(h.accepted),declined:f(h.declined),tentative:f(h.tentative)},numParticipants:v,hasUnconfirmed:h.unconfirmed.length>0,hasAccepted:h.accepted.length>0,hasDeclined:h.declined.length>0,hasTentative:h.tentative.length>0}})}function g(e){var t=n.getRecurrenceString(e);return n.getDateTimeIntervalMarkup(e,{output:"strings",zone:moment().tz()}).dateStr+(""!==t?" – "+t:"")}function y(e){return n.getDateTimeIntervalMarkup(e,{output:"strings",zone:moment().tz()}).timeStr}function x(e){return e=e.get?e.attributes:e,_.extend(v(e),{original:e,subject:e.summary,location:$.trim(e.location),content:h(e),date:g(e),time:y(e)})}return{load:function(e){var t=e.participants,n=_.chain(t).filter(function(e){return 1===e.type}).map(function(e){return e.id}).value(),i=_.chain(t).filter(function(e){return 2===e.type}).map(function(e){return{id:e.id}}).value(),o=_.chain(t).filter(function(e){return 3===e.type}).map(function(e){return{id:e.id}}).value(),u=_.chain(t).filter(function(e){return 5===e.type}).sortBy(function(e){return e.mail}).value(),d=n.length?c.getList(n):$.Deferred().resolve([]);return $.when(d,a.getList(i),r.getList(o)).then(function(t,n,i){return v(e,t,n,i,u)})},open:function(n,i){e.smart({get:function(e){return t.get(e)},title:1===n.length?n[0].title:void 0,i18n:{accepted:u("Accepted"),declined:u("Declined"),tentative:u("Tentatively accepted"),unconfirmed:u("Unconfirmed")},process:x,selection:n,selector:".appointment",window:i})}}});