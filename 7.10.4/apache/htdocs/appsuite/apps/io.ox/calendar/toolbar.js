define("io.ox/calendar/toolbar",["io.ox/core/extensions","io.ox/backbone/views/actions/util","io.ox/backbone/mini-views/dropdown","io.ox/backbone/views/toolbar","io.ox/core/tk/upload","io.ox/core/dropzone","io.ox/core/notifications","io.ox/core/capabilities","io.ox/calendar/api","io.ox/calendar/util","gettext!io.ox/calendar","io.ox/calendar/actions","less!io.ox/calendar/style"],function(e,o,t,i,a,n,l,r,d,p,s){"use strict";function c(){var e=this.$el.find('[data-name="checkboxes"]').parent(),o=this.model.get("layout");e.toggle("list"===o)}function u(){var e=this.$el.find('[data-name="darkColors"]').parent(),o=this.model.get("layout");e.toggle("list"!==o)}function g(e){e.app.perspective&&"list"!==e.app.perspective.getName()||this.$el.find('[data-name="print"]').toggleClass("disabled",e.data&&_.isEmpty(e.data))}function b(t,i){if(i.preventDefault(),t.app.perspective&&"list"===t.app.perspective.getName()){if(!t.data||_.isEmpty(t.data))return;o.invoke("io.ox/calendar/detail/actions/print-appointment",t)}else o.invoke("io.ox/calendar/detail/actions/print",e.Baton({app:t.app,window:t.app.getWindow()}))}function f(e){return e.perspective&&"list"===e.perspective.getName()?e.listView.selection.get():[]}if(!_.device("smartphone")){var h=e.point("io.ox/calendar/toolbar/links"),x={create:{prio:"hi",mobile:"hi",title:s("New appointment"),drawDisabled:!0,ref:"io.ox/calendar/detail/actions/create"},schedule:{prio:"hi",mobile:"hi",title:s.pgettext("app","Scheduling"),tooltip:s("Find a free time"),ref:"io.ox/calendar/actions/freebusy"},today:{prio:"hi",mobile:"hi",title:s("Today"),ref:"io.ox/calendar/actions/today"},edit:{prio:"hi",mobile:"hi",title:s("Edit"),tooltip:s("Edit appointment"),ref:"io.ox/calendar/detail/actions/edit"},changestatus:{prio:"hi",mobile:"lo",title:s("Change status"),tooltip:s("Change status"),ref:"io.ox/calendar/detail/actions/changestatus"},delete:{prio:"hi",mobile:"hi",title:s("Delete"),tooltip:s("Delete appointment"),ref:"io.ox/calendar/detail/actions/delete"},export:{prio:"lo",mobile:"lo",title:s("Export"),drawDisabled:!0,ref:"io.ox/calendar/detail/actions/export"},print:{prio:"lo",mobile:"lo",title:s("Print"),drawDisabled:!0,ref:"io.ox/calendar/detail/actions/print-appointment"},move:{prio:"lo",mobile:"lo",title:s("Move"),ref:"io.ox/calendar/detail/actions/move",drawDisabled:!0,section:"file-op"}},m=0;_(x).each(function(e,o){e.id=o,e.index=m+=100,h.extend(e)}),e.point("io.ox/calendar/toolbar/links").extend({id:"view-dropdown",index:1e4,custom:!0,draw:function(e){var o=new t({el:this,caret:!0,model:e.app.props,label:s("View")}).group(s("Layout")).option("layout","week:day",s("Day"),{radio:!0,group:!0});_.device("!smartphone")&&o.option("layout","week:workweek",s("Workweek"),{radio:!0,group:!0}),o.option("layout","week:week",s("Week"),{radio:!0,group:!0}).option("layout","month",s("Month"),{radio:!0,group:!0}).option("layout","year",s("Year"),{radio:!0,group:!0}).option("layout","list",s("List"),{radio:!0,group:!0}).divider().group(s("Options")).option("folderview",!0,s("Folder view"),{group:!0}).option("showMiniCalendar",!0,s("Mini calendar"),{group:!0}),"month"===e.app.props.get("layout")&&o.option("showMonthviewWeekend",!0,s("Weekends"),{group:!0}),o.option("checkboxes",!0,s("Checkboxes"),{group:!0}).listenTo(e.app.props,"change:layout",c).listenTo(e.app.props,"change:layout",u),r.has("calendar-printing")&&"year"!==e.app.props.get("layout")&&o.divider().link("print",s("Print"),b.bind(null,e)),o.render().$el.addClass("dropdown pull-right").attr("data-dropdown","view"),setTimeout(function(){g.call(o,e),c.call(o),u.call(o)},0)}}),e.point("io.ox/calendar/mediator").extend({id:"toolbar",index:1e4,setup:function(e){var o=new i({point:"io.ox/calendar/toolbar/links",title:e.getTitle()});e.getWindow().nodes.body.addClass("classic-toolbar-visible").prepend(o.$el),e.updateToolbar=function(e){var t={data:[],models:[],folder_id:this.folder.get(),app:this},i=e.map(_.cid);o.setSelection(i,function(){return!i.length||i.length>100?t:d.getList(i).pipe(function(e){return t.models=e,t.data=_(e).invoke("toJSON"),t})})},e.forceUpdateToolbar=function(e){o.selection=null,this.updateToolbar(e)}}}),e.point("io.ox/calendar/mediator").extend({id:"update-toolbar",index:10200,setup:function(e){e.updateToolbar([]),e.listView.on("selection:change",function(){e.updateToolbar(f(e))}),e.on("folder:change",function(){e.updateToolbar(f(e))}),e.getWindow().on("change:perspective change:initialPerspective",function(){_.defer(function(){e.forceUpdateToolbar(f(e))})})}}),e.point("io.ox/calendar/mediator").extend({id:"bottom-toolbar",index:10300,setup:function(e){if(!_.device("smartphone")){var o=$('<div class="generic-toolbar calendar bottom visual-focus" role="region">').append($('<button type="button" class="btn btn-link toolbar-item" data-action="close-folder-view">').attr("aria-label",s("Open folder view")).append($('<i class="fa fa-angle-double-right" aria-hidden="true">').attr("title",s("Open folder view"))).on("click",{state:!0},e.toggleFolderView));e.getWindow().nodes.body.append(o);var t=function(){var t="list"===e.props.get("layout");e.getWindow().nodes.body.toggleClass("bottom-toolbar",!t),o.toggle(!t)};e.getWindow().nodes.body.append(o),e.props.on("change:layout",t),e.getWindow().on("change:perspective",t)}}})}});