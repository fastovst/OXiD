define("io.ox/calendar/conflicts/conflictList",["io.ox/core/extensions","io.ox/calendar/common-extensions","io.ox/calendar/api","io.ox/core/folder/api","io.ox/core/util","io.ox/calendar/util","io.ox/contacts/util","io.ox/backbone/views/modal","gettext!io.ox/calendar/conflicts/conflicts","settings!io.ox/calendar","less!io.ox/calendar/style"],function(t,e,n,i,a,o,d,l,c,s){"use strict";function r(e){e.preventDefault(),e.data.icon.toggleClass("fa-angle-right fa-angle-down"),e.data.content.toggle(!e.data.icon.hasClass("fa-angle-right"));var a=e.data.baton;if(!e.data.content.children().length)return a.data.event.folder?void n.get(a.data.event).done(function(n){var o=i.pool.getModel(a.data.event.folder);n.get("private_flag")&&(n.get("createdBy")||{}).entity!==ox.user_id&&!i.is("private",o)||(n.nohalo=!0,(a=t.Baton.ensure(n.attributes)).model=n,t.point("io.ox/calendar/conflicts/details").invoke("draw",e.data.content.empty(),a),e.data.content.show())}):(t.point("io.ox/calendar/conflicts/details").invoke("draw",e.data.content.empty(),t.Baton.ensure(a.data.event)),void e.data.content.show())}function f(t){return a.renderPersonalName({html:d.getFullName(t,!0)},t).html()}function p(e){return _(e).sortBy(function(t){return t.event.startDate}).map(function(e){var n=t.Baton.ensure(e),i=$('<div class="conflict-summary">'),a=$('<div class="conflict-details">').hide(),o=$('<i class="fa fa-angle-right" aria-hidden="true">'),d=$('<a href="#" role="button" class="detail-toggle">').attr("summary",c("Show appointment details")).append(o),l=$("<li>").append(d,i,a),f=(e.event.createdBy||{}).entity;return s.get("freeBusyStrict",!0)&&f!==ox.user_id&&_.isUndefined(e.event.summary)?(d.remove(),a.remove()):(i.addClass("pointer"),l.on("click",".conflict-summary, .detail-toggle",{icon:o,baton:n,content:a},r)),t.point("io.ox/calendar/conflicts").invoke("draw",i,n),l})}var x=0;return t.point("io.ox/calendar/conflicts").extend({index:x+=100,id:"subject",draw:e.h2}),t.point("io.ox/calendar/conflicts").extend({index:x+=100,id:"datetime",draw:e.datetime}),t.point("io.ox/calendar/conflicts").extend({index:x+=100,id:"conflicts",draw:function(t){if(t.data.conflicting_attendees){var e=$('<div class="conflicts">').text(c("Conflicts:")+" ");$.when.apply($,_(t.data.conflicting_attendees).map(f)).then(function(){e.append([].slice.call(arguments).join('<span class="delimiter"> • </span>'))}),this.append(e)}}}),x=0,t.point("io.ox/calendar/conflicts/details").extend({index:x+=100,id:"location",draw:e.locationDetail}),t.point("io.ox/calendar/conflicts/details").extend({index:x+=100,id:"note",draw:e.note}),t.point("io.ox/calendar/conflicts/details").extend({index:x+=100,id:"participants",draw:function(t){var e=$("<div>");require(["io.ox/participants/chronos-detail"],function(n){var i=new n(t,{summary:!1,inlineLinks:!1,halo:!1});e.append(i.draw())}),this.append(e)}}),t.point("io.ox/calendar/conflicts/details").extend({index:x+=100,id:"list",draw:function(e){var n=$('<table class="details-table">');t.point("io.ox/calendar/conflicts/details/list").invoke("draw",n,e),this.append(n)}}),x=0,t.point("io.ox/calendar/conflicts/details/list").extend({index:x+=100,id:"organizer",draw:function(t){t.organizerNode=$("<span>"),e.organizer.bind(this)(t)}}),t.point("io.ox/calendar/conflicts/details/list").extend({index:x+=100,id:"sentby",draw:function(t){t.sendbyNode=$("<span>"),e.sentBy.bind(this)(t)}}),t.point("io.ox/calendar/conflicts/details/list").extend({index:x+=100,id:"shownAs",draw:e.shownAs}),t.point("io.ox/calendar/conflicts/details/list").extend({index:x+=100,id:"folder",draw:e.folder}),t.point("io.ox/calendar/conflicts/details/list").extend({index:x+=100,id:"created",draw:e.created}),t.point("io.ox/calendar/conflicts/details/list").extend({index:x+=100,id:"modified",draw:e.modified}),{dialog:function(t){return new l({title:c("Conflicts detected"),width:640}).build(function(){var e=!!_.find(t,function(t){return!0===t.hard_conflict});this.$header.append($('<div class="modal-subtitle">').text(c("The new appointment conflicts with existing appointments."))),e&&this.$body.append($('<div class="alert alert-info hard-conflict">').text(c("Conflicts with resources cannot be ignored"))),this.$body.append($('<ul class="list-unstyled conflict-overview calendar-detail">').append(p(t))),this.addCancelButton(),e||this.addButton({action:"ignore",className:"btn-primary",label:c("Ignore conflicts"),placement:"right"})}).open()},drawHeader:function(){return $('<h4 class="text-error">').text(c("Conflicts detected")).add($('<div class="modal-subtitle">').text(c("The new appointment conflicts with existing appointments.")))}}});