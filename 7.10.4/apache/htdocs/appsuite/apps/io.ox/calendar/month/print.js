define("io.ox/calendar/month/print",["io.ox/calendar/api","io.ox/calendar/util","io.ox/core/print","io.ox/core/folder/api"],function(e,t,o,n){"use strict";function r(e,o){return function(n){var r=n.getMoment("startDate"),a=n.getMoment("endDate");return t.isAllday(n)&&a.subtract(1,"day"),!e.isAfter(a)&&!o.isSameOrBefore(r)}}function a(e){return t.isAllday(e)?-1:t.getMomentInLocalTimezone(e.get("startDate")).valueOf()}function i(e){var o=n.pool.models[e.get("folder")],r=t.getAppointmentColor(o.attributes,e)||"#e8e8e8";return{time:t.isAllday(e)?void 0:t.getMomentInLocalTimezone(e.get("startDate")).format("LT"),title:e.get("summary"),color:t.getForegroundColor(r),backgroundColor:r}}return{open:function(t,n){o.smart({selection:[t.folders],get:function(){var o=e.getCollection({start:t.start,end:t.end,folders:t.folders,view:"month"});return o.sync().then(function(){for(var e=moment(t.current).month(),n=moment(t.start),d=moment(t.end),l=[];d.diff(n)>-1;n.add(1,"week")){for(var m=n.clone(),c=n.clone().add(1,"week"),u=[];c.diff(m)>0;m.add(1,"day")){var s=m.clone().add(1,"day");u.push({date:m.date(),events:o.chain().filter(r(m,s)).sortBy(a).map(function(e){return i(e)}).value(),className:m.month()===e?"in":"out"})}l.push({days:u})}return l})},meta:{labels:_(_.range(7)).map(function(e){return moment().weekday(e).format("dddd")}),title:t.title+" - "+moment(t.current).formatCLDR("yMMMM")},selector:".calendar-month-view",window:n})}}});