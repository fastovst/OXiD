define("io.ox/files/listview",["io.ox/core/tk/list","io.ox/core/tk/list-contextmenu","io.ox/core/extensions","io.ox/files/common-extensions","io.ox/files/api","settings!io.ox/core","gettext!io.ox/files","io.ox/files/view-options","less!io.ox/files/style"],function(i,e,t,n,a,l,o){"use strict";var d="io.ox/files/listview",s=d+"/item",r=i.extend(e).extend({ref:d,initialize:function(e){function t(){this.favorites=l.get("favorites/infostore",[]),this.favoriteFiles=l.get("favoriteFiles/infostore",[])}i.prototype.initialize.apply(this,arguments),this.contextMenu=e.contextMenu,this.$el.attr("aria-label",o("List view")).addClass("file-list-view"),t.call(this),l.on("change:favorites/infostore",t.bind(this))},getCompositeKey:function(i){return i.isFolder()?"folder."+i.get("id"):i.cid},onChange:function(e){_.intersection(_(e.changed).keys(),r.relevantAttributes).length&&i.prototype.onChange.apply(this,arguments)},getContextMenuData:function(i){return this.app.getContextualData(i,"main")}});r.relevantAttributes=["index","id","last_modified","locked_until","filename","file_mimetype","file_size","source","title","version","index/virtual/favorites/infostore"],t.point("io.ox/core/viewer/sidebar/fileinfo").extend({index:50,id:"thumbnail",draw:function(i){var e=this.find(".sidebar-panel-body");_.defer(function(){if(e.closest(".viewer-sidebar.rightside").length){var t=e.closest(".viewer-sidebar.rightside").find(".sidebar-panel-thumbnail"),a=t.length?t:$('<div class="sidebar-panel-thumbnail" role="tabpanel">');a.empty(),n.thumbnail.call(a,i),e.before(a)}e=null})}}),t.point(d+"/notification/error").extend({id:"default",index:100,draw:function(i){this.append($('<i class="fa fa-exclamation-triangle" aria-hidden="true">'),$.txt(o("Error: Failed to load files")),$('<button type="button" class="btn btn-link">').text(o("Retry")).on("click",{baton:i},function(i){i.data.baton.listView.load()}))}}),t.point(s).extend({id:"default",index:100,draw:function(i){var e=i.app&&i.app.props.get("layout")||"list";i.model||(i.model=new a.Model(i.data)),t.point(s+"/"+e).invoke("draw",this,i)}},{id:"aria-label",index:200,draw:n.ariaLabel});var c=function(i){var e=l.get("folder/mailattachments",{});return _.values(e).indexOf(i.app.folder.get())>-1};return t.point(s+"/list").extend({id:"file-type",index:10,draw:n.fileTypeClass},{id:"locked",index:20,draw:n.locked},{id:"col1",index:100,draw:function(i){var e=$('<div class="list-item-column column-1">');n.fileTypeIcon.call(e,i),this.append(e)}},{id:"col2",index:200,draw:function(i){var e=$('<div class="list-item-column column-2">');this.parent().tooltip("destroy"),n.filename.call(e,i),this.append(e)}},{id:"mail-attachment-from",index:210,draw:function(i){if(!_.device("smartphone")&&c(i)){var e=$('<div class="list-item-column column-5">');n.mailFrom.call(e,i),this.addClass("attachment-view").append(e)}}},{id:"mail-attachment-subject",index:220,draw:function(i){if(!_.device("smartphone")&&c(i)){var e=$('<div class="list-item-column column-5">');n.mailSubject.call(e,i),this.append(e)}}},{id:"col3",index:300,draw:function(i){if(!(_.device("smartphone")||c(i)&&5!==i.app.props.get("sort"))){var e=$('<div class="list-item-column column-3 gray">');n.smartdate.call(e,i),this.append(e)}}},{id:"col4",index:500,draw:function(i){if(!(_.device("smartphone")||c(i)&&704!==i.app.props.get("sort"))){var e=$('<div class="list-item-column column-4 gray">');n.size.call(e,i),this.append(e)}}}),t.point(s+"/icon").extend({id:"file-type",index:10,draw:n.fileTypeClass},{id:"thumbnail",index:100,draw:function(){n.thumbnail.apply(this,arguments),this.prepend($('<div class="thumbnail-masking-box"></div>'))}},{id:"locked",index:200,draw:n.locked},{id:"file-icon",index:300,draw:function(i){var e=$('<div class="filename-file-icon">');n.fileTypeIcon.call(e,i),this.append(e)}},{id:"filename",index:400,draw:function(i){n.filename.call(this,i,{max:36,charpos:"middle",suppressExtension:!0,optimizeWordbreak:!0}),n.filenameTooltip.call(this,i)}}),t.point(s+"/tile").extend({id:"file-type",index:10,draw:n.fileTypeClass},{id:"thumbnail",index:100,draw:function(){n.thumbnail.apply(this,arguments),this.prepend($('<div class="thumbnail-masking-box"></div>'))}},{id:"locked",index:200,draw:n.locked},{id:"filename",index:400,draw:function(i){n.filenameTooltip.call(this,i)}}),r});