define("io.ox/files/favorite/listview",["io.ox/core/extensions","io.ox/core/folder/breadcrumb","io.ox/core/tk/list","io.ox/core/tk/list-contextmenu","io.ox/files/common-extensions","settings!io.ox/core","io.ox/core/folder/api","io.ox/files/api","io.ox/backbone/views/actions/util","less!io.ox/files/favorite/style","io.ox/files/favorite/view-options"],function(e,t,i,o,l,n,s,a,r){"use strict";var c="io.ox/files/favorite/myfavorites/listview",d=c+"/item",f=i.extend(o).extend({ref:c,initialize:function(t){t.collection=this.collection=s.pool.getCollection("virtual/favorites/infostore"),this.contextMenuRef="io.ox/files/listview/contextmenu",this.folderID=n.get("favorites/infostore",[]),i.prototype.initialize.call(this,t),this.$el.addClass("myfavorites-list column-layout"),this.model.set({sort:t.app.props.get("sort"),order:t.app.props.get("order")}),this.toggleCheckboxes(!1),this.load(),this.sortBy(),this.listenTo(this.model,"change:sort change:order",this.sortBy),this.listenTo(t.collection,"update:collection",this.sortBy),this.$el.on(_.device("touch")?"tap":"dblclick",".list-item .list-item-content",function(i){var o=$(i.currentTarget).parent().attr("data-cid");if("false"!==$(i.currentTarget).parent().attr("data-is-file")){var l=t.app,n=_(a.resolve([o],!1)).invoke("toJSON"),s=e.Baton({data:n[0],all:l.myFavoriteListView.collection,app:l,options:{eventname:"selection-doubleclick"}});r.invoke("io.ox/files/actions/default",s)}else t.app.folder.set(o.replace(/^folder./,""),!0)})},load:function(){var e=this,t=[],i=[],o=!e.collection.expired&&e.collection.fetched;_.each(e.collection.models,function(e){e.folder_name?i.push(e.id):t.push(e)}),require(["io.ox/files/api"]).then(function(l){return l.getList(t,{errors:!0,cache:o,onlyAttributes:!0}).then(function(t){return s.multiple(i,{errors:!0,cache:o}).then(function(i){var o=[];_.each(i,function(e){o.push(e)}),_.each(t,function(e){o.push(e)}),e.collection.reset(o)})})})},sortBy:function(){var e="desc"===this.model.get("order");switch(this.model.get("sort")){case 5:this.collection.comparator=function(t){var i=t.get("last_modified");return i=t.isFolder()?(e?"1":"0")+i:(e?"0":"1")+i,e?-i:i};break;case 702:this.collection.comparator=function(t,i){var o=t.getDisplayName().toLowerCase(),l=i.getDisplayName().toLowerCase(),n=(o=t.isFolder()?(e?"1":"0")+o:(e?"0":"1")+o)>(l=i.isFolder()?(e?"1":"0")+l:(e?"0":"1")+l)?1:-1;return e?-n:n}}this.collection.sort({silent:!0}),this.collection.each(function(e,t){e.set("index",t)}),this.collection.trigger("sort"),this.app.props.set(this.model.attributes)},getContextMenuData:function(e){return this.app.getContextualData(e,"favorites")}});return e.point(d).extend({id:"default",index:100,draw:function(t){e.point(d+"/list").invoke("draw",this,t)}}),e.point(d+"/list").extend({id:"file-type",index:10,draw:function(e){if(e&&e.model){var t=!!e.model.getFileType&&e.model.getFileType();this.closest(".list-item").addClass("file-type-"+t).attr("data-is-favorite-view",!0).attr("data-is-file","folder"!==t)}}},{id:"locked",index:20,draw:l.locked},{id:"col1",index:100,draw:function(){var e=$('<div class="list-item-column column-1">').append('<i class="fa file-type-icon" aria-hidden="true">');this.append(e)}},{id:"col2",index:200,draw:function(e){var t=$('<div class="list-item-column column-2">');l.filename.call(t,e),this.append(t)}},{id:"col3",index:300,draw:function(e){if(!_.device("smartphone")){var i=new t({folder:e.model.getFileType?e.model.attributes.folder_id:e.model.id,exclude:["9"],notail:!0,isLast:!0});i.handler=function(e){ox.launch("io.ox/files/main",{folder:e}).done(function(){this.folder.set(e)})},this.append($('<div class="list-item-column column-3 gray">').append(i.render().$el))}}},{id:"col4",index:400,draw:function(e){if(!_.device("smartphone")){var t=$('<div class="list-item-column column-4 gray">');l.smartdate.call(t,e),this.append(t)}}}),f});