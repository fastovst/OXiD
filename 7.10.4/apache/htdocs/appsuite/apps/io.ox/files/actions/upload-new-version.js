define("io.ox/files/actions/upload-new-version",["io.ox/files/api","io.ox/core/folder/api","io.ox/backbone/views/modal","io.ox/core/tk/attachments","gettext!io.ox/files"],function(e,t,o,i,n){"use strict";return function(l){function d(){var e=this,t=arguments;require(["io.ox/core/yell"],function(o){o.apply(e,t)})}function a(){return l.meta&&l.meta.Encrypted}function r(o,i){if(!o)return $.Deferred().reject();var n={file:o,id:l.id,folder:l.folder_id,version_comment:i||"",params:a()?{cryptoAction:"Encrypt"}:{}};return t.pool.getModel(l.folder_id).supports("extended_metadata")&&(n.version_comment=i||""),e.versions.upload(n).fail(d)}var f=i.fileUploadWidget({multi:!1,buttontext:n("Select file")}),s=$('<div class="form-group">').css("font-size","14px").hide();new o({title:n("Upload new version"),async:!0}).build(function(){this.$body.append(f.on("change",function(){0===f.find('input[type="file"]')[0].files.length?s.text("").hide():s.text(f.find('input[type="file"]')[0].files[0].name).show()}),s,t.pool.getModel(l.folder_id).supports("extended_metadata")?$('<textarea rows="6" class="form-control">'):"")}).addCancelButton().addButton({label:n("Upload"),action:"upload"}).on("upload",function(){var e=this.$body,o=e.find('input[type="file"]')[0].files,i=t.pool.getModel(l.folder_id).supports("extended_metadata")?e.find("textarea").val():"";r(_.first(o),i).then(this.close,this.idle).fail(function(){0===o.length&&d("info",n("You have to select a file to upload.")),_.defer(function(){e.focus()})})}).open()}});