define("io.ox/files/actions/rename",["io.ox/files/api","io.ox/core/extensions","io.ox/backbone/views/modal","io.ox/files/util","gettext!io.ox/files"],function(e,n,i,t,o){"use strict";return function(a){function l(n){var i=!a.filename&&a.title?{title:n}:{filename:n};return e.update(a,i).fail(f)}function f(){var e=this,n=arguments;require(["io.ox/core/notifications"],function(i){i.yell.apply(e,n)})}function r(e){var i;return n.point("io.ox/core/filename").invoke("validate",null,e,"file").find(function(e){if(!0!==e)return f("warning",e),i=!0}),i?$.Deferred().reject():t.confirmDialog(e,c).then(l.bind(this,e))}var c=a["com.openexchange.file.sanitizedFilename"]||a.filename||a.title;new i({title:o("Rename"),enter:"rename",async:!0}).build(function(){this.$body.append($('<input type="text" name="name" class="form-control">'));var e=/\.[a-z0-9]+\.pgp/i.test(c)?c.replace(".pgp","").lastIndexOf("."):c.lastIndexOf(".");this.$body.find('input[name="name"]').focus().val(c).get(0).setSelectionRange(0,e>-1?e:c.length)}).addCancelButton().addButton({label:o("Rename"),action:"rename"}).on("rename",function(){var e=this.$body;r(e.find('input[name="name"]').val()).then(this.close,this.idle).fail(function(){_.defer(function(){e.focus()})})}).open()}});