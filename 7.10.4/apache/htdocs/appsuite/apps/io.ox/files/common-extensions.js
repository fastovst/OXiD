define("io.ox/files/common-extensions",["io.ox/mail/util","io.ox/files/api","io.ox/core/strings","gettext!io.ox/files","settings!io.ox/core"],function(e,a,t,i,l){"use strict";var o={ariaLabel:function(e){var a=[];a.push(e.data.filename||e.data.title),e.model.isFolder()&&a.push(i("Folder")),a.push(i("modified")+" "+moment(e.data.last_modified).format("LLL")),a.push(i("size")+" "+t.fileSize(e.data.file_size||0,1)),this.closest("li").attr("aria-label",a.join(", ")+".")},date:function(a,t){var i=a.data.last_modified;_.isNumber(i)&&this.append($('<time class="date">').attr("datetime",moment(i).toISOString()).text(e.getDateTime(i,t)))},smartdate:function(e){o.date.call(this,e,{fulldate:!1,smart:!0})},fulldate:function(e){o.date.call(this,e,{fulldate:!0,smart:!1})},compactdate:function(e){o.date.call(this,e,{fulldate:!1,smart:!1})},filename:function(e,a){var t=e.data["com.openexchange.file.sanitizedFilename"]||e.data.filename||e.data.title||"",l=!1;e.model&&_.isFunction(e.model.isLocked)&&e.model.isLocked()&&(t+=" ("+i("Locked")+")"),a?(t=_.ellipsis(t,a),!0!==a.optimizeWordbreak&&(l=!0)):l=!0,l&&(t=t.replace(/_/g,"_​")),this.append($('<div class="filename">').text(t))},filenameTooltip:function(e){var a=e.data["com.openexchange.file.sanitizedFilename"]||e.data.filename||e.data.title||"",t=this.parent(),i=_.breakWord(a);t.attr("data-original-title",i).tooltip("hide"),t.tooltip({title:i,trigger:"hover",placement:"bottom auto",animation:!0,delay:{show:400},container:t,viewport:{selector:".io-ox-files-main .list-view-control.toolbar-top-visible",padding:16}}).on("dispose",function(){$(this).parent().tooltip("destroy")})},mailSubject:function(a,t){if(_.has(a.data,"com.openexchange.file.storage.mail.mailMetadata")){var i=a.data["com.openexchange.file.storage.mail.mailMetadata"],l=e.getSubject(i.subject||"");t&&(l=_.ellipsis(l,t)),l=l.replace(/_/g,"_​"),this.append($('<div class="subject">').text(l))}},mailFrom:function(a,t){if(_.has(a.data,"com.openexchange.file.storage.mail.mailMetadata")){var i=a.data["com.openexchange.file.storage.mail.mailMetadata"],o=l.get("folder/mailattachments",{}),s=a.app.folder.get()===o.sent?i.to[0]:i.from[0];s=e.getDisplayName(s),t&&(s=_.ellipsis(s,t)),s=s.replace(/_/g,"_​"),this.append($('<div class="from">').text(s))}},size:function(e){var a=e.data.file_size;this.append($('<span class="size">').text(_.isNumber(a)?t.fileSize(a,1):"—"))},locked:function(e){e.model&&e.model.isLocked&&this.toggleClass("locked",e.model.isLocked())},fileTypeIcon:function(){this.append('<i class="fa file-type-icon" aria-hidden="true">')},fileTypeClass:function(e){var a=e.model.getFileType();a&&this.closest(".list-item").addClass("file-type-"+a)},thumbnail:function(){function e(){1===this.width&&1===this.height?t.call(this):a.call(this)}function a(){var e=$(this),a=e.attr("src");e.parent().css("background-image","url("+a+")"),e.remove()}function t(){var a=$(this),t=a.data("retry")+1,l=String(a.attr("src")||"").replace(/&retry=\d+/,"")+"&retry="+t,o=3e3*Math.pow(2,t-1);t>3||setTimeout(function(){a.off("load.lazyload error.lazyload").on({"load.lazyload":e,"error.lazyload":i}).attr("src",l).data("retry",t),a=null},o)}function i(){$(this).parent().addClass("default-icon").append($('<span class="file-icon"><i class="fa file-type-icon" aria-hidden="true"></i></span>')),$(this).remove()}return function(a){if(a.model.isFolder())return this.append($('<div class="icon-thumbnail default-icon">').append($('<span class="folder-name">').text(a.model.getDisplayName()),$('<span class="folder-icon"><i class="fa file-type-icon" aria-hidden="true"></i></span>')));var t=a.model.supportsPreview();if(t){var l=a.model.getUrl(t,{width:200,height:150,scaleType:"cover"}),o=$('<img class="dummy-image invisible">').data("retry",0);return o.attr("data-original",l.replace(/format=preview_image/,"format=thumbnail_image")),o.on({"load.lazyload":e,"error.lazyload":i}).lazyload(),this.append($('<div class="icon-thumbnail">').append(o))}this.append($('<div class="icon-thumbnail default-icon">').append($('<span class="file-icon"><i class="fa file-type-icon" aria-hidden="true"></i></span>')))}}()};return o});