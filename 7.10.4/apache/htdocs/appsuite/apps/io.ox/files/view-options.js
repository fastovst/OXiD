define("io.ox/files/view-options",["io.ox/core/extensions","io.ox/backbone/mini-views/dropdown","io.ox/core/folder/breadcrumb","io.ox/core/folder/api","io.ox/core/capabilities","io.ox/core/api/filestorage","io.ox/core/folder/util","gettext!io.ox/files"],function(e,o,i,t,a,n,l,d){"use strict";function r(e){e.preventDefault();var o=e.data.list,i=$(this).attr("data-name");_.defer(function(){"all"===i?o.selection.selectAll():"files"===i?(o.selection.selectNone(),o.selection.selectAll(":not(.file-type-folder)")):"none"===i&&o.selection.selectNone()})}function s(e){if(e.preventDefault(),e.data.app.folderView.toggle(e.data.state),e.data.state)e.data.app.folderView.tree.getNodeView(e.data.app.folder.get()).$el.focus();else{var o=e.data.app.listView,i=o.selection.get().reduce(function(e,i){return e||o.selection.getNode(i)},null);if(i)return o.selection.focus(0,i);if(0===o.collection.length)return o.$el.focus();o.selection.select(0)}}function p(e){e.getWindow().nodes.main.find(".list-view-control").removeClass("toolbar-bottom-visible")}function c(e){e.getWindow().nodes.main.find(".list-view-control").addClass("toolbar-bottom-visible")}e.point("io.ox/files/listviewcontrol/list-view/toolbar/top").extend({id:"secondary",index:100,draw:function(){this.addClass("secondary-toolbar")}}),e.point("io.ox/files/view-options").extend({id:"sort",index:100,draw:function(){this.data("view").option("sort",702,d("Name"),{radio:!0}).option("sort",5,d("Date"),{radio:!0}).option("sort",704,d("Size"),{radio:!0})}}),e.point("io.ox/files/view-options").extend({id:"order",index:200,draw:function(){this.data("view").divider().option("order","asc",d("Ascending"),{radio:!0}).option("order","desc",d("Descending"),{radio:!0})}}),e.point("io.ox/files/listviewcontrol/list-view/toolbar/top").extend({id:"dropdown-container",index:900,draw:function(o){var i=$('<div class="dropdown-container pull-right">');e.point("io.ox/files/listviewcontrol/list-view/toolbar/dropdowns").invoke("draw",i,o),this.append(i)}}),e.point("io.ox/files/listviewcontrol/list-view/toolbar/dropdowns").extend({id:"dropdown",index:100,draw:function(i){var t=new o({label:d.pgettext("dropdown","Sort by"),model:i.app.props,caret:!0});e.point("io.ox/files/view-options").invoke("draw",t.$el,i),this.append(t.render().$el.addClass("grid-options toolbar-item").on("dblclick",function(e){e.stopPropagation()}))}}),e.point("io.ox/files/select/options").extend({id:"default",index:100,draw:function(e){function o(){e.app.folder.getData().done(function(e){n.isExternal(e)||l.is("attachmentView",e)?i.data("view").$ul.children().slice(4).hide():i.data("view").$ul.children().slice(4).show()})}this.data("view").header(d("Select")).link("all",d("All")).link("files",d("All files")).link("none",d("None")),a.has("search")&&this.data("view").divider().header(d.pgettext("verb","Filter")).option("filter","pdf",d("PDFs"),{radio:!0}).option("filter","doc-text",d("Text documents"),{radio:!0}).option("filter","doc-spreadsheet",d("Spreadsheets"),{radio:!0}).option("filter","doc-presentation",d("Presentations"),{radio:!0}).option("filter","image",d("Images"),{radio:!0}).option("filter","audio",d("Music"),{radio:!0}).option("filter","video",d("Videos"),{radio:!0}).option("filter","all",d("All"),{radio:!0}),this.data("view").$ul.on("click","a",{list:e.app.listView},r);var i=this;this.data("view").$el.one("click",function(){o()}),e.app.on("folder:change",function(){o()})}}),e.point("io.ox/files/listviewcontrol/list-view/toolbar/dropdowns").extend({id:"select",index:200,draw:function(i){if(!_.device("smartphone")){var t=new o({label:d.pgettext("dropdown","Select"),model:i.app.props,caret:!0,dataAction:"select"});e.point("io.ox/files/select/options").invoke("draw",t.$el,i),this.append(t.render().$el.addClass("grid-options toolbar-item pull-right"))}}}),e.point("io.ox/files/listviewcontrol/list-view/toolbar/top").extend({id:"move-up",index:2100,draw:function(e){_.device("!smartphone")||this.append($('<div class="grid-options toolbar-item pull-left">').append($('<a href="#" role="button">').append($('<span class="folder-up fa-stack">').append($('<i class="fa fa-folder fa-stack-2x" aria-hidden="true">'),$('<i class="fa fa-level-up fa-stack-1x fa-inverse" aria-hidden="true">'))).attr({title:d("Switch to parent folder")}).on("click",function(o){o.preventDefault();var i=e.app,t=i.folder;t.getData().done(function(e){"9"===e.folder_id||"1"===e.folder_id?i.pages.goBack():t.set(e.folder_id)})})))}}),e.point("io.ox/files/listviewcontrol/list-view/toolbar/top").extend({id:"breadcrumb",index:300,draw:function(e){var o=this;_.device("smartphone")||t.get("9").then(function(t){var a=new i({app:e.app,rootAlwaysVisible:!0,linkReadOnly:!0,defaultRootPath:t}).render().$el.addClass("toolbar-item"),n=$('<div class="toolbar-item">').text(d("Search results")).hide();o.append(a,n),e.app.props.on("change:find-result",function(e,o){a.toggle(!o),n.toggle(o)})})}}),e.point("io.ox/files/listviewcontrol/list-view/toolbar/bottom").extend({id:"toggle-folderview",index:200,draw:function(e){this.append($('<a href="#" role="button" class="toolbar-item" data-action="open-folder-view">').attr("aria-label",d("Open folder view")).append($('<i class="fa fa-angle-double-right" aria-hidden="true">').attr("title",d("Open folder view"))).on("click",{app:e.app,state:!0},s)),e.app.on({"folderview:open":p.bind(null,e.app),"folderview:close":c.bind(null,e.app)}),e.app.folderViewIsVisible()&&_.defer(p,e.app)}}),e.point("io.ox/files/sidepanel").extend({id:"toggle-folderview",index:1e3,draw:function(e){this.addClass("bottom-toolbar").append($('<div class="generic-toolbar bottom visual-focus" role="region">').append($('<button class="btn btn-link toolbar-item" data-action="close-folder-view">').attr("aria-label",d("Close folder view")).append($('<i class="fa fa-angle-double-left" aria-hidden="true">').attr("title",d("Close folder view"))).on("click",{app:e.app,state:!1},s)))}})});