define("io.ox/files/detail/main",["io.ox/files/api","gettext!io.ox/files","io.ox/core/notifications","io.ox/files/actions"],function(e,i,t){"use strict";var n="io.ox/files/detail";return ox.ui.App.mediator(n,{"show-file":function(n){function o(e){n.setTitle(e.getDisplayName())}function a(t){var a=i("File Details"),r=t["com.openexchange.file.sanitizedFilename"]||t.filename||t.title;n.getWindowNode().addClass("detail-view-app").append($('<div class="f6-target detail-view-container" tabindex="-1" role="complementary">').attr("aria-label",a)),l=e.pool.get("detail").get(_.cid(t))||null,require(["io.ox/core/viewer/main"],function(e){var i={files:[l||t],app:n,container:n.getWindowNode(),standalone:!0,opt:{disableFolderInfo:!l}};(new e).launch(i)}),n.setTitle(r),l&&(n.listenTo(l,"change:com.openexchange.file.sanitizedFilename change:filename change:title",o),n.on("quit",function(){n.stopListening(l,"change:com.openexchange.file.sanitizedFilename change:filename change:title",o)}),e.once("delete:"+_.ecid(t),function(){n.quit()}))}var l=null;n.showFile=function(i){if(i.file)return a(i.file);e.get(i).then(a,function(e){t.yell(e),n.quit()})}},"manage-url":function(e){var i,t=e.getWindow();t.on("show",function(){e.setState(i)}),t.on("hide",function(){e.setState({attachment:null})}),e.setUrlParameter=function(t){i=t,e.setState(t)}}}),{getApp:function(){var e=ox.ui.createApp({closable:!0,name:n,title:""});return e.setLauncher(function(i){var o=ox.ui.createWindow({chromeless:!0,name:n,toolbar:!1});if(o.nodes.outer.css("z-index",2),e.setWindow(o),e.mediate(),o.show(),i.file){var a=i.file.mail;return a?e.setUrlParameter({folder:a.folder_id,id:a.id,attachment:i.file.id}):e.setUrlParameter({folder:i.file.folder_id,id:i.file.id}),e.showFile(i)}var l,r=i.cid;if(void 0!==r)return l=_.cid(r),e.setUrlParameter({folder:l.folder_id,id:l.id}),void e.showFile(l);(l=_.clone(e.getState())).folder&&l.id&&(l.attachment?require(["io.ox/mail/api","io.ox/mail/util"],function(i,n){i.get({folder:l.folder,id:l.id}).then(function(i){var t=n.getAttachments(i),o=_.find(t,function(e){return e.id===l.attachment});e.showFile({file:o}),e.setUrlParameter(l)},function(i){t.yell(i),e.close()})}):(e.showFile(l),e.setUrlParameter(l)))})}}});