define("io.ox/participants/chronos-detail",["io.ox/calendar/util","io.ox/core/extensions","io.ox/contacts/util","io.ox/calendar/util","io.ox/mail/util","io.ox/core/util","gettext!io.ox/core","settings!io.ox/calendar","less!io.ox/participants/style"],function(a,t,e,n,i,r,s,p){"use strict";function o(a){var t=a.appointment.toJSON();return!(!t.organizer||!t.organizer.entity&&!t.organizer.email)&&(a.data.entity?a.data.entity===t.organizer.entity:a.data.email===t.organizer.email)}function l(a,e,n){n=_.extend({halo:!0},n);var i=$('<div class="flex-wrapper" >'),r=$('<li class="participant">').append(i),s=new t.Baton({data:a,options:n,appointment:e,flexWrapper:i});return t.point("io.ox/participants/chronos/item").invoke("draw",r,s),r}function d(a){a.preventDefault(),$(this).parent().hasClass("active")?($(this).attr("aria-pressed",!1),$(".active",a.data.participantsContainer).removeClass("active"),$(".participant",a.data.participantsContainer).show()):($(".participant",a.data.participantsContainer).show().find("a.person:not(."+a.data.res.css+")").parent().parent().toggle(),$(".active",a.data.participantsContainer).removeClass("active"),$(this).attr("aria-pressed",!0).parent().addClass("active"))}return t.point("io.ox/participants/chronos/item").extend({index:100,id:"resource",draw:function(a){var t=a.data,e=n.getAttendeeName(t);if("RESOURCE"===t.cuType){if(!a.options.halo)return this.append($.txt(e));t.resource&&(t=t.resource),a.flexWrapper.append($('<a href="#" role="button" class="halo-resource-link">').attr("title",t.display_name||e).data(_.extend(t,{email1:t.mailaddress||t.email})).append($.txt(t.display_name||e)))}}}),t.point("io.ox/participants/chronos/item").extend({index:200,id:"person",draw:function(a){if("RESOURCE"!==a.data.cuType){var t,e,s;t=i.getDisplayName([n.getAttendeeName(a.data),a.data.email],{showMailAddress:!0}),e=a.data.full_name?$(a.data.full_name):$.txt(t),s=_.extend({html:e},a.data),a.options.halo||(s.$el=$("<span>")),a.data.entity&&(s.user_id=a.data.entity),a.flexWrapper.append(r.renderPersonalName(s,a.data))}}}),t.point("io.ox/participants/chronos/item").extend({index:300,id:"status",draw:function(t){var e=t.data,n="RESOURCE"!==t.data.cuType?a.getConfirmationSymbol(e.partStat):"",i="RESOURCE"!==t.data.cuType?e.comment:void 0,r=a.getConfirmationClass(e.partStat);t.flexWrapper.children().first().addClass(r).addClass("RESOURCE"===t.data.cuType?"":"person"),t.flexWrapper.append(t.data.isResource?"":$('<span class="sr-only">').text(", "+a.getConfirmationLabel(e.partStat)+"."),n?$('<span class="status" aria-hidden="true">').addClass(r).append(n):""),t.appointment.get("attendees").length>1&&o(t)&&t.flexWrapper.append($('<span class="organizer-container">').text("("+s("Organizer")+")")),this.append(i?$('<div class="comment">').text(i):"")}}),function(n,i){i=_.extend({summary:!0,inlineLinks:!1,halo:!0,separateLists:p.get("separateExternalParticipantList",!1)},i),this.draw=function(){var r=n.model.get("attendees")||[],p=r.length?$('<div class="participants-view">'):$();if(r.length){p.busy();var c,u=_(r).filter(function(a){return(!a.cuType||"INDIVIDUAL"===a.cuType)&&(!i.separateLists||a.entity)}),m=_(r).filter(function(a){return i.separateLists&&(!a.cuType||"INDIVIDUAL"===a.cuType)&&!a.entity}),f=_(r).filter(function(a){return"RESOURCE"===a.cuType});u.length&&p.append($("<fieldset>").append($('<legend class="io-ox-label">').append($("<h2>").text(s("Participants"))),c=$('<ul class="participant-list list-inline">'))),_(u).chain().map(function(a){return a.contact?(a.full_name=e.getFullName(a.contact,!0),a.sort_name=a.contact.last_name||a.contact.first_name||a.contact.display_name||""):a.sort_name=a.cn,a}).sortBy(function(a){return a.sort_name}).each(function(a){o({data:a,appointment:n.model})?c.prepend(l(a,n.model,i)):c.append(l(a,n.model,i))});var x;if(m.length>0&&p.append($("<fieldset>").append($('<legend class="io-ox-label">').append($("<h2>").text(s("External participants"))),x=$('<ul class="participant-list list-inline">'))),_(m).each(function(a){x.append(l(a,n.model,i))}),f.length){var h;p.append($("<fieldset>").append($('<legend class="io-ox-label">').append($("<h2>").text(s("Resources"))),h=$('<ul class="participant-list list-inline">'))),_(f).chain().sortBy(function(a){return a.display_name}).each(function(a){h.append(l(a,n.model,i))})}var y=a.getConfirmationSummary(r,{chronos:!0});i.summary&&y.count>3&&p.find("legend").first().append($('<ul class="summary list-inline pull-right">').attr("aria-label",s("Summary")).append(_.map(y,function(a){if(_.isNumber(a.count)&&!(a.count<=0))return $("<li>").append($('<a href="#" role="button" aria-pressed="false">').text(a.count).attr("aria-label",a.title+" "+a.count).prepend($('<span class="status">').addClass(a.css).append(a.icon)).on("click",{participantContainer:p,res:a},d))}))),i.inlineLinks&&t.point(i.inlineLinks).invoke("draw",p,n),p.idle()}return p}}});