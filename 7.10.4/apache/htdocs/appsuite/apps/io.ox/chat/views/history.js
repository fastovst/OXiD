define("io.ox/chat/views/history",["io.ox/backbone/views/disposable","io.ox/chat/views/chatAvatar","io.ox/chat/data"],function(e,t,n){"use strict";return e.extend({className:"history abs",initialize:function(){this.collection=n.chats,this.listenTo(this.collection,{add:this.onAdd,remove:this.onRemove,"change:open":this.onChangeOpen,change:this.onChange})},render:function(){return this.$el.append($('<div class="header abs">').append($("<h2>").append("Recent conversations")),$('<div class="scrollpane abs">').append($("<ul>").append(this.getItems().map(this.renderItem,this)))),this},getItems:function(){return this.collection.getHistory()},renderItem:function(e){return $("<li>").attr("data-cid",e.cid).append(new t({model:e}).render().$el,$('<div class="title">').text(e.getTitle()),$('<div class="date">').text(e.getLastMessageDate()),$('<div class="body">').text(e.getLastMessage()),$('<button type="button" class="btn btn-default btn-action" >').attr({"data-cmd":"open-chat","data-id":e.id}).text("Open"))},getNode:function(e){return this.$('[data-cid="'+e.cid+'"]')},onAdd:function(){},onRemove:function(e){this.getNode(e).remove()},onChangeOpen:function(e,t){console.log("onChangeOpen",e,t),t&&this.onRemove(e)},onChange:function(){}})});