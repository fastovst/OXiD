define("io.ox/multifactor/auth",["io.ox/multifactor/api","io.ox/multifactor/views/selectDeviceView","io.ox/multifactor/deviceAuthenticator","io.ox/multifactor/bundle"],function(e,t,r,o){"use strict";function i(e){require(["io.ox/core/notifications"],function(t){t.yell("error",e),$("#io-ox-core").show(),$(".multifactorBackground").hide()})}function n(t){t=t||{};var r=$.Deferred();return ox.idle(),f.getAuthentication(t).then(function(o){c=!1,o?e.doAuth(o.provider,o.id,o.response,o.parameters).then(function(e){r.resolve(e)},function(e){if(t.error={backup:!0===o.backup},!e.code||!/MFA-002[1-3]/.test(e.code))return e&&i(e.error),void window.setTimeout(function(){r.reject()},3e3);t.error.text=e.error,n(t).then(r.resolve,r.reject)}):r.reject()},function(e){if(e&&e.error)return i(e.error),void window.setTimeout(function(){r.reject()},3e3);r.reject(e)}),r}var u,c=!1;o.exports&&!window.u2f&&(window.u2f=o.exports);var f={getAuthentication:function(o){if(c)return u;c=!0;var i=u=$.Deferred();return o.def=i,o.error&&o.error.backup?(require(["io.ox/multifactor/lost"],function(e){e(o)}),i):(e.getDevices().then(function(e){if(e&&e.length>0)if(e&&e.length>1)t.open(e,o);else{var n=e[0];o=_.extend(o,{providerName:n.providerName,device:n}),r.getAuth(o)}else i.reject()},function(e){i.reject(e)}),i)},doAuthentication:n,reAuthenticate:function(){return n({reAuth:!0})}};return f});