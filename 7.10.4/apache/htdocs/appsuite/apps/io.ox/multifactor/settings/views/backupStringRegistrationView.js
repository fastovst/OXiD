define("io.ox/multifactor/settings/views/backupStringRegistrationView",["io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","io.ox/multifactor/api","io.ox/core/print","gettext!io.ox/core/boot"],function(e,o,t,n,i,r,a){"use strict";function c(e,o){return new n({async:!0,point:v,title:a("Recovery Code"),width:640,enter:"OK",model:new Backbone.Model({resp:o})}).build(function(){}).addButton({label:a("Ok"),action:"OK"}).addAlternativeButton({label:a("Download"),action:"Download"}).addAlternativeButton({label:a("Print"),action:"Print"}).on("OK",function(){s.close(),u.resolve()}).on("Download",function(){s.idle(),d(o.sharedSecret)}).on("Print",function(){s.idle(),r.request("io.ox/multifactor/settings/views/printBackupString",[l(o.sharedSecret)])}).open()}function d(e){var o=new Blob([l(e)]);if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(o,a("recovery")+".txt");else{var t=$('<a id="downloadCode">').attr("download",a("recovery")+".txt").attr("href",window.URL.createObjectURL(o,{type:"text/plain"}));$(".multifactorRecoveryCodeDiv").append(t),$("#downloadCode")[0].click(),t.remove()}}function l(e){for(var o="",t=0;t<e.length;t++)o+=e.charAt(t),t%4==3&&(o+=" ");return o}var s,u,v="multifactor/settings/views/backupStringRegistrationView",p=0;return o.point(v).extend({index:p+=100,id:"header",render:function(){var e=$("<p>").append(a("This is your recovery code. Please write it down, print it, or save the file. Be sure to save this in a secure location.")).append("<br>");this.$body.append(e)}},{index:p+=100,id:"selection",render:function(e){var o=$('<div class="multifactorRecoveryCodeDiv selectable-text">'),t=l(e.model.get("resp").sharedSecret);o.append(t),this.$body.append(o)}}),{open:function(e,o,t){if(o&&o.challenge)return s=c(0,o.challenge),u=t,s;console.error("Missing backupString data"),t.reject()}}});