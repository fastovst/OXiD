define("io.ox/multifactor/settings/views/addDevice",["io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","io.ox/core/yell","io.ox/multifactor/api","io.ox/multifactor/views/constants","gettext!io.ox/core/boot","less!io.ox/multifactor/style"],function(e,t,o,i,n,r,a,c){"use strict";function s(e,t){var o;switch(e){case a.SMS:o=g+"SMS";break;default:return void v(e,"",t)}return new i({async:!0,point:o,title:c("Add Multifactor Device"),enter:"OK",model:new Backbone.Model({provider:e,backup:t})}).build(function(){}).addCancelButton().addButton({label:c("Ok"),action:"OK"}).on("cancel",function(){m.reject()}).on("OK",function(){var o=$("#deviceName").length?$("#deviceName").val():"";b.busy(),v(e,o,t,this.model)&&b.close()}).on("open",function(){_.defer(function(){$("#deviceName")&&$("#deviceName").focus(),$("#deviceNumber")&&$("#deviceNumber").focus()})}).open()}function u(e){$(e.target).toggleClass("mfInputError",e.target.value.match(x)[0]!==e.target.value)}function d(e,o){if(o&&o.challenge){var i;switch(e){case a.SMS:i="io.ox/multifactor/settings/views/smsRegistrationView";break;case a.U2F:i="io.ox/multifactor/settings/views/u2fRegistrationView";break;case"WEB-AUTH":i="io.ox/multifactor/settings/views/webAuthnRegistrationView";break;case"YUBIKEY":i="io.ox/multifactor/settings/views/yubikeyRegistrationView";break;case a.TOTP:i="io.ox/multifactor/settings/views/totpRegistrationView";break;case a.BACKUP:i="io.ox/multifactor/settings/views/backupStringRegistrationView";break;default:var n=new t.Baton({data:{provider:e,resp:o,def:m}});t.point("io.ox/multifactor/addDevice/"+e).invoke("view",this,n).any()||m.reject()}i&&require([i],function(t){t.open(e,o,m)})}o||l(c("Something went wrong. Please try again later."))}function l(e){require(["io.ox/core/notifications"],function(t){t.yell("error",e)})}function f(e){return e.match(x)[0]===e||(l(c("Please only use numeric characters for phone number")),!1)}function v(e,t,o,i){var n={};switch(e){case a.SMS:if(n.phoneNumber=i.get("code")+$("#deviceNumber").val(),!f(n.phoneNumber))return b.idle(),!1}r.beginRegistration(e,t,o,n).then(function(t){return d(e,t),b.close(),!0},function(e){return console.log(e),l(e),!1})}var m,b,g="multifactor/settings/addDevice/",p=0,x=/[0-9\s\-+]*/;return t.point(g+"SMS").extend({index:p+=100,id:"header",render:function(){var e=$('<label for="deviceNumber">').append(c("Please enter the phone number for the device."));this.$body.append(e).append("<br>")}},{index:p+=100,id:"localInput",render:function(e){var t=$('<div class="countryCodes">');require(["io.ox/onboarding/clients/codes"],function(i){var n=new o.SelectView({name:"code",model:e.model,list:i.get()}),r=n.render().$el.removeClass("form-control").addClass("select form-control countryCodes").attr("title","Country Codes").attr("list","addresses"),a=ox.language;a.indexOf("_")>0&&(a=a.substring(a.indexOf("_")+1));try{i.get(a)&&(n.$el.find('option:contains("'+i.get(a).label+'")').prop("selected","selected"),e.model.set("code",i.get(a).value,{silent:!0}))}catch(e){console.error("Unable to find country code from language "+ox.language),console.error(e)}t.append(r)}),this.$body.append(t)}},{index:p+=100,id:"numberInput",render:function(){var e=$('<input type="text" id="deviceNumber" class="form-control mfInput">').on("keyup",u),t=$('<div class="deviceNumber">').append(e);this.$body.append(t)}}),{start:function(e,t,o){b=s(e,o),m=t}}});