define("io.ox/multifactor/views/smsProvider",["io.ox/multifactor/api","io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","gettext!io.ox/core/boot","io.ox/multifactor/views/constants","io.ox/backbone/mini-views/helplink","less!io.ox/multifactor/style"],function(e,t,o,i,n,r,a,c){"use strict";function s(e,t){return new n({async:!0,point:p,title:t.reAuth?a.ReAuthenticationTitle:a.AuthenticationTitle,enter:"OK",className:a.AuthDialogClass,model:new Backbone.Model({provider:t.providerName,deviceId:t.device.id,challenge:e,error:t.error})}).build(function(){}).addCancelButton().addButton({label:a.OKButton,action:"OK"}).addAlternativeButton({label:a.LostButton,action:"lost",className:t.device.backup?"hidden":"btn-default"}).on("OK",function(){var e=$("#verification").val().replace(/\s/g,"");if(e&&""!==e){var o={response:e,id:t.device.id,provider:t.providerName};u.resolve(o)}else u.reject();l&&l.close()}).on("cancel",function(){u.reject()}).on("open",function(){_.defer(function(){$("#verification").focus()})}).on("lost",function(){l.close(),require(["io.ox/multifactor/lost"],function(e){e(t)})}).open()}function d(e){$(e.target).toggleClass("mfInputError",e.target.value.match(/[0-9\s]*/)[0]!==e.target.value)}var l,u,p="multifactor/views/smsProvider",f=0;return o.point(p).extend({index:f+=100,id:"help",render:function(){var e=new c({base:"help",iconClass:"mfHelp fa-question-circle fa",href:"ox.appsuite.user.sect.security.multifactor.sms.html",tabindex:"-1",simple:!ox.ui.createApp,metrics:void 0!==ox.ui.createApp}).render().$el;this.$header.append(e)}},{index:f+=100,id:"header",render:function(e){var t=e.model.get("error")&&!e.model.get("error").repeat,o="";t&&(o=$('<dev class="newSMS">').append(r("New code sent.")+" "));var i=$('<label for="verification">').append(t?r("A new code was sent to your SMS device. Please enter the code."):r("You secured your account with 2-Step Verification. Please enter the verification code we sent to the phone *****%s.",e.model.get("challenge").phoneNumberTail)).append("<br>");this.$body.append(o,i)}},{index:f+=100,id:"selection",render:function(){var e=$('<input type="text" class="form-control mfInput" id="verification">').keyup(d),t=$('<div class="multifactorAuthDiv">').append(e);this.$body.append(t)}},{index:f+=100,id:"error",render:function(e){var t=e.model.get("error");if(t&&t.text){var o=$('<div class="multifactorError">').append(t.text);this.$body.append(o)}}}),{open:function(e,t){return l=s(e,t),u=t.def,l}}});