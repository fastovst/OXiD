define("io.ox/preview/officePreview/main",["io.ox/core/tk/keys","io.ox/core/util","less!io.ox/preview/officePreview/style"],function(e,n){"use strict";function a(e){return/\.pptx?$/.test(e.name)?"io-ox-office-preview-presentation ":"io-ox-office-preview-page"}function o(e){e.find("*").each(function(e,n){var a;(a=(n=$(n)).css("position"))&&"fixed"===a.toLowerCase()&&n.css({position:"absolute"})})}var t=5;return{getApp:function(i){function s(){u.busy()}function r(){u.idle()}function d(e){return-1!==c.maxPages?(new $.Deferred).resolve(c.document):c.document.length>=e?(new $.Deferred).resolve(c.document):(s(),$.ajax({url:i.dataURL+"&format=preview_filtered&pages="+e+"&previewForceDiv=true&view=html",dataType:"json"}).then(function(e){return r(),c.document=e.data.document.map(function(e){return e=$(e),o(e),e}),e.data.moreAvailable||(c.maxPages=c.document.length-1),c.document}))}i?(_.url.hash("name",i.name),_.url.hash("dataURL",i.dataURL)):i={name:_.url.hash("name"),dataURL:_.url.hash("dataURL")};var c,u,f=$("<div>");(c=ox.ui.createApp({name:"io.ox/preview/officePreview",title:"Preview"})).document=[],c.index=0,c.maxPages=-1;var l=$("<span>").addClass("io-ox-office-preview-page-indicator").text("1"),p=$('<button type="button">').addClass("btn btn-primary disabled").append('<i class="icon-white fa fa-chevron-right">').on("click",function(e){e.preventDefault(),c.nextPage()}),v=$('<button type="button">').addClass("btn btn-primary disabled").append('<i class="icon-white fa fa-chevron-left">').on("click",function(e){e.preventDefault(),c.previousPage()});return c.nextPage=function(){c.showPage(c.index+1)},c.previousPage=function(){c.showPage(c.index-1)},c.showPage=function(e){e=Math.max(0,e),-1!==c.maxPages&&e>c.maxPages&&(e=c.maxPages),d(e+t-e%t).done(function(o){var t=o[e].clone();t.find("img").each(function(){var e=$(this),a=String(e.attr("src"));e.attr("src",n.replacePrefix(a,ox.apiRoot))}),f.empty().append(t);var s=$(window).width()/2-t.width()/2;t.addClass(a(i)),t.addClass("io-ox-office-preview-content").css({position:"relative",left:s,right:s}),c.index=e,l.text(e+1),0===e?v.hasClass("disabled")||v.addClass("disabled"):v.removeClass("disabled"),e===c.maxPages?p.hasClass("disabled")||p.addClass("disabled"):p.removeClass("disabled")})},c.setLauncher(function(){var n=new e;u=ox.ui.createWindow({name:"io.ox/preview/officepreview",title:i.name,titleWidth:"40%",toolbar:!0,close:!0}),c.setWindow(u),f=$("<div>").addClass("abs").css({overflow:"auto",zIndex:2}).appendTo(u.nodes.main),u.nodes.main.addClass("io-ox-office-preview-background").append(l),u.show(function(){u.nodes.body.addClass("full-height-tablet full-height-phone"),u.nodes.body.on("click",function(e){e.pageX>$(window).width()/2?c.nextPage():c.previousPage()}),u.nodes.toolbar.append($("<div>").append(v,$.txt(" "),p)).css({left:"47%"}),c.showPage(0)}),u.on("idle show",function(){n.include()}),u.on("hide busy",function(){n.remove()}),n.on("leftarrow",function(){c.previousPage()}),n.on("uparrow",function(){c.previousPage()}),n.on("rightarrow",function(){c.nextPage()}),n.on("downarrow",function(){c.nextPage()}),n.on("space",function(){c.nextPage()}),n.on("esc",function(){c.quit()})}),c}}});