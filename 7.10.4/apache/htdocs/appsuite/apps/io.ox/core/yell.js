define("io.ox/core/yell",["gettext!io.ox/core"],function(e){"use strict";function t(e,t){var r,n,o=t;this.pause=function(){window.clearTimeout(r),o-=new Date-n},this.resume=function(){n=new Date,window.clearTimeout(r),r=window.setTimeout(e,o)},this.clear=function(){window.clearTimeout(r)},this.resume()}function r(){u&&u.clear(),$(".io-ox-alert").trigger("notification:removed").remove(),$("body").off(".yell")}function n(e){var t=$(".io-ox-alert");if(0!==t.length){if(_.device("smartphone"))return r();if("keydown"!==e.type)return $.contains(t.get(0),e.target)?$(e.target).closest(".close").length?r():void 0:r();if(($(e.target).closest(".close").length||27===e.which)&&(13===e.which||32===e.which||27===e.which))return r()}}function o(){u&&u.pause()}function a(){u&&u.resume()}function i(e){var t=$("#sr-alert-text").removeAttr("role").attr("role","alert"),r=$.txt(e);t.contents().filter(function(){return 3===this.nodeType}).remove(),$("#io-ox-alert-screenreader").css("clip","auto"),t.append(r).hide().css("display","inline")}function s(s,p,h){if("destroy"===s||"close"===s)return r();var g={duration:0,focus:!1,type:"info",closeOnClick:!0},m=!1,y={warnings:[]};if(_.isObject(s))if("error"in s)if("CONFLICT"!==s.categories||"FILE_STORAGE-0045"!==s.code&&"FLD-1038"!==s.code){if(!0===s.handled)return;g.type="error",g.message=s.message||s.error,g.headline=e("Error")}else m=!0,g.type="error",y.title||(y.title=s.error),y.warnings.push(s.warnings.error);else g=_.extend(g,s);else g.type=s||"info",g.message=p,g.focus=h;if(c.test(g.type)){var w=[];if("screenreader"===g.type)return i(g.message);if(!m){if(!g.message)return;u&&u.clear(),u=-1===g.duration?null:new t(r,g.duration||l[g.type]||5e3),w=$(".io-ox-alert"),$("body").off(".yell"),g.closeOnClick&&_.defer(function(){$("body").on(_.device("touch")?"tap.yell":"mousedown.yell keydown.yell",n)});var x,v,b,C=$('<div tabindex="-1" class="io-ox-alert">').addClass("io-ox-alert-"+g.type);return g.message instanceof $?b=(x=g.message).text():(x=$.parseHTML(_.escape(g.message).replace(/\n/g,"<br>")),b=g.message),v=b.indexOf("http")>=0?"break-all":"normal",w.length&&(C.addClass("appear"),w.trigger("notification:removed"),w.remove()),C.append($('<div class="icon">').append($('<i aria-hidden="true">').addClass(f[g.type]||"fa fa-fw"))).mouseover(o).mouseout(a),_.defer(function(){C.append($('<div role="alert" aria-live="polite" class="message user-select-text">').append(d[g.type]&&g.headline&&g.type!==g.headline.toLowerCase()?$('<span class="sr-only">').text(e(d[g.type])):[],g.headline?$('<h2 class="headline">').text(g.headline):[],$("<div>").css("word-break",v).append(x)))}),g.closeOnClick&&C.append($('<button type="button" class="btn btn-link close">').attr("title",e("Close this notification")).append($('<i class="fa fa-times" aria-hidden="true">'))),$(document.body).hasClass("modal-open")||$(".wizard-container").length>0?$(document.body).append(C):$("#io-ox-core").append(C),setTimeout(function(){C.trigger("notification:appear").addClass("appear"),g.focus&&C.attr("tabindex",0).focus()},_.device("touch")?300:2),C}require(["io.ox/core/tk/filestorageUtil"],function(e){e.displayConflicts(y)})}}var c=/^(busy|error|info|success|warning|screenreader)$/,l={busy:1e4,error:3e4,info:1e4,success:4e3,warning:1e4,screenreader:5e3},d={error:"Error",info:"Info",success:"Success",warning:"Warning"},f={busy:"fa fa-refresh fa-spin",error:"fa fa-exclamation",info:"fa fa-exclamation",success:"fa fa-check",warning:"fa fa-exclamation"},u=null;return s.done=function(){s("success",e("Done"))},s.close=function(){s("close")},s});