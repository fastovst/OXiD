define("io.ox/core/extPatterns/links",["io.ox/core/extensions","io.ox/core/collection","io.ox/core/extPatterns/actions","io.ox/backbone/mini-views/dropdown","io.ox/core/a11y","gettext!io.ox/core"],function(t,e,a,n,i,o){"use strict";function r(t){t.preventDefault();var e=t.data.extension,n=t.data.baton;n.e=t,a.invoke(e.ref,e,n)}function d(t){var e=t.children("li");t.children("li").each(function(t,a){(a=$(a)).hasClass("dropdown-description")&&(t-1>=1&&!a.prev().prev().hasClass("divider")&&$(e[t-1]).before('<li class="divider" role="separator">'),t!==e.length-1&&(a.next().hasClass("divider")||a.after('<li class="divider" role="separator">')))})}function s(t){var e="",a=$('<li class="divider" role="separator">'),n=$('<li class="dropdown-header">');t.children("li").each(function(){var t=$(this),i=t.children("a"),o=i.attr("data-section"),r=i.attr("data-section-description");void 0!==o&&(""!==e&&e!==o&&(t.before(a.clone()),r&&t.before(n.clone().text(r))),e=o)})}var l=function(t,e,a){if(this.attr("data-described")||!!e.description){if(!e.description)return d(this);var n=e.ref.replace(/\//g,"-")+"-descr";a.attr("aria-describedby",n),a.parent().addClass("has-dropdown-description"),this.append($("<li>").attr({id:n,"data-section":e.ref,role:"presentation",class:"dropdown-header dropdown-description"}).text(e.description).on("click",{baton:t,extension:e},r)),this.attr("data-described",!0),d(this)}},c=function(t,e,n,i){return a.applyCollection(t.ref,e,n,i)},u=function(e,a,n,i,o,r){var d=(i=t.Baton.ensure(i)).$el||$('<ul class="list-unstyled" role="toolbar">').addClass(e.classes||"").attr(e.attributes||{}).appendTo(n),s=$('<li role="presentation">');return c(e,a,i,o).always(function(t){var e=0;_(t).each(function(t){var a=t.link;!1===t.state?_.isFunction(a.drawDisabled)&&(a.drawDisabled.call(r?s.clone().appendTo(d):d,i),e++):_.isFunction(a.draw)&&(a.draw.call(r?s.clone().appendTo(d):d,i),e++)}),d.find("li > a").attr("tabindex",-1),d.find("li > a:first").attr("tabindex",0),0===e&&d.addClass("empty").removeAttr("role")}).pipe(function(){return d})},p=function(e,a,n,i,o,r){i=t.Baton.ensure(i);var d=$('<div class="btn-group">'),s=$('<nav role="presentation">').append(d).appendTo(n);return e.attributes&&s.attr(e.attributes),e.classes&&s.addClass(e.classes),c(e,a,i,o).always(function(t){var e=0;_(t).each(function(t){var a=t.link;!1===t.state?_.isFunction(a.drawDisabled)&&(a.drawDisabled.call(r?$("<li>").appendTo(d):d,i),e++):_.isFunction(a.draw)&&(a.draw.call(r?$("<li>").appendTo(d):d,i),e++)}),0===e&&d.addClass("empty")}).then(function(){return d})},f=function(t,a,n,i){var o;(i=this.data("ul")||i)&&(i.find('[data-action="close-menu"]')&&(o=i.find('[data-action="close-menu"]').parent().clone(!0)),a.$el=i.empty(),o&&a.$el.append(o),u(t,new e(a.data),null,a,n,!0).done(function(){s(a.$el),_.device("smartphone")&&a.$el.find('[data-prio="none"]').closest("li").remove(),a.$el.parent().trigger("ready"),o&&a.$el.append(o),delete a.$el}))},h=function(t){var e=t.data.baton;e.data=e.model?e.model.toJSON():e.data,e.options.icons=!1,f.call($(this),t.data.options,e,t.data.args)},b=function(t,e){var a=e.label||t.label,i=$.makeArray(arguments),o=e.$el||$("<div>"),r=$('<ul class="dropdown-menu" role="menu">'),d=new n({el:o.addClass("dropdown").attr("role","presentation"),$toggle:$('<a href="#" role="button" data-toggle="dropdown" aria-haspopup="true">').attr({"aria-label":t.ariaLabel?t.ariaLabel:a.textContent}).append(t.icon?$('<i aria-hidden="true">').addClass(t.icon).attr("title",a.textContent):a,t.noCaret?$():$('<i class="fa fa-caret-down" aria-hidden="true">')),$ul:r});return a=_.isString(a)?$.txt(a):a,this.append(d.render().$el),o.data("ul",r),e.model?o.on("show.bs.dropdown",{options:t,baton:e,args:i},h):_.defer(f.bind(o),t,e,i,d.$ul),t.classes&&o.addClass(t.classes),t.attributes&&o.attr(t.attributes),o},m=function(t,a){var n=$.makeArray(arguments),i=$('<div class="btn-group">').addClass(t.classes).attr("data-toggle",t.radio?"buttons-radio":"").appendTo(this),o=i;return u(t,new e(a.data),o,a,n,!1),i};return{Action:a.Action,Link:function(e){ox.debug&&console.warn("Link is DEPRECATED with 7.10.2 (io.ox/core/extPatterns/links.js)",e),_.extend(this,e);var n=this,i={a:$("<a>"),i:$("<i>")},o=function(t){t.preventDefault();var e=$(this),n=e.data("baton"),i=e.data("ref");n.e=t,a.invoke(i,this,n,t),_.defer(function(){e.tooltip("hide")})},r=function(t){var a=_.device("smartphone")?n.mobile:n.prio,o=n.icon&&!1!==t.options.icons,r=n.title||n.label,d={href:"#","data-action":n.id,draggable:e.draggable||!1,role:n.role||"menuitem","data-section":n.section||"default","data-section-description":n.sectionDescription||n.sectionTitle,"data-prio":_.device("smartphone")?n.mobile||"none":n.prio||"lo","data-ref":n.ref,tabindex:-1},s=i.a.clone().addClass(n.cssClasses||"io-ox-action-link");!e.draggable&&_.device("firefox")&&(d.ondragstart="return false;"),o&&"hi"===a?s.append(i.i.clone().addClass(n.icon).attr("aria-hidden","true")):r&&s.append($.txt(r)),o&&s.addClass("no-underline");var l=n.toolTip&&"hi"===a&&_.device("!smartphone");return l&&_.extend(d,{title:n.toolTip,"data-toggle":"tooltip","data-placement":"bottom","data-animation":"false","data-container":"body","aria-label":n.toolTip}),s.attr(d),l&&s.tooltip({trigger:"hover"}).on("dispose",function(){$(this).tooltip("destroy")}),s};this.draw=this.draw||function(e){e=_.clone(t.Baton.ensure(e));var a=r(e);this.append(a.data({ref:n.ref,baton:e}).click(o)),n.customize&&n.customize.call(a,e)},!0===this.drawDisabled&&(this.drawDisabled=function(t){var e=r(t);this.append(e.tooltip("destroy").addClass("disabled").attr("aria-disabled",!0)),n.customize&&n.customize.call(e,t)})},Button:function(e){_.extend(this,e);var n,i=this,o=e.tagtype?e.tagtype:"a",r=function(t){if(n.hasClass("io-ox-busy"))return!1;t.preventDefault();var e=t.data.extension;t.data.baton.e=t,a.invoke(e.ref,e,t.data.baton)};this.draw=function(e){e=t.Baton.ensure(e);var a={href:"#",role:"button",class:"btn btn-default","data-action":i.id};"button"===o&&(a.type="button"),this.append(n=$("<"+o+">",a).addClass(i.cssClasses).css(i.css||{}).on("click",{extension:i,baton:e},r).append(_.isString(i.label)?$.txt(i.label):$()).append(_.isString(i.icon)?$("<i>").addClass(i.icon):$()))},this.busy=function(){n.busy()},this.idle=function(){n.idle()}},ActionLink:function(e,a){a=a||{},a=_.extend({ref:e+"/"+a.id,draw:function(e){var n;e=t.Baton.ensure(e),this.append($('<li role="presentation">').append(n=$('<a href="#" role="menuitem">').attr("data-action",a.ref).text(a.label).on("click",{baton:e,extension:a},r))),l.call(this,e,a,n)}},a),t.point(e).extend(a)},ToolbarButtons:function(a){var n=_.extend(this,a);this.draw=function(a){var i=$.makeArray(arguments);a=t.Baton.ensure(a),u(n,new e(a.data),this,a,i),this.children("a").addClass("btn btn-primary"),this.children(".dropdown").children("a").addClass("btn btn-primary")}},ToolbarLinks:function(a){var n=_.extend(this,a);this.draw=function(a){var i=$.makeArray(arguments);a=t.Baton.ensure(a),u(n,new e(a.data),this,a,i)}},InlineLinks:function(a){function i(t,e){var a=_.isArray(t.data)&&t.data.length>1,i=e.children(),d=i.children().filter('[data-prio="lo"]').parent(),l=i.children().filter('[data-prio="hi"]').parent(),c=d.find("a"),u=c.length===c.filter(".disabled").length,p=_.device("smartphone");if(l.length>0&&!u&&l.find("a").attr("role","button"),p&&i.children().filter('[data-prio="none"]').parent().remove(),d.length>1&&!u&&(!a||!0===r.dropdown)&&!1!==r.dropdown){var f=$('<a href="#" class="io-ox-action-link" draggable="false" role="button" data-toggle="dropdown" data-action="more" aria-haspopup="true" tabindex="-1">').attr("data-original-title",o(p?"Actions":"More actions")).append(p&&!r.compactDropdown?$().add($.txt(o("Actions"))).add($('<i class="fa fa-caret-down" aria-hidden="true">')):$('<span class="sr-only">').text(o("Actions")).add($('<i class="fa fa-bars" aria-hidden="true">'))),h=$('<ul class="dropdown-menu pull-right" role="menu">').attr("aria-label",o(p?"Actions":"More")).append(d);e.append(new n({tagName:"li",attributes:{role:"presentation"},$ul:h,$toggle:f}).render().$el),_.device("IE")&&h.on("wheel",function(t){t.preventDefault(),t.stopPropagation(),this.scrollTop=this.scrollTop+t.originalEvent.deltaY}),p||f.attr({"data-placement":"bottom","data-animation":"false","data-container":"body"}).tooltip({trigger:"hover"}).parent().on("shown.bs.dropdown dispose",function(){$(this).children("a").tooltip("destroy")}),_.device("firefox")&&f.attr("ondragstart","return false;"),s(e.find("ul"))}u&&d.hide(),r.customizeNode&&r.customizeNode(e),r.customize&&r.customize.call(e,t),t.$.positionDummy&&(t.$.positionDummy.before(e.children()),t.$.positionDummy.remove(),delete t.$.positionDummy),i=d=null}ox.debug&&console.warn("InlineLinks is DEPRECATED with 7.10.2 (io.ox/core/extPatterns/links.js)",a);var r=_.extend(this,{classes:"io-ox-inline-links",attributes:{"aria-label":o("Inline menu %1$s",a.title||"")}},a);this.draw=function(a){(a=t.Baton.ensure(a)).$el&&(a.$.temp=$("<div>"),a.$.positionDummy=$('<div class="position-dummy">').hide(),a.$el.append(a.$.positionDummy));var n=u(r,new e(a.data),a.$.temp||this,a,$.makeArray(arguments),!0);return r.noLfo?n.done(_.partial(i,a)):n.done(_.lfo(!0,i,a)),delete a.$.temp,delete a.$el,n}},InlineButtonGroup:function(a){var n=_.extend(this,{classes:"io-ox-inline-buttongroup"},a);this.draw=function(i){i=t.Baton.ensure(i),p(n,new e(i.data),this,i,$.makeArray(arguments)).done(function(t){a.customizeNode&&a.customizeNode(t)})}},Dropdown:function(e){ox.debug&&console.warn("Dropdown is DEPRECATED with 7.10.2 (io.ox/core/extPatterns/links.js)",e);var a=_.extend(this,e);this.draw=function(e){return e=t.Baton.ensure(e),b.call(this,a,e)}},DropdownLinks:function(t,a,n){return ox.debug&&console.warn("DropdownLinks is DEPRECATED with 7.10.2 (io.ox/core/extPatterns/links.js)",t),t=t||{},a.$el=$('<ul class="dropdown-menu" role="menu">'),n=!!_.defaultValue(t.wrap,!0),u(t,new e(a.data),null,a,[],n).done(function(){a.$el&&(t.emptyCallback&&a.$el.hasClass("empty")&&t.emptyCallback(),s(a.$el))}),a.$el},ButtonGroup:function(e,a){var n=a||{};n.ref=e+"/"+n.id,t.point(e).extend(_.extend({ref:n.ref,draw:function(e){e=t.Baton.ensure(e),m.call(this,n,e)}},n))},ActionGroup:function(){function a(t){t.preventDefault()}function n(t,n){var i,o,d,s=$.makeArray(arguments),l=[];return this.append(d=$('<li class="toolbar-button dropdown">').append(i=$('<a href="#" data-toggle="dropdown" title="">').attr("data-ref",t.ref).addClass(t.addClass).append(t.icon()),o=$('<ul class="dropdown-menu dropdown-right-side" role="menu">'))),c(t,new e(n.data),n,s).then(function(t){return _.chain(t).filter(function(t){return t.state}).pluck("link").value()}).done(function(e){e.length>1?(_(e).chain().filter(function(t){return _.isFunction(t.draw)}).each(function(t){l.push(t.label),t.draw.call(o,n)}),i.attr({title:t.label||l.join(", "),"aria-label":t.label||l.join(", "),role:"menuitem","aria-haspopup":!0}),d.attr("role","toolbar"),t.label&&o.append($('<li class="dropdown-footer">').text(t.label))):(i.removeAttr("data-toggle"),o.remove(),1===e.length?(i.attr({title:e[0].label||"","aria-label":e[0].label||"",role:"menuitem","data-animation":"false","data-placement":"right","data-container":"body"}).on("click",{baton:n,extension:e[0]},r),_.device("touch")||i.tooltip({trigger:"hover"})):i.addClass("disabled").attr("aria-disabled",!0).on("click",a))})}function i(){return $('<i class="fa fa-magic" aria-hidden="true">')}return function(e,a){a=a||{},a=_.extend({ref:e+"/"+(a.id||"default"),icon:i,draw:function(e){e=t.Baton.ensure(e),n.call(this,a,e)}},a),t.point(e).extend(a)}}()}});