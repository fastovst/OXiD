define("io.ox/core/folder/actions/add",["io.ox/core/folder/api","io.ox/backbone/views/modal","io.ox/core/extensions","io.ox/core/notifications","io.ox/core/capabilities","gettext!io.ox/core"],function(e,t,o,n,i,r){"use strict";function d(t,i,r){var d=!1;return o.point("io.ox/core/filename").invoke("validate",null,r,"folder").find(function(e){if(!0!==e)return n.yell("warning",e),d=!0}),d?$.Deferred().reject():e.create(t,{title:$.trim(r),module:i}).fail(n.yell)}function a(e,o){var n=$.Deferred();return new t({async:!0,context:{folder:e,module:o.module,supportsPublicFolders:o.supportsPublicFolders},enter:"add",focus:'input[name="name"]',previousFocus:$(document.activeElement),help:"ox.appsuite.user.sect.dataorganisation.folder.html",point:"io.ox/core/folder/add-popup",width:_.device("smartphone")?window.innerWidth-30:400}).inject({addFolder:d,getTitle:function(){var e=this.context.module;return r("event"===e?"Add new calendar":"contacts"===e?"Add new address book":"Add new folder")},getName:function(){var e=this.context.module;return r("event"===e?"New calendar":"contacts"===e?"New address book":"New folder")},getLabel:function(){var e=this.context.module;return r("event"===e?"Calendar name":"contacts"===e?"Address book name":"Folder name")}}).extend({title:function(){this.$(".modal-title").text(this.getTitle())},name:function(){var e=_.uniqueId("label_");this.$body.append($('<div class="form-group">').append($('<label class="sr-only">').text(this.getLabel()).attr("for",e),$('<input type="text" name="name" class="form-control">').attr({id:e,placeholder:this.getName()})))},checkbox:function(){if(this.context.supportsPublicFolders){var e=r("event"===this.context.module?"Add as public calendar":"Add as public folder"),t=_.uniqueId("form-control-label-");this.$body.append($('<div class="form-group checkbox">').append($("<label>").attr("for",t).append($('<input type="checkbox" name="public">').attr("id",t),$.txt(e))),$('<div class="help-block">').text(r("A public folder is used for content that is of common interest for all users. To allow other users to read or edit the contents, you have to set the respective permissions for the public folder.")))}}}).addCancelButton().addButton({action:"add",label:r("Add")}).on({add:function(){var t=this.$('input[name="name"]').val(),o=this.$('input[name="public"]').prop("checked");this.busy(!0),this.addFolder(o?"2":e,this.context.module,t).then(n.resolve.bind(n)).then(this.close,this.idle).fail(this.idle)},close:n.reject.bind(n),open:function(){this.$('input[name="name"]').val(this.getName()).focus().select()}}).open(),n}return function(t,o){if(o=o||{},!t||!o.module)return $.Deferred().reject();var n=/^(contacts|event|tasks)$/.test(o.module)&&i.has("edit_public_folders");return $.when(n?e.get("2"):void 0).then(function(n){return n&&(o.supportsPublicFolders=e.can("create:folder",n)),a(String(t),o)})}});