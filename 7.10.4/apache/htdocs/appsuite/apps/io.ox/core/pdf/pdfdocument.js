define("io.ox/core/pdf/pdfdocument",["io.ox/core/pdf/pdfview","io.ox/core/viewer/util","pdfjs-dist/build/pdf","settings!io.ox/core"],function(e,t,r,n){"use strict";return function(i){function o(t){var r=$.Deferred();return _.isNumber(t)&&t>0&&t<=c&&s.getPDFJSPage(t).then(function(t){var n=t.getViewport({scale:e.getAdjustedZoom(1)});return r.resolve(e.getNormalizedSize({width:n.width,height:n.height}))}),r.promise()}var s=this,a=$.Deferred(),u=null,c=0,g=null,d=[],f=!1!==n.get("pdf/enableRangeRequests"),l={url:i,disableRange:!f,disableStream:!f,disableAutoFetch:!f,verbosity:r.VerbosityLevel.ERRORS,cMapUrl:ox.abs+ox.root+"/apps/pdfjs-dist/cmaps/",cMapPacked:!0};this.destroy=function(){u&&u.destroy()},this.getLoadPromise=function(){return a.promise()},this.getPDFJSDocument=function(){return u},this.getPDFJSPage=function(e){return u.getPage(e)},this.getPageCount=function(){return c},this.getDefaultPageSize=function(){return g},this.getOriginalPageSize=function(e){var t=null;return c>0&&_.isNumber(e)&&e>0&&e<=c&&(t=d[e-1]),t||g},r.getDocument(l).promise.then(function(e){var r=!0,n=e&&e.transport&&e.transport.getPage;t.logPerformanceTimer("PDFDocument:PDFJs_getDocument_then_handler"),n&&(e.transport.getPage=function(t,r){return e.transport.messageHandler?n.call(this,t,r):Promise.reject()}),e&&(c=(u=e).numPages)>0&&(r=!1,o(1).then(function(e){return d[0]=g=e,a.resolve(c)})),r&&a.resolve({cause:"importError"})},function(){var e=i+"&enctest=pdf";$.ajax({url:e,dataType:"json"}).always(function(e){a.resolve(_.isObject(e)&&_.isString(e.cause)?e:{cause:"filterError"})})})}});