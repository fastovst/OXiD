define("io.ox/core/tk/nodetouch",[],function(){"use strict";function a(a,t){var e={threshold:3,tapTime:250,tapInterval:300,maxTapCount:2,horSwipeThreshold:100,horSwipeStrict:!0,horSwipePreventDefault:!0},n=$.extend({},e,t),o=t&&t.selector;n.taps=0,n.horSwipeDetected=!1,n.horSwipePossible=!0,a.on("touchstart",o,n,p).on("touchend",o,n,h).on("touchmove",o,n,l).on("touchcancel",o,n,c)}function t(a){a.off("touchstart touchend touchmove touchcancel")}function e(a,t,e,n){var o=0,i=0;return o=e-a,o*=o,i=n-t,i*=i,Math.sqrt(o+i)}function n(a){a.data.delayedTapId&&(clearTimeout(a.data.delayedTapId),a.data.delayedTapId=null)}function o(a){a.data.delayedTapId=null,a.data.tapHandler(a,a.data.taps)}function i(a){n(a),a.data.tapTimeStart=a.data.tapTimeLast=null,a.data.taps=0}function d(a){a.data.pinchHandler&&a.data.pinchHandler("cancel")}function r(a){a.data.horSwipeDetected=!1,a.data.horSwipePossible=!1,a.data.horSwipeHandler&&!1===a.data.horSwipeStrict&&a.data.horSwipeHandler("cancel")}function s(a,t){if("cancel"===a)i(t),d(t),r(t);else if(t){var s=t.originalEvent.touches.length;if(t.data.tapHandler)if("start"===a&&n(t),0===s){if("end"===a){var p=Date.now();p-t.data.tapTimeStart<=t.data.tapTime&&Math.abs(e(t.data.tapPosX1,t.data.tapPosY1,t.data.tapPosX2,t.data.tapPosY2))<=t.data.threshold?(t.data.taps++,1!==t.data.taps&&t.data.tapTimeStart-t.data.tapTimeLast>t.data.tapInterval&&(t.data.taps=1),t.data.maxTapCount===t.data.taps?(t.data.tapHandler(t,t.data.taps),t.data.taps=0):t.data.delayedTapId=setTimeout(function(){o(t)},t.data.tapInterval),t.data.tapTimeLast=p):i(t)}}else 1===s&&("start"===a?(t.data.tapTimeStart=Date.now(),t.data.tapPosX2=t.data.tapPosX1=t.originalEvent.touches[0].pageX,t.data.tapPosY2=t.data.tapPosY1=t.originalEvent.touches[0].pageY):"move"===a&&(t.data.tapPosX2=t.originalEvent.touches[0].pageX,t.data.tapPosY2=t.originalEvent.touches[0].pageY));if(t.data.horSwipeHandler)if(0===s)"end"===a?t.data.horSwipeDetected&&t.data.horSwipePossible&&(t.data.horSwipeHandler(a,t,t.data.lastHorDistance),t.data.horSwipePreventDefault&&t.preventDefault()):r(t);else if(1===s)if("start"===a)t.data.swipeX=t.originalEvent.touches[0].pageX,t.data.swipeY=t.originalEvent.touches[0].pageY,t.data.lastHorDistance=0,t.data.horSwipeDetected=!1,t.data.horSwipePossible=!0;else if("move"===a){if(t.data.horSwipePossible){var c=t.originalEvent.touches[0].pageX-t.data.swipeX,l=Math.abs(c);t.data.horSwipeDetected||(t.data.horSwipeDetected=l>=t.data.horSwipeThreshold),t.data.horSwipeDetected&&(t.data.horSwipeStrict?(t.data.lastHorDistance<0&&t.data.lastHorDistance<c||t.data.lastHorDistance>0&&t.data.lastHorDistance>c)&&(t.data.horSwipePossible=t.data.horSwipeDetected=!1):(t.data.horSwipeHandler(a,t,c),t.data.horSwipePreventDefault&&t.preventDefault()),t.data.lastHorDistance=c)}}else r(t);else r(t);t.data.pinchHandler&&(2!==s||"start"!==a&&"move"!==a?1===s&&"end"===a?t.data.pinchHandler(a,t):t.data.pinchHandler("cancel",t):(t.data.pinchHandler(a,t,e(t.originalEvent.touches[0].pageX,t.originalEvent.touches[0].pageY,t.originalEvent.touches[1].pageX,t.originalEvent.touches[1].pageY),{x:(t.originalEvent.touches[0].pageX+t.originalEvent.touches[1].pageX)/2,y:(t.originalEvent.touches[0].pageY+t.originalEvent.touches[1].pageY)/2}),t.preventDefault()))}}function p(a){s("start",a)}function c(a){s("cancel",a)}function l(a){s("move",a)}function h(a){s("end",a)}$.fn.enableTouch=function(e){return t(this),a(this,e),this},$.fn.disableTouch=function(){return t(this),this}});