define("io.ox/core/tk/list-control",["io.ox/core/tk/list","io.ox/core/extensions"],function(i,t){"use strict";function e(i,t,e){void 0===t?i.settings.remove("listview/"+e+"/"+_.display()):i.settings.set("listview/"+e+"/"+_.display(),t),i.settings.save()}function s(i,t){return"function"==typeof i&&(i=i()),i<0&&(i+=t),i}function o(){return _.chain(arguments).toArray().compact().min().value()}var n=Backbone.View.extend({className:"abs list-view-control",events:{"mousedown .resizebar:not(.vertical)":"onResize","mousedown .resizebar.vertical":"onVerticalResize"},applySizeConstraints:function(){if("list"!==this.listView.app.props.get("layout")&&this.$el.is(":visible")){var i=this.$el.parent(),t=i.siblings(".rightside"),a=i.parent(),r=this.$(".resizebar.vertical").is(":visible");if(0!==t.length){var h=r?o(i.height()+t.height(),a.height()):o(i.width()+t.width(),a.width()),l=s(r?n.minHeight:n.minWidth,h),d=s(r?n.maxHeight:n.maxWidth,h),c=r?i.height():i.width(),p=Math.max(l,Math.min(c,d));r&&i.height()===p||!r&&i.width()===p||(i.css(r?"height":"width",p),t.css(r?"top":"left",p),e(this.listView.app,p,r?"height":"width"))}}},onResize:function(i){i.preventDefault();var t,o=this.$el.parent(),a=o.siblings(".rightside"),r=i.pageX-o.width(),h=o.width()+a.width(),l=s(n.minWidth,h),d=s(n.maxWidth,h),c=this.listView.app;0!==a.length&&$(document).on({"mousemove.resize":function(i){t=Math.max(l,Math.min(i.pageX-r,d)),o.css("width",t),a.css("left",t)},"mouseup.resize":function(){$(this).off("mousemove.resize mouseup.resize").trigger("resize"),e(c,t,"width")}})},onVerticalResize:function(i){i.preventDefault();var t,o=this.$el.parent(),a=o.siblings(".rightside"),r=i.pageY-o.height(),h=o.height()+a.height(),l=s(n.minHeight,h),d=s(n.maxHeight,h),c=this.listView.app;0!==a.length&&$(document).on({"mousemove.resize":function(i){t=Math.max(l,Math.min(i.pageY-r,d)),o.css("height",t),a.css("top",t)},"mouseup.resize":function(){$(this).off("mousemove.resize mouseup.resize").trigger("resize"),e(c,t,"height")}})},resizable:function(){if(!_.device("touch")){this.$el.append('<div class="resizebar">'),this.$el.append('<div class="resizebar vertical">');var i=this.listView.app.getWindow();$(window).on("resize.list-control-"+i.id,_.debounce(this.applySizeConstraints.bind(this),100)),i.one("beforequit",function(){$(window).off("resize.list-control-"+i.id)})}},initialize:function(i){this.listView=i.listView,this.id=i.id||"default",this.options=i},render:function(){var i=$('<ul class="toolbar generic-toolbar top" role="toolbar">'),e=t.point(this.id+"/list-view/toolbar/top"),s=$('<ul class="toolbar generic-toolbar visual-focus bottom" role="toolbar">'),o=t.point(this.id+"/list-view/toolbar/bottom"),n=new t.Baton({view:this,app:this.options.app});return e.list().length&&(this.$el.addClass("toolbar-top-visible"),e.invoke("draw",i,n)),o.list().length&&_.device("!smartphone")&&(this.$el.addClass("toolbar-bottom-visible"),o.invoke("draw",s,n)),this.$el.attr({role:"navigation"}).append(i,this.listView.render().$el.addClass("abs"),s),this}});return n.minWidth=270,n.maxWidth=-250,n.minHeight=150,n.maxHeight=-100,n});