!function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=(n=t.attr("href"))&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var o=n&&e(n);return o&&o.length?o:t.parent()}function n(n){n&&3===n.which||(e(".dropdown-backdrop").remove(),i&&(e("#io-ox-core").removeClass("menu-blur"),e('.dropdown-menu:not([dontProcessOnMobile="true"])').hide(),ox.idle()),e('[data-toggle="dropdown"]').each(function(){var o=e(this),r=t(o),d={relatedTarget:this};if(r.hasClass("open")){var s=n?n.type:null;if(!("click"===s&&/input|textarea/i.test(n.target.tagName)&&e.contains(r[0],n.target)||(r.trigger(n=e.Event("hide.bs.dropdown",d)),n.isDefaultPrevented()||"true"===r.attr("forceOpen")))){var c=e(document.activeElement).filter('.editable, input[type="text"], input[type="textarea"], input[type="email"]');a&&(!i&&"click"===s&&c.length?c.focus():a.focus()),o.attr("aria-expanded",!1),r.removeClass("open").trigger(e.Event("hidden.bs.dropdown",d))}}}))}function o(){return e('<li><a href="#" class="io-ox-action-link" data-action="close-menu" data-i18n="Close">'+r+"</a></li>").on("click",function(e){return e.preventDefault(),n(),!1})}var a,i=_.device("smartphone");e.fn.dropdown=function(t){return this.each(function(){var n=e(this);n.attr("data-toggle","dropdown"),"toggle"===t&&n.trigger("click")})};var r;e(document).one("dropdown:translate",function(e,t){r=t}),e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",'[data-toggle="dropdown"]',function(r,d){var s=e(this),c=t(s),l=!!c.attr("dontProcessOnMobile"),u=c.hasClass("open");if(!s.is(".disabled, :disabled")){if(i&&!l){var p=c.find("ul");if(p.length>0)0===p.children().length?setTimeout(function(){var t=p.is(":visible");"foldertree"!==d&&p.append(o()),e("body").append(p.addClass("custom-dropdown")),t&&p.show()},50):("foldertree"!==d&&p.append(o()),e("body").append(p.addClass("custom-dropdown"))),c.data("menu",p);else{var f=c.data("menu");f.find('[data-action="close-menu"]').parent().is(":last-child")||f.find('[data-action="close-menu"]').parent().appendTo(f),0===f.find('[data-action="close-menu"]').length&&setTimeout(function(){f.append(o())},50)}c.data("menu").find(".divider").remove()}if(!r||c[0]===r.target&&this!==r.target||c.attr("forceOpen",!1),n(),!u){"ontouchstart"in document.documentElement&&!c.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",n);var h={relatedTarget:s.get(0)};if(c.trigger(r=e.Event("show.bs.dropdown",h)),a=e(this),r.isDefaultPrevented())return;s.attr("aria-expanded",!0),c.toggleClass("open").trigger(e.Event("shown.bs.dropdown",h)),i&&!l&&(ox.disable(!0),e("#io-ox-core").addClass("menu-blur"),c.data("menu").show()),s.focus()}return!1}}).on("keydown.bs.dropdown.data-api",'[data-toggle="dropdown"]',function(o){if(27===o.which)return n();if(/(13|32|38|40)/.test(o.which)){var a=e(o.target),i=t(a),r=a.siblings("ul");return i.hasClass("open")?void 0:(/(13|32)/.test(o.which)||a.trigger("click"),void require(["io.ox/core/a11y"],function(e){_.defer(function(){var t=e.getTabbable(r);/(13|32|40)/.test(o.which)&&t.first(":visible").focus(),38===o.which&&t.last(":visible").focus()})}))}}).on("keydown.bs.dropdown.data-api",".dropdown-menu",function(t){if(27===t.which)return n();if(/(38|40)/.test(t.which)){t.preventDefault();var o=e(t.target),a=o.closest("ul").find('a:visible[role^="menuitem"]'),i=a.index(o);38===t.which&&i--,40===t.which&&i++,i<0&&(i+=a.length),i>=a.length&&(i-=a.length),_.defer(function(){a.eq(i).focus()})}}).on("keydown.bs.dropdown.data-api","[role=menu]",function(t){var n=e(t.target);32===t.which&&n.is("a")&&n.click()}).on("focusout.dropdown.data-api",".dropdown-menu",function(){var t=this;_.defer(function(){e.contains(t,document.activeElement)||n()})}),e(window).on("resize",_.throttle(function(e){e.originalEvent&&!_.device("smartphone && android")&&n(e)},200))}(jQuery);