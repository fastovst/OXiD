define("io.ox/core/viewer/main",["io.ox/core/extensions","io.ox/core/capabilities","gettext!io.ox/core","io.ox/core/viewer/util"],function(e,i,n,o){"use strict";return function(){this.launch=function(t){function r(){return!_.isEmpty(t.folder)&&"10"!==t.folder}function a(){return _.isArray(t.files)&&t.files.length>0}function s(){f.fileCollection.each(function(e){e.set("file_options",{})})}function l(){o.savePerformanceTimer(t),c.removeAttr("aria-hidden").each(function(){var e=$(this);e.data("ox-restore-aria-hidden")&&e.attr("aria-hidden",e.data("ox-restore-aria-hidden")),e.removeData("ox-restore-aria-hidden")}),"io.ox/office/presenter"!==_.url.hash("app")&&_.url.hash("id",null),t.restoreFocus&&_.isFunction(t.restoreFocus.focus)&&t.restoreFocus.focus(),f.mainView||($(d).remove(),t.app&&"running"===t.app.get("state")&&t.app.quit())}if(o.startPerformanceTimer(),!t)return console.error("Core.Viewer.main.launch(): no data supplied");if(!a()&&!r())return console.error("Core.Viewer.main.launch(): no files to preview.");var c,f=this,d=$('<div class="io-ox-viewer abs">'),u=t.container||$("#io-ox-core"),p=$('<div class="viewer-print-overlay">').append($('<div class="print-content">').append($("<span>").text(n("Sorry, there is no preview available.")),$("<span>").text(n('To print this file, please use "Print as PDF" in the viewer.')))).attr("aria-hidden",!0);u.append(d),d.append(p),c=d.siblings().each(function(){$(this).data("ox-restore-aria-hidden",d.attr("aria-hidden"))}).attr("aria-hidden",!0),(r()?require(["io.ox/files/api"]).then(function(e){return e.getAll(t.folder).then(function(i){return _.map(i,function(e){return this.get(_.cid(e))},e.pool.get("detail"))})}):$.when([].concat(t.files))).then(function(i){return t.fileList=i,e.point("io.ox/core/viewer/main").cascade(this,new e.Baton({data:t}))}).then(function(){function e(){return!!i.has("guest")||"10"===t.folder||!(!f.fileCollection.first()||"10"!==f.fileCollection.first().get("folder_id"))}o.logPerformanceTimer("launchContStart"),require(["io.ox/core/viewer/backbone","io.ox/core/viewer/views/mainview"],function(i,n){f.fileCollection=new i.Collection,f.fileCollection.reset(t.fileList,{parse:!0}),t.selection?f.fileCollection.setStartIndex(t.selection):r()&&a()&&f.fileCollection.setStartIndex(t.files[0]),f.mainView=new n({collection:f.fileCollection,el:d,app:t.app,standalone:Boolean(t.standalone),opt:t.opt||{},openedBy:t.openedBy,isSharing:e()}),f.mainView.on("dispose",l),f.mainView.viewerEvents.listenTo(f.mainView.viewerEvents,"viewer:beforeclose",s)})},l)}}});