define("io.ox/core/viewer/views/types/imageview",["io.ox/core/viewer/views/types/baseview","gettext!io.ox/core"],function(e,i){"use strict";return e.extend({initialize:function(){this.isPrefetched=!1},render:function(){var e=$('<img class="viewer-displayer-item viewer-displayer-image hidden">'),i=this.getImageSize(),t=_.extend({scaleType:"contain"},i),r=this.getPreviewUrl(t),s=this.model.get("filename")||"";return this.$el.empty(),r&&(r=_.unescapeHTML(r),e.attr({"data-src":r,alt:s}),e.on("load",this.onLoadSuccess.bind(this)),e.on("error",this.onLoadError.bind(this)),this.$el.append($('<div class="viewer-displayer-item-container">').append(e))),this},onLoadSuccess:function(){this.$el.idle(),this.$el.find("img.viewer-displayer-image").removeClass("hidden")},onLoadError:function(){var e=this.displayDownloadNotification(i("Sorry, there is no preview available for this image."));this.$el.idle().append(e)},getImageSize:function(){var e=_.device("retina"),i=$(".viewer-displayer:visible"),t=e?2*i.width():i.width(),r=e?2*i.height():i.height();return{width:Math.floor(t),height:Math.floor(r)}},getLocalFilePreviewUrl:function(){var e=this.model.get("fileObj")||this.model.get("originalFile"),i=this.getImageSize();return require(["io.ox/contacts/widgets/canvasresize"]).then(function(t){var r=_.extend({crop:!1,quality:80},i);return t(e,r)})},prefetch:function(){if(!this.isPrefetched){var e=this.$el.find("img.viewer-displayer-image");if(0!==e.length)return this.$el.busy(),"localFile"===this.model.get("group")?this.getLocalFilePreviewUrl().done(function(i){i&&e.attr("src",i)}):e.attr("src",e.attr("data-src")),e.css({maxWidth:this.$el.width()+"px",maxHeight:this.$el.height()+"px"}),this.isPrefetched=!0,this}},show:function(){return this},unload:function(){var e=this.$el.find("img.viewer-displayer-image");return e.length>0&&e.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="),this.isPrefetched=!1,this},onDispose:function(){this.unload(),this.$el.find("img.viewer-displayer-image").off(),this.$el.off()}})});