define("io.ox/core/viewer/views/sidebar/fileinfoview",["io.ox/core/viewer/views/sidebar/panelbaseview","io.ox/core/extensions","io.ox/core/folder/api","io.ox/core/api/user","io.ox/core/util","io.ox/mail/util","io.ox/core/capabilities","io.ox/core/viewer/util","settings!io.ox/core","gettext!io.ox/core/viewer"],function(e,t,i,a,o,d,n,r,s,l){"use strict";function c(e){e.preventDefault();var t=e.data.id;ox.launch("io.ox/files/main",{folder:t}).done(function(){this.folder.set(t)})}function p(e){e.preventDefault();var t=e.data.model;require(["io.ox/files/share/permissions"],function(e){e.showByModel(t)})}function m(e,t){var i=e.getDisplayName()||"-",a=t.disableLink||!1;if(!e.isDriveItem())return $.txt(i);if(a)return $.txt(i);var d=o.getDeepLink("io.ox/files",e.isFile()?e.pick("folder_id","id"):e.pick("id"));return $('<a href="#" target="_blank" style="word-break: break-all">').attr("href",d).text(i)}function f(e){var t=moment().isSame(moment(e),"day");return e?moment(e).format(t?"LT":"l LT"):"-"}return t.point("io.ox/core/viewer/sidebar/fileinfo").extend({index:100,id:"fileinfo",draw:function(e){if(e.model){var t=e.model,o=e.options||{},h=t.get("modified_by"),x=f(t.get("last_modified")),u=t.get("folder_id"),g=t.get("media")||{},v=$("<dl>"),b=!_.isEmpty(t.get("com.openexchange.file.storage.mail.mailMetadata"));if(v.append($("<dt>").text(l("Name")),$('<dd class="file-name">').append(m(t,o)),$("<dt>").text(l("Size")),$('<dd class="size">').text(r.renderItemSize(t))),b){var w=t.get("com.openexchange.file.storage.mail.mailMetadata"),k=s.get("folder/mailattachments",{});v.append($("<dt>").text(l("Folder")),$('<dd class="mail-folder">').append($("<a>").attr("href",i.getDeepLink({module:"mail",id:w.folder})).append(i.getTextNode(w.folder)).on("click",function(e){e.preventDefault(),ox.launch("io.ox/mail/main",{folder:w.folder})})),$("<dt>").text(l("Subject")),$('<dd class="subject">').append($.txt(d.getSubject(w.subject||""))),$("<dt>").text(l(u===k.sent?"To":"From")),$('<dd class="from">').append($.txt(d.getDisplayName(u===k.sent?w.to[0]:w.from[0]))),$("<dt>").text(l(u===k.sent?"Sent":"Received")),$('<dd class="received">').append($.txt(x)),$("<dt>"),$('<dd class="link">').append($("<a>").attr("href",i.getDeepLink({module:"mail",id:w.folder})).text(l("View message")).on("click",function(e){e.preventDefault(),require(["io.ox/mail/api"],function(t){var i=_.cid({folder:w.folder,id:w.id});t.get(_.extend({},{unseen:!0},_.cid(i))).done(function(a){_.device("smartphone")?require(["io.ox/core/tk/dialogs","io.ox/mail/detail/view"],function(i,o){var d=new i.SidePopup({preserveOnAppchange:!0,tabTrap:!0}),n=t.reduce(a);t.get(n).done(function(t){var i=new o.View({data:t,disable:{"io.ox/mail/detail/header/row3":"different-subject","io.ox/mail/detail/header":"picture"}});d.show(e,function(e){e.append(i.render().expand().$el.addClass("no-padding"))})})}):ox.launch("io.ox/mail/detail/main",{cid:i})}).fail(function(e){require(["io.ox/core/yell"],function(t){t(e)})})})})))}else{if(g.width&&g.height&&v.append($("<dt>").text(l("Resolution")),$('<dd class="resolution">').text(g.width+" x "+g.height)),g.camera_make&&v.append($("<dt>").text(l("Device make")),$('<dd class="camera_make">').text(g.camera_make)),g.camera_model&&v.append($("<dt>").text(l("Device model")),$('<dd class="camera_model">').text(g.camera_model)),g.camera_aperture||g.camera_exposure_time||g.camera_focal_length){var D="";g.camera_aperture&&(D=g.camera_aperture+" "),g.camera_exposure_time&&(D=D+g.camera_exposure_time+" "),g.camera_focal_length&&(D+=g.camera_focal_length),v.append($("<dt>").text(l("Shot")),$('<dd class="camera_shot">').text(D))}g.camera_iso_speed&&v.append($("<dt>").text(l("ISO")),$('<dd class="camera_iso_speed">').text(g.camera_iso_speed)),t.get("capture_date")&&v.append($("<dt>").text(l("Capture date")),$('<dd class="camera_capture_date">').text(f(t.get("capture_date")))),v.append($("<dt>").text(l("Modified")),$('<dd class="modified">').append($('<span class="modifiedAt">').text(x),$('<span class="modifiedBy">').append(document.createTextNode("â€‹")).append(a.getTextNode(h)))),o.disableFolderInfo||v.append($("<dt>").text(l("Folder")),$('<dd class="saved-in">').append($("<a>").attr("href",i.getDeepLink({module:"infostore",id:u})).append(i.getTextNode(u)).on("click",{id:u},c)));var y=t.isFile()?t.get("object_permissions")||[]:_(t.get("permissions")).filter(function(e){return e.entity!==ox.user_id});n.has("invite_guests")&&!o.disableSharesInfo&&v.append($("<dt>").text(l("Shares")),$("<dd>").append(y.length?$('<a href="#">').text(l(t.isFile()?"This file is shared with others":"This folder is shared with others")).on("click",{model:t},p):$.txt("-")))}this.find(".sidebar-panel-body").empty().append(v)}}}),e.extend({className:"viewer-fileinfo",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.options=t||{},this.closable=!!this.options.closable,this.setPanelHeader(l("Details")),this.listenTo(this.model,"change:media change:cid change:filename change:title change:com.openexchange.file.sanitizedFilename change:file_size change:last_modified change:folder_id change:object_permissions change:permissions",this.render)},render:function(){if(!this.model)return this;var e=this.model.isFile()?this.model.toJSON():this.model.get("origData"),i=t.Baton({model:this.model,data:e,options:this.options});return t.point("io.ox/core/viewer/sidebar/fileinfo").invoke("draw",this.$el,i),this.closable&&0===this.$(".sidebar-panel-heading .close").length&&this.$(".sidebar-panel-heading").prepend($('<button type="button" class="close pull-right">').attr("title",l("Hide details")).append('<i class="fa fa-times" aria-hidden="true">')),this},onDispose:function(){this.model&&(this.model=null)}})});