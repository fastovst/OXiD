define("io.ox/core/viewer/views/sidebar/filedescriptionview",["io.ox/core/viewer/views/sidebar/panelbaseview","io.ox/core/extensions","io.ox/backbone/views/actions/util","gettext!io.ox/core/viewer"],function(i,e,t,n){"use strict";var o="io.ox/core/viewer/sidebar/description";return e.point(o+"/text").extend({index:10,id:"description-text",draw:function(i){var e=this.find(".sidebar-panel-body"),t=i.data;e.empty(),_.isString(t)&&(t.length>0&&e.append($('<div class="description">',{title:n("Description text")}).text(t)),i.view.hasWritePermissions().then(function(){e.append($('<button type="button" class="btn btn-link description-button">').text(n(t.length>0?"Edit description":"Add a description")))}).fail(function(){e.parent().hide()}))}}),i.extend({className:"viewer-filedescription",events:{"click .description":"onEdit","dblclick .description":"editDescription","click button.description-button":"editDescription"},onEdit:function(i){var e=_.device("smartphone || tablet"),t=!this.model.get("description");i.preventDefault(),(e||t)&&this.editDescription()},initialize:function(){i.prototype.initialize.apply(this,arguments),this.model&&this.model.isFile()?(this.setPanelHeader(n("Description")),this.togglePanel(!0),this.listenTo(this.model,"change:description",this.render)):this.$el.hide()},render:function(){return this.model&&this.model.isFile()&&e.point(o+"/text").invoke("draw",this.$el,e.Baton({data:this.model.get("description"),view:this})),this},editDescription:function(){this.hasWritePermissions().done(function(i){t.invoke("io.ox/files/actions/edit-description",i)})},hasWritePermissions:function(){return this.model?t.checkAction("io.ox/files/actions/edit-description",this.model.toJSON()):$.Deferred().reject()},onDispose:function(){this.model&&(this.model=null)}})});