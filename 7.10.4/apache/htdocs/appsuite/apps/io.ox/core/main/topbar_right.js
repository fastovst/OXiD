define("io.ox/core/main/topbar_right",["io.ox/core/session","io.ox/core/http","io.ox/core/extensions","io.ox/core/capabilities","io.ox/core/notifications","io.ox/backbone/mini-views/helplink","io.ox/backbone/mini-views/dropdown","io.ox/backbone/mini-views/upsell","io.ox/core/main/logout","io.ox/core/main/refresh","io.ox/core/main/addLauncher","io.ox/contacts/api","io.ox/core/api/user","settings!io.ox/core","gettext!io.ox/core"],function(e,o,t,n,i,r,a,d,c,s,p,l,u,h,g){function x(){var e=ox.ui.App.getCurrentFloatingApp()||ox.ui.App.getCurrentApp();return e&&e.getContextualHelp?e.getContextualHelp():_.extend({base:"help",target:"index.html"},e&&e.get("help"))}t.point("io.ox/core/appcontrol/right").extend({id:"upsell",index:50,draw:function(){if(!_.device("smartphone")){var e=new d({tagName:"li",className:"launcher",id:"secondary-launcher",requires:"active_sync || caldav || carddav",customize:function(){$("i",this.$el).addClass("launcher-icon")}});e.visible&&this.append(e.render().$el)}}}),t.point("io.ox/core/appcontrol/right").extend({id:"notifications",index:100,draw:function(){if(n.has("webmail")||n.has("calendar")||n.has("tasks")){var e=this;ox.online?e.append(i.attach(5e3)):ox.once("connection:online",function(){e.append(i.attach(5e3))})}}}),t.point("io.ox/core/appcontrol/right").extend({id:"search-mobile",index:150,draw:function(){n.has("search")&&_.device("smartphone")&&this.append(p("right",$('<i class="fa fa-search launcher-icon" aria-hidden="true">'),function(){require(["io.ox/search/main"],function(e){e.run({reset:!0})})},g("Search")).attr("id","io-ox-search-topbar-icon"))}}),t.point("io.ox/core/appcontrol/right").extend({id:"refresh",index:200,draw:function(){function e(){var e=parseInt(h.get("refreshInterval",3e5),10)/6e4;return o.attr("title",g("Refresh. Current interval (%1$s min) can be customized in settings.",e))}if(!_.device("smartphone")){var o=$('<i class="fa fa-refresh launcher-icon" aria-hidden="true">');this.append(p("right",o,function(){return s(),$.when()},g("Refresh")).attr("id","io-ox-refresh-icon")),e(),h.on("change:refreshInterval",e)}}}),t.point("io.ox/core/appcontrol/right").extend({id:"help",index:300,draw:function(){if(!_.device("smartphone")){var e=new r({iconClass:"fa-question launcher-icon",href:x});e.$el.hasClass("hidden")||this.append(p("right",e.render().$el.attr("tabindex",-1)).attr("id","io-ox-context-help-icon"))}}}),t.point("io.ox/core/appcontrol/right").extend({id:"settings",index:400,draw:function(){_.device("smartphone")||this.append(p("right",$('<i class="fa fa-cog launcher-icon" aria-hidden="true">').attr("title",g("Settings")),function(){ox.launch("io.ox/settings/main")},g("Settings")).attr("id","io-ox-settings-topbar-icon"))}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"upsell",index:50,extend:function(){var e=new d({tagName:"li",id:"topbar-dropdown",requires:"active_sync || caldav || carddav",title:g("Upgrade your account"),customize:function(){$("i",this.$el).css({width:"auto"})}});e.visible&&(this.append(e.render().$el),this.divider())}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"refreshMobile",index:80,extend:function(){_.device("smartphone")&&this.link("refresh-mobile",g("Refresh"),function(e){return e.preventDefault(),s(),$.when()})}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"settingsMobile",index:90,extend:function(){_.device("smartphone")&&this.link("settings-mobile",g("Settings"),function(e){return e.preventDefault(),ox.launch("io.ox/settings/main")})}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"onboarding",index:120,extend:function(){if(!n.has("!client-onboarding")){var e,o,t=this;_.device("android")&&(e=_.device("smartphone")?"android.phone":"android.tablet"),_.device("ios")&&(e=_.device("smartphone")?"apple.iphone":"apple.ipad"),t.append(o=$('<a href="#" data-app-name="io.ox/settings" data-action="client-onboarding" role="menuitem" tabindex="-1">').text(g(_.device("desktop")?"Connect your Device":"Connect this Device"))),require(["io.ox/onboarding/clients/api"],function(t){t.enabledDevices(e).then(function(t){var n=!!_.device("desktop")||(t[e]||!1);o.toggleClass("disabled ui-disabled",!n).attr("aria-disabled",!n).on("click",function(e){if(e.preventDefault(),!n)return e.stopPropagation();require(["io.ox/onboarding/clients/wizard"],function(e){e.run()})})})})}}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"change-user-data",index:150,extend:function(){!1!==h.get("user/internalUserEdit",!0)&&this.link("my-contact-data",g("My contact data"),function(e){e.preventDefault(),require(["io.ox/core/settings/user"],function(e){e.openModalDialog()})})}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"change-user-password",index:175,extend:function(){n.has("edit_password && guest")&&this.link("change-password",g(h.get("password/emptyCurrent")?"Add login password":"Change login password"),function(e){e.preventDefault(),require(["plugins/portal/userSettings/register"],function(e){e.changePassword()})})}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"app-specific-help",index:200,extend:function(){var e=new r({attributes:{role:"menuitem",tabindex:-1},content:g("Help"),href:x});this.divider(),e.$el.hasClass("hidden")||this.append(e.render().$el)}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"divider-before-about",index:290,extend:function(){this.divider()}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"about",index:400,extend:function(){this.link("about",g("About"),function(e){e.preventDefault(),require(["io.ox/core/about/about"],function(e){e.show()})})}}),t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"logout",index:1e3,extend:function(){this.divider(),t.point("io.ox/core/appcontrol/right/dropdown/signouts").invoke("extend",this)}}),t.point("io.ox/core/appcontrol/right/dropdown/signouts").extend({id:"logout",index:100,extend:function(){this.link("logout",g("Sign out"),function(e){e.preventDefault(),c({manualLogout:!0})})}}),t.point("io.ox/core/appcontrol/right").extend({id:"dropdown",index:1e3,draw:function(){function e(){i.empty().append(l.pictureHalo($('<div class="contact-picture" aria-hidden="true">').attr("title",o).append(u.getTextNode(ox.user_id,{type:"initials"})),{internal_userid:ox.user_id},{width:40,height:40,fallback:!1}))}var o=g(ox.openedInBrowserTab?"Sign out":"Support"),n=$('<ul id="topbar-settings-dropdown" class="dropdown-menu dropdown-menu-right" role="menu">'),i=$('<a href="#" class="dropdown-toggle f6-target" data-toggle="dropdown" tabindex="-1">').attr("aria-label",o),r=new a({attributes:{role:"presentation"},tagName:"li",id:"io-ox-topbar-dropdown-icon",className:"launcher dropdown",$ul:n,$toggle:i});e(),t.point("io.ox/core/appcontrol/right/dropdown").invoke("extend",r),this.append(r.render().$el.find("a").attr("tabindex",-1).end()),l.on("reset:image update:image",e),u.on("reset:image:"+ox.user_id+" update:image:"+ox.user_id,e),u.on("update",e)}}),!0===h.get("features/dedicatedLogoutButton",!1)&&_.device("!small")&&t.point("io.ox/core/appcontrol/right").extend({id:"logout-button",index:2e3,draw:function(){var e=p("right",$('<i class="fa fa-sign-out launcher-icon" aria-hidden="true">'),function(){c({manualLogout:!0})},g("Sign out"));e.find("a").attr("data-action","sign-out").tooltip({title:g("Sign out"),placement:function(e,o){return $(window).width()-$(o).offset().left-o.offsetWidth<80?"left":"auto"}}),this.append(e)}}),function(){var o=_.clone(h.get("features/logoutButtonHint",{}));o.enabled&&t.point("io.ox/core/appcontrol/right").extend({id:"logout-button-hint",index:2100,draw:function(){if(h.set("features/logoutButtonHint/active",!0).save(),_.isBoolean(o.active)&&o.active&&(!_.device("reload")||!e.isAutoLogin())){var t=this.find('[data-action="sign-out"], #io-ox-topbar-dropdown-icon > a').first();t.popover({content:o[ox.language]||g("You forgot to sign out last time. Always use the sign-out button when you finished your work."),template:'<div class="popover popover-signout" role="tooltip"><div class="arrow"></div><div class="popover-content popover-content-signout"></div></div>',placement:"bottom",container:"body"}),this.get(0).addEventListener("click",function(e){e.target.classList.contains("popover-content-signout")&&e.stopImmediatePropagation(),t.popover("destroy")},!0),$(document).one("click",t.popover.bind(t,"destroy")),_.defer(t.popover.bind(t,"show"))}}})}(),t.point("io.ox/core/appcontrol/right").extend({id:"client-onboarding-hint",index:2200,draw:function(){function o(){h.set("features/clientOnboardingHint/remaining",Math.max(0,t.remaining-1)).save(),i.popover("destroy"),document.body.removeEventListener("click",o,!0)}if(!n.has("!client-onboarding")&&_.device("smartphone")&&(!_.device("reload")||!e.isAutoLogin())){var t=_.extend({enabled:!0,remaining:2},h.get("features/clientOnboardingHint",{}));if(t.enabled&&t.remaining){var i=this.find("#io-ox-topbar-dropdown-icon > a");i.popover({content:g("Did you know that you can take %1$s with you? Just click this icon and choose 'Connect your device' from the menu.",ox.serverConfig.productName),template:'<div class="popover popover-onboarding" role="tooltip"><div class="arrow"></div><div class="popover-content popover-content-onboarding"></div></div>',placement:"bottom",container:"body"}),_.defer(i.popover.bind(i,"show")),document.body.addEventListener("click",o,!0)}}}})});