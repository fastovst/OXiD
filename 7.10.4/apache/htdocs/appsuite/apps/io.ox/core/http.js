define("io.ox/core/http",["io.ox/core/event"],function(e){"use strict";var t={common:{1:"id",2:"created_by",3:"modified_by",4:"creation_date",5:"last_modified",20:"folder_id",100:"categories",101:"private_flag",102:"color_label",104:"number_of_attachments"},mail:{102:"color_label",600:"id",601:"folder_id",602:"attachment",603:"from",604:"to",605:"cc",606:"bcc",607:"subject",608:"size",609:"sent_date",610:"received_date",611:"flags",612:"level",613:"disp_notification_to",614:"priority",615:"msgref",651:"flag_seen",652:"account_name",654:"original_id",655:"original_folder_id",656:"content_type",660:"flagged",662:"text_preview",663:"text_preview",664:"authenticity_preview"},contacts:{500:"display_name",501:"first_name",502:"last_name",503:"second_name",504:"suffix",505:"title",506:"street_home",507:"postal_code_home",508:"city_home",509:"state_home",510:"country_home",511:"birthday",512:"marital_status",513:"number_of_children",514:"profession",515:"nickname",516:"spouse_name",517:"anniversary",518:"note",519:"department",520:"position",521:"employee_type",522:"room_number",523:"street_business",524:"internal_userid",525:"postal_code_business",526:"city_business",527:"state_business",528:"country_business",529:"number_of_employees",530:"sales_volume",531:"tax_id",532:"commercial_register",533:"branches",534:"business_category",535:"info",536:"manager_name",537:"assistant_name",538:"street_other",539:"city_other",540:"postal_code_other",541:"country_other",542:"telephone_business1",543:"telephone_business2",544:"fax_business",545:"telephone_callback",546:"telephone_car",547:"telephone_company",548:"telephone_home1",549:"telephone_home2",550:"fax_home",551:"cellular_telephone1",552:"cellular_telephone2",553:"telephone_other",554:"fax_other",555:"email1",556:"email2",557:"email3",558:"url",559:"telephone_isdn",560:"telephone_pager",561:"telephone_primary",562:"telephone_radio",563:"telephone_telex",564:"telephone_ttytdd",565:"instant_messenger1",566:"instant_messenger2",567:"telephone_ip",568:"telephone_assistant",569:"company",571:"userfield01",572:"userfield02",573:"userfield03",574:"userfield04",575:"userfield05",576:"userfield06",577:"userfield07",578:"userfield08",579:"userfield09",580:"userfield10",581:"userfield11",582:"userfield12",583:"userfield13",584:"userfield14",585:"userfield15",586:"userfield16",587:"userfield17",588:"userfield18",589:"userfield19",590:"userfield20",592:"distribution_list",594:"number_of_distribution_list",596:"contains_image1",597:"image_last_modified",598:"state_other",599:"file_as",104:"number_of_attachments",601:"image1_content_type",602:"mark_as_distributionlist",605:"default_address",606:"image1_url",607:"sort_name",608:"useCount",616:"yomiFirstName",617:"yomiLastName",618:"yomiCompany",619:"addressHome",620:"addressBusiness",621:"addressOther"},files:{23:"meta",108:"object_permissions",109:"shareable",700:"title",701:"url",702:"filename",703:"file_mimetype",704:"file_size",705:"version",706:"description",707:"locked_until",708:"file_md5sum",709:"version_comment",710:"current_version",711:"number_of_versions",7010:"com.openexchange.share.extendedObjectPermissions",7030:"com.openexchange.file.storage.mail.mailMetadata",7040:"com.openexchange.file.sanitizedFilename"},tasks:{200:"title",201:"start_date",202:"end_date",203:"note",204:"alarm",209:"recurrence_type",212:"days",213:"day_in_month",214:"month",215:"internal",216:"until",220:"participants",221:"users",300:"status",301:"percent_completed",302:"actual_costs",303:"actual_duration",305:"billing_information",307:"target_costs",308:"target_duration",309:"priority",312:"currency",313:"trip_meter",314:"companies",315:"date_completed",316:"start_time",317:"end_time",401:"full_time"},folders:{1:"id",2:"created_by",3:"modified_by",4:"creation_date",5:"last_modified",6:"last_modified_utc",20:"folder_id",23:"meta",300:"title",301:"module",302:"type",304:"subfolders",305:"own_rights",306:"permissions",307:"summary",308:"standard_folder",309:"total",310:"new",311:"unread",312:"deleted",313:"capabilities",314:"subscribed",315:"subscr_subflds",316:"standard_folder_type",317:"supported_capabilities",318:"account_id",319:"folder_name",3010:"com.openexchange.publish.publicationFlag",3020:"com.openexchange.subscribe.subscriptionFlag",3030:"com.openexchange.folderstorage.displayName",3050:"com.openexchange.imap.extAccount",3060:"com.openexchange.share.extendedPermissions",3201:"com.openexchange.calendar.extendedProperties",3203:"com.openexchange.calendar.provider",3220:"com.openexchange.caldav.url",3204:"com.openexchange.calendar.accountError",3205:"com.openexchange.calendar.config"},user:{610:"aliases",611:"timezone",612:"locale",613:"groups",614:"contact_id",615:"login_info",616:"guest_created_by"},group:{1:"id",700:"name",701:"display_name",702:"members"},resource:{},account:{1001:"id",1002:"login",1003:"password",1004:"mail_url",1005:"transport_url",1006:"name",1007:"primary_address",1008:"spam_handler",1009:"trash",1010:"sent",1011:"drafts",1012:"spam",1013:"confirmed_spam",1014:"confirmed_ham",1015:"mail_server",1016:"mail_port",1017:"mail_protocol",1018:"mail_secure",1019:"transport_server",1020:"transport_port",1021:"transport_protocol",1022:"transport_secure",1023:"transport_login",1024:"transport_password",1025:"unified_inbox_enabled",1026:"trash_fullname",1027:"sent_fullname",1028:"drafts_fullname",1029:"spam_fullname",1030:"confirmed_spam_fullname",1031:"confirmed_ham_fullname",1032:"pop3_refresh_rate",1033:"pop3_expunge_on_quit",1034:"pop3_delete_write_through",1035:"pop3_storage",1036:"pop3_path",1037:"personal",1038:"reply_to",1039:"addresses",1040:"meta",1041:"archive",1042:"archive_fullname",1043:"transport_auth",1044:"mail_starttls",1045:"transport_starttls",1046:"root_folder",1047:"mail_oauth",1048:"transport_oauth"},attachment:{1:"id",2:"created_by",4:"creation_date",800:"folder",801:"attached",802:"module",803:"filename",804:"file_size",805:"file_mimetype",806:"rtf_flag"},subscriptions:{id:"id",folder:"folder",source:"source",displayName:"displayName",enabled:"enabled"},subscriptionSources:{id:"id",displayName:"displayName",icon:"icon",module:"module",formDescription:"formDescription"}},r=["3060","7010"],n=["SVL-0003","SVL-0015","LGI-0006","MFA-0001"];$.extend(t.contacts,t.common),$.extend(t.calendar,t.common),$.extend(t.files,t.common),delete t.files[101],delete t.files[104],$.extend(t.tasks,t.common),t.user=$.extend({},t.contacts,t.common,t.user);var o={},i=function(e){return 400!==e&&/^(0|4\d\d|5\d\d)$/.test(e)},a=function(e){return!!e&&("abort"!==e.statusText&&(0===e.status||i(e.status)))},s={SLOW:1e3,collection:Backbone?new Backbone.Collection([]):null,add:function(e,t){s.collection&&s.collection.add(new Backbone.Model(e).set({params:t.params,data:t.data,index:s.collection.length,timestamp:_.now(),url:t._url}))}};!function(){var e=[],t=[],r=0,n=0;s.took=function(t){e.push(t),r++},s.loss=function(){n++},s.ping=function(e){t.push(e)},s.statistics={avg:function(){var t=_(e).reduce(function(e,t){return e+t},0);return Math.round(t/r)},count:function(){return r},data:function(){return e},isLoss:i,loss:function(){return Math.round(n/r*100)/100},ping:function(){return t}}}();var d=function(e,n){var o=t[e]||{},i=[],a="";for(a in o)-1===r.indexOf(a)&&i.push(a);return i.sort(function(e,t){return e-t}),!0===n?i.join(","):i},l=function(e,r,n){if("object"!=typeof e)return e;n=void 0!==n?n:d(r);for(var o,i,a=t[r]||{},s={},l=0,c=e.length;l<c;l++)void 0===(i=a[o=n[l]]||o)&&l<n.length&&console.error("Undefined column",e,r,n,"index",l),s[i]=e[l];return s},c=function(e,t){var r,n=$.extend({module:"",params:{},data:{},dataType:"json",appendColumns:!("GET"===t||"UPLOAD"===t),columnModule:e.module||"",appendSession:!0,processData:!0,processResponse:!0,cursor:!0},e||{});switch(n.type=t,n._url=n.url||ox.apiRoot+"/"+n.module,n.jsessionid&&(n._url+=";jsessionid="+n.jsessionid),!0===n.appendSession&&(n.params.session=ox.session||"unset"),!0===n.appendColumns&&void 0===n.params.columns&&(r=d(n.columnModule)).length&&(n.params.columns=r.join(",")),n.params.columns&&(n.params.columns=n.params.columns.replace(/\s/g,"")),ox.trigger("http:before:send",n),t){case"GET":case"POST":n._url+="?"+$.param(_.omit(n.params,_.isUndefined));break;case"PUT":case"PATCH":case"DELETE":n._url+="?"+_.serialize(n.params),n.original=n.data,n.data="string"!=typeof n.data?JSON.stringify(n.data):n.data,n.contentType="text/javascript; charset=UTF-8";break;case"UPLOAD":n._url+="?"+_.serialize(n.params),n.contentType=!1,n.processData=!1,n.processResponse=!1}return n},u=function(e,t,r){if(!_.isArray(e)||!r)return e;for(var n,o=0,i=e.length,a=[],s=r.split(",");o<i;o++)n=e[o],a.push(_.isArray(n)?l(n,t,s):n);return a},f=function(e,t,r){if(t){var n="data"in t,i=13===t.category&&n;if("error"in t&&!i){ox.trigger("http:error:"+t.code,t,r),ox.trigger("http:error",t,r);var a=/^SES-/i.test(t.code),s="login"===r.module&&r.data&&/^(login|autologin|store|tokens)$/.test(r.data.action);return!a||s||r.failOnError?o.isDisconnected()&&!r.force?void x.push({deferred:e,options:r}):void e.reject(t):(ox.session="",void ox.trigger("relogin:required",r,e,t))}if(i&&ox.trigger("http:warning",t),"json"===r.dataType&&!0===r.processResponse){var l,c=[];if(t)if("multiple"===r.module){for(var f,p=0,m=t.length;p<m;p++)if(t[p])if(l=void 0!==t[p].timestamp?t[p].timestamp:_.now(),_.isEmpty(t[p]))c.push({data:t[p],timestamp:l});else if(void 0!==t[p].data){var g=r.data[p].columnModule?r.data[p].columnModule:r.data[p].module;"string"==typeof r.data&&(r.data=JSON.parse(r.data),g=r.data[p].module),void 0!==t[p].error&&13!==t[p].category?c.push({error:t[p],timestamp:l}):(13===t[p].category&&console.warn("http.js: warning inside multiple"),f=u(t[p].data,g,r.data[p].columns),c.push({data:f,timestamp:l}))}else c.push({error:t[p],timestamp:l});e.resolve(c)}else{var h=r.params.columns||(!0===r.processResponse?d(r.columnModule,!0):"");c=u(t.data,r.columnModule,h),"mail"===r.module&&"GET"===r.type&&t.warnings&&(c.warnings=t.warnings),l=void 0!==t.timestamp?t.timestamp:_.now(),e.resolve(c,l)}else e.resolve({},_.now())}else e.resolve(t)}else e.reject(t)},p=!1,m=[],g=void 0!==_.url.hash("slow"),h=void 0!==_.url.hash("fail")||void 0!==ox.fail,v=!1,x=[],y=function(){function e(e,t){ox.extract&&ox.extract.enabled&&_.each([].concat(ox.extract.matcher||[]),function(r){e.module===r.module&&e.params.action===r.action&&(console.groupCollapsed('extract: (module: "'+r.module+'", action: "'+r.action+'") '+(e.params.id||"")),console.log(JSON.stringify(t,void 0,4)),console.groupEnd(),ox.extract.output=ox.extract.output||[],ox.extract.output.unshift(JSON.stringify(t,void 0,4)))})}function t(t){var r=t.o.fixPost&&"POST"===t.xhr.type,d=_.extend({},t.xhr,{dataType:r?"text":t.xhr.dataType}),l=$.ajaxSettings.xhr();l.upload&&(d.xhr=function(){return l},l.upload.addEventListener("progress",function(e){t&&t.def&&t.def.notify&&t.def.notify(e)},!1));var c,u;c=_.now(),u=$.ajax(d);var p=function(){u.abort()},m=_.bind(t.def.promise,t.def);_.extend(t.def,{abort:p,promise:function(){return _.extend(m(),{abort:p})}}),t.def.fail(function(e,r){var d=_.now()-c;s.took(d);var l=r&&r.status||200;if(i(l)&&s.loss(),503===l&&e&&"503 Server shutting down..."===e.error){var u=require("gettext!io.ox/core");e.error=u("Server shutting down.")}a(r)?(o.trigger("unreachable"),ox.trigger("connection:down",e,t.o)):(o.trigger("reachable"),ox.trigger("connection:online connection:up")),e.code&&n.indexOf(e.code)>=0||(e=_.extend({status:l,took:d},e),s.add(e,t.o))}),u.then(function(e){if(r){var t=/\((\{.*?\})\)/.exec(e);return t&&t[1]?JSON.parse(t[1]):JSON.parse(e)}return e}).done(function(r){o.trigger("reachable"),ox.trigger("connection:online connection:up"),ox.debug&&e(t.o,r);var n=_.now()-c;s.took(n),n>s.SLOW&&s.add({error:"Took: "+Math.round(n/100)/10+"s",status:200,took:n},t.o),o.trigger("stop done",t.xhr),t.o.processData?f(t.def,r,t.o,t.o.type):"json"===t.xhr.dataType&&void 0!==r.error&&13!==r.category?(r.folder=t.o.data.folder,ox.trigger("http:error:"+r.code,r,t.o),ox.trigger("http:error",r,t.o),t.def.reject(r)):_.isArray(r.data)?(r.data=_(r.data).map(function(e){if(13!==e.category)return e}),t.def.resolve(r)):t.def.resolve(r),t=null}).fail(function(e,r,n){o.trigger("stop fail",t.xhr);var i=0!==e.status?e.status+" ":"";i+=n||(navigator.onLine?o.messages.generic:o.messages.offline),t.def.reject({error:i,code:navigator.onLine?"NOSERVER":"OFFLINE"},e),t=null})}function r(e){return e?JSON.parse(JSON.stringify(e)):e}function d(e){var t;if("GET"===e.o.type||"PUT"===e.o.type){try{t=JSON.stringify(e.xhr)}catch(e){ox.debug&&console.error(e)}if(!1!==e.o.consolidate&&t&&_.isArray(u[t]))return"reject"===e.o.consolidate?void e.def.reject({error:"request is already pending and consolidate parameter is set to reject",code:"UI_CONSREJECT"}):(u[t].push(e),e=t=null,!0);u[t]=[],e.def.always(function(){var n="resolved"===e.def.state(),i=u[t];if(delete u[t],i&&i.length){var a=_(arguments).map(r);_(i).each(function(e){e.def[n?"resolve":"reject"].apply(e.def,a),o.trigger("stop "+(n?"done":"fail"),e.xhr)}),e=t=null}})}}function l(e){d(e)||y(e)}var u={},y=function(){function e(){return o<ox.serverConfig.maxConnections}function r(e){o++,e.def.always(n),t(e)}function n(){o--,e()&&i.length>0&&r(i.shift())}var o=0,i=[];return function(t){if(!ox.serverConfig.maxConnections)return r(t);e()?r(t):i.push(t)}}();return function(e,t){function r(){(ox.fail||h)&&"login"!==e.module&&Math.random()<Number(ox.fail||_.url.hash("fail")||0)?(console.error("HTTP fail",n.o._url,n.xhr),n.def.reject({error:"0 simulated fail"}),o.trigger("stop fail",n.xhr)):l(n),n=e=null}e=c(e,t);var n,i=$.Deferred();if(!e.params.session&&!1!==e.appendSession){var a=["login#*","capabilities#*","apps/manifests#*","files#document","office#getFile"];if(!_.find(a,function(t){var r=t.split("#");return e.module===r[0]&&("*"===r[1]||e.params.action===r[1])}))return ox.trigger("relogin:required",e,i,{}),i}return!0!==v||e.force?(n={def:i,o:e,xhr:{type:"UPLOAD"===t?"POST":t,url:e._url,data:e.data,dataType:e.dataType,processData:e.processData,contentType:void 0!==e.contentType?e.contentType:"application/x-www-form-urlencoded",beforeSend:e.beforeSend}},!0===p?(d(n)||m.push({deferred:i,options:e}),i):("number"==typeof e.timeout&&(n.xhr.timeout=e.timeout),o.trigger("start",n.xhr,e),g&&Number(_.url.hash("slow"))?setTimeout(r,250*Number(_.url.hash("slow"))+(500*Math.random()>>0)):r(),i)):(x.push({deferred:i,options:e}),i)}}(),b=function(){function e(){n.resolve(),n=$.Deferred()}function t(o){return o?(t.pending++,o.always(function(){t.pending--,0===t.pending&&e()})):0===t.pending?r:n.promise()}var r=$.when(),n=$.Deferred();return t.pending=0,t}();return o={GET:function(e){return y(e,"GET")},POST:function(e){return y(e,"POST")},PATCH:function(e){return y(e,"PATCH")},PUT:function(e){return y(e,"PUT")},DELETE:function(e){return y(e,"DELETE")},UPLOAD:function(e){return y(e,"UPLOAD")},FORM:function(e){e=_.extend({module:"files",action:"new",data:{},params:{},form:$(),field:"json"},e);var t="formpost_"+_.now(),r="callback_"+e.action,n="callback_"+e.module,o=$.Deferred(),i=JSON.stringify(e.data),a=ox.apiRoot+"/"+e.module+"?action="+e.action+"&session="+ox.session,s=e.form;return $("#tmp").append($("<iframe>",{name:t,id:t,height:1,width:1,src:ox.base+"/blank.html"})),window[r]=function(e){_.isArray(e.data)&&(e.data=_(e.data).map(function(e){if(13!==e.category)return e})),o[e&&e.error?"reject":"resolve"](e),window[r]=i=s=o=null,$("#"+t).remove()},window[n]=window[r],s.find('input[name="'+e.field+'"]').length?s.find('input[name="'+e.field+'"]').val(i):s.append($('<input type="hidden" name="'+e.field+'">').val(i)),s.prop({method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data",action:a+"&"+_.serialize(e.params),target:t}),s.submit(),o},wait:b,getAllColumns:d,getColumnMapping:function(e){return _.clone(t[e]||{})},getRequestLengthLimit:function(){return ox.serverConfig.limitRequestLine||8190},makeObject:l,simplify:function(e){for(var t=0,r=null,n=new Array(e.length);r=e[t];t++)"object"==typeof r?(n[t]={id:r.id},("folder"in r||"folder_id"in r)&&(n[t].folder=r.folder||r.folder_id),"recurrence_position"in r&&(n[t].recurrence_position=r.recurrence_position)):n[t]=r;return n},fixList:function(e,t){return t.then(function(t){e=o.simplify(e);var r,n,i,a={},s=new Array(t.length),d=_(e).reduce(function(e,t){return e&&_.isNumber(t)},!0);for(r=0;n=t[r];r++)a[i=d?n.internal_userid||n.user_id||n.id:_.cid(n)]=n;for(r=0;n=e[r];r++)i=d?n:_.cid(n),s[r]=a[i];return a=n=e=null,s})},retry:function(e){var t=(e.type||"GET").toUpperCase();return e.consolidate=!1,this[t](e)},pause:function(){p=!0,this.trigger("paused")},isPaused:function(){return p},disconnect:function(){o.trigger("disconnect"),v=!0},isDisconnected:function(){return v},reconnect:function(){v=!1;var e=x.slice().map(function(e){return e.options.consolidate=!1,y(e.options,e.options.type).then(e.deferred.resolve,e.deferred.reject)});$.when.apply(null,e).always(function(){o.trigger("reconnect")}),x=[]},resetDisconnect:function(e){var t=x.slice().map(function(t){return t.deferred.reject(e),t.deferred});x=[],$.when.apply(null,t).always(o.reconnect)},resume:function(e){e=e||{};var t=$.Deferred(),r=m.slice();if(!0===p){for(var n,o,i=0,a=r.length,s=[];i<a;i++)delete(n=r[i].options).params.session,o=$.extend(n.params,{module:n.module,data:n.original}),void 0!==n.params.action&&(o.action=n.params.action),s.push(o);m=[],p=!1,this.trigger("resumed"),s.length>0?this.PUT({module:"multiple",continue:!0,data:s,appendColumns:!1,consolidate:e.consolidate}).done(function(e){for(var n,o=0,i=r.length;o<i;o++)if(n=e[o],_.isObject(n)&&"data"in n&&"timestamp"in n)r[o].deferred.resolve(n.data,n.timestamp);else if(void 0===n||null===n){var a=require("gettext!io.ox/core");r[o].deferred.reject({error:a("Server did not send a response"),code:"0000"})}else n.error?r[o].deferred.reject(n.error):r[o].deferred.resolve(n);t.resolve(e)}).fail(function(e){_(r).each(function(t){t.deferred.reject(e)}),t.reject(e)}):t.resolve([])}else t.resolve([]);return t},getColumn:function(e,r){if(!e)return t;var n=t[e]||{};return r?n[r]:n},ping:function(){var e=_.now();return this.GET({module:"system",params:{action:"ping",timestamp:_.now()}}).then(function(){var t=_.now()-e;return s.ping(t),t})},log:function(){return s.collection},statistics:s.statistics,messages:{generic:"An unknown error occurred",noserver:"An unknown error occurred",offline:"Cannot connect to server. Please check your connection."},defaultColumns:{mail:function(){var e="102,600,601,602,603,604,605,606,607,608,610,611,614,652,656";return{generic:e,unseen:"102,600,601,602,603,604,605,606,607,608,610,611,614,652,656,654,655",all:"102,600,601,602,603,604,605,606,607,608,610,611,614,652,656,X-Open-Xchange-Share-URL",search:"102,600,601,602,603,604,605,606,607,608,610,611,614,652,656,654,655"}}()}},e.extend(o),function(e){var t;e.on("disconnect",function(){void 0===t&&(t=require.s.contexts._.config.waitSeconds),require.config({waitSeconds:0})}),e.on("reconnect",function(){window.setTimeout(function(){require.config({waitSeconds:t}),t=void 0},100)})}(o),o});