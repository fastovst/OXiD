define("io.ox/core/desktopNotifications",["settings!io.ox/core","io.ox/core/tk/visibility-api-util"],function(i,o){"use strict";function t(i){if(o.isHidden||i.ignoreVisibility||i.forceDisplay){var t,n=(i=_.extend({title:"",body:"",duration:"4000"},i)).title,e=i.duration,s=i.onclose,r=i.onshow,c=i.onclick,u=i.onerror;i=_(i).omit("title duration ignoreVisibility onclick onclose onshow onerror"),t=new Notification(n,i),s&&(t.onclose=s),r&&(t.onshow=r),c&&(t.onclick=c),u&&(t.onerror=u),e&&(_.device("firefox")&&e>=4e3||(t.onshow=function(){setTimeout(function(){$(t).trigger("close")},e),r&&r.call(arguments,this)}))}}var n=!_.device("smartphone")&&!!window.Notification;return{getPermissionStatus:function(){return n?Notification.permission:"unsupported"},isSupported:function(){return n},requestPermission:function(i){n?Notification.requestPermission(i):i("unsupported")},show:function(o){o&&n&&i.get("showDesktopNotifications",!0)&&(2===arguments.length?_.isString(arguments[0])&&_.isString(arguments[1])?o={title:o,body:arguments[1]}:(arguments[1].title=o,o=arguments[1]):_.isString(o)&&(o={title:o}),"granted"===this.getPermissionStatus()&&t(o))}}});