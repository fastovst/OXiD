define("io.ox/core/api/snippets",["io.ox/core/http","io.ox/core/event","settings!io.ox/mail"],function(e,n,t){"use strict";function i(e){return _.isString(e.misc)&&(e.misc=JSON.parse(e.misc)),e.misc=$.extend({insertion:t.get("defaultSignaturePosition","below")},e.misc||{}),e}var r={},o=null,u=new Backbone.Collection;return n.extend(r),r.getCollection=function(){return u},r.getAll=function(){return o?$.Deferred().resolve(o):e.GET({module:"snippet",params:{action:"all"},timeout:15e3}).then(function(e){return o=_(e).map(i),u.reset(o),o},function(){return o=null,[]})},r.create=function(n){return e.PUT({module:"snippet",params:{action:"new"},data:n}).done(function(e){o=null,u.add(_({},n,{id:e})),r.trigger("refresh.all")})},r.update=function(n){return e.PUT({module:"snippet",params:{action:"update",id:n.id},data:n}).done(function(){o=null,u.add(n,{merge:!0}),r.trigger("refresh.all")})},r.get=function(n){return e.GET({module:"snippet",params:{action:"get",id:n}})},r.list=function(n){return e.PUT({module:"snippet",params:{action:"list"},data:n})},r.destroy=function(n){return e.GET({module:"snippet",params:{action:"delete",id:n}}).done(function(){o=null,u.remove(n),r.trigger("refresh.all")})},r});