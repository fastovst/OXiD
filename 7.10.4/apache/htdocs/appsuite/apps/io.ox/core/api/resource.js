define("io.ox/core/api/resource",["io.ox/core/http","io.ox/core/api/factory"],function(e,t){"use strict";function n(){a.caches.all.clear(),a.caches.list.clear(),a.caches.get.clear()}var a=t({module:"resource",keyGenerator:function(e){return String(e.id)},requests:{all:{},list:{},get:{},search:{action:"search",getData:function(e){return{pattern:e}}}}}),r=Backbone.Model.extend({defaults:{description:"",display_name:"",name:"",mailaddress:""},initialize:function(){this.on("change:display_name",function(){this.set("name",this.getName())}),this.set("name",this.getName())},getName:function(){var e={"ä":"ae","ö":"oe","ü":"ue","ß":"ss"};return function(){return this.has("id")&&this.get("name")?this.get("name"):this.get("display_name").trim().toLowerCase().replace(/[äöüß]/g,function(t){return e[t]}).replace(/\W+/g,"_")}}()}),o=Backbone.Collection.extend({comparator:function(e){return(e.get("display_name")||"").toLowerCase()},model:r});return a.collection=new o,a.getModel=function(e){return a.collection.get(e)||new r},a.create=function(t){return e.PUT({module:"resource",params:{action:"new"},data:t,appendColumns:!1}).then(function(e){return a.get({id:e.id}).done(function(e){a.collection.add(e,{parse:!0}),a.trigger("create",e),n()})})},a.update=function(t){return e.PUT({module:"resource",params:{action:"update",id:t.id,timestamp:_.then()},data:_(t).pick("description","display_name","mailaddress","name"),appendColumns:!1}).done(function(){var e=a.collection.get(t.id);e&&e.set(t),a.trigger("update",t),n()})},a.remove=function(t){return a.trigger("before:remove",t),e.PUT({module:"resource",params:{action:"delete",timestamp:_.then()},data:{id:t},appendColumns:!1}).done(function(){var e=a.collection.get(t);e&&a.collection.remove(e),a.trigger("remove",t),n()})},a});