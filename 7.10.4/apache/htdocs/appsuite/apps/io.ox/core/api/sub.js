define("io.ox/core/api/sub",["io.ox/core/http","io.ox/core/api/factory"],function(e,r){"use strict";var t=function(e,r){var t={general:e.cid(""),folder:e.cid({folder:r.folder}),pub:"."+r.id,sub:r.folder+"."};return $.when(e.caches.all.remove(t.general),e.caches.get.grepRemove(t.pub),e.caches.get.grepRemove(t.sub))},n=$.extend(!0,function(n){return $.extend(!0,r(n),{update:function(r){return t(this,{id:r.id||"",folder:r.folder||r.entity.folder||""}).then(function(){return e.PUT({module:n.module,params:{action:"update"},data:r})})},destroy:function(e){var r=this;return t(this,{id:e}).then(function(){return r.remove(e)})},create:function(r){return t(this,r.entity).then(function(){return e.PUT({module:n.module,appendColumns:!1,params:{action:"new"},data:r})})}})}({module:"subscriptions",requests:{all:{columns:"id,folder,displayName,enabled",extendColumns:"io.ox/core/api/pubsub/subscriptions/all"}}}),{refresh:function(r){if(r){var n=r.folder||r.attributes.folder||"";return t(this,r).then(function(){return e.GET({module:"subscriptions",appendColumns:!1,params:{action:"refresh",id:r.id,folder:n}}).then(this.resolve,function(e){var r=e.error_params[0];throw"SUB-90112"===e.code&&r&&(e.error_html=e.error.replace(r,'<a href="'+r+'" title="'+r+'" target="_blank">Link</>')),e})})}}});return ox.on("refresh^",function(){_([n]).each(function(e){e.caches.get.clear(),e.caches.all.clear().then(function(){e.trigger("refresh:all")})})}),{subscriptions:n,sources:r({module:"subscriptionSources",requests:{all:{columns:"id,displayName,icon,module,formDescription"}}})}});