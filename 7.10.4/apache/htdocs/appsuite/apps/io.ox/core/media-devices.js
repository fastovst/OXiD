define("io.ox/core/media-devices",["gettext!io.ox/core"],function(e){"use strict";function i(){var e=$.Deferred();return navigator.mediaDevices.enumerateDevices().then(e.resolve,e.reject),e}function n(i){return a[i.kind]=(a[i.kind]||0)+1,"audioinput"===i.kind?e("Microphone %1$s",a[i.kind]):"videoinput"===i.kind?e("Camera %1$s",a[i.kind]):e("Unknown %1$s",a[i.kind])}var r={unavailable:e("There are currently no compatible media devices available on your device."),"permission-denied":e("Access to your media devices has been denied. Please refer to your browser help pages for how to reset authorization."),"non-secure":e("This feature isn't available for non-secure connections.")},t=!navigator.mediaDevices,a={};return{isSupported:function(){return!t},getDevices:function(r){return t?$.Deferred().reject({type:"Unsupported",message:e("Unfortunately your browser doesn't support listing available media devices.")}):i().then(function(e){return a={},_.chain(e).map(function(e){if(!r||0===e.kind.indexOf(r))return{id:e.deviceId,value:e.deviceId,label:e.label||n(e),type:e.kind.replace("input",""),physicalDevice:e.groupId}}).compact().value()})},getStream:function(e){function i(e){var i=e.message;/^(PermissionDeniedError|Permission denied|NotAllowedError)$/.test(e.name||e.message)&&(i=r["permission-denied"]),/(DevicesNotFoundError)$/.test(e.name||e.message)&&(i=r.unavailable),/(secure origins)/.test(e.message)&&(i=r["non-secure"]),n.reject({type:e.name,message:i,original_message:e.message})}var n=$.Deferred();try{t?navigator.getUserMedia(e,n.resolve.bind(n),i):navigator.mediaDevices.getUserMedia(e).then(n.resolve,i)}catch(e){i(e)}return n.promise()}}});