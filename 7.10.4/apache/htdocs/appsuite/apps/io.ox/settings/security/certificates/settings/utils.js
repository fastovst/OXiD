define("io.ox/settings/security/certificates/settings/utils",["io.ox/backbone/views/modal","io.ox/settings/security/certificates/settings/certificate-view","gettext!io.ox/settings/certificates","io.ox/backbone/views/disposable","io.ox/core/api/certificate","io.ox/core/api/account"],function(e,t,i,r,n,a){var o=r.extend({tagName:"div",events:{trust:"onTrust"},initialize:function(e){this.opt=_.extend({},e)},render:function(){var e=this,t={commonName:i("Common name"),expired:i("Expired"),expiresOn:i("Expires on"),failureReason:i("Failure reason"),fingerprint:i("Fingerprint"),hostname:i("Hostname"),issuedBy:i("Issued by"),issuedOn:i("Issued on"),serialNumber:i("Serial number"),signature:i("Signature"),trusted:i("Trusted")};return this.certificate=null,n.examine({fingerprint:this.opt.error.error_params[0]}).done(function(i){var r=$("<div>");e.certificate=i,e.$el.addClass("certificates").append(r,_.map(i,function(e,i){if("issuedOn"!==i&&"expiresOn"!==i||(e=moment(e).toString()),"failureReason"!==i)return $('<dl class="dl-horizontal">').append($("<dt>").text(t[i]),$("<dd>").text(e));r.append($('<div class="alert alert-warning">').text(e))}))}).fail(function(t){e.$el.addClass("certificates").append($('<div class="alert alert-warning">').text(t.error_desc)),e.dialog.$footer.find('button[data-action="trust"]').attr("disabled","disabled")}),this},onTrust:function(){var e=this,t=this.certificate.hostname!==this.opt.error.error_params[1]&&void 0!==this.opt.error.error_params[1]?this.opt.error.error_params[1]:this.certificate.hostname;n.update({fingerprint:this.certificate.fingerprint,hostname:t,trust:!0}).done(function(){e.dialog.close(),a.trigger("refresh:ssl"),n.trigger("update"),require(["io.ox/portal/main","io.ox/portal/widgets"],function(e,t){var i=e.getApp();_(t.getEnabled()).chain().filter(function(e){return"rss"===e.get("type")}).each(function(e,t){i.refreshWidget(e,t)})})})}});return{openExaminDialog:function(t,r){var n=new o({error:/SSL/.test(t.code)?t:t.warnings[1]});n.dialog=new e({top:60,width:800,center:!1,maximize:500,async:!0,point:"io.ox/settings/certificates/examin",title:i("Certificate details")}),n.dialog.$body.append(n.render().el),n.dialog.addButton({label:i("Trust certificate"),action:"trust"}).addCancelButton(),n.dialog.on("trust",function(){n.dialog.$body.find("div").first().trigger("trust"),r&&r.idle()}),n.dialog.open()}}});