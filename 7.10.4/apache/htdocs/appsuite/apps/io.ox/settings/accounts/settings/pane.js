define("io.ox/settings/accounts/settings/pane",["io.ox/core/extensions","io.ox/backbone/views/extensible","io.ox/core/api/account","io.ox/keychain/api","io.ox/keychain/model","io.ox/core/settings/util","io.ox/core/notifications","io.ox/settings/accounts/views","io.ox/backbone/mini-views/settings-list-view","settings!io.ox/core","gettext!io.ox/settings/accounts","withPluginsFor!keychainSettings"],function(e,t,i,n,o,s,c,a,r,u,l){"use strict";e.point("io.ox/settings/accounts/settings/detail").extend({index:100,id:"view",draw:function(){this.append(new t({point:"io.ox/settings/accounts/settings/detail/view",model:u}).inject({hasNoOAuthCredentials:function(e){return!(e.has("mail_oauth")&&e.get("mail_oauth")>=0)},openRecoveryDialog:function(e){e.preventDefault(),ox.load(["io.ox/keychain/secretRecoveryDialog"]).done(function(e){e.show()})},updateListAndStatuses:function(){var e=this.collection;return $.when(n.getAll(),i.getStatus()).done(function(t,i){e.reset(o.wrap(t).models),i=i[0];for(var n in i){var s=e.get("mail"+n),c=i[n];if(!s)return;s.set("status","ok"!==c.status?c:c.status)}})},showNoticeFields:["security/acceptUntrustedCertificates"],showNotice:function(e){return _(this.showNoticeFields).some(function(t){return t===e})}}).build(function(){this.listenTo(u,"change:security/acceptUntrustedCertificates",function(){u.save()})}).render().$el)}});var d=0;e.point("io.ox/settings/accounts/settings/detail/view").extend({id:"header",index:d+=100,render:function(){this.$el.addClass("io-ox-accounts-settings").append(s.header(l("Accounts")))}},{id:"list",index:d+=100,render:function(){var e=this.collection=o.wrap(n.getAll()),t=new r({tagName:"ul",childView:a.ListItem,collection:this.collection,filter:this.hasNoOAuthCredentials});require(["io.ox/oauth/keychain"],function(i){t.listenTo(i.accounts,"add remove change",function(){e.reset(o.wrap(n.getAll()).models)})}),this.$el.append(t.render().$el),this.updateListAndStatuses(),this.listenTo(n,"refresh.all refresh.list",this.updateListAndStatuses)}},{id:"onchange",index:d+=100,render:function(){this.listenTo(u,"change",function(e){var t=this.showNotice(e);u.saveAndYell(void 0,{force:!!t}).then(function(){t&&c.yell("success",l("The setting requires a reload or relogin to take effect."))})})}},{id:"untrusted-certificates",index:d+=100,render:function(){u.isConfigurable("security/acceptUntrustedCertificates")&&this.$el.append($('<div class="form-group">').append(s.checkbox("security/acceptUntrustedCertificates",l("Allow connections with untrusted certificates"),u)))}},{id:"recovery",index:d+=100,render:function(){this.collection.length<=1||this.$el.append($('<h2 class="sr-only">').text(l("Password recovery")),$('<a href="#" role="button" class="hint">').text(l("Show information about account recovery")).on("click",function(e){e.preventDefault(),$(this).hide().next().show()}),$('<div class="hint">').hide().append($("<p>").text(l("For security reasons, all credentials are encrypted with your primary account password. If you change your primary password, your external accounts might stop working. In this case, you can use your old password to recover all account passwords.")),$('<button type="button" class="btn btn-primary" data-action="recover">').text(l("Recover passwords")).on("click",this.openRecoveryDialog)))}})});