define("io.ox/contacts/actions/invite",["io.ox/contacts/api","io.ox/calendar/util","io.ox/contacts/util"],function(i,e,t){"use strict";return function(n){function a(i){if(!i.distribution_list||!i.distribution_list.length)return!i.internal_userid&&!i.user_id||"email1"!==i.field&&i.field?{type:5,display_name:i.display_name,mail:i[i.field]||i.mail||i.email1||i.email2||i.email3}:{type:1,user_id:i.internal_userid||i.user_id,display_name:i.display_name,email1:i.email1};u.push(i)}function r(i){return 1===i.type||!!i.mail}function l(i){var e=[];return _(i).each(function(i){i.mark_as_distributionlist?u=u.concat(i.distribution_list||[]):e.push(i)}),e}var o=null,u=[];if(1!==n.length||0!==n[0].id&&0!==n[0].folder_id)o=i.getList(n,!0,{check:function(i){return i.mark_as_distributionlist||i.internal_userid||i.email1||i.email2||i.email3}}).then(function(e){var n=_.chain(l(e)).map(a).flatten(!0).filter(r).value(),o=[];return u=_.union(u),_(u).each(function(i){i.id||o.push(i)}),u=_.difference(u,o),u=t.validateDistributionList(u),i.getList(u).then(function(i){i=_(i).map(function(i,e){return u[e].mail_field&&(i.field="email"+u[e].mail_field),i});var e=_.chain([].concat(i,o)).map(a).flatten(!0).filter(r).value();return n.concat(e)})});else{var s=n[0].email1||n[0].email2||n[0].email3;o=$.Deferred().resolve([{type:5,mail:s}])}o.done(function(i){require(["io.ox/calendar/edit/main","settings!io.ox/calendar"],function(t,n){t.getApp().launch().done(function(){var t=moment().startOf("hour").add(1,"hours"),a=[];_.each(i,function(i){a.push(e.createAttendee(i))}),this.create({attendees:a,folder_id:n.get("chronos/defaultFolderId"),startDate:{value:t.format("YYYYMMDD[T]HHmmss"),tzid:t.tz()},endDate:{value:t.add(1,"hours").format("YYYYMMDD[T]HHmmss"),tzid:t.tz()}})})})})}});