define("io.ox/contacts/distrib/create-dist-view",["io.ox/backbone/views","io.ox/backbone/mini-views","gettext!io.ox/contacts","io.ox/core/extensions","io.ox/participants/add","io.ox/participants/views","io.ox/participants/model"],function(t,e,i,a,n,o,s){"use strict";var d=t.point("io.ox/contacts/distrib/create-dist-view"),r=d.createView({tagName:"div",className:"create-distributionlist-view"});return d.basicExtend({id:"title-controls",index:100,className:"row title-controls",draw:function(t){var e=i("Create list"),a=i("Create distribution list"),n=this;t.model.get("id")&&(e=i("Save"),a=i("Edit distribution list")),t.app.getWindow().setHeader($('<div class="header">').append($('<h1 class="sr-only">').text(a),$('<button type="button" class="btn btn-primary" data-action="save">').text(e).on("mousedown",function(){t.addParticipantView.resolve()||(n.find('input[name="display_name"]').trigger("blur"),t.member.resolve().always(function(){t.model.save()}))}),$('<button type="button" class="btn btn-default" data-action="discard">').text(i("Discard")).on("click",function(){$(this).trigger("controller:quit")})))}}),d.extend({id:"displayname",index:200,className:"row",render:function(){var t=_.uniqueId("form-control-label-");this.$el.append($("<div>").addClass("form-group col-md-12").append($("<label>").addClass("control-label").attr("for",t).text(i("Name")),new e.InputView({name:"display_name",model:this.baton.model,className:"form-control control",id:t}).render().$el))}}),d.extend({id:"participants_list",index:300,className:"row",render:function(){var t=this;this.baton.member=new s.Participants(this.baton.model.get("distribution_list"),{silent:!1}),this.listenTo(this.baton.member,"add remove",function(e,i){var a=i.map(function(t){return _.isNumber(t.getContactID())?{id:t.getContactID(),folder_id:t.get("folder_id"),display_name:t.getDisplayName(),mail:t.getTarget(),mail_field:t.getFieldNumber()}:{display_name:t.getDisplayName(),mail:t.getTarget(),mail_field:0}});t.baton.model.set("distribution_list",a)}),this.$el.append(new o.UserContainer({collection:this.baton.member,baton:this.baton,isMail:!0,strict:!0,empty:i("This list has no members yet")}).render().$el)}}),d.extend({id:"add-participant",index:400,className:"row",render:function(){var t=new n({apiOptions:{contacts:!0},placeholder:i("Add contact")+" â€¦",label:i("Add contact"),collection:this.baton.member,scrollIntoView:!0,isMail:!0});this.$el.append(t.$el),t.render().$el.addClass("col-md-6"),this.baton.addParticipantView=t}}),d.extend({id:"notice",index:400,className:"row",render:function(){this.$el.append($('<div class="col-md-6">').append($('<div class="help-block">').text(i('To add contacts manually, just provide a valid email address (e.g john.doe@example.com or "John Doe" <jd@example.com>)'))))}}),d.extend({id:"metrics",render:function(){var t=this;require(["io.ox/metrics/main"],function(e){e.isEnabled()&&t.baton.app.getWindow().nodes.footer.on("mousedown","[data-action]",function(t){var i=$(t.target);e.trackEvent({app:"contacts",target:"edit/distribution-list/toolbar",type:"click",action:i.attr("data-action")||i.attr("data-name"),detail:i.attr("data-value")})})})}}),r});