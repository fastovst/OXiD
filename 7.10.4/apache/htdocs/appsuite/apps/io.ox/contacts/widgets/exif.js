define("io.ox/contacts/widgets/exif",function(){"use strict";function t(t){if(255!==t.getByteAt(0)||216!==t.getByteAt(1))return!1;for(var r,n=2,g=t.getLength();n<g;){if(255!==t.getByteAt(n))return o&&console.log("Not a valid marker at offset "+n+", found: "+t.getByteAt(n)),!1;if(22400===(r=t.getByteAt(n+1)))return o&&console.log("Found 0xFFE1 marker"),e(t,n+4,t.getShortAt(n+2,!0));if(225===r)return o&&console.log("Found 0xFFE1 marker"),e(t,n+4,t.getShortAt(n+2,!0));n+=2+t.getShortAt(n+2,!0)}}function e(t,e){if("Exif"!==t.getStringAt(e,4))return o&&console.log("Not valid EXIF data! "+t.getStringAt(e,4)),!1;var n,i=e+6;if(18761===t.getShortAt(i))n=!1;else{if(19789!==t.getShortAt(i))return o&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}return 42!==t.getShortAt(i+2,n)?(o&&console.log("Not valid TIFF data! (no 0x002A)"),!1):8!==t.getLongAt(i+4,n)?(o&&console.log("Not valid TIFF data! (First offset not 8)",t.getShortAt(i+4,n)),!1):r(t,i,i+8,g,n)}function r(t,e,r,g,i){var A,a,u,s=t.getShortAt(r,i),f={};for(u=0;u<s;u++)A=r+12*u+2,!(a=g[t.getShortAt(A,i)])&&o&&console.log("Unknown tag: "+t.getShortAt(A,i)),f[a]=n(t,A,e,r,i);return f}function n(t,e,r,n,o){var g,i,A,a=t.getShortAt(e+2,o),u=t.getLongAt(e+4,o),s=t.getLongAt(e+8,o)+r;switch(a){case 1:case 7:if(1===u)return t.getByteAt(e+8,o);for(g=u>4?s:e+8,i=[],A=0;A<u;A++)i[A]=t.getByteAt(g+A);return i;case 2:return g=u>4?s:e+8,t.getStringAt(g,u-1);case 3:if(1===u)return t.getShortAt(e+8,o);for(g=u>2?s:e+8,i=[],A=0;A<u;A++)i[A]=t.getShortAt(g+2*A,o);return i;case 4:if(1===u)return t.getLongAt(e+8,o);for(i=[],A=0;A<u;A++)i[A]=t.getLongAt(s+4*A,o);return i;case 5:if(1===u)return t.getLongAt(s,o)/t.getLongAt(s+4,o);var f=[];for(A=0;A<u;A++)f[A]=t.getLongAt(s+8*A,o)/t.getLongAt(s+4+8*A,o);return f;case 9:if(1===u)return t.getSLongAt(e+8,o);for(i=[],A=0;A<u;A++)i[A]=t.getSLongAt(s+4*A,o);return i;case 10:if(1===u)return t.getSLongAt(s,o)/t.getSLongAt(s+4,o);for(i=[],A=0;A<u;A++)i[A]=t.getSLongAt(s+8*A,o)/t.getSLongAt(s+4+8*A,o);return i}}var o=!1,g={274:"Orientation"},i=function(t,e,r){var n=t,o=e||0,g=0;this.getRawData=function(){return n},"string"==typeof t&&(g=r||n.length,this.getByteAt=function(t){return 255&n.charCodeAt(t+o)},this.getBytesAt=function(t,e){for(var r=[],g=0;g<e;g++)r[g]=255&n.charCodeAt(t+g+o);return r}),this.getLength=function(){return g},this.getSByteAt=function(t){var e=this.getByteAt(t);return e>127?e-256:e},this.getShortAt=function(t,e){var r=e?(this.getByteAt(t)<<8)+this.getByteAt(t+1):(this.getByteAt(t+1)<<8)+this.getByteAt(t);return r<0&&(r+=65536),r},this.getSShortAt=function(t,e){var r=this.getShortAt(t,e);return r>32767?r-65536:r},this.getLongAt=function(t,e){var r=this.getByteAt(t),n=this.getByteAt(t+1),o=this.getByteAt(t+2),g=this.getByteAt(t+3),i=e?(((r<<8)+n<<8)+o<<8)+g:(((g<<8)+o<<8)+n<<8)+r;return i<0&&(i+=4294967296),i},this.getSLongAt=function(t,e){var r=this.getLongAt(t,e);return r>2147483647?r-4294967296:r},this.getStringAt=function(t,e){for(var r=[],n=this.getBytesAt(t,e),o=0;o<e;o++)r[o]=String.fromCharCode(n[o]);return r.join("")},this.getCharAt=function(t){return String.fromCharCode(this.getByteAt(t))},this.toBase64=function(){return window.btoa(n)},this.fromBase64=function(t){n=window.atob(t)}};return{getOrientation:function(e){var r=atob(e.split(",")[1]),n=t(new i(r));if(_.isObject(n)&&n.Orientation)return n.Orientation}}});