define("io.ox/mail/compose/actions/save",["io.ox/core/extensions","io.ox/mail/compose/actions/extensions","io.ox/mail/api","io.ox/mail/util","io.ox/core/notifications"],function(e,r,o,i,n){"use strict";e.point("io.ox/mail/compose/actions/save").extend({id:"metrics",index:100,perform:function(){require(["io.ox/metrics/main"],function(e){e.trackEvent({app:"mail",target:"compose/toolbar",type:"click",action:"saveDraft"})})}},{id:"check:attachment-empty",index:150,perform:r.emptyAttachmentCheck},{id:"wait-for-pending-uploads",index:200,perform:r.waitForPendingUploads},{id:"remove-unused-inline-images",index:300,perform:r.removeUnusedInlineImages},{id:"check-for-auto-enabled-drive-mail",index:400,perform:r.checkForAutoEnabledDriveMail({yell:!0})},{id:"send",index:1e3,perform:function(e){return e.model.saveDraft().then(function(r){e.msgref=r.data})}},{id:"error",index:1100,perform:function(e){if(e.error)return n.yell("error",e.error),e.stopPropagation(),(new $.Deferred).reject(e.error)}},{id:"reload",index:1200,perform:function(e){var r=i.parseMsgref(o.separator,e.msgref);switch(e.model.get("contentType")){case"text/plain":r.view="raw";break;case"text/html":case"ALTERNATIVE":r.view="html"}return o.get(r).then(function(r){e.mail=r})}},{id:"reloadError",index:1300,perform:function(e){if(e.error)return n.yell("error",e.error),e.stopPropagation(),(new $.Deferred).reject(e.error)}})});