define("io.ox/mail/compose/resize-view",["io.ox/mail/compose/resize","settings!io.ox/mail","gettext!io.ox/mail","io.ox/backbone/mini-views/dropdown"],function(e,i,t,s){"use strict";function n(i,s){var n=s.get("originalFile");return n?0===n.size?(require(["io.ox/core/notifications"],function(e){e.yell("warning",t("The image cannot not be resized because it was not found on your hard drive."))}),$.when()):"original"===i?(delete s.resized,s.trigger("image:resized",n),$.when()):e.matches("type",n)&&e.matches("size",n)?(s.resized=new $.Deferred,e.addDimensionsProperty(n).then(function(){if(n._dimensions&&e.matches("dimensions",n,{target:i})){var t=e.getTargetDimensions(n,i);return e.resizeImage(n,t)}}).then(function(e){e&&(s.resized.resolve(e),s.trigger("image:resized",e))})):$.when():$.when()}var a=t("Image size");return s.extend({settings:{small:i.get("features/imageResize/small",320),medium:i.get("features/imageResize/medium",640),large:i.get("features/imageResize/large",1280)},initialize:function(e){var t=i.get("features/imageResize/default","original");this.model.set("imageResizeOption",this.settings[t]||"original"),e=_({label:"",caret:!0}).extend(e),s.prototype.initialize.call(this,e)},setup:function(){s.prototype.setup.apply(this,arguments),this.$el.addClass("resize-options"),_.device("smartphone")&&(this.header(a),this.divider()),this.option("imageResizeOption",this.settings.small,t("Small (%1$s px)",this.settings.small),{radio:!0}),this.option("imageResizeOption",this.settings.medium,t("Medium (%1$s px)",this.settings.medium),{radio:!0}),this.option("imageResizeOption",this.settings.large,t("Large (%1$s px)",this.settings.large),{radio:!0}),this.option("imageResizeOption","original",t("Original"),{radio:!0}),this.listenTo(this.model,"change:imageResizeOption",this.onChange),this.listenTo(this.collection,"add reset",this.onAddReset),_.device("smartphone")||this.$el.prepend($('<span class="image-resize-label">').text(a+": "))},onChange:function(){this.collection.each(n.bind(null,this.model.get("imageResizeOption")))},onAddReset:function(e){n(this.model.get("imageResizeOption"),e)},label:function(){var e=t("Original");switch(this.model.get("imageResizeOption")){case this.settings.small:e=t("Small");break;case this.settings.medium:e=t("Medium");break;case this.settings.large:e=t("Large");break;default:e=t("Original")}this.$el.find(".dropdown-label").text(e+" "),this.$toggle.attr("aria-label",t("Image size")+": "+e)}})});