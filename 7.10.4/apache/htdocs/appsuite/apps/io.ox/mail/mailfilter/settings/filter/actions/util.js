define("io.ox/mail/mailfilter/settings/filter/actions/util",["io.ox/core/extensions","io.ox/backbone/mini-views","gettext!io.ox/mailfilter","io.ox/core/folder/api"],function(t,e,a,i){"use strict";function s(t,e){i.get(t).done(function(a){var i=t.split("/");i.shift(),a.standard_folder?e.val(a.title):e.val(i.join("/"))})}var l=e.InputView.extend({events:{change:"onChange",keyup:"onKeyup",paste:"onPaste"},onChange:function(){if("flags"===this.name){var t=/customflag_/g.test(this.id)||/removeflags_/g.test(this.id)?["$"+this.$el.val().toString()]:[this.$el.val()];this.model.set(this.name,t)}else"to"===this.name?this.model.set(this.name,this.$el.val().trim()):this.model.set(this.name,this.$el.val());this.onKeyup()},update:function(){/customflag_/g.test(this.id)||/removeflags_/g.test(this.id)?this.$el.val(this.model.get("flags")[0].replace(/^\$+/,"")):/move_/g.test(this.id)||/copy_/g.test(this.id)?s(this.model.get("into"),this.$el):this.$el.val($.trim(this.model.get(this.name)))},onKeyup:function(){var t=""===$.trim(this.$el.val())?"invalid:":"valid:";this.model.trigger(t+this.name),this.$el.trigger("toggle:saveButton")}}),d=e.DropdownLinkView.extend({onClick:function(t){t.preventDefault(),/markas_/g.test(this.id)?this.model.set(this.name,[$(t.target).attr("data-value")]):this.model.set(this.name,$(t.target).attr("data-value"))}}),n=function(t){return $('<button type="button" class="btn btn-link remove">').attr({"data-action":"remove-"+t,"aria-label":a("Remove")}).append($('<i class="fa fa-trash-o" aria-hidden="true">').attr("title",a("Remove")))};return{Input:l,drawAction:function(t){var i=t.errorView?new e.ErrorView({selector:".row"}).render().$el:[];return t.activeLink?$("<li>").addClass("filter-settings-view row").attr({"data-action-id":t.actionKey}).append($("<div>").addClass("col-sm-4 singleline").append($("<span>").addClass("list-title").text(t.title)),$("<div>").addClass("col-sm-8").append($("<div>").addClass("row").append($("<div>").addClass("col-sm-4 rightalign").append($('<a href="#" class="folderselect">').text(a("Select folder")).data({model:t.inputOptions.model})),$('<div class=" col-sm-8">').append($('<label for="'+t.inputId+'" class="sr-only">').text(t.inputLabel),new l(t.inputOptions).render().$el.prop("disabled",!0)))),n("action")):/markas_/g.test(t.inputId)?$("<li>").addClass("filter-settings-view row").attr({"data-action-id":t.actionKey}).append($("<div>").addClass("col-sm-4 singleline").append($("<span>").addClass("list-title").text(t.title)),$("<div>").addClass("col-sm-8").append($("<div>").addClass("row").append($("<div>").addClass("col-sm-3 col-sm-offset-9 rightalign").append(new d(t.dropdownOptions).render().$el))),n("action")):/discard_/g.test(t.inputId)||/keep_/g.test(t.inputId)?$("<li>").addClass("filter-settings-view "+t.addClass+" row").attr("data-action-id",t.actionKey).append($("<div>").addClass("col-sm-4 singleline").append($("<span>").addClass("list-title").text(t.title)),n("action")):$("<li>").addClass("filter-settings-view row").attr({"data-action-id":t.actionKey}).append($("<div>").addClass("col-sm-4 singleline").append($("<span>").addClass("list-title").text(t.title)),$("<div>").addClass("col-sm-8").append($("<div>").addClass("row").append($("<div>").addClass("col-sm-8 col-sm-offset-4").append($('<label for="'+t.inputId+'" class="sr-only">').text(t.inputLabel),new l(t.inputOptions).render().$el,i))),n("action"))},Dropdown:d,drawDeleteButton:n,prepareFolderForDisplay:s,drawColorDropdown:function(t,e,a){function i(t){t.preventDefault(),$(this).closest(".flag-dropdown").attr("data-color-value",t.data.color).removeClass(t.data.flagclass).addClass("flag_"+t.data.color)}var s="flag_"+a[t];return $('<div class="dropup flag-dropdown clear-title flag">').attr("data-color-value",t).addClass(s).append($('<a href="#" class="abs dropdown-toggle" data-toggle="dropdown" role="menuitem" aria-haspopup="true" tabindex="1">'),$('<ul class="dropdown-menu" role="menu">').append(_(e).map(function(t){return $("<li>").append($('<a href="#" data-action="change-color" tabindex="1">').append(t.value>0?$('<span class="flag-example">').addClass("flag_"+t.value):$(),$.txt(t.text)).on("click",{color:t.value,flagclass:s},i))})))}}});