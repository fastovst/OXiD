define("io.ox/mail/detail/mobileView",["io.ox/mail/detail/view","io.ox/mail/common-extensions","io.ox/core/extensions","io.ox/mail/api","io.ox/mail/util","io.ox/mail/detail/content","gettext!io.ox/mail","less!io.ox/mail/style"],function(i,e,t,a,o,d,n){"use strict";var l=0;t.point("io.ox/mail/mobile/detail").extend({id:"unread-class",index:l+=100,draw:e.unreadClass}),t.point("io.ox/mail/mobile/detail").extend({id:"flagged-class",index:l+=100,draw:e.flaggedClass}),t.point("io.ox/mail/mobile/detail").extend({id:"header",index:l+=100,draw:function(i){var e=$('<header class="mobile-detail-view-mail detail-view-header">');t.point("io.ox/mail/mobile/detail/header").invoke("draw",e,i),this.append(e)}});var s=0;return t.point("io.ox/mail/mobile/detail/header").extend({id:"drag-support",index:s+=100,draw:function(i){this.attr({"data-drag-data":_.cid(i.data),"data-drag-message":o.getSubject(i.data)})}}),t.point("io.ox/mail/mobile/detail/header").extend({id:"actions",index:s+=100,draw:e.actions}),t.point("io.ox/mail/mobile/detail/header").extend({id:"from",index:s+=100,draw:e.fromDetail}),t.point("io.ox/mail/mobile/detail/header").extend({id:"priority",index:s+=100,draw:e.priority}),t.point("io.ox/mail/mobile/detail/header").extend({id:"paper-clip",index:s+=100,draw:e.paperClip}),t.point("io.ox/mail/mobile/detail/header").extend({id:"recipients",index:s+=100,draw:e.recipients}),t.point("io.ox/mail/mobile/detail/header").extend({id:"subject",index:s+=100,draw:function(i){var e=o.getSubject(i.data);this.append($('<h1 class="subject">').text(e))}}),t.point("io.ox/mail/mobile/detail/header").extend({id:"date",index:s+=100,draw:e.fulldate}),t.point("io.ox/mail/mobile/detail/header").extend({id:"flags",index:s+=100,draw:function(i){var e=$('<span class="flags">').appendTo(this);t.point("io.ox/mail/mobile/detail/header/flags").invoke("draw",e,i)}}),t.point("io.ox/mail/mobile/detail/header/flags").extend({id:"security",index:s+=100,draw:e.security}),t.point("io.ox/mail/mobile/detail/header/flags").extend({id:"flag-toggle",index:s+=100,draw:e.flagToggle}),t.point("io.ox/mail/mobile/detail/header/flags").extend({id:"color-picker",index:s+=100,draw:function(i){e.flagPicker.call(this,i)}}),t.point("io.ox/mail/mobile/detail").extend({id:"notifications",index:l+=100,draw:function(i){var e=$('<section class="notifications">');t.point("io.ox/mail/detail/notifications").invoke("draw",e,i),this.append(e)}}),t.point("io.ox/mail/mobile/detail").extend({id:"body",index:l+=100,draw:function(){this.append($('<section class="attachments">'),$('<section class="body user-select-text">'))}}),t.point("io.ox/mail/mobile/detail/attachments").extend({id:"attachment-list",index:100,draw:function(i){0!==i.attachments.length&&e.attachmentList.call(this,i)}}),t.point("io.ox/mail/mobile/detail/attachments").extend({id:"attachment-preview",index:200,draw:e.attachmentPreview}),t.point("io.ox/mail/mobile/detail/body").extend({id:"iframe+content",index:100,draw:function(i){var e=this;t.point("io.ox/mail/detail/body").get("iframe",function(t){t.invoke("draw",e,i)}),t.point("io.ox/mail/detail/body").get("content",function(t){t.invoke("draw",e,i)})}}),t.point("io.ox/mail/mobile/detail/body").extend({id:"max-size",after:"content",draw:function(i){if(_(i.data.attachments).some(function(i){return i.truncated})){var e="api/mail?"+$.param({action:"get",view:"document",folder:i.data.folder_id,id:i.data.id,session:ox.session});this.append($('<div class="max-size-warning">').append($.txt(n("This message has been truncated due to size limitations.")),$.txt(" "),$('<a role="button" target="_blank">').attr("href",e).text(n("Show entire message"))))}}}),{HeaderView:i.View.extend({events:{"click .detail-view-header":"onClick"},onClick:function(i){$(i.target).hasClass("show-all-recipients")||this.$el.trigger("showmail")},toggle:function(){return this}}),DetailView:i.View.extend({onChangeAttachments:function(){var i=this.model.toJSON(),e=t.Baton({data:i,attachments:o.getAttachments(i),view:this}),a=this.$el.find("section.attachments").empty();t.point("io.ox/mail/mobile/detail/attachments").invoke("draw",a,e),this.model.previous("attachments")&&this.model.get("attachments")&&this.model.previous("attachments")[0].content!==this.model.get("attachments")[0].content&&this.onChangeContent()},onChangeContent:function(){var i=this.model.toJSON(),e=t.Baton({view:this,model:this.model,data:i,attachments:o.getAttachments(i)}),a=this.getEmptyBodyNode();e.disable(this.options.disable),t.point("io.ox/mail/mobile/detail/body").invoke("draw",a,e)},render:function(){var i=this.model.toJSON(),e=t.Baton({data:i,model:this.model,view:this}),a=o.getSubject(i),d=o.hasFrom(i)?n("Email from %1$s: %2$s",o.getDisplayName(i.from[0]),a):a;return _(this.options.disable).each(function(i,t){_.isArray(i)?_(i).each(function(i){e.disable(t,i)}):e.disable(t,i)}),this.$el.attr({"aria-label":d,"data-cid":this.cid,"data-loaded":"false"}),this.$el.data({view:this,model:this.model}),this.baton=e,t.point("io.ox/mail/mobile/detail").invoke("draw",this.$el,e),$('[data-page-id="io.ox/mail/detailView"]').trigger("header_ready"),this}})}});