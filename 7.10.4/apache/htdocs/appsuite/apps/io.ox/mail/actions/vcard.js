define("io.ox/mail/actions/vcard",["io.ox/core/notifications","settings!io.ox/core","gettext!io.ox/mail","io.ox/contacts/api","io.ox/core/http"],function(e,i,n,o,t){"use strict";return function(a){var r=_.isArray(a.data)?_.first(a.data):a.data;require(["io.ox/core/api/conversion"]).done(function(a){a.convert({identifier:"com.openexchange.mail.vcard",args:[{"com.openexchange.mail.conversion.fullname":r.parent.folder_id},{"com.openexchange.mail.conversion.mailid":r.parent.id},{"com.openexchange.mail.conversion.sequenceid":r.id}]},{identifier:"com.openexchange.contact.json",args:[]}).then(function(a){function r(){var e=$.Deferred();return t.pause(),_.each(c.distribution_list,function(i,n){o.getByEmailaddress(i.mail).done(function(){n===c.distribution_list.length-1&&e.resolve()})}),t.resume(),e}if(_.isArray(a)&&0!==a.length){var c=a[0],s=i.get("folder/contacts");c.mark_as_distributionlist?require(["io.ox/contacts/distrib/main"],function(e){$.when(e.getApp(c).launch(),r()).done(function(){this[0].create(s,c)})}):require(["io.ox/contacts/edit/main"],function(e){c.folder_id=s,e.reuse("edit",c)||e.getApp(c).launch()})}else e.yell("error",n("Failed to add. Maybe the vCard attachment is invalid."))},function(i){e.yell(i)})})}});