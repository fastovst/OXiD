define("io.ox/mail/categories/mediator",["io.ox/core/capabilities","io.ox/core/extensions","io.ox/mail/categories/api","io.ox/mail/api","io.ox/mail/categories/tabs","io.ox/core/yell","settings!io.ox/mail","gettext!io.ox/mail"],function(e,i,o,t,n,a,r,s){"use strict";var c=r.get("folder/inbox"),l=!1,d=i.point("io.ox/mail/actions/category"),g={isVisible:function(){return l},getInitialCategoryId:function(){return"general"}};return e.has("mail_categories")?_.device("smartphone")?g:(i.point("io.ox/mail/mediator").extend({id:"toggle-category-tabs",index:2e4,setup:function(e){function i(){return!!e.props.get("categories")}function t(){return e.folder.get()===c}function n(){l=i()&&t(),e.getWindow().nodes.outer.toggleClass("mail-categories-visible",l),e.listView.model.set("category_id",l?e.props.get("category_id"):void 0),l&&o.collection.initializeRefresh(),d.toggle("default",l)}e.on("folder:change",n),e.props.on("change:categories",function(){i()&&!t()&&e.folder.set(c),n()}),n()}},{id:"foward-category-id",index:20100,setup:function(e){e.props.on("change:category_id",function(i,o){l&&e.listView.model.set("category_id",o)})}},{id:"import",index:0xe8d4a5100a,setup:function(e){e.queues.importEML&&e.queues.importEML.on("stop",function(i,n,r,s){var c,l=g.getInitialCategoryId(),d=e.listView.model.get("category_id");g.isVisible()&&d&&l!==d&&(c=_(s).chain().pluck("response").filter(function(e){return!("Error"in e)}).value(),t.getList(c).done(function(e){o.move({source:l,target:d,sourcename:o.collection.get(l).get("name"),targetname:o.collection.get(d).get("name"),data:e}).fail(a)}))})}},{id:"category-tabs",index:20200,setup:function(e){_.defer(function(){"compact"===e.props.get("layout")?e.right.addClass("classic-toolbar-visible").prepend($('<div class="categories-toolbar-container">').append(new n({props:e.props}).render().$el)):e.getWindow().nodes.body.addClass("classic-toolbar-visible").prepend($('<div class="categories-toolbar-container">').append(new n({props:e.props}).render().$el))}),o.on("move train",e.listView.reload.bind(e.listView)),o.collection.on("save",e.listView.reload.bind(e.listView))}},{id:"ensure-category-id",index:20300,setup:function(e){o.collection.on("change:enabled",function(i,o){o||i.id===e.props.get("category_id")&&e.props.set("category_id","general")})}},{id:"setting-updates-prop",index:20400,setup:function(e){r.on("change:categories/enabled",function(i){e.props.set("categories",i)})}},{id:"check-category-state",index:20500,setup:function(e){e.props.get("categories")&&"running"===r.get("categories/initialized")&&a("info",s("It may take some time until mails are assigned to the default categories."))}}),g):g});