define("io.ox/find/view-token",["io.ox/backbone/mini-views/dropdown"],function(e){"use strict";return Backbone.View.extend({initialize:function(){return this.ui={label:this.$el.find(".token-label"),tokeninput:this.$el.parent().find(".token-input.tt-input"),dropdown:$()},this.api=this.$el.closest(".tokenfield").find("input.tokenfield").data("bs.tokenfield"),this.listenTo(this.model,"change:option",_.bind(this.render,this)),this},render:function(){return this.ui.label.empty().append(this.model.isPerson()?this.getDropdown():this.getNameNode()),this.api.update(),this},getNameNode:function(){return this.model.isPerson()?$():this.model.getNameDetail()?[$('<span class="token-name">').text(this.model.getName()),$.txt("Â "),$('<span class="token-detail">').text(this.model.getNameDetail())]:$.txt(this.model.getName())},update:function(){var e=this.$el.offset().left;this.ui.dropdown.$el.find(".dropdown-menu").css("left",e)},getDropdown:function(){if(!this.model.isPerson())return $();if(!this.model.get("options").length)return[$('<span class="token-name">').text(this.model.getDisplayName())];var t=this.model,n=new Backbone.Model,i=new e({model:n,tagName:"div",classname:"facets",label:function(){return[$('<span class="token-type">').text(t.getTokenType()),$('<i class="fa fa-caret-down" aria-hidden="true">'),$('<span class="token-name">').text(t.getDisplayName())]}});return i.$el.on("show.bs.dropdown",function(){$(this).find(".dropdown-menu").css("top",$(this).offset().top+$(this).height()+"px")}),this.ui.dropdown=i,n.set("option",t.getOption().id),i.$el.on("show.bs.dropdown",_.bind(this.update,this)),n.on("change:option",function(e,n){t.activate(n)}),_.each(t.get("options"),function(e){if(!e.hidden){var t=(e.item||e).name;i.option("option",e.id,t)}}),i.render().$el.addClass("pull-left").attr("data-dropdown","view")}})});