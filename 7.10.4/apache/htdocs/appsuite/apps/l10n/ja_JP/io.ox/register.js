define("l10n/ja_JP/io.ox/register",["io.ox/contacts/util","io.ox/core/extensions","io.ox/backbone/mini-views","l10n/ja_JP/io.ox/collation","settings!io.ox/core","css!l10n/ja_JP/io.ox/style.css"],function(t,n,i,a,e){"use strict";function o(t){return{first:$.trim(t.first_name),last:$.trim(t.last_name),company:$.trim(t.company),first_yomi:$.trim(t.yomiFirstName),last_yomi:$.trim(t.yomiLastName),company_yomi:$.trim(t.yomiCompany)}}function r(t){return["first","last","company"].reduce(function(n,i){return t[i+"_yomi"]&&t[i+"_yomi"]!==t[i]?(t[i]||(t[i+"_yomi"]=""),!0):n},!1)}function s(t,n,i){t.find(n).addClass("with-furigana").prepend($('<span class="furigana">').text(i||" "),$("<br>"))}function m(t,n){function i(){var t=e.value;if(t!==c){if(c=t,!t)return o.value="",l=0,s="",m=0,void(u=0);for(var n=0,i=t.length,r=s.length;n<i&&n<r&&t.charAt(n)===s.charAt(n);n++);for(var f=0,h=i,g=r;h>n&&g>n&&t.charAt(--h)===s.charAt(--g);f++);if(n+f===r){if((n<m||f<u)&&(m=n,u=f,l=0),a(t.substring(n,i-f))){s=t;var p=a(t.slice(m,i-u)),y=o.value;o.value=y.slice(0,y.length-l)+p,l=p.length}}else m=(s=t).length,u=0,l=0}}function a(t){for(var n=[],i=0;i<t.length;i++){var a=t.charCodeAt(i);a>=12353&&a<=12446&&(a+=96),(a>=12447&&a<=12543||a>=12784&&a<=12799||a>=65377&&a<=65439)&&n.push(a)}return String.fromCharCode.apply(String,n)}var e=t.get(0),o=n.get(0);if(e&&o){var r;t.on({focus:function(){r=setInterval(i,200)},blur:function(){void 0!==r&&(clearInterval(r),r=void 0),n.trigger("change")}});var s=e.value,m=0,u=0,c=s,l=0}}t.getFullNameWithFurigana=function(t){var n=this.getFullName(t,!0),i=$("<div>").html(n);return t=o(t),r(t)&&(s(i,".title",""),s(i,".last_name",t.last_yomi),s(i,".first_name",t.first_yomi),s(i,".company",t.company_yomi)),i.contents().length?i.contents():""},n.point("io.ox/contacts/edit/view").extend({index:"last",id:"furigana",render:function(){e.get("features/furiganaAutoComplete",!1)&&(m(this.$('input[name="last_name"]'),this.$('input[name="yomiLastName"]')),m(this.$('input[name="first_name"]'),this.$('input[name="yomiFirstName"]')),m(this.$('input[name="company"]'),this.$('input[name="yomiCompany"]')))}}),n.point("io.ox/contacts/api/search").extend({id:"furigana",getData:function(){this.last_name&&(this.yomiLastName=this.last_name),this.first_name&&(this.yomiFirstName=this.first_name),this.company&&(this.yomiCompany=this.company)}});var u=[12354,12363,12373,12383,12394,12399,12414,12420,12425,12431],c=_.map(u,function(t){return String.fromCharCode(t)});"ja_JP"===ox.locale&&(n.point("io.ox/contacts/getLabel").extend({id:"furigana",getLabel:function(t){var n=String(t.sort_name||"").substr(0,1).toUpperCase();return""===n?"A～Z":a.isKana(n)?a.getKanaLabel(n):/^[A-ZÄÖÜ]/.test(n)?"A～Z":"その他"}}),n.point("io.ox/contacts/thumbIndex").extend({index:200,id:"furigana",getIndex:function(t){var n=_(t.labels).keys(),i=_(n).any(function(t){return"その他"===t}),a=_(n).any(function(t){return"A～Z"===t}),e=new t.Thumb({label:"その他",text:"その他",enabled:function(){return i}}),o=new t.Thumb({label:"A～Z",text:"A～Z",enabled:function(){return a}});t.data=_.map(c,t.Thumb),t.data.push(e,o)}}))});