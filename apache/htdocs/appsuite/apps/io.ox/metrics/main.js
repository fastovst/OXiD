define("io.ox/metrics/main",["io.ox/core/extensions","settings!io.ox/core","io.ox/metrics/util","io.ox/core/capabilities","io.ox/core/http","io.ox/metrics/extensions","io.ox/metrics/adapters/default","io.ox/metrics/adapters/pro","io.ox/metrics/adapters/analytics","io.ox/metrics/adapters/console","io.ox/metrics/adapters/context"],function(e,t,i,a,o){"use strict";function n(){return!i.doNotTrack()&&(!_.device("karma")&&(!ox.debug&&!!t.get("tracking/enabled",!1)))}function r(e){var t=e.data,i=t.action?t.action.replace(/^io\.ox\//,""):t.action,a=_.isBoolean(t.detail)?String(t.detail):t.detail,o=_.compact([t.app,t.target,i,a]).join("/");return o?(e.id=o,e):e}function c(t){var i=!!t.preventDefault;return r(e.Baton.ensure(i?{data:t.data,event:t}:{data:t}))}function s(e){var t="drive"===e.app?"files":e.app,i=o.getColumnMapping(t);return e.detail=i[e.detail]||e.detail}var l,d,u=e.point("io.ox/metrics/adapter");return d={trackEvent:function(e){"sort"===e.action&&s(e),u.invoke("trackEvent",d,c(e))},trackPage:function(e){u.invoke("trackPage",d,c(e))},trackVariable:function(e){u.invoke("trackVariable",d,e)},watch:function(e,t){e.node.on(e.type,e.selector,t,d.trackEvent)},getUserHash:function(){return l=l||i.getUserHash()},getFolderFlags:i.getFolderFlags,isEnabled:n},n()?(u.invoke("setup",d),u.invoke("trackVisit",d,[{id:"language",value:ox.language},{id:"version",value:ox.version},{id:"capabilities",value:a.getFlat().enabled}]),e.point("io.ox/metrics/extensions").invoke("register",d),d):(_.each(d,function(e,t){d[t]=$.noop}),d)});