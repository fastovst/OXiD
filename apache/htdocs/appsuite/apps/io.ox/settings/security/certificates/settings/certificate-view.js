define("io.ox/settings/security/certificates/settings/certificate-view",["io.ox/core/extensions","io.ox/backbone/views/modal","gettext!io.ox/settings/certificates","io.ox/backbone/views/disposable","io.ox/core/api/certificate","io.ox/core/api/account","less!io.ox/settings/security/certificates/settings/style"],function(e,t,i,o,r,n){"use strict";return{CertificateSettingsView:o.extend({tagName:"li",className:"settings-list-item",events:{'click [data-action="toggle"]':"onToggle",'click [data-action="delete"]':"onDelete"},render:function(){if(this.disposed)return this;var t=e.Baton({model:this.model,view:this});return e.point("io.ox/settings/security/certificates/settings/detail/view").invoke("draw",this.$el.empty(),t),this},onToggle:function(e){var t=this;e.preventDefault();var i=this.model.get("trusted");this.model.set("trusted",!i,{validate:!0}),r.update({fingerprint:this.model.get("fingerprint"),hostname:this.model.get("hostname"),trust:this.model.get("trusted")}).done(function(){n.trigger("refresh:ssl",t.model.get("hostname")),t.refreshWidget(),t.render()})},removeCertificate:function(){var e=this;r.remove({fingerprint:this.model.get("fingerprint"),hostname:this.model.get("hostname")}).done(function(){ox.trigger("SSL:remove",{code:"SSL:remove",error_params:[e.model.get("fingerprint"),e.model.get("hostname")]}),e.model.collection.remove(e.model.cid),e.refreshWidget(),e.render()})},onDelete:function(e){e.preventDefault();var o=this;new t({title:i("Remove certificate"),description:i("Do you really want to remove this certificate?")}).addCancelButton().addButton({label:i("Remove"),action:"certremove"}).on("certremove",function(){o.removeCertificate()}).open()},refreshWidget:function(){require(["io.ox/portal/main","io.ox/portal/widgets"],function(e,t){var i=e.getApp();_(t.getEnabled()).chain().filter(function(e){return"rss"===e.get("type")}).each(function(e,t){i.refreshWidget(e,t)})})}})}});