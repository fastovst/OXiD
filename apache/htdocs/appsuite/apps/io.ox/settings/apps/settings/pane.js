define("io.ox/settings/apps/settings/pane",["io.ox/core/extensions","gettext!io.ox/core","io.ox/core/http","io.ox/backbone/views/modal","io.ox/core/notifications","io.ox/core/capabilities","less!io.ox/settings/apps/settings/style"],function(e,t,i,n,s,o){"use strict";if(o.has("oauth-grants")){e.point("io.ox/settings/pane/external").extend({id:"external/apps",title:t("External Apps"),ref:"io.ox/settings/apps",index:100});var a=Backbone.View.extend({tagName:"ul",className:"list-unstyled list-group settings-list",events:{"click .remove":"onRemove"},initialize:function(){this.$el.on("dispose",function(e){this.dispose(e)}.bind(this)),this.listenTo(this.collection,"reset remove",this.render)},onRemove:function(e){e.preventDefault();var o=$(e.currentTarget).closest("li").attr("data-id");new n({title:t("Do you want to revoke the access of this application?")}).addCancelButton().addButton({title:t("Revoke"),action:"ok"}).on("ok",function(){return r.remove(o),i.GET({module:"oauth/grants",params:{action:"revoke",client:o}}).fail(s.yell)}).open()},renderItem:function(e){var i=e.get("client");return $('<li class="widget-settings-view">').attr("data-id",i.id).append($("<img>").attr("src",i.icon),$('<div class="selectable deletable-item">').append($('<div class="widget-title">').text(i.name),$("<div>").append($('<a target="_blank" rel="noopener">').attr("href",i.website).text(i.website)),$("<div>").text(i.description),$('<div class="permissions">').append($("<span>").text(t("Permissions:")),_(e.get("scopes")).values().join(" ")),$('<div class="date">').append($("<span>").text(t("Approved:")),moment(e.get("date")).format("l"))),$('<div class="widget-controls">').append($('<a class="remove" href="#" role="button" data-action="delete" aria-label="remove">').attr({title:t("Delete")}).append('<i class="fa fa-trash-o" aria-hidden="true">')))},render:function(){return this.$el.empty().append(this.collection.map(this.renderItem)),this},dispose:function(){this.stopListening(),this.collection=null}}),l=Backbone.Model.extend({initialize:function(e){this.id=e.client.id}}),r=new(Backbone.Collection.extend({model:l,load:function(){var e=this;return i.GET({module:"oauth/grants",params:{action:"all"}}).done(function(t){e.reset(t)})}}));e.point("io.ox/settings/apps/settings/detail").extend({id:"title",index:100,draw:function(){this.addClass("io-ox-app-settings"),this.append($("<h1>").text(t("External Apps")))}}),e.point("io.ox/settings/apps/settings/detail").extend({id:"sub-title",index:200,draw:function(){var e;this.append(e=$('<div class="hint">')),r.off("reset remove",null,this),r.on("reset remove",function(){r.length>0?e.text(t("The following external applications/services can access your data:")):e.text(t("There are no external applications/services which can access your account."))},this)}}),e.point("io.ox/settings/apps/settings/detail").extend({id:"list",index:300,draw:function(){var e;this.append(e=$("<fieldset>")),r.length>0?(r.load(),e.append(new a({collection:r}).render().$el)):r.load().done(function(){e.append(new a({collection:r}).render().$el)})}})}});