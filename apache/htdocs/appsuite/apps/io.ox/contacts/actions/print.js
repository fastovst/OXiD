define("io.ox/contacts/actions/print",["io.ox/core/extensions","io.ox/backbone/mini-views","gettext!io.ox/contacts","io.ox/core/print","settings!io.ox/contacts"],function(t,e,i,n,o){"use strict";var s={simple:"io.ox/contacts/print",details:"io.ox/contacts/print-details"};return t.point("io.ox/contacts/actions/print/dialog").extend({id:"preview",index:100,render:function(t){var n,o=new $.Deferred;this.$body.append($('<div class="col-xs-offset-1 col-xs-6">').append(n=$('<iframe aria-hidden="true">').attr({title:i("Print preview"),src:ox.base+"/print.html"}).on("load",o.resolve)),$('<div class="col-xs-5">').append($("<fieldset>").append($('<legend class="sr-only">').attr("aria-labelledby",this.$el.attr("aria-labelledby")),new e.CustomRadioView({model:this.model,name:"list-type",list:[{value:"simple",label:i("Phone list")},{value:"details",label:i.pgettext("contact-print-dialog","Details")}]}).render().$el))),o.done(function(){n.contents().find("body").addClass("scaled-preview")}),this.listenTo(this.model,"change:list-type",function(){var e=s[this.model.get("list-type")]||"io.ox/contacts/print";$.when(require([e]),o).done(function(e){var i=e.getOptions(t.view.options.list),o=n.contents().find(i.selector).html(),s=n.contents().find("body");$.when.apply($,_.chain(i.selection).map(function(t){return _.isString(t)?t:_.cid(t)}).uniq().map(function(t,e){return i.get(_.cid(t)).then(function(t){return i.process?i.process(t,e,i):t})}).value()).done(function(){var t=_.chain(arguments).toArray(),e=t.value().length;i.filter&&(t=t.filter(i.filter)),i.sortBy&&(t=t.sortBy(i.sortBy)),t=t.value(),s.find(".print-wrapper").remove(),s.prepend($('<div class="print-wrapper">'+$.trim(_.template(o)({data:t,i18n:i.i18n,length:t.length,filtered:e-t.length}))+"</div>")),s.find(".note").remove()})})})}}),{multiple:function(t){require(["io.ox/backbone/views/modal"],function(e){new e({model:new Backbone.Model({"list-type":o.get("contactsPrintLayout")}),title:i("Select print layout"),point:"io.ox/contacts/actions/print/dialog",list:_(t).first(40)}).build(function(){this.$el.addClass("io-ox-contact-print-dialog")}).addCancelButton().addButton({label:i("Print"),action:"print"}).on("print",function(){var e=s[this.model.get("list-type")]||"io.ox/contacts/print";n.request(e,t),this.model.get("list-type")!==o.get("contactsPrintLayout")&&o.set("contactsPrintLayout",this.model.get("list-type")).save()}).on("open",function(){this.model.trigger("change:list-type")}).open()})}}});