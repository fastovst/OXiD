define("io.ox/tours/whats-new",["io.ox/core/extensions","io.ox/core/capabilities","settings!io.ox/tours","io.ox/core/tk/wizard","io.ox/backbone/views/modal","gettext!io.ox/core"],function(t,e,o,n,i,a){"use strict";var s,c=t.point("io.ox/tours/whats_new");return t.point("io.ox/tours/whats_new").extend({id:"launcher-icon",index:100,steps:function(t){t.tour&&t.tour.step().title(a("App Launcher")).content(a("To navigate between the %1$s applications, just click on the new App Launcher icon.",ox.serverConfig.productName)).spotlight("#io-ox-launcher").end()}}),t.point("io.ox/tours/whats_new").extend({id:"launcher",index:200,steps:function(t){t.tour&&t.tour.step().title(a("App Launcher")).waitFor(".launcher-dropdown:visible").on("wait",function(){0===$(".launcher-dropdown:visible").length&&$(".launcher-btn").click(),$("#io-ox-launcher").attr("forceOpen",!0)}).on("hide",function(){$("#io-ox-launcher").attr("forceOpen",!1),$(".launcher-dropdown:visible").length&&$(".launcher-btn").click()}).content(a("Click on the application that you would like to use.")).spotlight(".launcher-dropdown").end()}}),t.point("io.ox/tours/whats_new").extend({id:"compose",index:300,steps:function(t){t.tour&&t.tour.step().title(a("New Windows")).waitFor(".io-ox-mail-compose-window:visible:last").on("back",function(){s&&!s.getWindow().floating.model.get("minimized")&&s.getWindow().floating.onMinimize()}).on("wait",function(){s?s.getWindow().floating.model.get("minimized")&&s.getWindow().floating.model.set("minimized",!1):ox.launch("io.ox/mail/main").done(function(){ox.registry.call("mail-compose","open").then(function(t){s=t.app})})}).content(a("E-Mails will appear in a new window. These windows can be maximized, minimized and closed.")).spotlight(".io-ox-mail-compose-window:visible:last").end()}}),t.point("io.ox/tours/whats_new").extend({id:"compose-minimized",index:400,steps:function(t){t.tour&&t.tour.step().title(a("New Windows")).waitFor(".taskbar-button:visible:last").on("wait",function(){s&&s.getWindow().floating.model.get("minimized")||$('.io-ox-mail-compose-window:last [data-action="minimize"]').click()}).content(a("Windows you have minimized will appear in all applications for easy access. You can maximize a window again by clicking on it.")).spotlight(".taskbar-button:visible:last").end().on("stop",function(){s&&(s.view.dirty(!1),s.quit(),s=null)})}}),t.point("io.ox/tours/whats_new").extend({id:"multifactor",index:500,steps:function(t){t.tour&&e.has("multifactor")&&t.tour.step().title(a("2-step Verification Options")).waitFor(".multifactorStatusDiv.mfLoaded").on("wait",function(){ox.launch("io.ox/settings/main",{id:"io.ox/multifactor"})}).content(a("You can now add additional verification options to enhance the security of your account.")).spotlight(".io-ox-multifactor-settings #addDevice").end()}}),t.point("io.ox/tours/whats_new").extend({id:"help",index:600,steps:function(t){t.tour&&t.tour.step().title(a("What's new")).content([a("To learn more about the new and improved features you can visit "),$('<a target="_blank" rel="noopener">').text(o.get("whatsNew/helpUrl","https://www.open-xchange.com/whats-new-7-10")).attr("href",o.get("whatsNew/helpUrl","https://www.open-xchange.com/whats-new-7-10"))]).end()}}),n.registry.add({id:"default/io.ox/whats_new",priority:1},function(){var e=new n,s=new t.Baton({tour:e});c.invoke("steps",this,s),e.on("stop",function(){o.set("whatsNew/autoShow",0).save()}),e.steps[0].options.labelNext=a("Next"),new i({title:a("What's new"),width:"600px"}).build(function(){this.$body.css("white-space","pre-line").append($("<div>").text(a("Welcome to %1$s.\nWe've made some exciting changes to %1$s. This quick tour will guide you through some of the new and improved features.",ox.serverConfig.productName))),this.$footer.append($('<div class="checkbox pull-left">').css({margin:"0",padding:"4px 0"}).append($('<label class="control-label">').text(a("Never show again")).prepend('<input type="checkbox">')))}).addCancelButton().addButton({action:"start",label:a("Start tour")}).on("start",function(){this.$footer.find("input").prop("checked")&&o.set("whatsNew/neverShowAgain",!0).save(),e.start()}).on("cancel",function(){this.$footer.find("input").prop("checked")&&o.set("whatsNew/neverShowAgain",!0).save()}).open(),o.set("whatsNew/autoShow",Math.max(o.get("whatsNew/autoShow",1)-1,0)).save()}),o.get("whatsNew/menuEntry",!0)&&t.point("io.ox/core/appcontrol/right/dropdown").extend({id:"whats-new",index:260,extend:function(){e.has("guest")||_.device("smartphone")||this.append($('<a href="#" data-action="whats-new" role="menuitem">').text(a("What's new")).on("click",function(t){t.preventDefault(),n.registry.run("default/io.ox/whats_new")}))}}),{run:function(){n.registry.run("default/io.ox/whats_new")}}});