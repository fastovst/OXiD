define("io.ox/portal/settings/widgetview",["io.ox/core/extensions","io.ox/backbone/views/modal","io.ox/core/manifests","io.ox/core/upsell","gettext!io.ox/portal","io.ox/backbone/views/disposable","less!io.ox/portal/style"],function(t,e,i,o,n,l){"use strict";return l.extend({tagName:"li",className:"settings-list-item",events:{'click [data-action="edit"]':"onEdit",'click [data-action="change-color"]':"onChangeColor",'click [data-action="toggle"]':"onToggle",'click [data-action="delete"]':"onDelete"},initialize:function(){this.$el.attr("data-widget-id",this.model.get("id"));var e=this.model.get("enabled");this.model.set("enabled",!(void 0!==e&&!0!==e),{validate:!0});var i=this.model.get("color");this.model.set("color",void 0===i||"default"===i?"default":i,{validate:!0}),this.point="io.ox/portal/widget/"+this.model.get("type"),this.options=t.point(this.point+"/settings").options()},render:function(){var e=t.Baton({model:this.model,view:this});return this.disposed?this:(t.point("io.ox/portal/settings/detail/list-item").invoke("draw",this.$el.empty(),e),this)},edit:function(){_.isFunction(this.options.edit)&&this.options.edit(this.model,this)},onEdit:function(t){t.preventDefault(),this.edit()},onChangeColor:function(t){t.preventDefault();var e=$(t.target),i=e.attr("data-color")?e.attr("data-color"):e.parent().attr("data-color");this.model.set("color",i),this.render()},onToggle:function(t){t.preventDefault();var e=this.model.get("enabled"),n=this.model.get("type"),l=i.manager.getRequirements("plugins/portal/"+n+"/register");e||o.any(l)?(this.model.set("enabled",!e,{validate:!0}),this.render()):o.trigger({type:"portal-widget",id:n,missing:o.missing(l)})},removeWidget:function(){this.model.collection.remove(this.model)},onDelete:function(t){t.preventDefault();var i=this;if(_.isEmpty(this.model.get("props")))this.removeWidget();else{var o=new e({title:n("Delete widget"),description:n("Do you really want to delete this widget?")}).addCancelButton().on("delete",function(){i.removeWidget()}).addButton({label:n("Delete"),action:"delete"});this.model.get("enabled")&&o.on("disable",function(){i.onToggle(t)}).addButton({label:n("Just disable widget"),action:"disable",placement:"left",className:"btn-default"}),o.open()}}})});