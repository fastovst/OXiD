define("io.ox/help/main",["io.ox/backbone/views/modal","gettext!io.ox/help","io.ox/core/capabilities","less!io.ox/help/style"],function(e,n,o){"use strict";function i(e){var n=e.href,o=e.base;return _.isFunction(n)&&(n=e.href()),_.isObject(n)&&(o=n.base||o,n=n.target||n),o+"/l10n/"+ox.language+"/"+n}return{getApp:function(t){var a=_.extend({base:"help",href:"index.html",modal:!1},t),d=n("%1$s Help",ox.serverConfig.productName||"OX App Suite"),l=ox.ui.createApp({name:"io.ox/help",title:d,closable:!0,floating:!_.device("smartphone"),size:"width-xs height-md",href:a.href});return l.cid="io.ox/help:"+i(a),l.showModal=function(n){var o=new e({focus:_.device("smartphone")?"":"iframe",title:d,width:"640px",maximize:650}).build(function(){this.$el.addClass("inline-help"),this.$body.append(n.addClass("abs"))}).addCloseButton().on("close",function(){l.quit()}).open();$.noop(o)},l.showFloatingWindow=function(e){var o;l.setWindow(o=ox.ui.createWindow({name:"io.ox/help",chromeless:!0,floating:!_.device("smartphone"),closable:!0,title:n("Online help")})),o.nodes.main.append(e),o.show()},l.createIframe=function(){function e(e){27===e.which&&(e.preventDefault(),$(".inline-help").find('[data-action="cancel"]').click())}function t(e){a.modal&&9===e.which&&e.shiftKey&&(e.preventDefault(),$(".inline-help").find('[data-action="cancel"]').focus())}function d(e){a.modal||9!==e.which||e.shiftKey||(e.preventDefault(),$(".io-ox-help-window").find('[data-action="minimize"]').focus())}var l=$('<iframe class="hidden inline-help-iframe" frameborder="0">').attr({src:i(a),title:n("loading")}),f=function(){a.modal||this.getWindow().floating.activate()}.bind(this);return l.on("load",function(){var n=a.modal?"embedded in-modal":"embedded",i=$(".inline-help-iframe").contents(),r=i.find(".oxhelp-content a:first"),s=i.find(".navbar-nav a:eq(2)"),c=o.getFlat(),h=i.find(".oxhelp-navigation-top"),u=i.find(".oxhelp-content");h.before(u),_(c.enabled).each(function(e){n+=" cap-"+e}),i.find("html").addClass(n).on("mousedown",f).find(".navbar-brand").remove(),i.find("body").on("keydown",e),r.on("keydown",t),s.on("keydown",d),$(this).attr("title",i.attr("title")).removeClass("hidden"),_.defer(function(){l.focus(),r.focus()}),$(this.contentWindow).on("dragover drop",!1),this.contentWindow.addEventListener("beforeunload",function(){l.addClass("hidden"),i.find("html").off("mousedown",f),i.find("body").off("keydown",e),r.off("keydown",t),s.off("keydown",d)})}),l},l.setLauncher(function(){var e=l.createIframe();if(a.modal)return l.showModal(e);l.showFloatingWindow(e)}),l.launch().then(function(){a.modal||this.getWindow().floating.activate()}),l},reuse:function(e){return ox.ui.App.reuse("io.ox/help:"+i(e))},getAddress:i}});