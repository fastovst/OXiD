define("io.ox/files/upload/view",["io.ox/core/tk/dialogs","gettext!io.ox/files","io.ox/files/upload/main","io.ox/core/extensions","io.ox/core/strings","less!io.ox/files/upload/style"],function(e,i,o,a,s){"use strict";var t=0,n=Backbone.View.extend({initialize:function(e){var o=this;this.dialog=e.dialog,this.model=e.model,this.index=e.index,this.model.on("change:progress",function(){var e=Math.round(100*o.model.get("progress"));if(1===o.model.get("progress"))o.$el.find(".progress").addClass("invisible"),o.$el.find(".remove-icon").off("click").empty().append($('<i class="fa fa-lg fa-check" aria-hidden="true">'));else{var a=o.$el.find(".progress-bar");a.css({width:e+"%"}).attr({"aria-valuenow":e}),a.find(".sr-only").text(i("%1$s completed",e+"%"))}}),this.model.on("change:abort",function(e,i){if(i){var a,s=o.$el.parent();o.remove(),(a=s.find(".upload-entry")).each(function(e,i){$(i).attr({index:e})}),0===a.length&&o.dialog.close()}})},render:function(){var e=Math.round(100*this.model.get("progress")),o=$('<div class="remove-icon">');this.$el.attr("data-cid",this.model.cid).addClass("upload-entry").append($('<div class="file-name">').text(this.model.get("file").name),$('<div class="file-size">').text(i.format("%1$sÂ ",s.fileSize(this.model.get("file").size))),o,$('<div class="progress">').addClass(this.model.get("progress")<1?"":"invisible").append($('<div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">').attr("aria-valuenow",e).css({width:e+"%"}).append($('<span class="sr-only">').text(i("%1$s completed",e+"%"))))),this.model.get("progress")<1?o.append($('<a href=# class="remove-link">').text(i("Cancel"))):o.append($('<i class="fa fa-lg fa-check" aria-hidden="true">'))},events:{"click .remove-link":"removeEntry"},removeEntry:function(e){e.preventDefault(),o.abort(this.$el.attr("data-cid"))}});return a.point("io.ox/files/upload/files").extend({index:t+=100,id:"files",draw:function(e){e.container=this,e.collection.each(function(i,o){var a=new n(_.extend(e,{model:i,index:o}));a.render(),e.container.append(a.el)})}}),{show:function(){var s=$('<div class="view-upload-wrapper">'),t=new e.CreateDialog({width:450,center:!0,async:!0,container:$(".io-ox-files-window"),tabTrap:!0});a.point("io.ox/files/upload/files").invoke("draw",s,{collection:o.collection,dialog:t}),t.header($("<h4>").text(i("Upload progress"))),t.getBody().append(s),t.addButton("cancel",i("Close"),"close").on("close",function(){o.collection.each(function(e){e.off("change:progress")})}).show()}}});