define("io.ox/find/extensions-facets",["io.ox/core/extensions","io.ox/backbone/mini-views/toolbar","io.ox/backbone/mini-views/dropdown","io.ox/backbone/mini-views/helplink","gettext!io.ox/core"],function(e,t,i,n,o){"use strict";return{toolbar:function(i){if(!_.device("smartphone")){var n=new t({title:o("Search")}).render().$list.clone();this.append(n),e.point("io.ox/find/facets/list").invoke("draw",n,i)}},list:function(t){var i,n=this,o=[];i=t.model.manager.filter(function(e){return e.is("toolbar")}),t.options.conflicting={},_.each(i,function(e){e.getValue().isActive()&&_.each(e.getConflicting(),function(e){t.options.conflicting[e]=!0})}),_.each(i,function(i){if(i.is("toolbar")){var a=i.get("id"),s=e.point("io.ox/find/facets/dropdown/"+a);s.list().length>0?s.invoke("draw",n,t,i):o.push(i)}}),o.length&&e.point("io.ox/find/facets/dropdown/default").invoke("draw",this,t,o),e.point("io.ox/find/facets/help").invoke("draw",this,t,o)},dropdownDefault:function(t,n){var a=new Backbone.Model,s=new i({model:a,tagName:"li",className:"facets dropdown pull-left",attributes:{"data-dropdown":"view",role:"presentation"},caret:!0,label:o("Options")});_.each(n,function(i){e.point("io.ox/find/facets/dropdown/default/item").invoke("draw",s,t,i)}),a.on("change",function(e){var i=Object.keys(e.changed)[0],n=e.get(i+":value"),o=e.get(i);t.model.manager.activate(i,n,o)}),this.append(s.render().$el)},item:function(e,t){var i=this,n=i.model,o=t.id,a=e.options.conflicting[o];i.$ul.append($('<li class="dropdown-header">').text(t.getName())),_.each(t.get("values").models,function(e){e.set(o,e.getOption().id),n.set(o,e.getOption().id),n.set(o+":value",e.id),_.each(e.get("options"),function(e){if(!e.hidden){var t=(e.item||e).name;i.option(o,e.id,t),a&&i.$ul.children().last().find("a").addClass("disabled")}})})},dropdownFolder:function(e,t){var n,o=t.get("values").first(),a=o.getOption().id,s=new Backbone.Model({option:a}),d=new i({model:s,tagName:"li",caret:!0,label:o.getOption().name||o.getDisplayName(),attributes:{"data-facet":t.get("id"),"data-dropdown":"view",role:"presentation"},className:"facets dropdown pull-left"});e.options.conflicting[t.id]&&d.$el.addClass("conflicting");var l={default:"standard"};o.set("option",a),s.on("change:option",function(t,i){e.view.userchange(),o.activate(i)}),_.each(o.get("options"),function(t){if(!t.hidden){var i=(t.item||t).name,o=t.account||t.type,a=e.view.ui.facets;n&&(l[o]||o!==n)&&(d.divider(),t.item&&t.item.detail&&d.$ul.append($('<li class="dropdown-header">').text(t.item.detail))),n=l[o]||o,"link"!==o?d.option("option",t.id,i):d.link("link",i,_.bind(a[t.callback],a))}}),this.append(d.render().$el)},help:function(){var e={mail:"ox.appsuite.user.sect.email.search.html",contacts:"ox.appsuite.user.sect.contacts.search.html",calendar:"ox.appsuite.user.sect.calendar.search.html",tasks:"ox.appsuite.user.sect.tasks.search.html",files:"ox.appsuite.user.sect.drive.search.html"};return function(t){var i=e[t.app.getModuleParam()];if(i){var o=new n({href:i});o.$el.hasClass("hidden")||this.append($('<li class="pull-right" role="presentation">').append(o.render().$el))}}}()}});