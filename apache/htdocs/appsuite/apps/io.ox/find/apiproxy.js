define("io.ox/find/apiproxy",["io.ox/core/extensions","io.ox/find/api","io.ox/core/notifications","io.ox/find/extensions-api"],function(e,t,n,r){"use strict";var i=e.point("io.ox/find/api/autocomplete");i.extend({id:"custom-facet-daterange",index:200,customize:r.daterange}),i.extend({id:"flag",index:300,customize:r.flag}),i.extend({id:"folder",index:350,customize:r.folder}),i.extend({id:"account",index:360,customize:r.account}),i.extend({id:"add-option-disabled",index:400,customize:r.addOptionDisabled});return{init:function(r){function a(t,n){var a=e.Baton.ensure({app:r,data:n.facets,request:t,waitsFor:[]});return i.invoke("customize",this,a),$.when.apply($,a.waitsFor).then(function(){return a.data})}function o(e){return e.data.facets=d.manager.getRequest(),e.data.options=e.data.options||{},/^virtual/.test(e.data.options.folder)&&!r.isMandatory("folder")&&(e.data.options.folder=void 0),t.autocomplete(e).then(a.bind(this,e))}var d=r.model;return{resetCache:t.resetCache,config:function(e){var n={params:{module:r.getModuleParam()},data:{facets:d.manager.getRequest(),prefix:""}},i=$.extend(!0,n,e||{});return t.config(i).then(a.bind(this,i))},search:function(e){var t={params:{module:r.getModuleParam()},data:{prefix:e}};return r.trigger("find:autocomplete:start",e),o(t).then(function(t){return d.set({query:e}),t},function(e){throw n.yell(e),e})},query:function(){function e(e){return!e.data.facets.length||1===e.data.facets.length&&"folder"===e.data.facets[0].facet?$.Deferred().resolve(void 0):t.query(e)}function i(e,t){return t&&(t.request=e),t}function a(e){return e&&r.trigger("find:query:result",e),r.trigger("find:query:stop"),e}function o(e){throw n.yell(e),r.trigger("find:query:stop"),r.trigger("find:query:fail"),e}return function(t,n){var u=d.manager,s={params:_.extend({module:r.getModuleParam()},n),data:{start:d.get("start"),size:d.get("size")+d.get("extra"),facets:u.getRequest()}};return r.trigger("find:query:start"),r.trigger("find:query:running"),e(s).then(i.bind(this,s)).then(t?a:_.lfo(a),t?o:_.lfo(o))}}()}}}});