define("io.ox/find/view",["io.ox/core/extensions","io.ox/find/view-searchbox","io.ox/find/view-facets","gettext!io.ox/core","less!io.ox/find/style"],function(i,e,t,s){"use strict";return Backbone.View.extend({events:{"focusin .token-input":"show",keydown:"onKeydown",focusout:"smartCancel","click .action-cancel":"cancel","keydown .action-cancel":"cancel"},classes:{active:"io-ox-find-active",userchange:"changed-by-user"},initialize:function(s){var n={app:s.app,win:s.app.getWindow(),model:s.model,baton:i.Baton({app:s.app,model:s.model,view:this,$:this.$el})};n.baton.model=n.model,_.extend(this,n),_.extend(this,{active:!1,lastFocus:"",selectors:{facets:".search-facets:first",facetsadv:".search-facets-advanced"}}),this.setElement(this.win.nodes.sidepanel.find(".io-ox-find")),this.ui={container:void 0,body:void 0,manager:void 0,searchbox:void 0,facets:void 0,field:this.$el.find(".search-field"),action:this.$el.find(".action-show")},this.ui.container=this.$el.closest(".window-container"),this.ui.body=this.ui.container.find(".window-body"),this.ui.manager=$("#io-ox-windowmanager"),this.ui.searchbox=new e(_.extend(n,{parent:this})),this.ui.facets=new t(_.extend(n,{parent:this})),this.listenTo(s.app,"view:disable",this.disable),this.listenTo(s.app,"view:enable",this.enable)},disable:function(){!0!==this.ui.field.prop("disabled")&&(this.ui.field.prop("disabled",!0),this.ui.action.prop("disabled",!0),this.ui.field.find("input.token-input.tt-input").removeAttr("tabindex"),this.$el.find("input.form-control.tokenfield").trigger("aria-live-update",s("Search function not supported in this folder")))},enable:function(){!1!==this.ui.field.prop("disabled")&&(this.ui.field.prop("disabled",!1),this.ui.action.prop("disabled",!1),this.ui.field.find("input.token-input.tt-input").attr("tabindex",0),this.$el.find("input.form-control.tokenfield").trigger("aria-live-update",""))},calculateDimensions:function(){this.css={body:{closed:this.ui.body.css("top"),open:this.$el.outerHeight()+"px"},el:{closed:this.$el.css("top"),open:this.ui.manager.offset().top+"px"}}},render:function(){return this.ui.searchbox.render(),this.ui.facets.render(),this.register(),this},onKeydown:function(i){this.isActive()||9===i.which||this.show()},show:function(){this.trigger("focusin"),this.isActive()||(this.calculateDimensions(),this.$el.next().css("margin-top",this.css.body.open),this.ui.body.css("top",this.css.body.open),this.ui.container.addClass(this.classes.active),this.ui.searchbox.show(),this.ui.facets.show(),this.trigger("show"))},hide:function(){this.isActive()&&this.isEmpty()&&(this.$el.next().css("margin-top",""),this.ui.body.css("top",this.css.body.closed),this.$el.css("top",this.css.el.closed),this.ui.container.removeClass(this.classes.active),this.ui.searchbox.hide(),this.ui.facets.hide(),this.trigger("hide"))},reset:function(){this.isActive()&&(this.model.reset(),this.ui.searchbox.reset(),this.ui.facets.reset(),this.ui.container.removeClass(this.classes.userchange),this.trigger("reset"))},cancel:function(i){i&&"click"!==i.type&&!/13|32/.test(i.which)||(this.reset(),this.hide(),this.trigger("cancel"))},userchange:function(){this.ui.container.addClass(this.classes.userchange),this.setFocus()},hasChanged:function(){return this.ui.container.hasClass(this.classes.userchange)},smartCancel:function(){var i=this;this.app.trigger("focusout"),_.delay(function(){i.hasFocus()||!i.isEmpty()||i.hasChanged()||i.cancel()},150)},_onResize:function(i){var e=this.$el,t=this.ui.facets.$el.find("ul"),s=this.$el.closest(".window-sidepanel").find(".folder-tree"),n=this.$el.closest(".window-container").find(".window-body");e.outerHeight(e.outerHeight()+i),t.outerHeight(t.outerHeight()+i),s.offset({top:s.offset().top+i}),this.app.isActive()&&n.offset({top:n.offset().top+i})},register:function(){this.ui.searchbox.on("resize",_.bind(this._onResize,this))},setFocus:function(){return this.ui.searchbox.setFocus()},isActive:function(){return this.ui.container.hasClass(this.classes.active)},isEmpty:function(){return this.ui.searchbox.isEmpty()},hasFocus:function(){return!!$(document.activeElement).closest(".io-ox-find, .smart-dropdown-container.facets").length}})});