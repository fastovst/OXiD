define("io.ox/find/date/patterns",["io.ox/core/extensions","gettext!io.ox/core"],function(t,e){"use strict";function a(){function t(t){return _.map(t,function(t){return"("!==t[0]?t:/\((.+)\|.*\)/.exec(t)[1]})}function a(t,e,a){[].concat(t).forEach(function(t){var n=String(t).toLowerCase();o[n]=_.extend({},a,{label:t,id:n,index:e})})}if(c===moment().format("YYYY-MM-DD"))return f;var n,o={},r=t(moment.weekdays()),d=t(moment.months()),m=moment().month(),i=moment().year();for(_(r).map(function(t,e){var n=moment().day(e);moment().diff(n,"day",!0)<0&&n.subtract(7,"days"),a(t,e,{start:n.clone(),end:n.clone()})}),n=i;n>=i-5;n--)_(d).each(_.partial(function(t,e,n){if(!(t===i&&n>m)){var o=n+1+" "+t;a(e+" "+t,-(t+.01*n),{start:moment(o,"M YYYY").startOf("month"),end:moment(o,"M YYYY").endOf("month")})}},n));for(n=i;n>=i-20;n--)a(n,-n,{start:moment(n,"YYYY").startOf("year"),end:moment(n,"YYYY").endOf("year")});return a(e("Today"),0,{start:moment(),end:moment()}),a([e("Last day"),e("Yesterday")],0,{start:moment().subtract(1,"day"),end:moment().subtract(1,"day")}),a([e("Last week"),e("Previous week")],0,{start:moment().subtract(7,"day").startOf("week"),end:moment().subtract(7,"day").endOf("week")}),a([e("Last month"),e("Previous month")],1,{start:moment().subtract(1,"month").startOf("month"),end:moment().subtract(1,"month").endOf("month")}),a([e("Last year"),e("Previous year")],2,{start:moment().subtract(1,"year").startOf("year"),end:moment().subtract(1,"year").endOf("year")}),a(e("Last 7 days"),3,{start:moment().subtract(7,"day"),end:moment()}),a(e("Last 30 days"),4,{start:moment().subtract(30,"day"),end:moment()}),a(e("Last 365 days"),5,{start:moment().subtract(7,"day"),end:moment()}),f={},_(o).each(function(t,e){var a=e.substr(0,2);(f[a]||(f[a]=[])).push(_.extend(t,{id:e}))}),c=moment().format("YYYY-MM-DD"),f}function n(t){var e=a(),n=t.substr(0,2),o=t.length;return _(e[n]).chain().filter(function(e){return e.id.substr(0,o)===t}).sortBy("index").value()}var o=t.point("io.ox/find/date/patterns"),r=0,d={fulldate:"((\\d{1,2})[/.-](\\d){1,2}[/.-](\\d{4})|(\\d{4})[/.-](\\d){1,2}[/.-](\\d{1,2}))",connector:"(\\s)?("+["-","\\.\\.","to","bis","Ã ","au","a"].join("|")+")(\\s)?"},m=new RegExp("^"+d.fulldate+"$"),i=new RegExp(d.fulldate,"g"),s=new RegExp("^"+d.fulldate+d.connector+d.fulldate+"$");o.extend({index:r+=100,id:"lookup",match:function(t){var e=t.data.value,a=t.options.limit-t.data.matched.length;a<=0||(t.data.matched=t.data.matched.concat(n(e).slice(0,a)))}}),o.extend({index:r+=100,id:"format-full-date",regex:m,match:function(t){var e,a=t.extension,n=t.data.value;t.options.limit!==t.data.matched.length&&a.regex.test(n)&&(e=moment(n,u(n)),t.data.matched.push({id:a.id,start:e.clone(),end:e.clone()}))}}),o.extend({index:r+=100,id:"range",regex:s,match:function(t){var a,n,o,r,d,m=t.extension,s=t.data.value;t.options.limit!==t.data.matched.length&&m.regex.test(s)&&(a=s.match(i).slice(0,2),n=_.map(a,function(t){return{value:t,format:u(t)}}),o=moment(n[0].value,n[0].format),r=moment(n[1].value,n[1].format),d=o.diff(r,"days")>0,t.data.matched.push({id:m.id,detail:e("as daterange"),start:d?r:o,end:d?o:r}))}});var c,u=function(){var t=/(\d{1,4})([/.-])(\d{1,2})[/.-](\d{1,4})/,e=function(t,e,a,n,o){var r,d=e.length<o.length,m=d?[void 0,void 0,"YYYY"]:["YYYY",void 0,void 0];return"/"===a&&d&&(r="MM/DD/YYYY"===moment.localeData().longDateFormat("L"),m[0]=e.replace(/./g,r?"M":"D"),m[1]=n.replace(/./g,r?"D":"M")),m[1]=m[1]||n.replace(/./g,"M"),m[0]=m[0]||e.replace(/./g,"D"),m[2]=m[2]||o.replace(/./g,"D"),m.join(a)};return function(a){return a.replace(t,e)}}(),f={};return{lookup:n,getTree:a,getMatches:function(e,a){e=String(e||"").toLowerCase();var n=_.extend({limit:3},a||{}),o=t.Baton.ensure({data:{matched:[],value:e},options:n});return t.point("io.ox/find/date/patterns").invoke("match",this,o),o.data.matched}}});