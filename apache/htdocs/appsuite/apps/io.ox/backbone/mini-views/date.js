define("io.ox/backbone/mini-views/date",["io.ox/backbone/mini-views/abstract","gettext!io.ox/core"],function(t,e){"use strict";function a(t,e){if("ja_JP"===ox.locale){if("year"===t)return e+"年";if("date"===t)return e+"日"}return e}function n(t,e,n,l,o){for(var s,r,d=$('<select class="form-control">').attr({name:t,title:i[t],"aria-label":i[t]}),h=Math.min(e,n),c=Math.max(e,n),u=moment.utc(0),m=[];h<=c;h++)l.call(u,h),r=a(t,r=u.format(o)),m.push($("<option>").val(h).text(r));return e>n&&m.reverse(),s=$("<option>",{value:"year"===t?"1604":""}).text(""),m.unshift(s),d.append(m)}var i={year:e("Year"),month:e("Month"),date:e("Day")};return{DateSelectView:t.extend({className:"native-date-picker row",events:{"change select":"onChange","focus select":"onFocus","blur select":"onBlur"},onChange:function(){var t=this.getDate();null!==t&&void 0!==t?(t.isValid()||(t=moment([t.creationData().input.year,t.creationData().input.month]).endOf("month").hours(1).minutes(0).seconds(0).milliseconds(0),this.$el.find(".date").val(t.date())),this.model.set(this.name,t.valueOf())):(this.model.set(this.name,t),this.$el.find(".date").children().prop("disabled",!1))},onFocus:function(t){this.label.text(this.originalLabel+" - "+$(t.target).attr("title"))},onBlur:function(){this.label.text(this.originalLabel)},getDate:function(){var t=this.$el.find(".year").val(),e=this.$el.find(".month").val(),a=this.$el.find(".date").val();if(!(""!==e&&null!==e||""!==a&&null!==a))return null;if(""!==e&&null!==e&&""!==a&&null!==a)return moment.utc({year:parseInt(t,10),month:parseInt(e,10),date:parseInt(a,10)})},value:function(){var t=this.getDate();return t&&_.pad(t.year(),4)+"-"+_.pad(t.month()+1,2)+"-"+_.pad(t.date(),2)},update:function(){var t,e,n,i=this.model.get(this.name);if(_.isNumber(i)){if(t=moment.utc(i),"1"!==(e=String(t.year()))&&"1604"!==e){var l=[];this.$el.find(".year option").each(function(){l.push($(this).val())}),_.contains(l,e)||(n=a("year",e),this.$el.find(".year").append($("<option>").val(e).text(n)))}"1"===e&&(e=1604),this.$el.find(".year").val(_.pad(e,4)),this.$el.find(".month").val(t.month()),this.$el.find(".date").val(t.date()),t.date(1),t.add(1,"month"),t.date(0);var o=t.date(),s=this.$el.find(".date").children().prop("disabled",!1);(s=s.slice(o+1,s.length)).prop("disabled",!0)}},setup:function(t){this.label=t.label,this.originalLabel=this.label.text(),this.name=t.name,this.future=t.future||0,this.past=t.past||150,this.listenTo(this.model,"change:"+this.name,this.update)},render:function(){var t=this,e=this.label.attr("id");return moment.localeData().longDateFormat("LL").replace(/(Y+)|(M+)|(D+)|(?:''|'(?:[^']|'')*'|[^A-Za-z'])+/g,function(a,i,l,o){var s,r,d=moment.fn;i?(r=moment().year(),s=$('<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">').append(n("year",r+t.future,r-t.past,d.year,i).addClass("year").attr("aria-labelledby",e))):l?s=$('<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">').append(n("month",0,11,d.month,"MMMM").addClass("month").attr("aria-labelledby",e)):o&&(s=$('<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">').append(n("date",1,31,d.date,a).addClass("date").attr("aria-labelledby",e))),t.$el.append(s)}),this.update(),this}})}});