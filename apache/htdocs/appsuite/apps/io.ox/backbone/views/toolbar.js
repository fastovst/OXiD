define("io.ox/backbone/views/toolbar",["io.ox/backbone/views/disposable","io.ox/core/extensions","io.ox/backbone/views/actions/util","gettext!io.ox/core"],function(t,i,n,o){"use strict";return t.extend({events:{"click a[data-action]":"onClick","focus > ul > li > a":"onFocus"},constructor:function(i){this.options=_.extend({inline:!1,point:"",dropdown:!0,simple:!1,strict:!0,align:"left"},i),this.setPoint(this.options.point),t.prototype.constructor.apply(this,arguments),this.$el.addClass(this.options.inline?"inline-toolbar-container":"classic-toolbar-container").toggleClass("align-right","right"===this.options.align).append(this.createToolbar()),this.selection=null,this.options.data&&this.setData(this.options.data)},render:function(t){if(!t)return this;if(!this.point)return console.error("Missing extension point definition"),this;var i=this.point.list().map(n.processItem.bind(null,t)).map(n.createItem.bind(null,t)),o=this.createToolbar().append(_(i).pluck("$li"));return n.waitForMatches(i,function(){this.disposed||(this.injectMoreDropdown(o),this.replaceToolbar(o),this.initButtons(o),this.ready())}.bind(this)),this},createToolbar:function(){var t=this.options.title?o("%1$s toolbar. Use cursor keys to navigate.",this.options.title):o("Actions. Use cursor keys to navigate.");return $('<ul role="toolbar">').addClass(this.options.inline?"inline-toolbar":"classic-toolbar").attr({"aria-label":t}).on("click","a",$.preventDefault)},replaceToolbar:function(t){var i;if($.contains(this.el,document.activeElement)){var n=$(document.activeElement),o=n.data("action");i=o?'[data-action="'+o+'"]':"> li:eq("+n.closest("li").index()+") "+n.prop("tagName")+":first"}return this.$("> ul").tooltip("hide").replaceWith(t),i&&this.$(i).focus(),this},injectMoreDropdown:function(t){t.find("li.hidden").remove();var i=t.children('[data-prio="lo"]');if(i.length===i.children("a.disabled").length)return i.remove();if(this.options.dropdown&&i.length){var e=t.children('[data-prio="hi"]:not(.hidden)'),s=n.createDropdownList().toggleClass("dropdown-menu-right",e.length>1),a=n.createListItem().addClass("dropdown more-dropdown").append(n.createDropdownToggle().attr("data-action","more").append('<i class="fa fa-bars" aria-hidden="true">').addActionTooltip(o(_.device("smartphone")?"Actions":"More actions")),s);a.on("shown.bs.dropdown",function(){$(this).find("a").tooltip("hide")}),_.device("smartphone")?n.bindActionEvent(s):n.addBackdrop(a),s.on("click","a",this.track.bind(this)),a.insertAfter(i.last()),i.find("> a > i.fa").each(function(){var t=$(this).parent(),i=t.attr("title");t.text(i)}),s.append(i),n.injectSectionDividers(s)}},getButtons:function(){return this.$("> ul > li > a").not(":hidden")},disableButtons:function(){this.$("a[data-action]").attr("data-action",null),this.getButtons().off().tooltip("hide").tooltip("disable")},initButtons:function(t){this.getButtons().attr("tabindex",-1),t.find("> li > a").first().attr("tabindex",0)},setSelection:function(t,i){if(!this.disposed&&_.isArray(t)){var o=t.map(n.cid).join(",");return this.options.strict&&this.selection===o?this.ready():(this.selection=o,this.disableButtons(),n.setSelection.call(this,t,i))}},setData:n.setData,setPoint:function(t){return this.point=_.isString(t)?i.point(t):t,this},ready:function(){this.trigger("ready ready:"+this.selection,this.selection)},onFocus:function(t){this.getButtons().attr("tabindex",-1),$(t.currentTarget).attr("tabindex",0)},onClick:function(t){this.track(t),n.invokeByEvent(t)},track:function(t){var i=$(t.delegateTarget?t.currentTarget:t.target);i.hasClass("dropdown-toggle")&&i.parent().hasClass("open")||this.$el.trigger("track",i)}})});