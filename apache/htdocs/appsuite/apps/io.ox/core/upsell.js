define("io.ox/core/upsell",["io.ox/core/capabilities","settings!io.ox/core","gettext!io.ox/core"],function(e,n,t){"use strict";function r(e){console.debug("upsell:requires-upgrade",e),require(["io.ox/backbone/views/modal"],function(n){new n({title:t("Upgrade required"),description:t("This feature is not available. In order to use it, you need to upgrade your account now.")+" "+t("The first 90 days are free.")}).addCancelButton().addButton({label:t("Get free upgrade"),action:"upgrade"}).on("upgrade",function(){ox.trigger("upsell:upgrade",e)}).on("open",function(){ox.off("upsell:requires-upgrade",r),this.$el.next(".modal-backdrop.in:visible").css({opacity:.7,backgroundColor:"#08C"})}).on("close",function(){ox.on("upsell:requires-upgrade",r)}).open()})}function o(e){console.debug("upsell:upgrade",e),alert("User decided to upgrade! (global event: upsell:upgrade)")}var a=n.get("upsell/enabled")||{},i={},u={},c={trigger:function(e){ox.trigger("upsell:requires-upgrade",e||{})},click:function(e){e.preventDefault(),c.trigger()},any:function(e){return!e||_([].concat(e)).reduce(function(e,n){return e||void 0===n||c.has(n)},!1)},missing:function(e){return e?(e=[].concat(e).join(" "),_(e.match(/!?[a-z_:-]+/gi)).filter(function(e){return!c.has(e)}).join(" ")):""},has:function(n){return!n||(n in i?i[n]:i[n]=e.has(n))},visible:function(){function e(e){return!!_.isString(e)&&!!a[e]}function n(n){var t=n.replace(/([^&|]) ([^&|])/gi,"$1 && $2");return ox.debug&&/,/.test(t)?!!console.error("You can't use a comma in a condition use space instead."):(t=t.replace(/[\w:-]+/gi,function(n){return n=n.toLowerCase(),e(n)||c.has(n)}),new Function("return !!("+t+")")())}return function(e){var t=_.compact([].concat(e));return!t.length||_.reduce(t,function(e,t){return e||n(t)},!1)}}(),enabled:function(){function e(e){return!!_.isString(e)&&!!a[e]}return function(){var n=_(arguments).flatten().join(" || ").replace(/([^&|]) ([^&|])/gi,"$1 && $2");return ox.debug&&/,/.test(n)?!!console.error("You can't use a comma in a condition use space instead."):(n=n.replace(/[a-z0-9_:-]+/gi,function(n){return n=n.toLowerCase(),e(n)}),new Function("return !!("+n+")")())}}(),captureRequiresUpgrade:function(){ox.on("upsell:requires-upgrade",r),c.captureRequiresUpgrade=$.noop},captureUpgrade:function(){ox.on("upsell:upgrade",o),c.captureUpgrade=$.noop},useDefaults:function(){c.captureRequiresUpgrade(),c.captureUpgrade()},debug:function(){console.debug("enabled",a,"capabilityCache",i,"enabledCache",u)},demo:function(e){var t=a,r=i;t.portal=t.webmail=t.contacts=t.calendar=t.infostore=t.tasks=t.publication=t.subscription=t.carddav=t.active_sync=!0,r.portal=r.webmail=r.contacts=!0,r.calendar=r.infostore=r.tasks=r.active_sync=r["active_sync || caldav || carddav"]=!1,r.publication=r.subscription=!1,n.set("features/upsell/secondary-launcher",{icon:"fa-star fa-star fa-star",color:"#ff0"}),n.set("features/upsell/portal-widget",{imageURL:"http://lorempixel.com/400/300/"}),n.set("features/upsell/folderview/mail/i18n/en_US",{title:"Custom english title for synchronizing mails."}),n.set("features/upsell/topbar-dropdown",{color:"#df0000"}),n.set("features/upsell/mail-folderview-quota",{upsellLimit:10485760}),console.debug("Disabled inline actions regarding calendar, tasks, and files; enabled upsell instead"),e||c.useDefaults()},setEnabled:function(e){a[e]=!0}};return(_.url.hash("demo")||"").indexOf("upsell")>-1&&c.demo(),c});