define("io.ox/core/metrics/bot/main",["io.ox/core/metrics/metrics","io.ox/core/metrics/bot/util"],function(t,e){"use strict";function i(t){this.items=[],this.current=-1,this.deferred=$.Deferred(),this.only=!1,t&&t.call(this)}function n(t){window.suite=this,r=this,i.call(this,t)}function o(t,e,n){i.call(this,e),this.description=t,this.only=!!n}_.extend(i.prototype,{run:function(){return this.next(),this.deferred.promise()},next:function(){var t=this.items[++this.current];t?this.process(t):this.resolve()},resolve:function(){this.deferred.resolve(this)},done:function(t){return this.deferred.done(t.bind(this))},getState:function(){return this.deferred.state()},getResults:function(){return _(this.items).map(function(t){return{description:t.description,duration:t.getDuration(),state:t.getState()}})}});var r=null;return _.extend(n.prototype,i.prototype,{process:function(e){console.log("Running test:",e.description),e.run().then(function(){console.log("Test finished. Took:",t.formatTimestamp(e.getDuration())),this.next()}.bind(this),function(){console.error("Test failed:",e.description),this.next()}.bind(this))},getDuration:function(){return _(this.items).reduce(function(t,e){return t+e.getDuration()},0)},test:function(t,e,i){this.only&&!i||this.items.push(new o(t,e,i))},xtest:function(){},toCSV:function(){return t.getBrowser()+";"+_.now()+";"+t.toSeconds(this.getDuration())+";"+_(this.getResults()).map(function(e){return"resolved"===e.state?t.toSeconds(e.duration):"N/A"}).join(";")}}),n.prototype.test.only=function(t,e){r.items=_(r.items).filter(function(t){return t.only}),r.test(t,e,!0),r.only=!0},_.extend(o.prototype,i.prototype,{step:function(t,e){this.items.push({description:t,callback:e,duration:-1})},xstep:function(){},process:function(i){var n=_.now(),o=setTimeout(function(){console.error("Timeout",i.description),this.deferred.reject(),i=r=o=null}.bind(this),e.TIMEOUT),r=function(){clearTimeout(o),i.duration=_.now()-n,console.log('... Step "'+i.description+'" ('+t.formatTimestamp(i.duration)+")"),this.next(),i=r=o=null};0===i.callback.length?(i.callback.call(this),r.call(this)):i.callback.call(this,r.bind(this))},getDuration:function(){return _(this.items).reduce(function(t,e){return t+e.duration},0)},waitFor:e.waitFor,waitForApp:e.waitForApp,waitForEvent:e.waitForEvent,waitForSelector:e.waitForSelector,waitForFolder:e.waitForFolder,waitForListView:e.waitForListView,waitForImage:e.waitForImage,$:function(t){return this.app?this.app.getWindowNode().find(t):$()}}),{ready:function(t){return e.ready(t.bind(this))},suite:function(e){var i=new n(e);return i.run().done(function(e){console.log("Suite finished.","Took: "+t.formatTimestamp(e.getDuration()),"Browser: "+t.getBrowser())}),i}}});