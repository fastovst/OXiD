define("io.ox/core/metrics/bot/util",[],function(){"use strict";var e=$.Deferred();ox.on("core:ready",e.resolve);var o={TIMEOUT:1e4,waitFor:function(e,r){var n=$.Deferred(),t=_.now(),i=setInterval(function(){e()?(clearInterval(i),n.resolve()):_.now()-t>o.TIMEOUT&&(clearInterval(i),r&&r(),n.reject())},50);return n.promise()},waitForEvent:function(e,r,n){var t=$.Deferred(),i=setTimeout(function(){console.error("Event not triggered",r),e.off(r,a),t.reject()},o.TIMEOUT),a=function(){clearTimeout(i),t.resolve()};return _.isString(e)&&(n=r,r=e,e=ox),(e.once||e.one).call(e,r,a),t.promise().done(n)},waitForSelector:function(e,r){return o.waitFor(function(){return $(e).length>0},function(){console.error("Cannot resolve selector",e)}).done(r)},waitForApp:function(e,r){var n=$.Deferred(),t=setTimeout(function(){console.error("Cannot launch app",e),ox.off("app:resume app:ready",i),n.reject()},o.TIMEOUT),i=function(o){o.getName()===e&&(clearTimeout(t),this.app=o,n.resolve(o))};return ox.once("app:resume app:ready",i.bind(this)),n.promise().done(r)},waitForFolder:function(e,o){return ox.ui.App.getCurrentApp().folder.set(e).done(o)},waitForListView:function(e,o,r){function n(){return e.collection&&e.collection.cid.indexOf(o)>-1}this.waitFor(function(){return!!n()&&!1===e.loader.loading}).done(function(){setTimeout(r,0)})},waitForImage:function(e,o){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){if(200===this.status){var r=new window.Blob([this.response],{type:"image/jpg"});o&&o(r)}else console.error("Failed to load image",e)},r.send()},ready:function(o){e.then(function(){return _.wait(3e3)}).done(o)}};return o});