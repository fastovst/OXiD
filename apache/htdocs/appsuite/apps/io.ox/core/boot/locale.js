define("io.ox/core/boot/locale",["gettext","io.ox/core/boot/util","io.ox/core/locale/meta"],function(a,e,t){"use strict";var n,l={change:function(n){var l=t.deriveSupportedLanguageFromLocale(n);a.setLanguage(l).done(function(){$("html").attr("lang",l.split("_")[0]),a.enable(),$("[data-i18n]").each(function(){var a=$(this),t=e.gt(a.attr("data-i18n")),n=(a.attr("data-i18n-attr")||"text").split(",");_.each(n,function(e){switch(e){case"value":a.val(t);break;case"text":a.text(t);break;case"label":a.contents().get(-1).nodeValue=t;break;default:a.attr(e,t)}})}),ox.locale=n,ox.language=l,_.setCookie("locale",n),ox.trigger("language",l,e.gt)})},getCurrentLocale:function(){return n||ox.locale||"en_US"},getSelectedLocale:function(){return n},setDefaultLocale:function(){return this.change(t.getValidDefaultLocale())},changeByUser:function(a){a&&(this.change(a),n=a)},render:function(){var a=t.getSupportedLocales(),n=$("#io-ox-languages"),o=_.size(a),r=function(a){return a.replace(/_/,"-")};if(o>1){e.debug("Render locales",a);var i,c,g=this.changeByUser.bind(this),u=t.getValidDefaultLocale();o<100&&!_.url.hash("language-select")&&_.device("!smartphone")?(n.append($('<span class="lang-label" id="io-ox-languages-label" data-i18n="Language" data-i18n-attr="text">'),$('<div class="dropup">').append(i=$('<a href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">').append($('<span class="sr-only" data-i18n="Language:" data-i18n-attr="text">'),$('<span class="toggle-text">').attr("lang",r(u)).text(t.getLocaleName(u)),$('<span class="caret">')),c=$('<ul id="io-ox-language-list" class="dropdown-menu" role="menu" data-i18n="Languages" data-i18n-attr="aria-label">'))),c.append(_(a).map(function(a){return $('<li role="presentation">').append($('<a href="#" role="menuitem">').attr({lang:r(a.id),"data-value":a.id}).text(a.name))})),c.on("click","a",function(a){var e=$(a.currentTarget).attr("data-value");a.preventDefault(),g(e),$(a.delegateTarget).parent().find(".toggle-text").text(t.getLocaleName(e)).attr("lang",r(e))}),i.dropdown()):n.append($('<label for="language-select" class="lang-label" data-i18n="Languages" data-i18n-attr="text">'),$('<select id="language-select">').on("change",function(){l.changeByUser($(this).val())}).append(_(a).map(function(a){return $("<option>").attr({lang:r(a.id),"data-value":a.id,value:a.id}).text(a.name)})).val(u))}else n.remove()}};return l});