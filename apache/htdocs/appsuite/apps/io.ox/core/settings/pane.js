define("io.ox/core/settings/pane",["io.ox/core/extensions","io.ox/backbone/views/extensible","io.ox/backbone/views/disposable","io.ox/backbone/mini-views/common","io.ox/core/settings/util","io.ox/core/api/apps","io.ox/core/upsell","io.ox/core/capabilities","io.ox/core/notifications","io.ox/core/locale","io.ox/core/desktopNotifications","plugins/portal/userSettings/register","settings!io.ox/core","settings!io.ox/core/settingOptions","gettext!io.ox/core","io.ox/backbone/mini-views/timezonepicker","io.ox/core/main/appcontrol","io.ox/core/settings/dialogs/quickLauncherDialog"],function(e,t,i,n,o,a,s,r,l,d,c,u,p,g,h,f,m,b){"use strict";var x=0,v=a.forLauncher().filter(function(e){var t=e.get("requires");return s.has(t)}).map(function(e){return{label:e.getTitle(),value:e.get("path")}}).concat([{label:h("None"),value:"none"}]);e.point("io.ox/core/settings/detail").extend({index:100,id:"view",draw:function(){this.append(new t({point:"io.ox/core/settings/detail/view",model:p}).inject({showNoticeFields:["language","timezone","theme"],showNotice:function(e){return _(this.showNoticeFields).some(function(t){return t===e})},reloadHint:h("Some settings (e.g. language and timezone) require a page reload or relogin to take effect."),getLanguageOptions:function(){var e=!_.isEmpty(p.get("localeData")),t=d.current();return _(d.getSupportedLocales()).map(function(i){return i.name=e&&i.id===t?i.name+" / "+h("Customized"):i.name,{label:i.name,value:i.id}})},getThemeOptions:function(){var e=g.get("themes")||{};return e.default&&(e.default=h("Default Theme")),_(e).chain().map(function(e,t){return{label:e,value:t}}).sortBy(function(e){return e.label.toLowerCase()}).value()},getDesigns:function(){return[{label:h("Unicolor"),options:[{label:h("Default"),value:"primary"}]},{label:h("Multicolor"),options:[{label:h("Indigo"),value:"night"},{label:h("Green"),value:"twilight"},{label:h("Turquoise"),value:"dawn"},{label:h("Blue"),value:"day"},{label:h("Purple/Magenta"),value:"dusk"}]},{label:h("Automatic"),options:[{label:h("Time-dependent"),value:"time"}]}]},hasMoreThanOneTheme:function(){return _(g.get("themes")).size()>1},getRefreshOptions:function(){return[{label:h("5 minutes"),value:3e5},{label:h("10 minutes"),value:6e5},{label:h("15 minutes"),value:9e5},{label:h("30 minutes"),value:18e5}]},openUserSettings:function(){require(["io.ox/core/settings/user"],function(e){e.openModalDialog()})},propagateSettingsLanguage:function(e){require(["io.ox/core/api/tab"],function(t){t.propagate("update-ox-object",{language:e,exceptWindow:t.getWindowName()}),t.updateOxObject({language:e})})},propagateSettingsTheme:function(e){require(["io.ox/core/api/tab"],function(t){t.propagate("update-ox-object",{theme:e,exceptWindow:t.getWindowName()}),t.updateOxObject({theme:e})})}}).render().$el)}}),e.point("io.ox/core/settings/detail/view").extend({id:"header",index:x+=100,render:function(){this.$el.addClass("settings-container").append(o.header(h("Basic settings")))}},{id:"onchange",index:x+=100,render:function(){this.listenTo(p,"change",function(e,t){ox.tabHandlingEnabled&&"theme"===e&&this.propagateSettingsTheme(t),ox.tabHandlingEnabled&&"language"===e&&this.propagateSettingsLanguage(t);var i=this.showNotice(e);p.saveAndYell(void 0,{force:!!i}).then(function(){if(i){var e=h("The setting requires a reload or relogin to take effect.");l.yell("success",e)}})})}},{id:"hint",index:x+=100,render:function(){this.$el.append($('<div class="help-block">').text(this.reloadHint+" ").css("margin-bottom","24px").append($('<a href="#" role="button" data-action="reload">').text(h("Reload page")).on("click",function(e){e.preventDefault(),location.reload()})))}},{index:x+=100,id:"fieldset/first",render:function(e){this.$el.append(e.branch("fieldset/first",this,$('<fieldset role="presentation">')))}},{index:x+=100,id:"fieldset/second",render:function(e){this.$el.append(e.branch("fieldset/second",this,$('<fieldset role="presentation">')))}},{index:x+=100,id:"fieldset/third",render:function(e){this.$el.append(e.branch("fieldset/third",this,$('<fieldset role="presentation">')))}},{id:"buttons",render:function(){var e=$('<div class="form-group buttons">');p.isConfigurable("apps/quickLaunch")&&0!==m.getQuickLauncherCount()&&!_.device("smartphone")&&e.append($('<button type="button" class="btn btn-default">').text(h("Configure quick launchers")+" ...").on("click",b.openDialog)),p.get("user/internalUserEdit",!0)&&e.append($('<button type="button" class="btn btn-default">').text(h("My contact data")+" ...").on("click",this.openUserSettings)),r.has("edit_password")&&e.append($('<button type="button" class="btn btn-default">').text(h("Change password")+" ...").on("click",u.changePassword)),e.children().length&&this.$el.append(e)}}),x=0,e.point("io.ox/core/settings/detail/view/fieldset/first").extend({id:"language",index:x+=100,render:function(e){function t(){return moment().format("dddd, L LT")+"   "+d.getDefaultNumberFormat()+"\n"+h("First day of the week: %1$s",d.getFirstDayOfWeek())}if(p.isConfigurable("language")){var i=this.getLanguageOptions.bind(this),n=o.compactSelect("language",h("Language"),this.model,i()),a=n.find("select").data("view");n.find(".col-md-6").append($('<div class="help-block locale-example" style="white-space: pre">').text(t()),$('<div class="help-block">').append($('<button role="button" class="btn btn-default" data-action="reload">').text(h("More regional settings")+" ...").on("click",function(e){e.preventDefault(),require(["io.ox/core/settings/editLocale"],function(e){e.open()})}))),a.listenTo(this.model,"change:language",function(e){_.setCookie("locale",e)}),a.listenTo(ox,"change:locale:data",function(){this.$el.siblings(".locale-example").text(t()),this.setOptions(i())}),e.$el.append(n)}}},{id:"timezone",index:x+=100,render:function(e){p.isConfigurable("timezone")&&e.$el.append($('<div class="form-group row">').append($('<div class="col-md-6">').append($('<label for="settings-timezone">').text(h("Time zone")),new f({name:"timezone",model:this.model,id:"settings-timezone",showFavorites:!0}).render().$el)))}},{id:"theme",index:x+=100,render:function(e){p.isConfigurable("theme")&&this.hasMoreThanOneTheme()&&e.$el.append(o.compactSelect("theme",h("Theme"),this.model,this.getThemeOptions()))}},{id:"design",index:x+=100,render:function(e){_.device("ie <= 11")||p.get("features/userDesigns",!0)&&(this.hasMoreThanOneTheme()||e.$el.append(o.compactSelect("design",h("Design"),this.model,this.getDesigns(),{groups:!0})))}},{id:"refreshInterval",index:x+=100,render:function(e){p.isConfigurable("refreshInterval")&&e.$el.append(o.compactSelect("refreshInterval",h("Refresh interval"),this.model,this.getRefreshOptions()))}}),x=0,e.point("io.ox/core/settings/detail/view/fieldset/second").extend({id:"autoStart",index:x+=100,render:function(e){p.isConfigurable("autoStart")&&(v<=2||e.$el.append(o.compactSelect("autoStart",h("Default app after sign in"),this.model,v)))}}),x=0,e.point("io.ox/core/settings/detail/view/fieldset/third").extend({id:"data-fixes",index:x+=100,render:function(){switch(this.model.get("autoOpenNotification")){case"always":case"noEmail":this.model.set("autoOpenNotification",!0);break;case"Never":this.model.set("autoOpenNotification",!1)}}},{id:"request-notifications",index:x+=100,render:function(){var e=this;this.$requestLink=$('<a href="#" role="button" class="request-desktop-notifications">').text(h("Manage browser permissions now")).on("click",function(t){t.preventDefault(),c.requestPermission(function(t){switch("default"!==t&&e.$requestLink.hide(),t){case"granted":p.set("showDesktopNotifications",!0).save();break;case"denied":p.set("showDesktopNotifications",!1).save()}})}),c.isSupported()&&(this.listenTo(this.model,"change:showDesktopNotifications",function(t){if(!0===t){var i=this;c.requestPermission(function(t){"default"!==t&&e.$requestLink.hide(),"denied"!==t||i.disposed||(l.yell("info",h("Please check your browser settings and enable desktop notifications for this domain")),i.model.set("showDesktopNotifications",!1,{silent:!0}))})}}),this.$requestLink=$("<br>").add(this.$requestLink)),c.getPermissionStatus().match(/granted|denied/)&&this.$requestLink.hide()}},{id:"options",render:function(e){var t=[o.checkbox("autoOpenNotification",h("Automatic opening of notification area"),this.model),o.checkbox("showDesktopNotifications",h("Show desktop notifications"),this.model).append(this.$requestLink)];e.$el.append($('<div class="form-group">').append(t))}})});