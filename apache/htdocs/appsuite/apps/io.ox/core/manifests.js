define.async("io.ox/core/manifests",["io.ox/core/extensions","io.ox/core/capabilities"],function(n,i){"use strict";function e(n){return n.requires&&!0!==n.upsell&&!i.has(n.requires)||!!n.device&&!_.device(n.device)}function s(n){n.namespace?n.path?e(n)||_([].concat(n.namespace)).each(function(i){_(i.split(/\s+,?/)).each(function(i){var e=o.pluginPoints;(e[i]=e[i]||[]).push(n),o.plugins[n.path]=n})}):console.warn("Cannot process plugin manifest without a path",n):ox.debug&&console.warn('Looks like an app is defined "the old way". Apps can not be defined in manifest files any longer, but should be defined explicitly in code.',n)}function t(){o.plugins||(o.pluginPoints={},o.plugins={},_(ox.serverConfig.manifests).each(s),_.url.hash("customManifests")&&_(u).each(s),_.isEmpty(o.pluginPoints)||ox.trigger("manifests"))}var o={getRequirements:function(n){return t(),(this.plugins[n]||{}).requires||""},loadPluginsFor:function(n,i){if(i=i||$.noop,t(),!this.pluginPoints[n]||0===this.pluginPoints[n].length)return i(),$.when();var e=_(this.pluginPoints[n]).pluck("path");return require(e,i)},withPluginsFor:function(n,i){return(i||[]).concat(this.pluginsFor(n))},hasPluginsFor:function(n){t();var i=this.pluginPoints[n];return i&&i.length>0},pluginsFor:function(n){t();var i=this.pluginPoints[n];return i&&0!==i.length?[].concat(_(i).chain().pluck("path").uniq().value()):[]},wrapperFor:function(n,i,e){var s=this;if(_(i).contains("plugins")){var t=_(i).indexOf("plugins");return{dependencies:i.slice(0,t).concat(i.slice(t+1)),definitionFunction:function(){var i=$.makeArray(arguments),o={loading:$.Deferred(),names:s.pluginsFor(n)};i=i.slice(0,t).concat([o]).concat(i.slice(t));var r=e.apply(this,i);return require(o.names).done(o.loading.resolve).fail(o.loading.reject),r}}}return{dependencies:this.withPluginsFor(n,i),definitionFunction:e,after:this.pluginsFor("after:"+n)}},isDisabled:function(n){return ox.debug&&console.warn("This method is deprecated and should not be used any longer."),t(),!this.plugins[n]},plugins:null,pluginPoints:null};ox.withPluginsFor=function(n,i){return o.withPluginsFor(n,i)},ox.manifests=o;var r=_.now(),u=[],a={manager:o,reset:function(){o.plugins=null,o.pluginPoints=null}},l=$.Deferred();return _.url.hash("customManifests")?require([ox.base+"/manifests/open-xchange-appsuite.json?t="+r],function(n){u=n,console.info("Loading custom manifests",_(n).pluck("path"),n),l.resolve(a)}):l.resolve(a),l.promise()});