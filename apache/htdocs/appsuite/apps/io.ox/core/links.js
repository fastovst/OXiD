define("io.ox/core/links",["io.ox/core/yell","io.ox/core/capabilities"],function(e,i){"use strict";function n(i,n){require(["io.ox/core/folder/api"],function(t){t.get(n).then(function(){ox.launch(i,{folder:n}).done(function(){"io.ox/calendar/main"===i?this.folders.setOnly(n):this.folder.get()!==n&&this.folder.set(n)})},e)})}var t=function(e){e.preventDefault();var i=$(this).data(),n=/^io.ox\/office\//.test(i.app)?{action:"load",file:{folder_id:i.folder,id:i.id}}:_(i).pick("folder","folder_id","id","cid");ox.launch(i.app+"/main",n).done(function(){_.isFunction(this.setSettingsPane)?this.setSettingsPane(n):i.folder&&this.folder.get()!==i.folder&&this.folder.set(i.folder)})};$(document).on("click",".deep-link-app",t);var o=function(i){i.preventDefault();var t=$(this).data();t.id?require(["io.ox/core/viewer/main","io.ox/files/api"],function(i,n){n.get(_(t).pick("folder","id")).then(function(e){(new i).launch({files:[e]})},e)}):n("io.ox/files/main",t.folder)};$(document).on("click",".deep-link-files",o);var a=function(e){e.preventDefault();var i=$(this).data();ox.launch("io.ox/contacts/main",{folder:i.folder}).done(function(){var e=this,n=i.folder,t=String(i.id||"").replace(/\//,".");e.folder.get()===n?e.getGrid().selection.set(t):e.folder.set(n).done(function(){e.getGrid().selection.set(t)})})};$(document).on("click",".deep-link-contacts",a);var d=function(i){i.preventDefault();var t=$(this).data();t.id?ox.load(["io.ox/core/tk/dialogs","io.ox/calendar/api","io.ox/calendar/view-detail","io.ox/core/folder/api"]).done(function(n,o,a,d){var l=new n.SidePopup({arrow:!_.device("chrome"),tabTrap:!0});_.device("chrome")&&l.setTarget(document.body),l.show(i,function(i){i.busy(),/^\d+\/\d+.\d+$/.test(t.id)&&(t=o.cid(t.id.replace(/\//,"."))),o.get(t).then(function(e){d.get(e.get("folder")).always(function(n){i.idle().append(a.draw(e,{container:i,noFolderCheck:void 0!==n.error}))})},function(i){l.close(),e(i)})})}):n("io.ox/calendar/main",t.folder)};$(document).on("click",".deep-link-calendar",d);var l=function(e){e.preventDefault();var i=$(this).data();ox.launch("io.ox/tasks/main",{folder:i.folder}).done(function(){var e=this,n=i.folder,t=String(i.id||"").replace(/\//,"."),o=t.indexOf(".")>-1?t:_.cid({folder:n,id:t});$.when().then(function(){if(!e.folder.get()===n)return e.folder.set(n)}).then(function(){if(t)return e.getGrid().selection.set(o)})})};$(document).on("click",".deep-link-tasks",l);var r=function(e){e.preventDefault();var i,n,t,o=$(this),a=o.data(),d={};require(["io.ox/mail/sanitizer"],function(e){if(a.address)i=a.address,n=a.name||a.address;else{t=o.attr("href").substr(7).split(/\?/,2),i=t[0],n=o.text(),d=_.deserialize(t[1]);for(var l in d)d[l.toLowerCase()]=d[l]}ox.registry.call("mail-compose","open",{to:[[n,i]],subject:d.subject||"",content:e.sanitize({content:d.body||"",content_type:"text/html"},{WHOLE_DOCUMENT:!1}).content})})},c=function(e){e.preventDefault();var i=$(this).data();require(["io.ox/settings/personalData/api"],function(e){e.trigger("updateStatus")}),ox.launch("io.ox/settings/main",{folder:i.folder}).done(function(){this.setSettingsPane({folder:i.folder})})};$(document).on("click",".deep-link-gdpr",c),i.has("webmail")&&$(document).on("click",".mailto-link",r),ox.on("click:deep-link-mail",function(e,i){var n=e.currentTarget.className.split(" ");n.indexOf("deep-link-files")>=0?o.call(i,e):n.indexOf("deep-link-contacts")>=0?a.call(i,e):n.indexOf("deep-link-calendar")>=0?d.call(i,e):n.indexOf("deep-link-tasks")>=0?l.call(i,e):n.indexOf("deep-link-gdpr")>=0?c.call(i,e):n.indexOf("deep-link-app")>=0?t.call(i,e):n.indexOf("mailto-link")>=0&&r.call(i,e)})});