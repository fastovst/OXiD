define("io.ox/core/pdf/pdfviewerlinkservice",[],function(){"use strict";function e(e){for(var t=e.split("&"),n={},i=0,r=t.length;i<r;++i){var s=t[i].split("="),o=s[0].toLowerCase(),a=s.length>1?s[1]:null;n[decodeURIComponent(o)]=decodeURIComponent(a)}return n}return function(){function t(e){e=e||{},this.baseUrl=e.baseUrl||null,this.pdfDocument=e.pdfDocument||null,this.pdfHistory=e.pdfHistory||null,this.eventHub=e.eventHub||null,this.externalLinkTarget=e.externalLinkTarget||null,this._pagesRefCache=this.pdfDocument?Object.create(null):null}return t.prototype={setDocument:function(e,t){this.baseUrl=t,this.pdfDocument=e,this._pagesRefCache=Object.create(null)},setHistory:function(e){this.pdfHistory=e},setEventHub:function(e){this.eventHub=e},get pagesCount(){return this.pdfDocument.numPages},navigateTo:function(e){var t,n="",i=this,r=function(t){var s=t instanceof Object?i._pagesRefCache[t.num+" "+t.gen+" R"]:t+1;s?(s>i.pagesCount&&(s=i.pagesCount),i.scrollPageIntoView(s,e),i.pdfHistory&&i.pdfHistory.push({dest:e,hash:n,page:s})):i.pdfDocument.getPageIndex(t).then(function(e){var n=e+1,s=t.num+" "+t.gen+" R";i._pagesRefCache[s]=n,r(t)})};"string"==typeof e?(n=e,t=this.pdfDocument.getDestination(e)):t=Promise.resolve(e),t.then(function(t){e=t,t instanceof Array&&r(t[0])})},getDestinationHash:function(e){if("string"==typeof e)return this.getAnchorUrl("#"+encodeURIComponent(e));if(e instanceof Array){var t=e[0],n=t instanceof Object?this._pagesRefCache[t.num+" "+t.gen+" R"]:t+1;if(n){var i=this.getAnchorUrl("#page="+n),r=e[1];if("object"==typeof r&&"name"in r&&"XYZ"===r.name){var s=e[4]||1,o=parseFloat(s);o&&(s=100*o),i+="&zoom="+s,(e[2]||e[3])&&(i+=","+(e[2]||0)+","+(e[3]||0))}return i}}return this.getAnchorUrl("")},getAnchorUrl:function(e){return(this.baseUrl||"")+e},setHash:function(t){if(t.indexOf("=")>=0){var n=e(t);if("nameddest"in n)return this.pdfHistory&&this.pdfHistory.updateNextHashParam(n.nameddest),void this.navigateTo(n.nameddest);var i,r;if("page"in n&&(i=0|n.page||1),"zoom"in n){var s=n.zoom.split(","),o=s[0],a=parseFloat(o);-1===o.indexOf("Fit")?r=[null,{name:"XYZ"},s.length>1?0|s[1]:null,s.length>2?0|s[2]:null,a?a/100:o]:"Fit"===o||"FitB"===o?r=[null,{name:o}]:"FitH"===o||"FitBH"===o||"FitV"===o||"FitBV"===o?r=[null,{name:o},s.length>1?0|s[1]:null]:"FitR"===o?5!==s.length?console.error("PDFViewerLinkService_setHash: Not enough parameters for 'FitR'."):r=[null,{name:o},0|s[1],0|s[2],0|s[3],0|s[4]]:console.error("PDFViewerLinkService_setHash: '"+o+"' is not a valid zoom value.")}(i||r)&&this.scrollPageIntoView(i,r),"pagemode"in n&&this.eventHub.trigger("viewer:sidebar:pagemode",n.pagemode)}else/^\d+$/.test(t)?this.scrollPageIntoView(t):(this.pdfHistory&&this.pdfHistory.updateNextHashParam(decodeURIComponent(t)),this.navigateTo(decodeURIComponent(t)))},executeNamedAction:function(e){switch(e){case"GoBack":this.pdfHistory&&this.pdfHistory.back();break;case"GoForward":this.pdfHistory&&this.pdfHistory.forward();break;case"NextPage":this.eventHub.trigger("viewer:document:next");break;case"PrevPage":this.eventHub.trigger("viewer:document:previous");break;case"LastPage":this.eventHub.trigger("viewer:document:last");break;case"FirstPage":this.eventHub.trigger("viewer:document:first");break;case"Print":this.eventHub.trigger("viewer:document:print")}},cachePageRef:function(e,t){var n=t.num+" "+t.gen+" R";this._pagesRefCache[n]=e},scrollPageIntoView:function(e,t){_.isNumber(e)||(e=t instanceof Object?this._pagesRefCache[t.num+" "+t.gen+" R"]:t+1),_.isNumber(e)&&(e=Math.min(Math.max(e,1),this.pagesCount),this.eventHub.trigger("viewer:document:scrolltopage",e))}},t}()});