define("io.ox/core/tk/flag-picker",["io.ox/mail/api","io.ox/core/folder/api","gettext!io.ox/mail","io.ox/backbone/mini-views/dropdown","less!io.ox/core/tk/flag-picker"],function(a,o,e,n){"use strict";var t={NONE:e("None"),RED:e("Red"),BLUE:e("Blue"),GREEN:e("Green"),GRAY:e("Gray"),PURPLE:e("Purple"),LIGHTGREEN:e("Light green"),ORANGE:e("Orange"),PINK:e("Pink"),LIGHTBLUE:e("Light blue"),YELLOW:e("Yellow")},r={NONE:0,RED:1,BLUE:2,GREEN:3,GRAY:4,PURPLE:5,LIGHTGREEN:6,ORANGE:7,PINK:8,LIGHTBLUE:9,YELLOW:10},l={div:$("<div>"),list:$('<ul class="dropdown-menu" role="menu">'),listItem:$("<li>"),menuItemLink:$('<a href="#" role="menuitem" class="io-ox-action-link">'),flag:$('<span class="flag-example" aria-hidden="true">'),setColorLink:$('<a href="#">').attr("aria-label",e("Set color")),dropdownIcon:$('<i class="flag-dropdown-icon" aria-hidden="true">').attr("title",e("Set color"))},i={appendDropdown:function(a,o){a.addClass("dropdown-toggle"),a.parent().addClass("dropdown flag-picker");var e=l.list.clone().on("click","a",{data:o},i.change).append(_(r).map(function(a,o){return l.listItem.clone().append(l.menuItemLink.clone().append(a>0?l.flag.clone().addClass("flag_bg_"+a):$(),$.txt(t[o])).attr({"data-color":a,"data-action":"color-"+o.toLowerCase()}))}));new n({el:a.parent(),$toggle:a,$ul:e}).render()},draw:function(a,o){var n,t=o.data,r=Math.max(0,t.color_label||0);a.append(l.div.clone().append(n=l.setColorLink.clone().append(l.dropdownIcon.clone().attr({"data-color":r,title:e("Set color")}).addClass("flag_"+r+" "+(r?"fa fa-bookmark":"fa fa-bookmark-o"))))),this.appendDropdown(n,t),o.view&&o.view.listenTo(o.model,"change:color_label",this.update)},change:function(e){e.preventDefault();var n=e.data.data,t=$(e.currentTarget).attr("data-color")||"0",r=$(this).closest(".flag-picker");n=o.ignoreSentItems(n),a.changeColor(n,t),r.find(".dropdown-toggle").focus()},update:function(a){var o=Math.max(0,a.get("color_label")||0),e="flag-dropdown-icon ";e+=0===o?"fa fa-bookmark-o":"fa fa-bookmark",e+=" flag_"+o,this.$el.find(".flag-dropdown-icon").attr({class:e,"data-color":o})},attach:function(a,o){this.appendDropdown(a,o.data)},colorName:function(a){if(_.isNumber(a))return t[_.invert(r)[a]]}};return i});