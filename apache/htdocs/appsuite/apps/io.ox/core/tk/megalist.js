define("io.ox/core/tk/megalist",[],function(){"use strict";function e(e,t){t.nextSibling?C.insertBefore(e,t):C.append(e)}function t(e){return _.isNumber(e)?l().eq(e):$(e)}function n(){return l().filter(T)}function a(){return l().filter(D)}function r(){return!!C.querySelector(T)}function i(){return w.hasClass("checkboxes")}function c(e,n,a){t(e).trigger($.Event(n,{shiftKey:a.shiftKey}))}function o(){g($(this)),x()}function l(){return w.find('[role="option"]')}function u(e){var n=l().index(this);b(),e.shiftKey?v(n):(q=n,m(t(n))),x()}function f(e){e.preventDefault();var n,a=l(),i=a.index(document.activeElement);if(!((i+=38===e.which?-1:1)<0||i>=a.length)){if(n=t(i),p(n),e.ctrlKey||e.metaKey)return r()||b(),void(q=i);c(n,"select",e)}}function s(e){var t=l().eq(35===e.which?-1:0);p(t),c(t,"select",e)}function d(e){e.preventDefault(),c(document.activeElement,"toggle",e)}function h(){w.trigger("enter",$(document.activeElement).attr("data-cid"))}function g(e){var t="true"!==e.attr(E);if(i()){var a=n().length;e.attr(E,t),(t||a>1)&&e.attr(A,t),t&&l().filter(S+D).attr(A,!1)}else e.attr(E,t).attr(A,t)}function p(e){l().filter(F).attr(N,-1),e.attr(N,1).focus()}function m(e){e.attr(A,!0)}function v(e){var t=Math.min(q,e),n=Math.max(q,e);l().slice(t,n+1).attr(E,!0).attr(A,!0)}function b(){n().attr(E,!1),a().attr(A,!1)}function y(e){return l().filter(e).map(function(){return $(this).attr("data-cid")}).toArray()}function x(){var e,t=y(D);e=i()?t.length>1?t:[]:y(T),w.trigger("change",{checked:e,selected:t})}var k=$('<li tabindex="-1" role="option" aria-selected="false" aria-checked="false" data-cid=""><i class="fa checkmark" aria-hidden="true"></i></li>')[0];$("body").append($('<ul class="megalist checkboxes" role="listbox" aria-multiselectable="true">').append(_.range(0,20).map(function(e){return $('<li class="page-divider">').attr("data-divider",e)})));var w=$(".megalist"),C=w[0],K=_.range(0,20).map(function(e){var t=document.createDocumentFragment();return _.range(0,50).forEach(function(n){var a=k.cloneNode(!0),r=100*e+n;a.setAttribute("data-cid",r),a.appendChild(document.createTextNode("List option #"+r)),t.appendChild(a)}),{detached:!0,fragment:t}});e(K[0].fragment,C.querySelector(".page-divider")),K[0].detached=!1,w.on("scrollend",function(){var t,n,a,r,i=this.scrollTop,c=i+this.clientHeight,o=this.querySelectorAll(".page-divider");for(r=0;n=o[r];r++)if(a=n.offsetTop,a+n.offsetHeight<i||a>c){if(K[r].detached)continue;t=document.createDocumentFragment(),C.querySelectorAll('[data-page="'+r+'"]').forEach(function(e){this.appendChild(e)}.bind(t)),K[r].fragment=t,K[r].detached=!0}else{if(!K[r].detached)continue;e(K[r].fragment,o[r]),K[r].detached=!1}});var q=0;w.attr("tabindex",-1).find('[role="option"]:first').attr({tabindex:1,"aria-selected":!0}).end().focus(),w.on("focusin focusout",function(e){$(this).toggleClass("has-focus","focusin"===e.type)}).on("keydown",function(e){switch(e.which){case 13:h();break;case 32:d(e);break;case 35:case 36:s(e);break;case 38:case 40:f(e)}}).on("mousedown",'[role="option"]',function(e){var t=e.ctrlKey||e.metaKey||e.offsetX<48&&i();c(e.currentTarget,t?"toggle":"select",e)}).on("select",'[role="option"]',function(e){u.call(e.currentTarget,e)}).on("toggle",'[role="option"]',function(e){o.call(e.currentTarget,e)}).on("enter action",function(e,t){console.log("selection:"+e.type,t)}).on("change",function(e,t){console.log("selection:change",t)});var E="aria-checked",T="["+E+'="true"]',S="["+E+'="false"]',A="aria-selected",D="["+A+'="true"]',N="tabindex",F="["+N+'="1"]';window.toggleCheckboxes=function(e){w.toggleClass("checkboxes",e)}});