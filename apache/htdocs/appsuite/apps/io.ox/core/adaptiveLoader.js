define("io.ox/core/adaptiveLoader",["io.ox/core/extensions","io.ox/core/capabilities","settings!io.ox/core"],function(e,n,c){"use strict";var t;if(localStorage&&n.has("lab:adaptiveLoading")){var o=_(ox.serverConfig.capabilities).pluck("id").sort().join(","),i=c.get("language"),a=c.get("theme");t={log:function(){t.debug,console.log.apply(console,arguments)},listen:function(e){t.log("listen",e),t.cache||t.init(),t.currentChunk=e,t.modules=t.cache[e]||[]},startAndLoad:function(e){if(t.log("startAndLoad",e),t.cache||t.init(),t.listen(e),t.cache[e])return require(t.cache[e])},startAndEnhance:function(e,n){return t.log("startAndEnhance",e,n),t.cache||t.init(),t.listen(e),t.cache[e]&&_(t.cache[e]).each(function(e){_(n).contains(e)||n.push(e)}),t.log("enhanced",n),n},stop:function(){t.log("stop",t.currentChunk),t.cache||t.init(),t.currentChunk&&(t.cache[t.currentChunk]=_.uniq(t.modules),t.log(t.cacheKey,t.cache),localStorage.setItem(t.cacheKey,JSON.stringify(t.cache)),delete t.modules,delete t.currentChunk)},record:function(e){return t.log("record",e),t.cache||t.init(),setTimeout(function(){t.currentChunk===e&&t.stop()}),t.listen(e)},init:function(){t.log("init"),t.cacheKey="ox-adaptiveload-"+ox.base+"["+(ox.user||"anon")+"]["+o+"]["+i+"]["+a+"]",t.cache=JSON.parse(localStorage.getItem(t.cacheKey)),t.cache||(t.cache={}),t.log("cache",t.cache),$(window).on("require:require",function(e,n){t.modules&&t.modules.push(n.replace(/\.js$/,"")),t.dirty||(t.dirty=!0,setTimeout(function(){t.currentChunk&&(t.cache[t.currentChunk]=_.uniq(t.modules),t.log(t.cacheKey,t.cache),localStorage.setItem(t.cacheKey,JSON.stringify(t.cache))),t.dirty=!1},3e3))})}}}else t={listen:$.noop,startAndLoad:function(){return $.Deferred().resolve()},startAndEnhance:function(e,n){return n},stop:$.noop,record:$.noop,init:$.noop};return t});