define("io.ox/core/viewer/views/types/textview",["io.ox/core/viewer/views/types/baseview","gettext!io.ox/core"],function(t,i){"use strict";return t.extend({initialize:function(t){_.extend(this,t),this.isPrefetched=!1,this.xhr=null,this.loadTimeoutId=null,this.listenTo(this.viewerEvents,"viewer:zoom:in",this.onZoomIn),this.listenTo(this.viewerEvents,"viewer:zoom:out",this.onZoomOut),this.$el.on("scroll",_.throttle(this.onScrollHandler.bind(this),500))},render:function(){return this.size=13,this.$el.empty().css("display","block"),this},onDataLoaded:function(t){this.clearLoadTimeout();var i=this.model.get("file_size");_.isNumber(i)&&i>0&&_.isEmpty(t)?this.onError():(this.$el.idle(),this.$el.addClass("swiper-no-swiping").append($('<div class="white-page letter plain-text">').text(t)))},onError:function(){this.displayNotification(i("Sorry, there is no preview available for this file."))},onLoadTimeout:function(){this.clearLoadTimeout(),this.abortAjaxRequest(),this.onError()},clearLoadTimeout:function(){this.loadTimeoutId&&(window.clearTimeout(this.loadTimeoutId),this.loadTimeoutId=null)},abortAjaxRequest:function(){this.xhr&&(this.xhr.abort(),this.xhr=null)},prefetch:function(){var t=this.getPreviewUrl();return this.$el.busy(),this.xhr=$.ajax({url:t,dataType:"text",context:this}).done(this.onDataLoaded).fail(this.onError),this.loadTimeoutId=window.setTimeout(this.onLoadTimeout.bind(this),9e4),this.isPrefetched=!0,this},show:function(){return this},unload:function(){return this.$el.find(".white-page").remove(),this.isPrefetched=!1,this},setFontSize:function(t){this.size=Math.min(Math.max(t,9),21),this.$(".white-page").css("fontSize",this.size)},onZoomIn:function(){this.setFontSize(this.size+2)},onZoomOut:function(){this.setFontSize(this.size-2)},onScrollHandler:function(){this.viewerEvents.trigger("viewer:blendnavigation")},onDispose:function(){this.abortAjaxRequest(),this.clearLoadTimeout(),this.$el.css("display","")}})});