define("io.ox/core/folder/api",["io.ox/core/http","io.ox/core/folder/util","io.ox/core/folder/sort","io.ox/core/folder/blacklist","io.ox/core/folder/title","io.ox/core/folder/bitmask","io.ox/core/api/account","io.ox/core/api/user","io.ox/core/api/jobs","io.ox/core/capabilities","io.ox/contacts/util","settings!io.ox/core","settings!io.ox/mail","settings!io.ox/calendar","io.ox/core/api/filestorage","gettext!io.ox/core"],function(e,t,n,r,o,i,a,l,s,u,d,c,f,h,g,p){"use strict";function m(e){return"1"===(e=String(e))||/^default\d+/.test(e)?0:1}function v(e,t,n){return t["index/"+e]=n,t}function b(e){var n=[].concat(e).filter(function(e){return!!/^(contacts|calendar|tasks|event)$/.test(e.module)&&(e.id===String(h.get("chronos/defaultFolderId"))||t.is("shared",e))}),r=_(n).chain().pluck("created_by").compact().uniq().value();return 0===r.length?$.when(e):l.getList(r).then(function(t){var o=_.object(r,t);return _(n).each(function(e){e.id===String(h.get("chronos/defaultFolderId"))||e.title===p("Calendar")?e.display_title=d.getFullName(o[e.created_by])||p("Default calendar"):e.display_title=p("%1$s: %2$s",d.getFullName(o[e.created_by]),e.title)}),e})}function w(e){delete ee.models[e.previous("id")],ee.models[e.id]=e}function x(e){ee.unfetch(e.id)}function y(e){return"cal://0/allPublic"===e||/^virtual/.test(e)}function C(e){return/^(contacts|calendar|tasks|event)$/.test(e)}function M(e,t){return(t?"all/":"")+String(e)}function S(e){return ee.getCollection(e.id).reduce(function(e,t){var n=a.getType(t.get("id"));return"trash"===n||"spam"===n||"confirmed_spam"===n?e:e+(t.get("subtotal")||0)+(t.get("unread")||0)},0)}function N(e,t,n){var r=t-(void 0!==e._previousAttributes[n]&&null!==e._previousAttributes[n]?e._previousAttributes[n]:0),o=ee.models[e.get("folder_id")],i=e.get("virtual_parents");0!==r&&o&&"system"!==o.get("module")&&ee.collections[o.get("id")]&&(o.is("unifiedfolder")||o.set("subtotal",S(o))),0!==r&&i&&i.length>0&&_(i).each(function(t){ee.models[t]&&ee.collections[t]._byId[e.get("id")]?ee.models[t].set("subtotal",S(ee.models[t])):e.set("virtual_parents",_(e.get("virtual_parents")).without(t))})}function O(e,t){N(e,t,"subtotal")}function k(e,t){N(e,t,"unread"),te.trigger("change:unread",e,t)}function F(){this.models={},this.collections={}}function J(e,t){return t=r.apply(t),t=n.apply(e,t),_(t).each(v.bind(null,e)),t}function T(e){if(e instanceof Backbone.Model){var t=e,n=t.toJSON(),r=n.id;return void 0!==t.changed.total&&null!==t.changed.total&&(te.trigger("update:total",r,n),te.trigger("update:total:"+r,n)),void(void 0!==t.changed.unread&&null!==t.changed.unread&&(te.trigger("update:unread",r,n),te.trigger("update:unread:"+r,n)))}return/^account:(create|delete|unified-enable|unified-disable)$/.test(e)?A("1",{cache:!1}).done(function(){ae.refresh(),te.trigger("refresh")}):ie}function j(e,t){this.id=e,this.getter=t}function D(e){return e={error:e,code:"UI-FOLDER"},console.warn("folder/api",e),te.trigger("error error:"+e.code,e),$.Deferred().reject(e)}function I(t,n){if(void 0===t)return D("Cannot fetch folder with undefined id");t=String(t),n=_.extend({cache:!0},n);var r=ee.models[t];return!0===n.cache&&void 0!==r&&r.has("title")?$.when(r.toJSON()):y(t)?$.when({id:t}):"6"!==t||u.has("gab")?e.GET({module:"folders",params:{action:"get",altNames:!0,id:t,timezone:"UTC",tree:m(t)}}).pipe(function(e){return b(e)},function(e){return te.trigger("error error:"+e.code,e,t),e}).pipe(function(e){var t=ee.addModel(e);return _(t.changed).size()&&te.trigger("changesAfterReloading:"+t.get("module"),t),T(t),e}):D(p("Accessing global address book is not permitted"))}function A(t,n){t=String(t),n=_.extend({all:!1,cache:!0},n);var r=M(t,n.all),o=ee.getCollection(r);if(o.fetched&&!o.expired&&!0===n.cache)return $.when(o.toJSON());if(oe[t]&&!n.all){var i=J(t,oe[t]);return delete oe[t],b(i).then(function(e){return ee.addCollection(t,e),e})}var a,l,s=/^flat\/([^/]+)\/([^/]+)$/.exec(t);return s?(a=s[1],l=s[2],q({module:a,cache:n.cache}).then(function(e){return e[l]})):y(t)?ae.list(t):e.GET({module:"folders",params:{action:"list",all:n.all?"1":"0",altNames:!0,parent:t,timezone:"UTC",tree:m(t)},appendColumns:!0}).then(b,function(e){throw te.trigger("error error:"+e.code,e,t),e}).then(function(e){return e=J(t,e),ee.addCollection(r,e,{all:n.all}),e})}function E(t){return e.makeObject(t,"folders")}function P(e,t){return"flat/"+e+"/"+t}function U(e,t){return ee.getCollection(P(e,t))}function B(){return _(ee.collections).chain().keys().filter(function(e){return/^flat/.test(e)}).map(function(e){return e.split("/")[1]}).uniq().value()}function L(e){e.unshift(ee.getModel("cal://0/allPublic").toJSON())}function q(n){if("calendar"===(n=_.extend({module:void 0,cache:!0},n)).module&&(n.module="event"),ox.debug&&!n.module)return console.warn("Folder API > flat() - Missing module",n),$.Deferred().reject();var r=n.module,o=U(r,"private"),i={};return o.fetched&&!0===n.cache?(i.private=o.toJSON(),["public","shared","sharing","hidden"].forEach(function(e){var t=U(r,e);t.fetched&&(i[e]=t.toJSON())}),$.when(i)):(te.trigger("before:flat:"+n.module),e.GET({module:"folders",appendColumns:!0,params:{action:"allVisible",altNames:!0,content_type:r,timezone:"UTC",tree:1,all:!!n.all}}).then(function(e){var n=[],r=_(e).chain().map(function(e,r){var o=_(e).chain().map(E).filter(function(e){return!(!t.can("read",e)&&!t.can("change:permissions",e))}).value();return n.push(o),[r,o]}).object().value();return b(_(n).flatten()).then(function(){return r})}).then(function(e){var o,i={},a=[],l=[],s=c.get(["folder/hidden"],{});return"event"!==r||e.public||(e.public=[]),_(e).each(function(e,n){var u=_(e).filter(function(e){return s[e.id]?(a.push(e),!1):(t.is("shared-by-me",e)&&l.push(e),!0)});"event"===r&&"public"===n&&L(u),u=J(o=P(r,n),u),ee.addCollection(o,i[n]=u,{reset:!0})}),o=P(r,"hidden"),a=J(o,a),ee.addCollection(o,i.hidden=a,{reset:!0}),o=P(r,"sharing"),l=J(o,l),ee.addCollection(o,i.sharing=l,{reset:!0}),te.trigger("after:flat:"+n.module),i}))}function R(t,n,o){if(_.isObject(n)&&!_.isEmpty(n)){o=_.extend({silent:!1},o);var i=ee.getModel(t).set(n,{silent:o.silent});if(y(t))return $.when();o.silent||te.trigger("before:update before:update:"+t,t,i);var a={folder:n},l=function(e){if(t!==e&&i.set("id",e),o.cascadePermissions&&Y(),o.silent||(te.trigger("update update:"+t,t,e,i.toJSON()),"permissions"in n&&te.trigger("change:permissions",t)),t!==e||n.title||n.folder_id)return A(i.get("folder_id"),{cache:!1}).then(function(){return ee.getCollection(i.get("folder_id")).sort(),"title"in n&&te.trigger("rename",t,i.toJSON()),"title"in n&&te.trigger("after:rename",t,i.toJSON()),e})},u=function(e){throw te.get(t,{cache:!1}),e&&e.code&&"FLD-0018"===e.code&&(e.error=p("Could not save settings. There have to be at least one user with administration rights.")),o.silent||te.trigger("update:fail",e,t),e};return o.notification&&!_.isEmpty(o.notification)&&(a.notification=o.notification),e.PUT({module:"folders",params:{action:"update",id:t,timezone:"UTC",tree:m(t),cascadePermissions:o.cascadePermissions,ignoreWarnings:o.ignoreWarnings,allow_enqueue:o.enqueue},data:a,appendColumns:!1}).done(function(){var e=i.toJSON();r.visible(e)||te.trigger("warn:hidden",e)}).then(function(e){return e&&o.enqueue&&("JOB-0003"===e.code||e.job)?(s.addJob({module:"folders",action:"update",done:!1,showIn:i.get("module"),id:e.job||e.data.job,successCallback:l,failCallback:u}),e):l(e)},u)}}function z(e){_(ee.collections).invoke("remove",e)}function G(e){this.nodeValue=e.display_title||e.title||e.id}function V(e){return _(e).chain().pluck("folder_id").uniq().value().length<=1}function X(e){return!a.is("sent",e.folder_id)}function W(e){return _.isString(e)?e:e?e.folder_id:null}function H(){_.chain(arguments).flatten().map(W).compact().uniq().each(function(e){H.hash[e]||(H.hash[e]=_.debounce(I.bind(null,e,{cache:!1}),H.wait)),te.trigger("reload:"+e),H.hash[e]()})}function K(e){var t=ee.getModel(e).get("module");c.set(["folder/hidden",e],!0).save(),te.trigger("hide",e),q({module:t,cache:!1})}function Q(e){var t=ee.getModel(e).get("module");c.remove(["folder/hidden",e]).save(),te.trigger("show",e),q({module:t,cache:!1})}function Y(){ee.expire(),e.pause();var t=[];return _(te.pool.models).chain().filter(function(e){return!C(e.get("module"))}).invoke("get","folder_id").uniq().compact().without("0").each(function(e){t.push(A(e,{cache:!1}))}),_(B()).each(function(e){t.push(q({module:e,all:"event"===e,cache:!1}))}),$.when.apply($,t).always(function(){ae.refresh()}),e.resume()}function Z(){return f.get("defaultseparator","/")}var ee,te={};_.extend(te,Backbone.Events);var ne=Backbone.Model.extend({constructor:function(){Backbone.Model.apply(this,arguments),this.set("virtual_parents",[]),"mail"!==this.get("module")&&void 0!==this.get("module")||this.on({"change:id":w,"change:subtotal":O,"change:unread":k})},isAdmin:function(){return!!new i(this.get("own_rights")).get("admin")},supportsInternalSharing:function(){return!!this.is("drive")||(this.is("mail")?u.has("gab")&&this.can("change:permissions"):!(this.is("calendar")&&this.is("private")&&!this.supportsShares())&&(this.is("public")?u.has("edit_public_folders"):u.has("read_create_shared_folders")))},supportsInviteGuests:function(){return!this.is("mail")&&u.has("invite_guests")&&this.supportsInternalSharing()},supportsShares:function(){return!(!this.is("mail")||1!=(1&this.get("capabilities")))||this.supports("permissions")},isShareable:function(){return this.isAdmin()&&this.supportsShares()},supports:function(e){return t.supports(e,this.attributes)},is:function(e){return t.is(e,this.attributes)},can:function(e){return t.can(e,this.attributes)}}),re=Backbone.Collection.extend({model:ne,constructor:function(e){Backbone.Collection.apply(this,arguments),this.id=e,this.fetched=!1,this.on("remove",this.onRemove,this),(/^flat\/(contacts|calendar|tasks|event)\/shared$/.test(this.id)||/^flat\/(contacts|calendar|tasks|event)\/hidden$/.test(this.id))&&(this.comparator=function(e){return(e.get("display_title")||e.get("title")).toLowerCase()})},comparator:function(e){return e.get("index/"+this.id)||0},onRemove:function(e){C(e.get("module"))||(ee.getModel(this.id).set("subscr_subflds",this.length>0),te.trigger("collection:remove",this.id,e))}});_.extend(F.prototype,{addModel:function(e){if(e.attributes)return e;var t=e.id,n=this.models[t];return void 0===n?(this.models[t]=n=new ne(e),te.trigger("pool:add",n)):n.set(e),n},removeModels:function(e){e&&_.each(this.models,function(t,n){return!t.get("account_id")||(t.get("account_id")!==e||(te.trigger("remove",n,this.models[n].toJSON()),void delete this.models[n]))}.bind(this))},addCollection:function(e,t,n){n&&!n.all&&_(t).each(function(e){delete e.subfolders});var r=_(t).map(this.addModel,this);n=n||{};var o=this.getCollection(e),i=o.fetched?"set":"reset";if(o.expired=!1,this.models[e]&&y(e)&&_(o.models).each(function(t){t.set("virtual_parents",_(t.get("virtual_parents")).without(e))}),o[i](r),o.fetched=!0,this.models[e]&&("mail"===this.models[e].get("module")||void 0===this.models[e].get("module"))&&!this.models[e].is("unifiedfolder")){for(var l=0,s=0;s<r.length;s++){var u=a.getType(r[s].get("id"));if("trash"!==u&&"spam"!==u&&"confirmed_spam"!==u&&(l+=(r[s].get("subtotal")||0)+(r[s].get("unread")||0),y(e))){var d=r[s].get("virtual_parents");d&&(d.push(e),r[s].set("virtual_parents",_.uniq(d)))}}this.models[e].set("subtotal",l)}n.reset&&o.trigger("reset")},removeCollection:function(e,t){t=t||{};var n=this.collections[e],r=this,o=n?n.models:[];if(n&&(n=null,delete this.collections[e],_(o).each(function(e){z(e.id),r.removeCollection(e.id,t)}),t.removeModels&&this.models[e])){var i=this.models[e].toJSON();this.models[e]=null,delete this.models[e],te.trigger("remove",e,i),te.trigger("remove:"+e,i),te.trigger("remove:"+i.module,i)}},getModel:function(e){return this.models[e]||(this.models[e]=new ne({id:e}))},getCollection:function(e,t){return e=M(e,t),this.collections[e]||(this.collections[e]=new re(e))},expire:function(){_(this.collections).each(function(e){e.expired=!0})},unfetch:function(e){if(0===arguments.length||"0"===e)return _(this.collections).each(function(e){e.fetched=!1});var t=this.collections[e];t&&(t.fetched=!1,t.each(x))}}),ee=new F,_(ox.rampup.folder).chain().keys().each(function(e){ee.addModel(ox.rampup.folder[e])});var oe={};_(ox.rampup.folderlist||{}).each(function(t,n){oe[n]=_(t).map(function(t){return _.isArray(t)?e.makeObject(t,"folders"):t})}),u.has("webmail")&&ee.addModel({folder_id:"default0/INBOX",id:"virtual/all-unseen",module:"mail",title:p("Unread")}),!u.has("guest")&&u.has("edit_public_folders")&&ee.addModel({folder_id:"1",id:"cal://0/allPublic",module:"calendar",permissions:[{bits:0,entity:ox.user_id,group:!1}],standard_folder:!0,supported_capabilities:[],title:p("All my public appointments"),total:-1,type:1,subscribed:!0});var ie=$.when();j.prototype.concat=function(){return _.whenSome.apply(void 0,arguments).then(function(e){return e.rejected.length&&_.each(e.rejected,function(e){console.error(e)}),_(e.resolved).chain().flatten().compact().value()})},j.prototype.list=function(){var e=this.id;return this.getter().done(function(t){_(t).chain().map(function(e){return y(e.id)?_.extend(e,ee.getModel(e.id).toJSON()):e}).each(v.bind(null,e)).value(),ee.addCollection(M(e),t),ee.getModel(e).set("subscr_subflds",t.length>0)})};var ae={hash:{},list:function(e){var t=this.hash[e];return void 0!==t?t.list():$.Deferred().reject()},add:function(e,t){this.hash[e]=new j(e,t),ee.getModel(e).set("subscr_subflds",!0)},concat:function(){return ox.debug&&console.warn("Deprecated! Please use this.concat()"),$.when.apply($,arguments).then(function(){return _(arguments).chain().flatten().map(v.bind(null,"concat")).value()})},reload:function(e){ee.getCollection(M(e)).fetched=!1,this.list(e)},refresh:function(){_(this.hash).invoke("list")},getCollections:function(){return _(this.hash).keys().map(function(e){return te.pool.getCollection(e)})}},le=[];H.hash={},H.wait=2e3;var se=function(){function e(e){delete n[e],H(e)}function t(t){n[t]&&clearTimeout(n[t]),n[t]=setTimeout(e,r,t)}var n={},r=500;return function(e,n){var r=ee.getModel(e);r.set("unread",Math.max(0,r.get("unread")+n)),t(e)}}();ox.on("please:refresh refresh^",Y),ox.on("account:delete",ee.removeModels.bind(ee)),g.on("create update",Y);var ue=""===f.get("namespace","INBOX/");return t.registerPool(ee),_.extend(te,{FolderModel:ne,FolderCollection:re,Pool:F,pool:ee,calculateSubtotal:S,get:I,list:A,multiple:function(t,n){function r(t){return $.Deferred().reject({error:e.messages[t],code:t.toUpperCase()})}if(!t||!t.length)return $.when([]);n=_.extend({cache:!0,errors:!1},n);try{return e.pause(),$.when.apply($,_(t).map(function(e){return I(e,{cache:n.cache}).pipe(null,function(t){return t.id=e,$.when(n.errors?t:void 0)})})).pipe(function(){return _(arguments).toArray()}).pipe(function(e){return e.length?_(e).all({code:"OFFLINE"})?r("offline"):_(e).all({code:"NOSERVER"})?r("noserver"):e:[]})}finally{e.resume()}},path:function(t){var n,r=[],o=t,i=!1;if(void 0===t)return $.when([]);do{r.push(n=ee.getModel(o).toJSON()),o=n.folder_id,i="1"===String(o)}while(o&&!i);return i?$.when(r.reverse()):y(t)?ee.getModel(t).toJSON()?$.when([ee.getModel(t).toJSON()]):$.when([]):e.GET({module:"folders",params:{action:"path",altNames:!0,id:t,tree:m(t)},appendColumns:!0}).then(function(e){return _(e).filter(function(e){return ee.addModel(e),"1"!==e.id}).reverse()})},flat:q,update:R,move:function(e,t,n){if(e===t)return $.when();n=n||{};var r=ee.getModel(e),o=r.get("folder_id");return z(r),te.trigger("before:move",r.toJSON(),t),r.set("unread",0),R(e,{folder_id:t},n).then(function(n){var i=function(n){if(n.error)throw ee.getModel(o).set("subscr_subflds",!0),ae.refresh(),ee.getCollection(o).add(r),n;ee.getModel(t).set("subscr_subflds",!0),ae.refresh(),ee.getCollection(t).add(r),te.trigger("move",e,n)};if(n&&("JOB-0003"===n.code||n.job))return te.trigger("new:longrunningjob"),void s.on("finished:"+(n.job||n.data.job),i);i(n)},function(e){throw ee.getModel(o).set("subscr_subflds",!0),ee.getCollection(o).add(r),ae.refresh(),e})},create:function(n,o){return n=String(n),I(n).then(function(i){C((o=_.extend({module:i.module,subscribed:1,title:p("New Folder")},o)).module)&&"calendar"!==o.module&&"event"!==o.module&&"2"!==i.id&&!t.is("public",i)&&(o.permissions=_(i.permissions).filter(function(e){return!!(268435456&e.bits)}));var a={action:"new",autorename:!0,folder_id:n};return"event"!==o.module&&(a.tree=m(n)),e.PUT({module:"folders",params:a,data:o,appendColumns:!1}).then(function(e){return I(e)}).then(function(e){return(C(o.module)?q({module:o.module,cache:!1}):A(n,{cache:!1})).then(function(){return e})}).done(function(e){r.visible(e)||te.trigger("warn:hidden",e)}).done(function(e){ee.getModel(n).set("subscr_subflds",!0),ae.refresh(),te.trigger("create",e),te.trigger("create:"+n.replace(/\s/g,"_"),e)}).fail(function(e){te.trigger("create:fail",e,n)})})},remove:function(t){_.isArray(t)||(t=[t]);var n,r={};return _(t).each(function(e){var t=ee.getModel(e),n=r[e]=t.toJSON();te.trigger("before:remove",n),t.set("unread",0),z(t),delete ee.models[e],t.trigger("destroy")}),n={action:"delete",failOnError:!0,tree:m(t[0]),extendedResponse:!0},e.PUT({module:"folders",params:n,data:t,appendColumns:!1}).done(function(e){e=e||[],_(t).each(function(t,n){var o=r[t];if(te.trigger("remove",t,o),te.trigger("remove:"+t,o),te.trigger("remove:"+o.module,o),!C(o.module))if(te.is("trash",o)||e[n]&&_.isEmpty(e[n].new_path))te.pool.removeCollection(t,{removeModels:!0});else{le.push(t);var i=e[n]?e[n].new_path:t;te.get(i,{cache:!1}).fail(function(e){"FLD-0008"!==e.code&&"IMAP-1002"!==e.code||te.pool.removeCollection(t,{removeModels:!0})}).always(function(){le=_(le).without(t)})}a.is("trash",t)&&te.trigger("cleared-trash")})}).fail(function(){_(t).each(function(e){te.trigger("remove:fail",e)}),Y()})},restore:function(t){_.isArray(t)||(t=[t]);var n=[];return _(t).each(function(e){var t=e.get("id");n.push(t),_(te.pool.collections).invoke("remove",e),e.set("unread",0)}),e.PUT({module:"folders",params:{action:"restore",tree:m(n[0])},data:n,appendColumns:!1}).done(function(){_(t).each(function(e){var t=e.get("id");te.get(t,{cache:!1}).done(function(){Y(),te.trigger("restore",e.toJSON())}).fail(function(t){"FLD-0008"!==t.code&&"IMAP-1002"!==t.code||z(e)})})}).fail(function(){_(t).each(function(e){te.propagate("restore:fail",e.toJSON())})})},isBeingDeleted:function(e){return _(le).contains(e)},clear:function(t){return te.trigger("before:clear",t),e.PUT({module:"folders",appendColumns:!1,params:{action:"clear",tree:m(t)},data:[t]}).done(function(){(te.pool.models[t]&&te.pool.models[t].is("trash")||a.is("trash",t))&&(te.pool.collections[t]&&te.pool.collections[t].each(function(e){te.pool.removeCollection(e.id,{removeModels:!0})}),te.trigger("cleared-trash")),te.trigger("clear",t),Y()})},reload:H,hide:K,show:Q,toggle:function(e,t){!0===t?Q(e):K(e)},refresh:Y,bits:t.bits,is:t.is,can:t.can,supports:t.supports,virtual:ae,isVirtual:y,isExternalFileStorage:function(e){return 14===(e instanceof Backbone.Model?e.get("type"):e.type)},isFlat:C,isNested:function(e){return/^(mail|infostore)$/.test(e)},getFlatCollection:U,getFlatViews:B,getDefaultFolder:t.getDefaultFolder,getExistingFolder:function(e){var n=t.getDefaultFolder(e);return n?$.Deferred().resolve(n):"mail"===e?$.Deferred().resolve("default0"+Z()+"INBOX"):"infostore"===e?$.Deferred().resolve(10):q({module:e}).then(function(e){for(var t in e)if("hidden"!==t){var n=e[t];if(n&&n[0]&&n[0].id)return n[0].id}return null})},getStandardMailFolders:function(){var e=_(a.getStandardFolders()).filter(function(e){return!/^default0/.test(e)}),t=a.getInbox(),n=ee.getCollection(t);return _(n.pluck("id")).filter(a.isStandardFolder).concat(e)},getDefaultSeparator:Z,getMailFolderSeparator:function(e){var t=e.split(Z())[0],n=f.get("separators")||{};return/^default\d+$/.test(t)?(t=t.replace("default",""),n[t]?n[t]:Z()):"/"},getTextNode:function(e){var t=document.createTextNode("");return I(e).done(G.bind(t)),t},getDeepLink:function(e){var t="io.ox/"+("infostore"===e.module?"files":e.module),n=encodeURIComponent(e.id);return ox.abs+ox.root+"/#!&app="+t+"&folder="+n},getFolderTitle:o,ignoreSentItems:function(e){return _.isArray(e)&&1!==e.length?V(e)?e:_(e).filter(X):e},processListResponse:J,changeUnseenCounter:se,setUnseenCounter:function(e,t){ee.getModel(e).set("unread",Math.max(0,t))},setUnseenMinimum:function(e,t){var n=ee.getModel(e);n.set("unread",Math.max(t||0,n.get("unread")))},getSection:function(e){return 3===e?"shared":2===e?"public":"private"},Bitmask:i,propagate:T,altnamespace:ue,injectIndex:v,multipleLists:function(t,n){try{return e.pause(),$.when.apply($,_(t).map(function(e){return A(e).then(null,function(t){return t.id=e,$.when(n.errors?t:void 0)})})).then(function(){var e=[];return _(arguments).toArray().forEach(function(t){Array.prototype.push.apply(e,t)}),e})}finally{e.resume()}}}),te});