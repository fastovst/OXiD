define("io.ox/core/folder/contextmenu",["io.ox/core/extensions","io.ox/core/folder/actions/common","io.ox/core/folder/api","io.ox/core/api/account","io.ox/core/capabilities","io.ox/core/api/filestorage","io.ox/backbone/mini-views/contextmenu-utils","settings!io.ox/core","settings!io.ox/files","gettext!io.ox/core"],function(e,a,d,t,i,o,n,r,l,s){"use strict";var c={markFolderSeen:function(e){"mail"===e.module&&n.addLink(this,{action:"markfolderread",data:{folder:e.data.id,app:e.app},enabled:d.can("write",e.data),handler:a.markFolderSeen,text:s("Mark all messages as read")})},moveAllMessages:function(e){"mail"===e.module&&n.addLink(this,{action:"move-all-messages",data:{id:e.data.id},enabled:d.can("delete",e.data),handler:a.moveAll.bind(a,e.data.id),text:s("Move all messages")})},expunge:function(e){"mail"===e.module&&n.addLink(this,{action:"expunge",data:{folder:e.data.id},enabled:d.can("delete",e.data),handler:a.expunge.bind(a,e.data.id),text:s("Clean up")})},archive:function(){function e(e){ox.load(["io.ox/core/folder/actions/archive"]).done(function(a){a(e.data.id)})}return function(a){if("mail"===a.module&&i.has("archive_emails")){var o=a.data.id;t.is("archive",o)||n.addLink(this,{action:"archive",data:{id:o},enabled:d.can("delete",a.data),handler:e,text:s("Archive old messages")})}}}(),empty:function(e){var t=d.is("trash",e.data);if(!e.data.total){if(t&&!e.data.subscr_subflds)return;if(!t)return}var i=s("Empty folder");"mail"!==e.module&&"infostore"!==e.module||"infostore"===e.module&&!t||(t?i=s("Empty trash"):"mail"===e.module&&(i=s("Delete all messages")),n.addLink(this,{action:"clearfolder",data:{id:e.data.id},enabled:d.can("delete",e.data),handler:a.clearFolder.bind(a,e.data.id),text:i}))},add:function(){function e(e){e.preventDefault(),ox.load(["io.ox/core/folder/actions/add"]).done(function(a){a(e.data.folder,{module:e.data.module})})}return function(a){/^(contacts|calendar|tasks)$/.test(a.module)||("default0"===a.data.id&&d.altnamespace||d.can("create:folder",a.data))&&(d.is("trash",a.data)||n.addLink(this,{action:"add-subfolder",data:{app:a.app,folder:a.data.id,module:a.module},enabled:!0,handler:e,text:s("Add new folder")}))}}(),rename:function(){function e(e){ox.load(["io.ox/core/folder/actions/rename"]).done(function(a){a(e.data.id)})}return function(a){var t=a.data.id||a.app.folder.get(),i=d.pool.getModel(t);d.can("rename",a.data)&&(d.is("trash",i.toJSON())||n.addLink(this,{action:"rename",data:{id:a.data.id},enabled:!0,handler:e,text:s("Rename")}))}}(),alarms:function(){function e(e){ox.load(["io.ox/calendar/actions/change-folder-alarms"]).done(function(a){a(e.data)})}return function(a){d.supports("alarms",a.data)&&"chronos"!==a.data["com.openexchange.calendar.provider"]&&n.addLink(this,{action:"alarms",data:a.data,enabled:!0,handler:e,text:s("Change reminders")})}}(),removeFolder:function(){function e(e){ox.load(["io.ox/core/folder/actions/remove"]).done(function(a){a(e.data.id)})}return function(a){if(d.can("remove:folder",a.data)){var t=a.data.id||a.app.folder.get(),i=d.pool.getModel(t);n.addLink(this,{action:"delete",data:{id:a.data.id},enabled:!0,handler:e,text:s(d.is("trash",i.toJSON())?"Delete forever":"Delete")})}}}(),restoreFolder:function(e){/^(infostore)$/.test(e.module)&&d.is("trash",e.data)&&d.can("restore:folder",e.data)&&String(l.get("folder/trash"))===e.data.folder_id&&n.addLink(this,{action:"restore",data:{id:e.data.id,listView:e.app.listView},enabled:!0,handler:function(e){ox.load(["io.ox/files/api","io.ox/files/actions/restore"]).done(function(a,t){var i=new a.Model(d.pool.getModel(e.data.id).toJSON()),o=e.data.listView.getCompositeKey(i);t(a.resolve([o],!1))})},text:s("Restore")})},move:function(){function e(e){require(["io.ox/core/folder/actions/move"],function(a){a.folder(e.data.id,r)})}return function(a){/^(mail)$/.test(a.module)&&(_.device("smartphone")||d.can("move:folder",a.data,{})&&n.addLink(this,{action:"move",data:{id:a.data.id},enabled:!0,handler:e,text:s("Move")}))}}(),moveDrive:function(){function a(a){a.preventDefault();var t=a.data.id;ox.load(["io.ox/files/api","io.ox/backbone/views/actions/util"]).done(function(i,o){var n=new i.Model(d.pool.getModel(t).toJSON()),r=a.data.listView.getCompositeKey(n),l=i.resolve([r]);o.invoke("io.ox/files/actions/move",e.Baton({models:l,data:l[0]}))})}return function(e){if(/^(infostore)$/.test(e.module)&&!_.device("smartphone")&&d.can("move:folder",e.data,{}))return!e.originFavorites&&void n.addLink(this,{action:"move",data:{id:e.data.id,listView:e.app.listView},enabled:!0,handler:a,text:s("Move")})}}(),zip:function(){function e(e){require(["io.ox/files/api"],function(a){a.zip(e.data.id)})}return function(a){if(-1!==_.indexOf(a.data.supported_capabilities,"zippable_folder")&&!_.device("smartphone")&&"infostore"===a.module){var d=!o.isExternal(a.data);n.addLink(this,{action:"zip",data:{id:a.data.id},enabled:d,handler:e,text:s("Download entire folder")})}}}(),exportData:function(){function e(e){require(["io.ox/core/export"],function(a){a.open(e.data.baton.data.module,{folder:e.data.baton.data.id})})}function a(e){require(["io.ox/core/download"],function(a){a.exported({folder:e.data.baton.data.id,format:"ical"})})}return function(t){if(!_.device("ios || android")&&d.can("export",t.data)&&0!==t.data.total&&(_.isNumber(t.data.total)||null===t.data.total)){var i=e;"calendar"===t.data.module&&(i=a),n.addLink(this,{action:"export",data:{baton:t},enabled:!0,handler:i,text:s("Export")})}}}(),importData:function(){function e(e){e.preventDefault(),require(["io.ox/core/import/import"],function(a){a.show(e.data.baton.data.module,e.data.baton.data.id)})}return function(a){_.device("ios || android")||d.can("import",a.data)&&n.addLink(this,{action:"import",data:{baton:a},enabled:!0,handler:e,text:s("Import")})}}(),shares:function(){function e(e){e.preventDefault();var a=e.data.id;require(["io.ox/files/share/permissions"],function(e){e.showFolderPermissions(a)})}function a(e){e.preventDefault();var a=e.data.id;ox.load(["io.ox/files/api","io.ox/files/actions/share"]).done(function(e,t){var i=new e.Model(d.pool.getModel(a).toJSON());t.link([i])})}return function(t){if(!t.data.filename&&!_.device("smartphone")&&!d.is("trash",t.data)){var o=String(t.data.id),r=d.pool.getModel(o),l=r.supportsInternalSharing(),c=r.supportsInviteGuests(),u=i.has("share_links"),f=c&&r.supportsShares(),p=u&&!r.is("mail")&&r.isShareable(o);(l||f||p)&&(n.header.call(this,s("Sharing")),(l||f)&&n.addLink(this,{action:"invite",data:{app:t.app,id:o},enabled:!0,handler:e,text:s(f?"Permissions / Invite people":"Permissions")}),p&&n.addLink(this,{action:"get-link",data:{app:t.app,id:o},enabled:!0,handler:a,text:s("Create sharing link")}))}}}(),showInDrive:function(){function d(d){d.preventDefault(),require(["io.ox/files/api"],function(t){var i=t.pool.get("detail").get(d.data.cid);a.invoke("io.ox/files/actions/show-in-folder",null,e.Baton({models:i,app:this.view.app,alwaysChange:!0}))})}return function(e){e.data.folder_name||_.device("smartphone")||n.addLink(this,{action:"showInDrive",data:{cid:e.data.cid},enabled:!0,handler:d,text:s("Show in Drive")})}}(),properties:function(){function e(e){e.preventDefault();var a=e.data.id;require(["io.ox/core/folder/actions/properties"],function(e){e(a)})}return function(a){if(!_.device("smartphone")&&("calendar"===a.module||"tasks"===a.module)){var d=a.data["com.openexchange.calendar.provider"],t=(a.data["com.openexchange.calendar.extendedProperties"]||{}).usedForSync||{};("chronos"!==d||t&&"true"===t.value)&&n.addLink(this,{action:"properties",data:{baton:a,id:String(a.data.id)},enabled:!0,handler:e,text:s("Properties")})}}}(),toggle:function(){function e(e){e.preventDefault(),d.toggle(e.data.id,e.data.state)}return function(a){if(a.data.id&&/^(contacts|calendar|tasks)$/.test(a.module)&&!_.device("smartphone")&&!a.data.standard_folder){var t=d.is("hidden",a.data);n.addLink(this,{action:"hide",data:{id:a.data.id,state:t,view:a.view},enabled:!0,handler:e,text:s(t?"Show":"Hide")})}}}(),customColor:function(e){if(/^calendar$/.test(e.module)){var a=e.data["com.openexchange.calendar.extendedProperties"];if(!a||!a.color||!1!==a.color.proected){var t,i=this.parent();this.append(t=$('<li role="presentation" class="io-ox-calendar-color-picker-container">')),require(["io.ox/calendar/color-picker","io.ox/calendar/util"],function(a,o){t.append(new a({model:d.pool.getModel(e.data.id),getValue:function(){return o.getFolderColor(this.model.attributes)},setValue:function(e){d.update(this.model.get("id"),{"com.openexchange.calendar.extendedProperties":_(_.copy(this.model.get("com.openexchange.calendar.extendedProperties")||{})).extend({color:{value:e}})}).fail(function(e){require(["io.ox/core/notifications"],function(a){a.yell(e)})})}}).render().$el),i.trigger("ready")})}}},refreshCalendar:function(e){/^calendar$/.test(e.module)&&d.can("sync:cache",e.data)&&n.addLink(this,{action:"refresh-calendar",data:{folder:e.data},enabled:!0,handler:a.refreshCalendar,text:s("Refresh this calendar")})},selectOnly:function(e){if(/^calendar$/.test(e.module)){var d=e.view.$el.hasClass("single-selection");n.addLink(this,{action:"select-only",data:{folder:e.data},enabled:!0,handler:a.selectOnly,text:s(d?"Show all calendars":"Show this calendar only")})}},selectAll:function(e){"mail"===e.module&&n.addLink(this,{action:"selectall",data:{folder:e.data.id,app:e.app},enabled:!0,handler:function(){e.listView.selection.selectAll(),e.listView.trigger("selection:showHint")},text:s("Select all messages")})},divider:n.divider};return e.point("io.ox/core/foldertree/contextmenu/default").extend({id:"add-folder",index:1e3,draw:c.add},{id:"rename",index:1100,draw:c.rename},{id:"change-alarms",index:1100,draw:c.alarms},{id:"move",index:1200,draw:c.move},{id:"moveDrive",index:1250,draw:c.moveDrive},{id:"publications",index:1300,draw:c.publish},{id:"subscribe",index:1400,draw:c.subscribe},{id:"divider-1",index:1450,draw:n.divider},{id:"customColor",index:1500,draw:c.customColor},{id:"divider-2",index:1600,draw:n.divider},{id:"shares",index:2e3,draw:c.shares},{id:"divider-3",index:2100,draw:n.divider},{id:"import",index:3100,draw:c.importData},{id:"export",index:3200,draw:c.exportData},{id:"zip",index:3300,draw:c.zip},{id:"divider-4",index:3400,draw:n.divider},{id:"mark-folder-read",index:4100,draw:c.markFolderSeen},{id:"move-all-messages",index:4200,draw:c.moveAllMessages},{id:"expunge",index:4300,draw:c.expunge},{id:"archive",index:4400,draw:c.archive},{id:"divider-5",index:4500,draw:n.divider},{id:"refresh-calendar",index:6100,draw:c.refreshCalendar},{id:"select-only",index:6200,draw:c.selectOnly},{id:"toggle",index:6300,draw:c.toggle},{id:"showInDrive",index:6400,draw:c.showInDrive},{id:"empty",index:6500,draw:c.empty},{id:"delete",index:6600,draw:c.removeFolder},{id:"restore",index:6600,draw:c.restoreFolder},{id:"properties",index:6700,draw:c.properties}),e.point("io.ox/core/foldertree/contextmenu/myfolders").extend({id:"add-folder",index:1e3,draw:c.add}),{extensions:c,addLink:n.addLink,disable:n.disable,divider:n.divider}});