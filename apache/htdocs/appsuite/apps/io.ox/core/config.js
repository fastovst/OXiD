define.async("io.ox/core/config",["io.ox/core/http","io.ox/core/cache"],function(e,n){"use strict";var o,t={},r=$.Deferred(),i=function(e){for(var n="string"==typeof e?e.split(/\./):e,o=t||{},r=0,i=n.length;r<i;r++){if(!(null!==o&&void 0!==o&&n[r]in o))return null;o=o[n[r]]}return o},f=function(e,n){for(var o="string"==typeof e?e.split(/\./):e,r=t||{},i=0,f=o.length;i<f;i++)if(r[o[i]]){if("object"!=typeof(r=r[o[i]]))return void console.error("config.set: "+r+" is a value")}else r=r[o[i]]={};r[o[f-1]]=n},u=function(e){for(var n="string"==typeof e?e.split(/\./):e,o=t||{},r=0,i=n.length;r<i;r++){if(!(null!==o&&void 0!==o&&n[r]in o))return!1;o=o[n[r]]}return!0},l=function(e){for(var n="string"==typeof e?e.split(/\./):e,o=t||{},r=0,i=n.length-1;r<i;r++)if(o[n[r]]){if("object"!=typeof(o=o[n[r]]))return void console.error("config.set: "+o+" is a value")}else o=o[n[r]]={};delete o[n[i]]},s={get:function(e,n){return e?void 0===n?i(e):u(e)?i(e):n:t},set:function(n,o,t){if(n&&(f(n,o),t))return e.PUT({module:"config/"+n,appendColumns:!1,processResponse:!1,data:o})},remove:function(e){e&&l(e)},contains:function(e){return u(e)},load:function(){var r=new $.Deferred,i=function(){return e.GET({module:"config",appendColumns:!1,processResponse:!1}).done(function(e){t=void 0!==e?e.data:{},o.add("default",t)})};return o||(o=new n.SimpleCache("config")),o.get("default").done(function(e){null!==e?(t=e,ox.online&&i(),r.resolve(e)):ox.online?i().done(r.resolve):r.resolve(t={})}),r},save:function(){return e.PUT({module:"config",appendColumns:!1,processResponse:!1,data:t})}};return s.load().done(function(){r.resolve(s)}).fail(r.reject),r});