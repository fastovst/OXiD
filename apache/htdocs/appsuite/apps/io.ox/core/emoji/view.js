define("io.ox/core/emoji/view",["raw!io.ox/emoji/unified.json","settings!io.ox/mail","gettext!io.ox/mail","less!io.ox/emoji/emoji"],function(e,t,i){"use strict";e=JSON.parse(e);var n=Backbone.View.extend({tagName:"div",className:"mceEmojiPane",events:{"click .emoji-icons .emoji":"onInsertEmoji","click .emoji-footer .emoji":"onSelectCategory","click .emoji-option, .emoji-tab":"onSelectEmojiCollection","click .reset-recents":"onResetRecents"},onInsertEmoji:function(e){var t=$(e.target).text();o.addRecent(t),this.editor.execCommand("mceInsertContent",!1,t),this.trigger("insert",t)},onSelectCategory:function(e){e.preventDefault();var t=$(e.target);this.setCategory(t.attr("data-category"))},onResetRecents:function(e){e.preventDefault(),o.resetRecents(),this.drawEmojis()},initialize:function(e){this.editor=e.editor,this.subject=e.subject||!1,this.isRendered=!1,this.isOpen=!1,this.currentCategory="",this.$el.data("view",this)},render:function(){var e=$('<div class="table-cell-fix">');return e.append($('<div class="emoji-header">').append($('<span class="emoji-category">')),$('<div class="emoji-icons">'),$('<div class="emoji-footer">')),this.$el.append(e),this.drawCategories(),this.setCategory(),this.isRendered=!0,this.isOpen=!0,this},drawCategories:function(){var e=this.$(".emoji-footer").empty(),t=o.getCategories();e.empty().append(_(t).map(function(e){return $('<button class="emoji">').attr("data-category",e.name).attr("title",i(e.name)).text(e.unicode)}))},getEmojis:function(){return o.getEmojis(this.currentCategory)},drawEmojis:function(){var e=this.$(".emoji-icons").hide().empty(),t=this.getEmojis();e.append(t.map(function(e){return $('<button class="emoji">').text(e)})),t.length>0&&"Recently"===this.currentCategory&&e.append($('<button class="reset-recents">').text(i("Reset this list"))),e.show().scrollTop(0)},setCategory:function(e){this.currentCategory=e||o.getDefaultCategory(),this.$(".emoji-category").text(o.getTitle(this.currentCategory)),this.$(".emoji-footer > button").removeClass("active"),this.$('.emoji-footer > [data-category="'+this.currentCategory+'"]').addClass("active"),this.drawEmojis()},toggle:function(){if(!this.isRendered)return this.render();this.$el.toggle(),this.isOpen=!this.isOpen,this.trigger("toggle",this.isOpen)}}),o={getCategories:function(){return e.meta},addRecent:function(e){var i=t.get("emoji/recently",{}),n=escape(e);n in i?(i[n].count++,i[n].time=_.now()):i[n]={count:1,time:_.now()},t.set("emoji/recently",i).save()},resetRecents:function(){t.set("emoji/recently",{}).save()},getEmojis:function(i){return"Recently"===i?_(t.get("emoji/recently",{})).chain().map(function(e,t){return[unescape(t),e]}).sortBy(function(e){return 0-e[1].time}).first(40).sortBy(function(e){return e[1].count}).pluck(0).value().reverse():e[i]||[]},getDefaultCategory:function(){return"People"},getTitle:function(e){switch(e){case"Recently":return i("Recently used");case"People":return i("People");case"Symbols":return i("Symbols");case"Nature":return i("Nature");case"Objects":return i("Objects");case"Places":return i("Places")}}};return n.util=o,n});