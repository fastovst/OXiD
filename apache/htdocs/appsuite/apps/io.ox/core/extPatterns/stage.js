define("io.ox/core/extPatterns/stage",["io.ox/core/extensions"],function(n){"use strict";var e=1,t=function(e,t){n.point(e).extend(t)};return t.pending={},t.isRunning=function(n){return!_.isEmpty(t.pending[n])},t.abort=function(n,e){t.pending[n]&&t.pending[n][e]&&t.pending[n][e].baton.stopPropagation()},t.abortAll=function(n){_(t.pending[n]).each(function(n){n.stopPropagation()})},t.run=function(i,r,o){(o=o||{}).methodName=o.methodName||"run",r=n.Baton.ensure(r);var d=n.point(i).list(),u=$.Deferred(),a=e++;return r.run_id||(r.run_id=i),r.deferred||(r.deferred=u),t.pending[i]||(t.pending[i]={}),t.pending[i][a]=r,u.always(function(){delete t.pending[i][a]}),(o.beginWith||o.beginAfter)&&(d=d.reduce(function(n,e){return _.isArray(n)?n.concat(e):o.beginAfter===e.id?[]:o.beginWith===e.id?[e]:void 0},null)),d.reduce(function(n,e){return n&&n.then||(n=$.when(n)),n.then(_.identity,function(n){return!0===o.softFail?$.when():$.Deferred().reject(n)}).then(function(){if(!(r.isPropagationStopped()||"default"===e.id&&r.isDefaultPrevented()||r.isDisabled(i,e.id)))return(e[o.methodName]||$.noop)(r)})},$.when()).then(u.resolve,u.reject),u},t});