define("io.ox/formats/vcard",function(){"use strict";var e={},t=function(e){var t={},a={};return a.parts=e.split(":"),a.keytype=a.parts[0].split(";"),a.values=a.parts[1].replace("\\,",",").split(";"),a.key=a.keytype[0].toLowerCase(),a.type=(a.keytype[2]||a.keytype[1]||"typeless").replace(/TYPE=/g,"").replace(/type=/g,"").toLowerCase(),t[a.key]={},t[a.key][a.type]={},"bday"===a.key&&(a.values[0]=a.values[0].slice(0,4)+"-"+a.values[0].slice(4,6)+"-"+a.values[0].slice(6,8)),"n"===a.key?(t[a.key][a.type]["family-name"]=a.values[0]||"",t[a.key][a.type]["given-name"]=a.values[1]||"",t[a.key][a.type]["additional-name"]=a.values[2]||"",t[a.key][a.type]["honorific-prefix"]=a.values[3]||"",t[a.key][a.type]["honorific-suffix"]=a.values[4]||""):"adr"===a.key?(t[a.key][a.type]["post-office-box"]=a.values[0]||"",t[a.key][a.type]["extended-address"]=a.values[1]||"",t[a.key][a.type]["street-address"]=a.values[2]||"",t[a.key][a.type].locality=a.values[3]||"",t[a.key][a.type].region=a.values[4]||"",t[a.key][a.type]["postal-code"]=a.values[5]||"",t[a.key][a.type]["country-name"]=a.values[6]||""):t[a.key][a.type]=a.values,t},a=function(e){var a,i={valid:/^(tel|email|version|n|adr|fn|title|org|role|url|bday|category|role|note)[:;](.+)$/i,next:/^(end)[:](VCARD)$/i,photo:/^(photo)[:;](.+)$/i},s=[],l="",r=e.split(/\r?\n/);for(a in r){var o=r[a],n=i.valid.test(o),d=i.photo.test(o),y=i.next.test(o),v=v||{};d?l=o:n?(""!==l&&(v=$.extend(!0,v,t(l)),l=""),v=$.extend(!0,v,t(o))):""!==l?l+=$.trim(o):y&&(s.push(JSON.parse(JSON.stringify(v))),v=null)}return s},i=function(e){var t,a,i,s,l,r='<div class="vcard" style="clear:both">';for(t in e.photo)r+=e.photo[t]?'<img class="photo" style="float:right" src="data:image/'+t+";base64,"+e.photo[t]+'" />':"";r+='<h1 class="fn" style="line-height: 1.1em">'+e.fn.typeless+"</h1>",l=["honorific-prefix","given-name","additional-name","family-name","honorific-suffix"];for(t in e.n){r+='<div class="n">';for(a in l)s=l[a],r+=(i=e.n[t][s])?'<div class="'+s+'">'+i+"</div>":"";r+="</div>"}r+=e.org?'<div class="org">'+e.org.typeless+"</div>":"",r+=e.title?'<div class="title">'+e.title.typeless+"</div>":"",r+=e.role?'<div class="role">'+e.role.typeless+"</div>":"";for(t in e.url)for(a in e.url[t])r+='<div class="url">',r+='<div class="type">'+t+"</div>",r+='<a class="value" href="'+(i=e.url[t][a])+'">'+i+"</a>",r+="</div>";for(t in e.email)for(a in e.email[t])r+='<div class="email">',r+='<div class="type">'+t+"</div>",r+='<a class="value" href="mailto:'+(i=e.email[t][a])+'">'+i+"</a>",r+="</div>";for(t in e.tel)for(a in e.tel[t])""!==(i=e.tel[t][a])&&(r+='<div class="tel">',r+='<div class="type">'+t+"</div>",r+='<div class="value">'+i+"</div>",r+="</div>");l=["street-address","locality","region","postal-code","country-name"];for(t in e.adr){r+='<div class="adr">',r+='<div class="type">'+t+"</div>";for(a in l)s=l[a],r+=(i=e.adr[t][s])?'<div class="'+s+'">'+i+"</div>":"";r+="</div>"}return r+=e.bday?'<div class="bday">'+e.bday.typeless+"</div>":"",(r+="</div><br>").replace(/\\n/g,"<br/>")},s=function(e){var t="";return _.each(e,function(e){return t+=i(e)}),'<body style="font: 14px/20px Arial; padding: 30px;">'+t+"</body>"};return e.getParsed=function(e){return a(e)},e.getHCard=function(t){return s(e.getParsed(t))},e});