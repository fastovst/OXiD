define("io.ox/calendar/view-detail",["io.ox/core/extensions","io.ox/calendar/common-extensions","io.ox/calendar/util","io.ox/calendar/api","io.ox/core/tk/attachments","io.ox/participants/chronos-detail","io.ox/backbone/views/toolbar","gettext!io.ox/calendar","io.ox/calendar/model","io.ox/calendar/actions","less!io.ox/calendar/style"],function(e,a,t,i,d,n,o,r,l){"use strict";function c(e){e.preventDefault();var a=e.data.baton;t.openDeeplink(a.model)}function s(e,a){$(this).replaceWith(e.data.view.draw(a))}return e.point("io.ox/calendar/detail").extend({index:100,id:"inline-actions",draw:function(e,a){a.hideToolbar||this.append(new o({point:"io.ox/calendar/links/inline",inline:!0}).setSelection(e.array(),{data:e.array(),model:e.model}).$el)}}),e.point("io.ox/calendar/detail").extend({index:150,id:"private-flag",draw:a.privateFlag}),e.point("io.ox/calendar/detail").extend({index:200,id:"title",draw:a.h1}),e.point("io.ox/calendar/detail").extend({index:300,id:"date-time",draw:function(a,t){var i=$('<div class="date-time-recurrence">');e.point("io.ox/calendar/detail/date").invoke("draw",i,a,_.extend({zone:moment().tz()},t)),e.point("io.ox/calendar/detail/icons").invoke("draw",i.find(".date-time"),a),this.append(i)}}),e.point("io.ox/calendar/detail/icons").extend({index:100,id:"additional-flags",draw:a.additionalFlags}),e.point("io.ox/calendar/detail/date").extend({index:100,id:"date",draw:a.date},{index:200,id:"recurrence",draw:function(e){var d=_.bind(function(t){t&&(e.recurrenceMaster=t),a.recurrence.call(this,e)},this);t.hasFlag(e.model,"overridden")&&moment(e.model.get("recurrenceId")).valueOf()===t.getMoment(e.model.get("startDate")).valueOf()?i.get({id:e.model.get("seriesId"),folder:e.model.get("folder")}).then(d,function(){d()}):d()}}),e.point("io.ox/calendar/detail").extend({index:400,id:"location",draw:a.locationDetail}),e.point("io.ox/calendar/detail").extend({index:450,id:"recurrence-warning",draw:function(e){e.data.recurrenceId&&e.data.id!==e.data.seriesId&&e.updateData&&e.updateData.showRecurrenceInfo&&this.append($('<p class="alert alert-info recurrence-warning" role="alert">').text(r("This appointment is an exception. Changing the exception does not affect the series.")))}}),e.point("io.ox/calendar/detail").extend({index:500,id:"note",draw:a.note}),e.point("io.ox/calendar/detail").extend({index:600,id:"participants",draw:function(e){var a=new n(e,{summary:!0});this.append(a.draw())}}),e.point("io.ox/calendar/detail").extend({index:800,id:"details",draw:a.detail}),e.point("io.ox/calendar/detail/details").extend({index:100,id:"organizer",draw:a.organizer}),e.point("io.ox/calendar/detail/details").extend({index:150,id:"sentby",draw:a.sentBy}),e.point("io.ox/calendar/detail/details").extend({index:200,id:"shownAs",draw:a.shownAs}),e.point("io.ox/calendar/detail/details").extend({index:300,id:"folder",draw:a.folder}),e.point("io.ox/calendar/detail/details").extend({index:350,id:"deeplink",draw:function(e,a){if(a&&a.deeplink){var i=t.getDeepLink(e.data);this.append($("<tr>").append($('<th class="detail-label">').text(r("Direct link")),$('<td class="detail">').attr("style","font-size: 12px;").append($('<a target="_blank" role="button" class="deep-link btn btn-primary btn-xs">').attr("href",i).text(r("Appointment")).on("click",{baton:e},c))))}}}),e.point("io.ox/calendar/detail/details").extend({index:400,id:"created",draw:a.created}),e.point("io.ox/calendar/detail/details").extend({index:500,id:"modified",draw:a.modified}),e.point("io.ox/calendar/detail").extend({id:"attachments",index:550,draw:function(a){var t=$('<fieldset class="attachments">').append($('<legend class="io-ox-label">').append($("<h2>").text(r("Attachments"))));a.data.attachments&&a.data.attachments.length&&(this.append(t),e.point("io.ox/calendar/detail/attachments").invoke("draw",t,a))}}),e.point("io.ox/calendar/detail/attachments").extend(new d.AttachmentList({id:"attachment-list",index:200,module:1,selector:".window-container.io-ox-calendar-window"})),{draw:function(a,d){a instanceof Backbone.Model&&(a=new e.Baton({model:a})),(a=e.Baton.ensure(a)).data&&_.isEmpty(a.model)&&(a.model=new l.Model(a.data)),a.model&&_.isEmpty(a.data)&&(a.data=a.model.toJSON()),d=_.extend({minimaldata:!a.data.folder},d),_.device("smartphone")&&!d.deeplink&&a.disable("io.ox/calendar/detail","inline-actions");try{var n=$.createViewContainer(a,i,i.get,{cidGetter:i.cid}).on("redraw",{view:this},s);return n.addClass("calendar-detail view user-select-text").attr("data-cid",String(t.cid(a.data))),e.point("io.ox/calendar/detail").invoke("draw",n,a,d),n}catch(e){console.error("io.ox/calendar/view-detail:draw()",e)}}}});