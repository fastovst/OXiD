define("io.ox/mail/actions/copyMove",["io.ox/mail/api","io.ox/core/folder/api","io.ox/core/extensions","settings!io.ox/mail","gettext!io.ox/mail","io.ox/core/capabilities"],function(e,t,o,i,s,a){"use strict";return{multiple:function(r){require(["io.ox/core/folder/actions/move"],function(l){function n(){require(["io.ox/mail/mailfilter/settings/filter"],function(e){e.initialize().then(function(e,t,i){var s,a={data:{obj:i.model.protectedMethods.buildFactory("io.ox/core/mailfilter/model",i.api).create(i.model.protectedMethods.provideEmptyModel())}};a.data.obj.set("actioncmds",[{id:"move",into:c}]),m.length>1?(s={id:"anyof",tests:[]},_.each(m,function(e){i.filterDefaults.tests.address?s.tests.push({comparison:"is",headers:["from"],id:"address",addresspart:"all",values:[e]}):s.tests.push({comparison:"contains",headers:["From"],id:"header",values:[e]})})):s=i.filterDefaults.tests.address?{comparison:"is",headers:["from"],id:"address",addresspart:"all",values:[m[0]]}:{comparison:"contains",headers:["From"],id:"header",values:[m[0]]},a.data.obj.set("test",s),o.point("io.ox/settings/mailfilter/filter/settings/detail").invoke("draw",void 0,a,t)})})}var c,d,f,m=_.chain(t.ignoreSentItems(r.list)).map(function(e){var t=s("unknown sender");return _.isArray(e.from)&&e.from[0]&&e.from[0][1]&&(t=e.from[0][1]),t}).uniq().value(),u=s.ngettext("All future messages from the sender will be moved to the selected folder.","All future messages from the senders of the selected mails will be moved to the selected folder.",m.length);l.item({all:r.list,api:e,button:r.label,list:t.ignoreSentItems(r.list),module:"mail",root:"1",settings:i,success:r.success,target:r.baton.target,title:r.label,type:r.type,pickerInit:function(e,t){if(e.on("ok",function(){c=t.selection.get()}),!_.device("small")&&a.has("mailfilter_v2")&&"move"===r.type){e.addCheckbox({label:s("Create filter rule"),action:"create-rule",className:"",status:!1});var o=e.$footer.find('[name="create-rule"]'),i=$('<div class="help-block">');o.closest(".checkbox").addClass("checkbox-block text-left").after(i),o.on("change",function(){if(d=$(this).prop("checked"))return i.text(u);i.empty()}),t.on("change",function(e){var t="default0"===e.split("/")[0];if(o.closest(".checkbox").toggleClass("disabled",!t),t)return o.prop("disabled",!1);o.prop({checked:!1,disabled:!0}).trigger("change"),i.empty()})}},pickerClose:function(){!f&&"move"===r.type&&d&&c&&(n(),f=!0)}})})}}});