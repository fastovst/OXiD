define("io.ox/mail/compose/actions/extensions",["io.ox/mail/actions/attachmentEmpty","io.ox/mail/api","io.ox/mail/compose/api","gettext!io.ox/mail","settings!io.ox/mail","io.ox/core/yell"],function(e,t,a,n,i,o){"use strict";var c={};return c.emptyAttachmentCheck=function(t){var a=t.model.get("attachments").chain().pluck("originalFile").compact().value();return e.emptinessCheck(a).then(_.identity,function(){throw t.stopPropagation(),arguments})},c.waitForPendingUploads=function(e){var t=e.model.get("attachments").chain().map(function(t){if(!(t.get("uploaded")>=1)){var a=new $.Deferred;return t.trigger("force:upload"),t.once("upload:complete",a.resolve),t.once("upload:failed",function(t){e.stopPropagation(),a.reject(t)}),a}}).compact().value();if(!(t.length<=0))return $.when.apply($,t).then(function(){e.view.syncMail()})},c.removeUnusedInlineImages=function(e){var n=e.model.get("attachments").where({contentDisposition:"INLINE"}),i=_(n).chain().map(function(n){var i=e.model.get("id"),o=t.getUrl(_.extend({space:i},n),"view").replace("?","\\?");if(!new RegExp('<img[^>]*src="'+o+'"[^>]*>').test(e.model.get("content"))&&!new RegExp('<img[^>]*src="[^"]*'+n.get("id")+'"[^>]*>').test(e.model.get("content")))return a.space.attachments.remove(i,n.get("id"))}).compact().value();return $.when.apply($,i)},c.checkForAutoEnabledDriveMail=function(e){return e=_.extend({yell:!1,restoreWindow:!1,stopPropagation:!1,removeQueue:!1},e),function(t){if(i.get("compose/shareAttachments/threshold",0)>0){var c=t.model,h=c.get("sharedAttachments")||{};if(c.get("attachments").getSize()>i.get("compose/shareAttachments/threshold",0)&&!1===h.enabled)throw e.yell&&o("info",n("Attachment file size too large. You have to use %1$s or reduce the attachment file size.",i.get("compose/shareAttachments/name"))),c.set("sharedAttachments",_.extend({},h,{enabled:!0})),e.stopPropagation&&t.stopPropagation(),e.restoreWindow&&t.app.getWindow().idle().show(),e.removeQueue&&a.queue.remove(t.model.get("id")),arguments}}},c.attachmentMissingCheck=function(e){if(!(e.model.get("attachments").length>=1)){var t=n("see attached|see attachment|see included|is attached|attached is|are attached|attached are|attached to this email|attached to this message|I'm attaching|I am attaching|I've attached|I have attached|I attach|I attached|find attached|find the attached|find included|find the included|attached file|see the attached|see attachments|attached files|see the attachment"),a=_((t+"|see attached|see attachment|see included|is attached|attached is|are attached|attached are|attached to this email|attached to this message|I'm attaching|I am attaching|I've attached|I have attached|I attach|I attached|find attached|find the attached|find included|find the included|attached file|see the attached|see attachments|attached files|see the attachment|siehe Anhang|angehängt|anbei|hinzugefügt|ist angehängt|angehängt ist|sind angehängt|angehängt sind|an diese E-Mail angehängt|an diese Nachricht angehängt|Anhang hinzufügen|Anhang anbei|Anhang hinzugefügt|anbei finden|anbei|im Anhang|mit dieser E-Mail sende ich|angehängte Datei|siehe angehängte Datei|siehe Anhänge|angehängte Dateien|siehe Anlage|siehe Anlagen").split("|")).chain().compact().uniq().value().join("|"),i=(e.model.get("subject")||"")+"|";"html"===e.view.editor.getMode()?i+=$(e.view.editor.getContent()).not("blockquote,.io-ox-signature").text():i+=e.view.editor.getContent().replace(/^>.*\n/gm,"");var o=new RegExp("("+a+")","i").exec(i);if(o){var c=$.Deferred();return require(["io.ox/backbone/views/modal"],function(t){new t({title:n("Forgot attachment?"),focus:".btn-primary"}).on("add",function(){this.previousFocus=$('[data-extension-id="add_attachments"] > div > a[role="button"]'),e.stopPropagation(),c.reject()}).on("send",function(){c.resolve()}).addButton({action:"send",label:n("Send without attachment")}).addAlternativeButton({action:"add",label:n("Cancel")}).build(function(){this.$body.append($("<div>").append($("<p>").text(n("It appears as if you forgot to attach a file.")),$("<p>").text(n.format(n('You mentioned "%s" in your email, but there are no files attached.'),o[1]))))}).open()}),c}}},c});