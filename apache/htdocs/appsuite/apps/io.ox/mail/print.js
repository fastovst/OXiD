define("io.ox/mail/print",["io.ox/core/print","io.ox/mail/api","io.ox/mail/util","io.ox/mail/detail/content","settings!io.ox/mail","gettext!io.ox/mail","io.ox/core/attachments/view"],function(t,e,n,i,o,r,c){"use strict";function a(){return o.get("allowHtmlMessages",!0)?"html":"text"}function s(t){if(!_.isArray(t.attachments))return"";if("text"===a()){var e=String(t.attachments[0].content||"");return e=n.replaceImagePrefix(e),$.trim(e.replace(/\n/g,"").replace(/<br[ ]?\/?>/g,"\n"))}return i.get(t,{autoCollapseBlockquotes:!1}).content.innerHTML}function l(t,e){return _(t[e||"from"]).map(function(t){return _.escape(n.getDisplayName(t,{showMailAddress:!0})).replace(/\s/g," ")}).join(" • ")}function u(t){return(t.headers||{})["X-Open-Xchange-Share-Type"]?[]:new c.Collection(n.getAttachments(t)||[]).filter(function(t){return t.isFileAttachment()}).map(function(t,e){return{title:t.get("filename","Attachment #"+e),size:t.get("size")?_.filesize(t.get("size")||0):0}})}function d(t){return t[0]&&t[0].security&&t[0].security.decrypted}function m(t){return{from:l(t,"from"),to:l(t,"to"),cc:l(t,"cc"),bcc:l(t,"bcc"),subject:t.subject,date:n.getFullDate(t.received_date||t.sent_date),sort_date:-(t.received_date||t.sent_date),content:s(t),attachments:u(t)}}return{open:function(i,c){t.smart({get:function(t){return n.isEmbedded(i[0])?e.getNestedMail(i[0]):e.get(_.extend({view:a(),unseen:!0,decrypt:d(i)},t))},title:1===i.length?i[0].subject:void 0,meta:{fixedWidthFont:o.get("useFixedWidthFont",!1)?"fixed-width-font":"",format:a(),classes:"mail-detail-content"},i18n:{to:r("To"),copy:r.pgettext("CC","Copy"),blindcopy:r.pgettext("BCC","Blind copy")},process:m,selection:i,selector:".mail",sortBy:"sort_date",window:c})}}});