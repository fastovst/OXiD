define.async("io.ox/mail/mailfilter/settings/filter/actions/register",["io.ox/core/extensions","gettext!io.ox/mailfilter","io.ox/backbone/mini-views","io.ox/mail/mailfilter/settings/filter/actions/util","io.ox/core/folder/picker","io.ox/core/api/mailfilter","settings!io.ox/mail"],function(e,i,t,a,n,o,s){"use strict";function d(t){var o=function(){var e={};return _.each(t.actioncmds,function(i){e[i.id]=i}),e}();o.addflags&&e.point("io.ox/mail/mailfilter/actions").extend({id:"addflags",index:400,initialize:function(e){var t={markmail:{flags:["\\seen"],id:"addflags"},tag:{flags:["$"],id:"addflags"},flag:{flags:["$cl_1"],id:"addflags"}},a={markmail:i("Mark mail as"),tag:i("Add IMAP keyword")};s.get("features/flag/color")&&(a.flag=i("Set color flag")),_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,a),_.extend(e.actionCapabilities,{markmail:"addflags",tag:"addflags",flag:"addflags"}),e.actionsOrder.push("markmail","tag"),s.get("features/flag/color")&&e.actionsOrder.push("flag")},draw:function(e,t,n,o,s){var d,l={"\\deleted":i("deleted"),"\\seen":i("seen"),"\\flagged":i("flagged")},r={NONE:{value:0,text:i("None")},RED:{value:1,text:i("Red")},ORANGE:{value:7,text:i("Orange")},YELLOW:{value:10,text:i("Yellow")},LIGHTGREEN:{value:6,text:i("Light green")},GREEN:{value:3,text:i("Green")},LIGHTBLUE:{value:9,text:i("Light blue")},BLUE:{value:2,text:i("Blue")},PURPLE:{value:5,text:i("Purple")},PINK:{value:8,text:i("Pink")},GRAY:{value:4,text:i("Gray")}},c={$cl_1:"1",$cl_2:"2",$cl_3:"3",$cl_4:"4",$cl_5:"5",$cl_6:"6",$cl_7:"7",$cl_8:"8",$cl_9:"9",$cl_10:"10"};/delete|seen/.test(s.flags[0])?(d=_.uniqueId("markas_"),this.append(a.drawAction({actionKey:t,inputId:d,title:e.view.actionsTranslations.markmail,dropdownOptions:{name:"flags",model:n,values:l,id:d}}))):/^\$cl/.test(s.flags[0])?(d=_.uniqueId("colorflag_"),this.append($("<li>").addClass("filter-settings-view row").attr({"data-action-id":t}).append($("<div>").addClass("col-sm-4 singleline").append($("<span>").addClass("list-title").text(e.view.actionsTranslations.flag)),$("<div>").addClass("col-sm-8").append($("<div>").addClass("row").append($("<div>").addClass("col-sm-3 col-sm-offset-9 rightalign").append(a.drawColorDropdown(s.flags[0],r,c)))),a.drawDeleteButton("action")))):(d=_.uniqueId("customflag_"),this.append(a.drawAction({actionKey:t,inputId:d,title:e.view.actionsTranslations.tag,inputLabel:e.view.actionsTranslations.tag,inputOptions:{name:"flags",model:n,className:"form-control",id:d},errorView:!0})))}}),o.removeflags&&e.point("io.ox/mail/mailfilter/actions").extend({id:"removeflags",index:1e3,initialize:function(e){var t={removeflags:{flags:["$"],id:"removeflags"}};_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,{removeflags:i("Remove IMAP keyword")}),_.extend(e.actionCapabilities,{removeflags:"removeflags"}),-1!==_.indexOf(e.actionsOrder,"tag")&&e.actionsOrder.push(_.first(e.actionsOrder.splice(_.indexOf(e.actionsOrder,"tag"),1))),e.actionsOrder.push("removeflags")},draw:function(e,i,t){var n=_.uniqueId("removeflags_");this.append(a.drawAction({actionKey:i,inputId:n,title:e.view.actionsTranslations.removeflags,inputLabel:e.view.actionsTranslations.removeflags,inputOptions:{name:"flags",model:t,className:"form-control",id:n},errorView:!0}))}}),o.discard&&e.point("io.ox/mail/mailfilter/actions").extend({id:"discard",index:600,initialize:function(e){var t={discard:{id:"discard"}};_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,{discard:i("Discard")}),_.extend(e.actionCapabilities,{discard:"discard"}),e.actionsOrder.push("discard")},draw:function(e,i,t,n,o){var s=_.uniqueId("discard_");this.append(a.drawAction({actionKey:i,inputId:s,addClass:"warning",title:e.view.actionsTranslations[o.id]}))}}),o.keep&&e.point("io.ox/mail/mailfilter/actions").extend({id:"keep",index:800,initialize:function(e){var t={keep:{id:"keep"}};_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,{keep:i("Keep")}),_.extend(e.actionCapabilities,{keep:"keep"}),e.actionsOrder.push("keep")},draw:function(e,i,t,n,o){var s=_.uniqueId("keep_");this.append(a.drawAction({actionKey:i,inputId:s,title:e.view.actionsTranslations[o.id]}))}}),o.move&&e.point("io.ox/mail/mailfilter/actions").extend({id:"move",index:100,initialize:function(e){var t={move:{id:"move",into:"default0/INBOX"}};_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,{move:i("File into")}),_.extend(e.actionCapabilities,{move:"move"}),e.actionsOrder.push("move")},draw:function(e,i,t,o,d){var l=_.uniqueId("move_");this.append(a.drawAction({actionKey:i,inputId:l,title:e.view.actionsTranslations[d.id],activeLink:!0,inputLabel:e.view.actionsTranslations[d.id],inputOptions:{name:"into",model:t,className:"form-control",id:l}})),this.find('[data-action-id="'+i+'"] .folderselect').on("click",function(i){i.preventDefault();var t=$(i.currentTarget).data("model");e.view.dialog.pause(),n({async:!0,context:"filter",done:function(e,i){t.set("into",e),i.close()},folder:t.get("into"),module:"mail",root:"1",settings:s,persistent:"folderpopup"})})}}),o.copy&&e.point("io.ox/mail/mailfilter/actions").extend({id:"copy",index:200,initialize:function(e){var t={copy:{id:"copy",into:"default0/INBOX",copy:!0}};_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,{copy:i("Copy into")}),_.extend(e.actionCapabilities,{copy:"copy"}),e.actionsOrder.push("copy")},draw:function(e,i,t,o,d){var l=_.uniqueId("copy_");this.append(a.drawAction({actionKey:i,inputId:l,title:e.view.actionsTranslations[d.id],activeLink:!0,inputLabel:e.view.actionsTranslations[d.id],inputOptions:{name:"into",model:t,className:"form-control",id:l}})),this.find('[data-action-id="'+i+'"] .folderselect').on("click",function(i){i.preventDefault();var t=$(i.currentTarget).data("model");e.view.dialog.pause(),n({async:!0,context:"filter",done:function(e,i){t.set("into",e),i.close()},folder:t.get("into"),module:"mail",root:"1",settings:s,persistent:"folderpopup"})})}}),o.redirect&&e.point("io.ox/mail/mailfilter/actions").extend({id:"redirect",index:300,initialize:function(e){var t={redirect:{id:"redirect",to:""}};_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,{redirect:i("Redirect to")}),_.extend(e.actionCapabilities,{redirect:"redirect"}),e.actionsOrder.push("redirect")},draw:function(e,i,t,n,o){var s=_.uniqueId("redirect_");this.append(a.drawAction({actionKey:i,inputId:s,title:e.view.actionsTranslations[o.id],inputLabel:e.view.actionsTranslations.redirect,inputOptions:{name:"to",model:t,className:"form-control",id:s},errorView:!0}))}}),o.reject&&e.point("io.ox/mail/mailfilter/actions").extend({id:"reject",index:700,initialize:function(e){var t={reject:{id:"reject",text:""}};_.extend(e.defaults.actions,t),_.extend(e.actionsTranslations,{reject:i("Reject with reason")}),_.extend(e.actionCapabilities,{reject:"reject"}),e.actionsOrder.push("reject")},draw:function(e,i,t,n,o){var s=_.uniqueId("reject_");this.append(a.drawAction({actionKey:i,inputId:s,title:e.view.actionsTranslations[o.id],inputLabel:e.view.actionsTranslations.reject,inputOptions:{name:"text",model:t,className:"form-control",id:s},errorView:!0}))}})}var l=$.Deferred();return o.getConfig().then(d).then(function(){return l.resolve({processConfig:d}),l})});