define("io.ox/mail/mailfilter/settings/util",["io.ox/core/folder/api","io.ox/mail/mailfilter/settings/filter/defaults","gettext!io.ox/mail"],function(e,s,t){"use strict";var r={getDefaultRulename:function(e){var s=new $.Deferred;return $.when(r.resolveDefaultRulename(e)).then(function(e){s.resolve(e)},function(){s.resolve(t("New rule"))}),s.promise()},resolveDefaultRulename:function(s){var i=this.getFirstTest(s),a=_(s.actioncmds).first();if(!i||!0===i.id||!a)return t("New rule");var l=r.getTestName(i),f=a.id;switch("addflags"===f&&/^(\\seen|\\deleted)$/.test(_(a.flags).first())&&(f="markmail"),"addflags"===f&&/^\$cl_\d+$/.test(_(a.flags).first())&&(f="flag"),l){case"from":case"address":if("keep"===f)return t("Keep mails from %1$s",_(i.values).first());if("discard"===f)return t("Discard mails from %1$s",_(i.values).first());if("move"===f)return e.get(a.into).then(function(e){var s,r=a.into.split("/");return r.shift(),s=e.standard_folder?e.title:r.join("/"),t("Move mails from %1$s into folder %2$s",_(i.values).first(),s)});if("redirect"===f)return t("Redirect mails from %1$s to %2$s",_(i.values).first(),a.to);if("reject"===f)return t("Reject mails from %1$s with reason %2$s",_(i.values).first(),a.text);if("markmail"===f)return"\\seen"===_(a.flags).first()?t("Mark mails from %1$s as seen",_(i.values).first()):t("Mark mails from %1$s as deleted",_(i.values).first());if("flag"===f)return t("Flag mails from %1$s with a color",_(i.values).first());if("addflags"===f)return t("Tag mails from %1$s with %2$s",_(i.values).first(),_(a.flags).first().substr(1));break;case"any":case"to":case"cc":if("keep"===f)return t("Keep mails to %1$s",_(i.values).first());if("discard"===f)return t("Discard mails to %1$s",_(i.values).first());if("move"===f)return e.get(a.into).then(function(e){var s,r=a.into.split("/");return r.shift(),s=e.standard_folder?e.title:r.join("/"),t("Move mails to %1$s into folder %2$s",_(i.values).first(),s)});if("redirect"===f)return t("Redirect mails to %1$s to %2$s",_(i.values).first(),a.to);if("reject"===f)return t("Reject mails to %1$s with reason %2$s",_(i.values).first(),a.text);if("markmail"===f)return"\\seen"===_(a.flags).first()?t("Mark mails to %1$s as seen",_(i.values).first()):t("Mark mails to %1$s as deleted",_(i.values).first());if("flag"===f)return t("Flag mails to %1$s with a color",_(i.values).first());if("addflags"===f)return t("Tag mails to %1$s with %2$s",_(i.values).first(),_(a.flags).first().substr(1));break;case"subject":if("keep"===f)return t("Keep mails with subject %1$s",_(i.values).first());if("discard"===f)return t("Discard mails with subject %1$s",_(i.values).first());if("move"===f)return e.get(a.into).then(function(e){var s,r=a.into.split("/");return r.shift(),s=e.standard_folder?e.title:r.join("/"),t("Move mails with subject %1$s into folder %2$s",_(i.values).first(),s)});if("redirect"===f)return t("Redirect mails with subject %1$s to %2$s",_(i.values).first(),a.to);if("reject"===f)return t("Reject mails with subject %1$s with reason %2$s",_(i.values).first(),a.text);if("markmail"===f)return"\\seen"===_(a.flags).first()?t("Mark mails with subject %1$s as seen",_(i.values).first()):t("Mark mails with subject %1$s as deleted",_(i.values).first());if("flag"===f)return t("Flag mails with subject %1$s with a color",_(i.values).first());if("addflags"===f)return t("Tag mails with subject %1$s with %2$s",_(i.values).first(),_(a.flags).first().substr(1))}return t("New rule")},getFirstTest:function(e){var s=(e=e||this.attributes).test;return s.tests?_(s.tests).first():s},getTestName:function(e){return _(s.tests).findKey(function(s){return!!_.isEqual(s.headers,e.headers)&&s.id===e.id})}};return r});