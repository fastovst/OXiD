define("io.ox/multifactor/views/u2fProvider",["io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","io.ox/multifactor/api","gettext!io.ox/core/boot","io.ox/multifactor/views/constants","io.ox/backbone/mini-views/helplink","io.ox/core/notifications"],function(e,i,o,t,r,n,a,c,s){"use strict";function d(e,i){return new t({async:!0,point:p,title:i.reAuth?a.ReAuthenticationTitle:a.AuthenticationTitle,enter:"OK",className:a.AuthDialogClass,model:new Backbone.Model({provider:i.providerName,deviceId:i.device.id,challenge:e,error:i.error,device:i.device})}).build(function(){}).addCancelButton().addAlternativeButton({label:a.LostButton,action:"lost",className:i.device.backup?"hidden":"btn-default"}).on("cancel",function(){f.reject()}).on("open",function(){l(i.providerName,i.device,e)}).on("lost",function(){u.close(),u=null,require(["io.ox/multifactor/lost"],function(e){e(i)})}).open()}function l(e,i,o){var t=o.signRequests[0].appId,r=o.signRequests[0].challenge;window.u2f.sign(t,r,o.signRequests,function(t){if(t.errorCode){var r,a;switch(t.errorCode){case 2:r=n("Bad parameters for authenticating with this key. Possibly wrong URL domain for this key."),a=!1;break;case 3:r=n("Configuration not supported"),a=!1;break;case 4:r=n("This device is not eligible for this request. Wrong hardware key?"),a=!0;break;case 5:r=n("Timeout"),a=!0;break;default:r=n("Error authenticating. Please reload browser and try again."),a=!1}u&&(s.yell("error",r),a?l(e,i,o):window.setTimeout(function(){u.close(),f.reject()},5e3))}else{s.yell.close();var c={parameters:t,id:i.id,provider:e};u.close(),f.resolve(c)}})}var u,f,p="multifactor/views/u2fProvider",h=0;return i.point(p).extend({index:h+=100,id:"help",render:function(){var e=new c({base:"help",iconClass:"mfHelp fa-question-circle fa",href:"ox.appsuite.user.sect.security.multifactor.securitykey.html",tabindex:"-1",simple:!ox.ui.createApp,metrics:void 0!==ox.ui.createApp}).render().$el;this.$header.append(e)}},{index:h+=100,id:"header",render:function(){var e;e=window.u2f?$("<label>").append(n("You secured your account with 2-Step Verification. Please use your authentication token to complete verification.")):$("<p>").append(n("This browser is not compatible with your configured authentication device. Please use Chrome browser, or Firefox with U2F enabled.")),this.$body.append(e)}},{index:h+=100,id:"error",render:function(e){var i=e.model.get("error");if(i&&i.text){var o=$('<label class="multifactorError">').append(i.text);this.$body.append(o)}}}),{open:function(e,i){return u=d(e,i),f=i.def,u}}});