define("io.ox/multifactor/views/selectDeviceView",["io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","io.ox/multifactor/factorRenderer","io.ox/multifactor/deviceAuthenticator","gettext!io.ox/core/boot","io.ox/multifactor/views/constants"],function(e,t,o,i,n,r,a,c){"use strict";function d(e,t){return new i({async:!0,point:v,title:t.reAuth?c.ReAuthenticationTitle:c.SelectDeviceTitle,width:500,className:c.AuthDialogClass,model:new Backbone.Model({devices:e,authInfo:t})}).build(function(){}).addButton().addAlternativeButton({label:c.LostButton,action:"lost",className:"btn-default"}).on("cancel",function(){s.reject()}).on("lost",function(){u.close(),u=null,require(["io.ox/multifactor/lost"],function(e){e(t)})}).open()}function l(e){var t=[];return e.forEach(function(e){p.includes(e.providerName)?m[e.providerName]?t.forEach(function(t){t.providerName===e.providerName&&(t.name="")}):(t.push(e),m[e.providerName]=!0):t.push(e)}),m={},t}var u,s,v="multifactor/views/selectDeviceView",f=0;t.point(v).extend({index:f+=100,id:"header",render:function(){var e=$("<label>").append(a("Please select a device to use for additional authentication")).append("<br>");this.$body.append(e)}},{index:f+=100,id:"selection",render:function(e){var t=$('<div class="multifactorSelector">').append(n.renderList(e.model.get("devices")));t.find(".multifactordevice").on("click",function(t){t.preventDefault();var o={id:$(this).attr("data-deviceid")},i=e.model.get("authInfo");i.providerName=$(this).attr("data-provider"),i.device=o,r.getAuth(i),u.close()}),this.$body.append(t)}},{index:f+=100,id:"error",render:function(e){var t=e.model.get("authInfo").error;if(t&&t.text){var o=$('<div class="multifactorError">').append(t.text);this.$body.append(o)}}});var p=["U2F","WEB-AUTH"],m={};return{open:function(e,t){return e=l(e),s=t.def,1===e.length?(_.extend(t,{device:e[0],providerName:e[0].providerName}),r.getAuth(t)):u=d(e,t)}}});