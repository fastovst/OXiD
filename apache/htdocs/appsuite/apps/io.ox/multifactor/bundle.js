define("io.ox/multifactor/bundle",[],function(){"use strict";var e={};define("io.ox/multifactor/api",["io.ox/core/http","static/3rd.party/purify.min.js"],function(e,t){function o(e){return e&&e.error?(require(["io.ox/core/notifications"],function(t){t.yell("error",e.error)}),console.error(e.error),e.error):e}function r(e){return!(!e||"AUTHENTICATION_DENIED"!==e.value)}return{getProviders:function(t){return $.when(e.GET({module:"multifactor/provider",params:{action:"all"},force:!0}).then(function(e){if(e){var r=[];return e.forEach(function(e){t&&e.backupProvider&&r.push(e),t||e.backupOnlyProvider||r.push(e)}),{providers:r}}o(e)}))},getDevices:function(r){var i=[];return $.when(e.GET({module:"multifactor/device",params:{action:"all"},force:!0}).then(function(e){if(_.isArray(e))return e.forEach(function(e){switch(e.name=t.sanitize(e.name)+"",r){case"BACKUP":e.backup&&i.push(e);break;case"APP":e.trustedApplicationDevice&&i.push(e);break;default:e.trustedApplicationDevice||e.backup||i.push(e)}}),i;o(e)},function(e){return o(e),$.Deferred().reject(e)}))},deleteDevice:function(t,r){var i=$.Deferred();return e.PUT({module:"multifactor/device",params:{action:"delete",providerName:t,deviceId:r}}).then(function(e){e&&e.error&&i.reject(o(e)),i.resolve(e)},i.reject),i},editDevice:function(t,r,i){var n=$.Deferred();return e.PUT({module:"multifactor/device",params:{action:"rename",providerName:t,deviceId:r},data:{name:i,providerName:t,id:r}}).then(function(e){e&&e.error&&n.reject(o(e)),n.resolve(e)},n.reject),n},beginAuth:function(t,o){return $.when(e.PUT({module:"multifactor/device",params:{action:"startAuthentication",deviceId:o,providerName:t},force:!0}))},beginRegistration:function(t,r,i,n){return $.when(e.PUT({module:"multifactor/device",params:{action:"startRegistration"},data:{providerName:t,name:r,backup:i,parameters:n}})).then(o,o)},finishRegistration:function(t,o,r,i){return $.when(e.PUT({module:"multifactor/device",params:_.extend({action:"finishRegistration",providerName:t,deviceId:o},i),data:r}))},doAuth:function(t,i,n,a){var s=$.Deferred(),c=_.extend({secret_code:n},a);return e.PUT({module:"multifactor/device",params:{action:"finishAuthentication",deviceId:i,providerName:t},data:c,force:!0}).then(function(e){e&&e.error&&s.reject(o(e)),r(e)?s.reject(e):s.resolve(e)},s.reject),s}}}),define("io.ox/multifactor/deviceAuthenticator",["io.ox/multifactor/api","io.ox/core/extensions","io.ox/multifactor/views/constants"],function(e,t,o){function r(e,r){var i=e.challenge;switch(r.providerName){case o.TOTP:require(["io.ox/multifactor/views/totpProvider"],function(e){e.open(i,r)});break;case o.SMS:require(["io.ox/multifactor/views/smsProvider"],function(e){e.open(i,r)});break;case o.U2F:require(["io.ox/multifactor/views/u2fProvider"],function(e){e.open(i,r)});break;case"WEB-AUTH":require(["io.ox/multifactor/views/webAuthProvider"],function(e){e.open(i,r)});break;case o.BACKUP:require(["io.ox/multifactor/views/backupProvider"],function(e){e.open(i,r)});break;default:var n=new t.Baton({data:{challengeData:i,authInfo:r}});t.point("io.ox/multifactor/device/"+r.providerName).invoke("auth",this,n).any()||r.def.reject()}}function i(e){return e.providerName!==o.SMS||(e.error?!(e.device.id===n.id&&++a<3)&&(n=e.device,a=0,!0):(n=e.device,a=0,!0))}var n,a,s;return{getAuth:function(t){i(t)?e.beginAuth(t.providerName,t.device.id).then(function(e){s=e,r(e,t)},t.def.reject):(t.error.repeat=!0,r(s,t))}}}),define("io.ox/multifactor/factorRenderer",["gettext!io.ox/core/boot","io.ox/core/extensions","io.ox/multifactor/views/constants","less!io.ox/multifactor/style","less!io.ox/backbone/mini-views/settings-list-view"],function(e,t,o){function r(t,o,r,i){var n=$('<li class="settings-list-item multifactordevice">').attr("data-deviceId",r.id).attr("data-deviceName",r.name).attr("data-provider",r.providerName).attr("title",o),a=$('<i class="fa '+t+' mfIcon">').attr("aria-label",o),s=$("<span>").addClass(i?"mfText":"mfTextWide").append(o),c=$('<span class="mfName">').text(r.name);i||n.addClass("multifactordeviceSelectable");var d=i?$('<a href="#" class="action mfEdit">').attr("title",e("Edit")).append(e("Edit")):"",u=i?$('<a href="#" class="action mfDelete">').attr("aria-label",e("Delete")).append($('<i class="fa fa-trash-o" aria-hidden="true">').attr("title",e("Delete"))):"";return n.append(a).append(s).append(c).append(d).append(u)}function i(i,n){switch(i.providerName){case o.SMS:return r(o.SMS_ICON,e("SMS Code"),i,n);case"WEB-AUTH":return r("fa-microchip",e("Web auth"),i,n);case o.U2F:if(!window.u2f&&!n)return void console.log("U2F not compatible with this browser");if(!n&&a.u2f)return;return a.u2f=!0,r(o.U2F_ICON,e("Security Token"),i,n);case"YUBIKEY":return r("fa-id-badge",e("Yubikey"),i,n);case o.TOTP:return r(o.TOTP_ICON,e("Google Authenticator"),i,n);case o.BACKUP:return r(o.BACKUP_ICON,e("Recovery code"),i,n);default:var s=new t.Baton;return t.point("io.ox/multifactor/device/"+i.providerName).invoke("render",this,s),s.data.text?r(s.data.icon,s.data.text,i,n):$("<span>").append("UNKOWN")}}function n(e,t){a={};var o=$('<div class="MultifactorDiv">'),r=$('<ul class="list-group list-unstyled settings-list-view">');return e.forEach(function(e){r.append(i(e,t))}),o.append(r)}var a={};return{renderDeletable:function(e){return n(e,!0)},renderList:function(e){return n(e,!1)}}}),define("io.ox/multifactor/views/constants",["gettext!io.ox/core/boot"],function(e){return{LostButton:e("I lost my device"),OKButton:e("Next"),CancelButton:e("Cancel"),AuthenticationTitle:e("2-Step Verification"),ReAuthenticationTitle:e("Reauthentication required for this action"),SelectDeviceTitle:e("Select 2-Step Verification Method"),AuthDialogClass:_.device("small")?"multifactorAuthMobile":"multifactorAuth",U2F:"U2F",U2F_ICON:"fa-microchip",SMS:"SMS",SMS_ICON:"fa-mobile",TOTP:"TOTP",TOTP_ICON:"fa-google",BACKUP:"BACKUP_STRING",BACKUP_ICON:"fa-file-text-o"}}),define("io.ox/multifactor/views/selectDeviceView",["io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","io.ox/multifactor/factorRenderer","io.ox/multifactor/deviceAuthenticator","gettext!io.ox/core/boot","io.ox/multifactor/views/constants"],function(e,t,o,r,i,n,a,s){function c(e,t){return new r({async:!0,point:p,title:t.reAuth?s.ReAuthenticationTitle:s.SelectDeviceTitle,width:500,className:s.AuthDialogClass,model:new Backbone.Model({devices:e,authInfo:t})}).build(function(){}).addButton().addAlternativeButton({label:s.LostButton,action:"lost",className:"btn-default"}).on("cancel",function(){l.reject()}).on("lost",function(){u.close(),u=null,require(["io.ox/multifactor/lost"],function(e){e(t)})}).open()}function d(e){var t=[];return e.forEach(function(e){v.includes(e.providerName)?m[e.providerName]?t.forEach(function(t){t.providerName===e.providerName&&(t.name="")}):(t.push(e),m[e.providerName]=!0):t.push(e)}),m={},t}var u,l,p="multifactor/views/selectDeviceView",f=0;t.point(p).extend({index:f+=100,id:"header",render:function(){var e=$("<label>").append(a("Please select a device to use for additional authentication")).append("<br>");this.$body.append(e)}},{index:f+=100,id:"selection",render:function(e){var t=$('<div class="multifactorSelector">').append(i.renderList(e.model.get("devices")));t.find(".multifactordevice").on("click",function(t){t.preventDefault();var o={id:$(this).attr("data-deviceid")},r=e.model.get("authInfo");r.providerName=$(this).attr("data-provider"),r.device=o,n.getAuth(r),u.close()}),this.$body.append(t)}},{index:f+=100,id:"error",render:function(e){var t=e.model.get("authInfo").error;if(t&&t.text){var o=$('<div class="multifactorError">').append(t.text);this.$body.append(o)}}});var v=["U2F","WEB-AUTH"],m={};return{open:function(e,t){return e=d(e),l=t.def,1===e.length?(_.extend(t,{device:e[0],providerName:e[0].providerName}),n.getAuth(t)):u=c(e,t)}}}),define("io.ox/multifactor/views/smsProvider",["io.ox/multifactor/api","io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","gettext!io.ox/core/boot","io.ox/multifactor/views/constants","io.ox/backbone/mini-views/helplink","less!io.ox/multifactor/style"],function(e,t,o,r,i,n,a,s){function c(e,t){return new i({async:!0,point:p,title:t.reAuth?a.ReAuthenticationTitle:a.AuthenticationTitle,enter:"OK",className:a.AuthDialogClass,model:new Backbone.Model({provider:t.providerName,deviceId:t.device.id,challenge:e,error:t.error})}).build(function(){}).addCancelButton().addButton({label:a.OKButton,action:"OK"}).addAlternativeButton({label:a.LostButton,action:"lost",className:t.device.backup?"hidden":"btn-default"}).on("OK",function(){var e=$("#verification").val().replace(/\s/g,"");if(e&&""!==e){var o={response:e,id:t.device.id,provider:t.providerName};l.resolve(o)}else l.reject();u&&u.close()}).on("cancel",function(){l.reject()}).on("open",function(){_.defer(function(){$("#verification").focus()})}).on("lost",function(){u.close(),require(["io.ox/multifactor/lost"],function(e){e(t)})}).open()}function d(e){$(e.target).toggleClass("mfInputError",e.target.value.match(/[0-9\s]*/)[0]!==e.target.value)}var u,l,p="multifactor/views/smsProvider",f=0;return o.point(p).extend({index:f+=100,id:"help",render:function(){var e=new s({base:"help",iconClass:"mfHelp fa-question-circle fa",href:"ox.appsuite.user.sect.security.multifactor.sms.html",tabindex:"-1",simple:!ox.ui.createApp,metrics:void 0!==ox.ui.createApp}).render().$el;this.$header.append(e)}},{index:f+=100,id:"header",render:function(e){var t=e.model.get("error")&&!e.model.get("error").repeat,o="";t&&(o=$('<dev class="newSMS">').append(n("New code sent.")+" "));var r=$('<label for="verification">').append(t?n("A new code was sent to your SMS device. Please enter the code."):n("You secured your account with 2-Step Verification. Please enter the verification code we sent to the phone *****%s.",e.model.get("challenge").phoneNumberTail)).append("<br>");this.$body.append(o,r)}},{index:f+=100,id:"selection",render:function(){var e=$('<input type="text" class="form-control mfInput" id="verification">').keyup(d),t=$('<div class="multifactorAuthDiv">').append(e);this.$body.append(t)}},{index:f+=100,id:"error",render:function(e){var t=e.model.get("error");if(t&&t.text){var o=$('<div class="multifactorError">').append(t.text);this.$body.append(o)}}}),{open:function(e,t){return u=c(e,t),l=t.def,u}}}),define("io.ox/multifactor/views/totpProvider",["io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","gettext!io.ox/core/boot","io.ox/multifactor/views/constants","io.ox/backbone/mini-views/helplink"],function(e,t,o,r,i,n,a){function s(e,t){return new r({async:!0,point:l,title:t.reAuth?n.ReAuthenticationTitle:n.AuthenticationTitle,enter:"OK",className:n.AuthDialogClass,model:new Backbone.Model({provider:t.providerName,deviceId:t.device.id,challenge:e,error:t.error})}).build(function(){}).addCancelButton().addButton({label:n.OKButton,action:"OK"}).addAlternativeButton({label:n.LostButton,action:"lost",className:t.device.backup?"hidden":"btn-default"}).on("OK",function(){var e=$("#authentication").val().replace(/\s/g,"");if(e&&""!==e){var o={response:e,id:t.device.id,provider:t.providerName};u.resolve(o)}else u.reject();d.close()}).on("cancel",function(){u.reject()}).on("open",function(){_.defer(function(){$("#authentication").focus()})}).on("lost",function(){d.close(),require(["io.ox/multifactor/lost"],function(e){e(t)})}).open()}function c(e){$(e.target).toggleClass("mfInputError",e.target.value.match(/[0-9\s]*/)[0]!==e.target.value)}var d,u,l="multifactor/views/totpProvider",p=0;return t.point(l).extend({index:p+=100,id:"help",render:function(){var e=new a({base:"help",iconClass:"mfHelp fa-question-circle fa",href:"ox.appsuite.user.sect.security.multifactor.authenticator.html ",tabindex:"-1",simple:!ox.ui.createApp,metrics:void 0!==ox.ui.createApp}).render().$el;this.$header.append(e)}},{index:p+=100,id:"help",render:function(){var e=$('<p style="multifactor-help">').append(i("You secured your account with 2-Step Verification. Please enter the verification code from the Authenticator App.")).append("<br>");this.$body.append(e)}},{index:p+=100,id:"header",render:function(){var e=$('<label for="authentication">').append("Authentication Code:").append("<br>");this.$body.append(e)}},{index:p+=100,id:"selection",render:function(){var e=$('<input type="text" class="form-control mfInput" id="authentication">').keyup(c),t=$('<div class="multifactorAuthDiv">').append(e);this.$body.append(t)}},{index:p+=100,id:"error",render:function(e){var t=e.model.get("error");if(t&&t.text){var o=$('<label class="multifactorError">').append(t.text);this.$body.append(o)}}}),{open:function(e,t){return d=s(e,t),u=t.def,d}}}),define("io.ox/multifactor/views/u2fProvider",["io.ox/backbone/views","io.ox/core/extensions","io.ox/backbone/mini-views","io.ox/backbone/views/modal","io.ox/multifactor/api","gettext!io.ox/core/boot","io.ox/multifactor/views/constants","io.ox/backbone/mini-views/helplink","io.ox/core/notifications"],function(e,t,o,r,i,n,a,s,c){function d(e,t){return new r({async:!0,point:f,title:t.reAuth?a.ReAuthenticationTitle:a.AuthenticationTitle,enter:"OK",className:a.AuthDialogClass,model:new Backbone.Model({provider:t.providerName,deviceId:t.device.id,challenge:e,error:t.error,device:t.device})}).build(function(){}).addCancelButton().addAlternativeButton({label:a.LostButton,action:"lost",className:t.device.backup?"hidden":"btn-default"}).on("cancel",function(){p.reject()}).on("open",function(){u(t.providerName,t.device,e)}).on("lost",function(){l.close(),l=null,require(["io.ox/multifactor/lost"],function(e){e(t)})}).open()}function u(e,t,o){var r=o.signRequests[0].appId,i=o.signRequests[0].challenge;window.u2f.sign(r,i,o.signRequests,function(r){if(r.errorCode){var i,a;switch(r.errorCode){case 2:i=n("Bad parameters for authenticating with this key. Possibly wrong URL domain for this key."),a=!1;break;case 3:i=n("Configuration not supported"),a=!1;break;case 4:i=n("This device is not eligible for this request. Wrong hardware key?"),a=!0;break;case 5:i=n("Timeout"),a=!0;break;default:i=n("Error authenticating. Please reload browser and try again."),a=!1}l&&(c.yell("error",i),a?u(e,t,o):window.setTimeout(function(){l.close(),p.reject()},5e3))}else{c.yell.close();var s={parameters:r,id:t.id,provider:e};l.close(),p.resolve(s)}})}var l,p,f="multifactor/views/u2fProvider",v=0;return t.point(f).extend({index:v+=100,id:"help",render:function(){var e=new s({base:"help",iconClass:"mfHelp fa-question-circle fa",href:"ox.appsuite.user.sect.security.multifactor.securitykey.html",tabindex:"-1",simple:!ox.ui.createApp,metrics:void 0!==ox.ui.createApp}).render().$el;this.$header.append(e)}},{index:v+=100,id:"header",render:function(){var e;e=window.u2f?$("<label>").append(n("You secured your account with 2-Step Verification. Please use your authentication token to complete verification.")):$("<p>").append(n("This browser is not compatible with your configured authentication device. Please use Chrome browser, or Firefox with U2F enabled.")),this.$body.append(e)}},{index:v+=100,id:"error",render:function(e){var t=e.model.get("error");if(t&&t.text){var o=$('<label class="multifactorError">').append(t.text);this.$body.append(o)}}}),{open:function(e,t){return l=d(e,t),p=t.def,l}}});var t=t||{};e.exports=t;var o;return t.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd",t.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_SIGN_RESPONSE:"u2f_sign_response",U2F_GET_API_VERSION_REQUEST:"u2f_get_api_version_request",U2F_GET_API_VERSION_RESPONSE:"u2f_get_api_version_response"},t.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5},t.U2fRequest,t.U2fResponse,t.Error,t.Transport,t.Transports,t.SignRequest,t.SignResponse,t.RegisterRequest,t.RegisterResponse,t.RegisteredKey,t.GetJsApiVersionResponse,t.getMessagePort=function(e){if("undefined"!=typeof chrome&&chrome.runtime){var o={type:t.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]};chrome.runtime.sendMessage(t.EXTENSION_ID,o,function(){chrome.runtime.lastError?t.getIframePort_(e):t.getChromeRuntimePort_(e)})}else t.isAndroidChrome_()?t.getAuthenticatorPort_(e):t.isIosChrome_()?t.getIosPort_(e):t.getIframePort_(e)},t.isAndroidChrome_=function(){var e=navigator.userAgent;return-1!=e.indexOf("Chrome")&&-1!=e.indexOf("Android")},t.isIosChrome_=function(){return["iPhone","iPad","iPod"].indexOf(navigator.platform)>-1},t.getChromeRuntimePort_=function(e){var o=chrome.runtime.connect(t.EXTENSION_ID,{includeTlsChannelId:!0});setTimeout(function(){e(new t.WrappedChromeRuntimePort_(o))},0)},t.getAuthenticatorPort_=function(e){setTimeout(function(){e(new t.WrappedAuthenticatorPort_)},0)},t.getIosPort_=function(e){setTimeout(function(){e(new t.WrappedIosPort_)},0)},t.WrappedChromeRuntimePort_=function(e){this.port_=e},t.formatSignRequest_=function(e,r,i,n,a){if(void 0===o||o<1.1){for(var s=[],c=0;c<i.length;c++)s[c]={version:i[c].version,challenge:r,keyHandle:i[c].keyHandle,appId:e};return{type:t.MessageTypes.U2F_SIGN_REQUEST,signRequests:s,timeoutSeconds:n,requestId:a}}return{type:t.MessageTypes.U2F_SIGN_REQUEST,appId:e,challenge:r,registeredKeys:i,timeoutSeconds:n,requestId:a}},t.formatRegisterRequest_=function(e,r,i,n,a){if(void 0===o||o<1.1){for(c=0;c<i.length;c++)i[c].appId=e;for(var s=[],c=0;c<r.length;c++)s[c]={version:r[c].version,challenge:i[0],keyHandle:r[c].keyHandle,appId:e};return{type:t.MessageTypes.U2F_REGISTER_REQUEST,signRequests:s,registerRequests:i,timeoutSeconds:n,requestId:a}}return{type:t.MessageTypes.U2F_REGISTER_REQUEST,appId:e,registerRequests:i,registeredKeys:r,timeoutSeconds:n,requestId:a}},t.WrappedChromeRuntimePort_.prototype.postMessage=function(e){this.port_.postMessage(e)},t.WrappedChromeRuntimePort_.prototype.addEventListener=function(e,t){var o=e.toLowerCase();"message"==o||"onmessage"==o?this.port_.onMessage.addListener(function(e){t({data:e})}):console.error("WrappedChromeRuntimePort only supports onMessage")},t.WrappedAuthenticatorPort_=function(){this.requestId_=-1,this.requestObject_=null},t.WrappedAuthenticatorPort_.prototype.postMessage=function(e){var o=t.WrappedAuthenticatorPort_.INTENT_URL_BASE_+";S.request="+encodeURIComponent(JSON.stringify(e))+";end";document.location=o},t.WrappedAuthenticatorPort_.prototype.getPortType=function(){return"WrappedAuthenticatorPort_"},t.WrappedAuthenticatorPort_.prototype.addEventListener=function(e,t){if("message"==e.toLowerCase()){var o=this;window.addEventListener("message",o.onRequestUpdate_.bind(o,t),!1)}else console.error("WrappedAuthenticatorPort only supports message")},t.WrappedAuthenticatorPort_.prototype.onRequestUpdate_=function(e,t){var o=JSON.parse(t.data),r=(o.intentURL,o.errorCode,null);o.hasOwnProperty("data")&&(r=JSON.parse(o.data)),e({data:r})},t.WrappedAuthenticatorPort_.INTENT_URL_BASE_="intent:#Intent;action=com.google.android.apps.authenticator.AUTHENTICATE",t.WrappedIosPort_=function(){},t.WrappedIosPort_.prototype.postMessage=function(e){var t=JSON.stringify(e),o="u2f://auth?"+encodeURI(t);location.replace(o)},t.WrappedIosPort_.prototype.getPortType=function(){return"WrappedIosPort_"},t.WrappedIosPort_.prototype.addEventListener=function(e,t){"message"!==e.toLowerCase()&&console.error("WrappedIosPort only supports message")},t.getIframePort_=function(e){var o="chrome-extension://"+t.EXTENSION_ID,r=document.createElement("iframe");r.src=o+"/u2f-comms.html",r.setAttribute("style","display:none"),document.body.appendChild(r);var i=new MessageChannel,n=function(t){"ready"==t.data?(i.port1.removeEventListener("message",n),e(i.port1)):console.error('First event on iframe port was not "ready"')};i.port1.addEventListener("message",n),i.port1.start(),r.addEventListener("load",function(){r.contentWindow.postMessage("init",o,[i.port2])})},t.EXTENSION_TIMEOUT_SEC=30,t.port_=null,t.waitingForPort_=[],t.reqCounter_=0,t.callbackMap_={},t.getPortSingleton_=function(e){t.port_?e(t.port_):(0==t.waitingForPort_.length&&t.getMessagePort(function(e){for(t.port_=e,t.port_.addEventListener("message",t.responseHandler_);t.waitingForPort_.length;)t.waitingForPort_.shift()(t.port_)}),t.waitingForPort_.push(e))},t.responseHandler_=function(e){var o=e.data,r=o.requestId;if(r&&t.callbackMap_[r]){var i=t.callbackMap_[r];delete t.callbackMap_[r],i(o.responseData)}else console.error("Unknown or missing requestId in response.")},t.isSupported=function(e){function r(t){i||(i=!0,e(t))}var i=!1;t.getApiVersion(function(e){o=void 0===e.js_api_version?0:e.js_api_version,r(!0)}),setTimeout(r.bind(null,!1),1500)},t.sign=function(e,r,i,n,a){void 0===o?t.getApiVersion(function(s){o=void 0===s.js_api_version?0:s.js_api_version,console.log("Extension JS API Version: ",o),t.sendSignRequest(e,r,i,n,a)}):t.sendSignRequest(e,r,i,n,a)},t.sendSignRequest=function(e,o,r,i,n){t.getPortSingleton_(function(a){var s=++t.reqCounter_;t.callbackMap_[s]=i;var c=void 0!==n?n:t.EXTENSION_TIMEOUT_SEC,d=t.formatSignRequest_(e,o,r,c,s);a.postMessage(d)})},t.register=function(e,r,i,n,a){void 0===o?t.getApiVersion(function(s){o=void 0===s.js_api_version?0:s.js_api_version,console.log("Extension JS API Version: ",o),t.sendRegisterRequest(e,r,i,n,a)}):t.sendRegisterRequest(e,r,i,n,a)},t.sendRegisterRequest=function(e,o,r,i,n){t.getPortSingleton_(function(a){var s=++t.reqCounter_;t.callbackMap_[s]=i;var c=void 0!==n?n:t.EXTENSION_TIMEOUT_SEC,d=t.formatRegisterRequest_(e,r,o,c,s);a.postMessage(d)})},t.getApiVersion=function(e,o){t.getPortSingleton_(function(r){if(r.getPortType){var i;switch(r.getPortType()){case"WrappedIosPort_":case"WrappedAuthenticatorPort_":i=1.1;break;default:i=0}e({js_api_version:i})}else{var n=++t.reqCounter_;t.callbackMap_[n]=e;var a={type:t.MessageTypes.U2F_GET_API_VERSION_REQUEST,timeoutSeconds:void 0!==o?o:t.EXTENSION_TIMEOUT_SEC,requestId:n};r.postMessage(a)}})},e});