define("plugins/portal/recentfiles/register",["io.ox/core/extensions","io.ox/files/api","io.ox/core/api/user","io.ox/core/strings","gettext!plugins/portal","settings!io.ox/core","settings!io.ox/files","less!plugins/portal/recentfiles/style"],function(e,t,i,n,a,l,o){"use strict";_(["recentfiles","myfiles"]).each(function(s){var r={includeSubfolders:!0,limit:_.device("smartphone")?5:10,order:"desc",sort:5};"myfiles"===s&&(r.folder=l.get("folder/infostore"));var c=a("recentfiles"===s?"Recently changed files":"My latest files");e.point("io.ox/portal/widget/"+s).extend({type:"recentfiles",title:c,load:function(e){return t.search("",r).then(function(t){!1===o.get("showHidden")&&(t=_(t).filter(function(e){return 0!==(e?e["com.openexchange.file.sanitizedFilename"]:"").indexOf(".")})),e.data=t;var n=_(t).chain().pluck("modified_by").uniq().value();return i.getList(n).done(function(e){_(t).each(function(t){t.modified_by=_(e).find(function(e){return e.id===t.modified_by})})}).then(function(){return t})})},summary:function(e){if(!this.find(".summary").length){var t="",i=e.data.length;t=0===i?a("No files have been changed recently"):1===i?a("1 file has been changed recently"):a("%1$d files has been changed recently",i),this.addClass("with-summary show-summary").append($('<div class="summary">').text(t)).on("tap","h2",function(e){$(e.delegateTarget).toggleClass("show-summary")})}},preview:function(i){var l=$('<ul class="content recentfiles list-unstyled">').appendTo(this),o=i.data;o&&0!==o.length?(l.append(_(o).map(function(e){var t=String(e["com.openexchange.file.sanitizedFilename"]||e.filename||e.title||""),i=n.fileSize(e.file_size,1),a=moment.duration(e.last_modified-_.utc()).humanize(!0);return t.length>25&&(t=t.replace(/^[0-9_\-.]{5,}(\D)/i,"…$1").replace(/[0-9_\-.]{5,}(\.\w+)?$/,"…$1")),$('<li class="item file" tabindex="0">').data("item",e).append($('<div class="title">').text(_.noI18n(_.ellipsis(t),{max:25})),$.txt(" "),$('<div class="clearfix">').append($('<span class="pull-left ellipsis">').text("recentfiles"===s?e.modified_by.display_name:i),$('<span class="pull-right accent">').text(a)))})),l.data("items",_(o).map(_.cid)),l.on("click","li.item",function(n){n.stopPropagation();var a=$(n.delegateTarget).data("items"),l=$(n.currentTarget).data("item");require(["io.ox/core/viewer/main"],function(n){t.get(l).done(function(l){var o=t.resolve(a,!1),s=new Backbone.Collection(o),r=new n;i=new e.Baton({data:l,collection:s}),r.launch({selection:i.data,files:i.collection.models})})})})):l.append($("<li>").text(a("No files have been changed recently")))},draw:function(){}}),e.point("io.ox/portal/widget").extend({id:s}),e.point("io.ox/portal/widget/"+s+"/settings").extend({title:c,type:s,unique:!0,editable:!1})})});