define("plugins/administration/groups/settings/edit",["io.ox/core/extensions","io.ox/backbone/views/disposable","io.ox/backbone/mini-views/common","io.ox/backbone/views/modal","io.ox/core/tk/typeahead","plugins/administration/groups/settings/members","io.ox/core/api/group","io.ox/core/notifications","gettext!io.ox/core"],function(e,i,t,n,o,s,r,a,d){"use strict";var l=i.extend({className:"administration-group-editor",initialize:function(){this.membersView=new s.View({model:this.model,editable:!0}),this.original=this.model.toJSON(),e.point("plugins/administration/groups/settings/edit/autoCompleteItem").extend({id:"view",index:100,draw:function(e){this.append($("<div>").html(e.getFullNameHTML()))}})},render:function(){var e,i=this,n=new o({apiOptions:{users:!0,split:!1},placeholder:d("User name"),harmonize:function(e){e=_(e).map(function(e){return e.internal_userid=e.id,new s.Member(e)});var t=i.membersView.collection;return _(e).filter(function(e){return!t.get(e.id)})},click:function(e,t){i.membersView.collection.add(t,{parse:!0})},extPoint:"plugins/administration/groups/settings/edit"});return this.$el.append($('<div class="form-group">').append($("<label>",{for:e=_.uniqueId("input")}).text(d("Group name")),new t.InputView({name:"display_name",id:e,model:this.model}).render().$el),$('<div class="form-group">').append($('<label class="sr-only">',{for:e=_.uniqueId("input")}).text(d("Start typing to search for user names")),n.$el.attr({id:e})),$('<div class="form-group">').append($("<label>",{for:e=_.uniqueId("list")}).text(d("Members")),this.membersView.render().$el.attr("id",e))),n.render(),this},toJSON:function(){return{id:this.model.get("id"),name:this.model.get("name"),display_name:this.model.get("display_name"),members:this.membersView.toJSON()}}});return{open:function(e){e=e||{};var i=r.getModel(e.id).clone(),t=i.has("id");new n({title:d(t?"Edit group":"Create new group"),async:!0}).build(function(){this.$body.append((this.view=new l({model:i})).render().$el)}).addCancelButton().addButton({label:d(t?"Save":"Create"),action:"save"}).on("save",function(){var e=this;r[t?"update":"create"](this.view.toJSON()).then(function(){e.close()},function(i){a.yell(i),e.idle()})}).on("close",function(){this.view=null}).open(),i=null}}});