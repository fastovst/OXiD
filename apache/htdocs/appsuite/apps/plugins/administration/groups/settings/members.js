define("plugins/administration/groups/settings/members",["io.ox/backbone/views/disposable","io.ox/core/api/user","io.ox/core/api/group","io.ox/contacts/util","io.ox/core/yell","settings!io.ox/core","gettext!io.ox/core"],function(e,t,i,s,r,o,n){"use strict";var a=e.extend({tagName:"ul",className:"administration-group-members",events:{"click .remove-member":"onRemove"},onRemove:function(e){e.preventDefault();var t=$(e.target).closest(".group-member").attr("data-id"),i=this.collection.get(t);this.collection.remove(i)},initialize:function(e){this.editable=!!e.editable,this.collection=new m,this.listenTo(this.collection,"reset add remove",this.renderMemberList),this.editable&&this.$el.addClass("editable"),this.resolveMembers(),this.listenTo(i.collection,"change:members",this.resolveMembers)},resolveMembers:function(){this.$el.busy({immediate:!0}),this.collection.resolve(this.model.get("members")).always(function(){this.disposed||this.$el.idle()}.bind(this))},renderMemberList:function(){this.$el.empty().append(this.collection.map(this.renderMember,this))},renderMember:function(e){return $('<li class="group-member">').attr({"data-id":e.id}).append($('<i class="fa fa-user" aria-hidden="true">'),$('<span class="name">').html(e.getFullNameHTML()),this.editable?$('<a href="#" role="button" class="close pull-right remove-member"><span aria-hidden="true">&times;</span></a>').attr("title",n("Remove member")).attr("aria-label",n("Remove %1$s",e.getFullName())):[])},toJSON:function(){return this.collection.pluck("internal_userid").sort()}}),l=Backbone.Model.extend({idAttribute:"internal_userid",constructor:function(){Backbone.Model.apply(this,arguments),this.attributes.display_name||(this.attributes.display_name=this.attributes.email1),this.value=this.getFullName()},getSortName:function(){return(this.get("last_name")||this.get("first_name")||this.get("display_name")||"").toLowerCase()},getFullName:function(){return s.getFullName(this.attributes)},getFullNameHTML:function(){return s.getFullName(this.attributes,!0)}}),m=Backbone.Collection.extend({comparator:function(e){return e.getSortName()},model:l,resolve:function(e){if(!e.length)return $.when();var i=o.get("groups/limit",1e3);return t.getList(e.slice(0,i)).done(function(t){this.reset(t,{parse:!0}),e.length>t.length&&r("warning",n("This dialog is limited to %1$d entries and this group exceeds this limitation. Therefore, some entries are not listed.",i))}.bind(this))}});return{View:a,Member:l,MemberCollection:m}});