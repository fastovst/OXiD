!function(){"use strict";var e=function(t){var n=t,l=function(){return n};return{get:l,set:function(e){n=e},clone:function(){return e(l())}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.util.Tools"),l=tinymce.util.Tools.resolve("tinymce.html.DomParser"),i=tinymce.util.Tools.resolve("tinymce.html.Node"),o=tinymce.util.Tools.resolve("tinymce.html.Serializer"),r={shouldHideInSourceView:function(e){return e.getParam("fullpage_hide_in_source_view")},getDefaultXmlPi:function(e){return e.getParam("fullpage_default_xml_pi")},getDefaultEncoding:function(e){return e.getParam("fullpage_default_encoding")},getDefaultFontFamily:function(e){return e.getParam("fullpage_default_font_family")},getDefaultFontSize:function(e){return e.getParam("fullpage_default_font_size")},getDefaultTextColor:function(e){return e.getParam("fullpage_default_text_color")},getDefaultTitle:function(e){return e.getParam("fullpage_default_title")},getDefaultDocType:function(e){return e.getParam("fullpage_default_doctype","<!DOCTYPE html>")}},a=function(e){return l({validate:!1,root_name:"#document"}).parse(e)},c={parseHeader:a,htmlToData:function(e,t){function l(e,t){return e.attr(t)||""}var i,o,c=a(t),u={};return u.fontface=r.getDefaultFontFamily(e),u.fontsize=r.getDefaultFontSize(e),7===(i=c.firstChild).type&&(u.xml_pi=!0,(o=/encoding="([^"]+)"/.exec(i.value))&&(u.docencoding=o[1])),(i=c.getAll("#doctype")[0])&&(u.doctype="<!DOCTYPE"+i.value+">"),(i=c.getAll("title")[0])&&i.firstChild&&(u.title=i.firstChild.value),n.each(c.getAll("meta"),function(e){var t,n=e.attr("name"),l=e.attr("http-equiv");n?u[n.toLowerCase()]=e.attr("content"):"Content-Type"===l&&(t=/charset\s*=\s*(.*)\s*/gi.exec(e.attr("content")))&&(u.docencoding=t[1])}),(i=c.getAll("html")[0])&&(u.langcode=l(i,"lang")||l(i,"xml:lang")),u.stylesheets=[],n.each(c.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&u.stylesheets.push(e.attr("href"))}),(i=c.getAll("body")[0])&&(u.langdir=l(i,"dir"),u.style=l(i,"style"),u.visited_color=l(i,"vlink"),u.link_color=l(i,"link"),u.active_color=l(i,"alink")),u},dataToHtml:function(e,t,l){function r(e,t,n){e.attr(t,n||void 0)}function c(e){s.firstChild?s.insert(e,s.firstChild):s.append(e)}var u,s,d,f,g,m=e.dom;u=a(l),(s=u.getAll("head")[0])||(f=u.getAll("html")[0],s=new i("head",1),f.firstChild?f.insert(s,f.firstChild,!0):f.append(s)),f=u.firstChild,t.xml_pi?(g='version="1.0"',t.docencoding&&(g+=' encoding="'+t.docencoding+'"'),7!==f.type&&(f=new i("xml",7),u.insert(f,u.firstChild,!0)),f.value=g):f&&7===f.type&&f.remove(),f=u.getAll("#doctype")[0],t.doctype?(f||(f=new i("#doctype",10),t.xml_pi?u.insert(f,u.firstChild):c(f)),f.value=t.doctype.substring(9,t.doctype.length-1)):f&&f.remove(),f=null,n.each(u.getAll("meta"),function(e){"Content-Type"===e.attr("http-equiv")&&(f=e)}),t.docencoding?(f||((f=new i("meta",1)).attr("http-equiv","Content-Type"),f.shortEnded=!0,c(f)),f.attr("content","text/html; charset="+t.docencoding)):f&&f.remove(),f=u.getAll("title")[0],t.title?(f?f.empty():c(f=new i("title",1)),f.append(new i("#text",3)).value=t.title):f&&f.remove(),n.each("keywords,description,author,copyright,robots".split(","),function(e){var n,l,o=u.getAll("meta"),r=t[e];for(n=0;n<o.length;n++)if((l=o[n]).attr("name")===e)return void(r?l.attr("content",r):l.remove());r&&((f=new i("meta",1)).attr("name",e),f.attr("content",r),f.shortEnded=!0,c(f))});var p={};return n.each(u.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&(p[e.attr("href")]=e)}),n.each(t.stylesheets,function(e){p[e]||((f=new i("link",1)).attr({rel:"stylesheet",text:"text/css",href:e}),f.shortEnded=!0,c(f)),delete p[e]}),n.each(p,function(e){e.remove()}),(f=u.getAll("body")[0])&&(r(f,"dir",t.langdir),r(f,"style",t.style),r(f,"vlink",t.visited_color),r(f,"link",t.link_color),r(f,"alink",t.active_color),m.setAttribs(e.getBody(),{style:t.style,dir:t.dir,vLink:t.visited_color,link:t.link_color,aLink:t.active_color})),(f=u.getAll("html")[0])&&(r(f,"lang",t.langcode),r(f,"xml:lang",t.langcode)),s.firstChild||s.remove(),(d=o({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(u)).substring(0,d.indexOf("</body>"))}},u={open:function(e,t){var l=c.htmlToData(e,t.get());e.windowManager.open({title:"Document properties",data:l,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(i){var o=c.dataToHtml(e,n.extend(l,i.data),t.get());t.set(o)}})}},s={register:function(e,t){e.addCommand("mceFullPageProperties",function(){u.open(e,t)})}},d={protectHtml:function(e,t){return n.each(e,function(e){t=t.replace(e,function(e){return"\x3c!--mce:protected "+escape(e)+"--\x3e"})}),t},unprotectHtml:function(e){return e.replace(/<!--mce:protected ([\s\S]*?)-->/g,function(e,t){return unescape(t)})}},f=n.each,g=function(e){return e.replace(/<\/?[A-Z]+/g,function(e){return e.toLowerCase()})},m=function(e,t,l,i){var o,a,u,s,m,h="",y=e.dom;if(!(i.selection||(u=d.protectHtml(e.settings.protect,i.content),"raw"===i.format&&t.get()||i.source_view&&r.shouldHideInSourceView(e)))){0!==u.length||i.source_view||(u=n.trim(t.get())+"\n"+n.trim(u)+"\n"+n.trim(l.get())),-1!==(o=(u=u.replace(/<(\/?)BODY/gi,"<$1body")).indexOf("<body"))?(o=u.indexOf(">",o),t.set(g(u.substring(0,o+1))),-1===(a=u.indexOf("</body",o))&&(a=u.length),i.content=n.trim(u.substring(o+1,a)),l.set(g(u.substring(a)))):(t.set(p(e)),l.set("\n</body>\n</html>")),s=c.parseHeader(t.get()),f(s.getAll("style"),function(e){e.firstChild&&(h+=e.firstChild.value)}),(m=s.getAll("body")[0])&&y.setAttribs(e.getBody(),{style:m.attr("style")||"",dir:m.attr("dir")||"",vLink:m.attr("vlink")||"",link:m.attr("link")||"",aLink:m.attr("alink")||""}),y.remove("fullpage_styles");var v=e.getDoc().getElementsByTagName("head")[0];h&&(y.add(v,"style",{id:"fullpage_styles"},h),(m=y.get("fullpage_styles")).styleSheet&&(m.styleSheet.cssText=h));var _={};n.each(v.getElementsByTagName("link"),function(e){"stylesheet"===e.rel&&e.getAttribute("data-mce-fullpage")&&(_[e.href]=e)}),n.each(s.getAll("link"),function(e){var t=e.attr("href");if(!t)return!0;_[t]||"stylesheet"!==e.attr("rel")||y.add(v,"link",{rel:"stylesheet",text:"text/css",href:t,"data-mce-fullpage":"1"}),delete _[t]}),n.each(_,function(e){e.parentNode.removeChild(e)})}},p=function(e){var t,n="",l="";if(r.getDefaultXmlPi(e)){var i=r.getDefaultEncoding(e);n+='<?xml version="1.0" encoding="'+(i||"ISO-8859-1")+'" ?>\n'}return n+=r.getDefaultDocType(e),n+="\n<html>\n<head>\n",(t=r.getDefaultTitle(e))&&(n+="<title>"+t+"</title>\n"),(t=r.getDefaultEncoding(e))&&(n+='<meta http-equiv="Content-Type" content="text/html; charset='+t+'" />\n'),(t=r.getDefaultFontFamily(e))&&(l+="font-family: "+t+";"),(t=r.getDefaultFontSize(e))&&(l+="font-size: "+t+";"),(t=r.getDefaultTextColor(e))&&(l+="color: "+t+";"),n+="</head>\n<body"+(l?' style="'+l+'"':"")+">\n"},h=function(e,t,l,i){i.selection||i.source_view&&r.shouldHideInSourceView(e)||(i.content=d.unprotectHtml(n.trim(t)+"\n"+n.trim(i.content)+"\n"+n.trim(l)))},y={setup:function(e,t,n){e.on("BeforeSetContent",function(l){m(e,t,n,l)}),e.on("GetContent",function(l){h(e,t.get(),n.get(),l)})}},v={register:function(e){e.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),e.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"})}};t.add("fullpage",function(t){var n=e(""),l=e("");s.register(t,n),v.register(t),y.setup(t,n,l)})}();