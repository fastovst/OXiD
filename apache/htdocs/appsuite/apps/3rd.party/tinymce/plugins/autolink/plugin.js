!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.Env"),n={getAutoLinkPattern:function(t){return t.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)},getDefaultLinkTarget:function(t){return t.getParam("default_link_target","")}},i=function(t,e){return t===e||" "===t||160===t.charCodeAt(0)},o=function(t){l(t,-1,"(")},r=function(t){l(t,0,"")},f=function(t){l(t,-1,"")},a=function(t,e){if(e<0&&(e=0),3===t.nodeType){var n=t.data.length;e>n&&(e=n)}return e},s=function(t,e,n){1!==e.nodeType||e.hasChildNodes()?t.setStart(e,a(e,n)):t.setStartBefore(e)},d=function(t,e,n){1!==e.nodeType||e.hasChildNodes()?t.setEnd(e,a(e,n)):t.setEndAfter(e)},l=function(t,e,o){var r,f,a,l,u,c,g,h,C,m,k=n.getAutoLinkPattern(t),y=n.getDefaultLinkTarget(t);if("A"!==t.selection.getNode().tagName){if((r=t.selection.getRng(!0).cloneRange()).startOffset<5){if(!(h=r.endContainer.previousSibling)){if(!r.endContainer.firstChild||!r.endContainer.firstChild.nextSibling)return;h=r.endContainer.firstChild.nextSibling}if(C=h.length,s(r,h,C),d(r,h,C),r.endOffset<5)return;f=r.endOffset,l=h}else{if(3!==(l=r.endContainer).nodeType&&l.firstChild){for(;3!==l.nodeType&&l.firstChild;)l=l.firstChild;3===l.nodeType&&(s(r,l,0),d(r,l,l.nodeValue.length))}f=1===r.endOffset?2:r.endOffset-1-e}a=f;do{s(r,l,f>=2?f-2:0),d(r,l,f>=1?f-1:0),f-=1,m=r.toString()}while(" "!==m&&""!==m&&160!==m.charCodeAt(0)&&f-2>=0&&m!==o);i(r.toString(),o)?(s(r,l,f),d(r,l,a),f+=1):0===r.startOffset?(s(r,l,0),d(r,l,a)):(s(r,l,f),d(r,l,a)),"."===(c=r.toString()).charAt(c.length-1)&&d(r,l,a-1),(g=(c=r.toString().trim()).match(k))&&("www."===g[1]?g[1]="http://www.":/@$/.test(g[1])&&!/^mailto:/.test(g[1])&&(g[1]="mailto:"+g[1]),u=t.selection.getBookmark(),t.selection.setRng(r),t.execCommand("createlink",!1,g[1]+g[2]),y&&t.dom.setAttrib(t.selection.getNode(),"target",y),t.selection.moveToBookmark(u),t.nodeChanged())}},u={setup:function(t){var n;t.on("keydown",function(e){if(13===e.keyCode)return f(t)}),e.ie?t.on("focus",function(){if(!n){n=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(t){}}}):(t.on("keypress",function(e){if(41===e.keyCode)return o(t)}),t.on("keyup",function(e){if(32===e.keyCode)return r(t)}))}};t.add("autolink",function(t){u.setup(t)})}();