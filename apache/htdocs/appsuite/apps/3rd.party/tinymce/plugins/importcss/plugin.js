!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),n=tinymce.util.Tools.resolve("tinymce.EditorManager"),r=tinymce.util.Tools.resolve("tinymce.Env"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),o={shouldMergeClasses:function(e){return e.getParam("importcss_merge_classes")},shouldImportExclusive:function(e){return e.getParam("importcss_exclusive")},getSelectorConverter:function(e){return e.getParam("importcss_selector_converter")},getSelectorFilter:function(e){return e.getParam("importcss_selector_filter")},getCssGroups:function(e){return e.getParam("importcss_groups")},shouldAppend:function(e){return e.getParam("importcss_append")},getFileFilter:function(e){return e.getParam("importcss_file_filter")}},s=function(e){var t=r.cacheSuffix;return"string"==typeof e&&(e=e.replace("?"+t,"").replace("&"+t,"")),e},c=function(e,t){var r=e.settings,i=!1!==r.skin&&(r.skin||"lightgray");return!!i&&t===(r.skin_url?e.documentBaseURI.toAbsolute(r.skin_url):n.baseURL+"/skins/"+i)+"/content"+(e.inline?".inline":"")+".min.css"},u=function(e){return"string"==typeof e?function(t){return-1!==t.indexOf(e)}:e instanceof RegExp?function(t){return e.test(t)}:e},l=function(e,t,n){function r(t,u){var l,a=t.href;if((a=s(a))&&n(a,u)&&!c(e,a)){i.each(t.imports,function(e){r(e,!0)});try{l=t.cssRules||t.rules}catch(e){}i.each(l,function(e){e.styleSheet?r(e.styleSheet,!0):e.selectorText&&i.each(e.selectorText.split(","),function(e){o.push(i.trim(e))})})}}var o=[],u={};i.each(e.contentCSS,function(e){u[e]=!0}),n||(n=function(e,t){return t||u[e]});try{i.each(t.styleSheets,function(e){r(e)})}catch(e){}return o},a=function(e,t){var n,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(r){var s=r[1],c=r[2].substr(1).split(".").join(" "),u=i.makeMap("a,img");return r[1]?(n={title:t},e.schema.getTextBlockElements()[s]?n.block=s:e.schema.getBlockElements()[s]||u[s.toLowerCase()]?n.selector=s:n.inline=s):r[2]&&(n={inline:"span",title:t.substr(1),classes:c}),!1!==o.shouldMergeClasses(e)?n.classes=c:n.attributes={class:c},n}},f=function(e,t){return i.grep(e,function(e){return!e.filter||e.filter(t)})},m=function(e){return i.map(e,function(e){return i.extend({},e,{original:e,selectors:{},filter:u(e.filter),item:{text:e.title,menu:[]}})})},g=function(e,t){return null===t||!1!==o.shouldImportExclusive(e)},p=function(e,t,n,r){return!(g(e,n)?t in r:t in n.selectors)},v=function(e,t,n,r){g(e,n)?r[t]=!0:n.selectors[t]=!0},d=function(e,t,n,r){return(r&&r.selector_converter?r.selector_converter:o.getSelectorConverter(e)?o.getSelectorConverter(e):function(){return a(e,n)}).call(t,n,r)},h={defaultConvertSelectorToFormat:a,setup:function(e){e.on("renderFormatsMenu",function(n){var r={},s=u(o.getSelectorFilter(e)),c=n.control,a=m(o.getCssGroups(e)),g=function(n,o){if(p(e,n,o,r)){v(e,n,o,r);var s=d(e,e.plugins.importcss,n,o);if(s){var u=s.name||t.DOM.uniqueId();return e.formatter.register(u,s),i.extend({},c.settings.itemDefaults,{text:s.title,format:u})}}return null};o.shouldAppend(e)||c.items().remove(),i.each(l(e,n.doc||e.getDoc(),u(o.getFileFilter(e))),function(e){if(-1===e.indexOf(".mce-")&&(!s||s(e))){var t=f(a,e);if(t.length>0)i.each(t,function(t){var n=g(e,t);n&&t.item.menu.push(n)});else{var n=g(e,null);n&&c.add(n)}}}),i.each(a,function(e){e.item.menu.length>0&&c.add(e.item)}),n.control.renderNew()})}},y={get:function(e){return{convertSelectorToFormat:function(t){return h.defaultConvertSelectorToFormat(e,t)}}}};e.add("importcss",function(e){return h.setup(e),y.get(e)})}();