!function(e){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),r=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),o=tinymce.util.Tools.resolve("tinymce.util.VK"),i=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),u=tinymce.util.Tools.resolve("tinymce.util.Tools"),s=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),a=function(e){return e&&"BR"===e.nodeName},c={isTextNode:function(e){return e&&3===e.nodeType},isListNode:function(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)},isOlUlNode:function(e){return e&&/^(OL|UL)$/.test(e.nodeName)},isDlItemNode:function(e){return e&&/^(DT|DD)$/.test(e.nodeName)},isListItemNode:function(e){return e&&/^(LI|DT|DD)$/.test(e.nodeName)},isTableCellNode:function(e){return e&&/^(TH|TD)$/.test(e.nodeName)},isBr:a,isFirstChild:function(e){return e.parentNode.firstChild===e},isLastChild:function(e){return e.parentNode.lastChild===e},isTextBlock:function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},isBlock:function(e,t){return e&&e.nodeName in t},isBogusBr:function(e,t){return!!a(t)&&!(!e.isBlock(t.nextSibling)||a(t.previousSibling))},isEmpty:function(e,t,n){var r=e.isEmpty(t);return!(n&&e.select("span[data-mce-type=bookmark]",t).length>0)&&r},isChildOfBody:function(e,t){return e.isChildOf(t,e.getRoot())}},f=function(e,t){if(c.isTextNode(e))return{container:e,offset:t};var r=n.getNode(e,t);return c.isTextNode(r)?{container:r,offset:t>=e.childNodes.length?r.data.length:0}:r.previousSibling&&c.isTextNode(r.previousSibling)?{container:r.previousSibling,offset:r.previousSibling.data.length}:r.nextSibling&&c.isTextNode(r.nextSibling)?{container:r.nextSibling,offset:0}:{container:e,offset:t}},l={getNormalizedPoint:f,normalizeRange:function(e){var t=e.cloneRange(),n=f(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=f(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t}},d=s.DOM,m={createBookmark:function(e){var t={},n=function(n){var r,o,i;o=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"],1===o.nodeType&&(r=d.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),n?o.insertBefore(r,o.childNodes[i]):d.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),t[n?"startContainer":"endContainer"]=o,t[n?"startOffset":"endOffset"]=i};return n(!0),e.collapsed||n(),t},resolveBookmark:function(e){function t(t){var n,r,o;n=o=e[t?"startContainer":"endContainer"],r=e[t?"startOffset":"endOffset"],n&&(1===n.nodeType&&(r=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(n),n=n.parentNode,d.remove(o),!n.hasChildNodes()&&d.isBlock(n)&&n.appendChild(d.create("br"))),e[t?"startContainer":"endContainer"]=n,e[t?"startOffset":"endOffset"]=r)}t(!0),t();var n=d.createRng();return n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),l.normalizeRange(n)}},g=function(e){return function(){return e}},p=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return!e.apply(null,t)}},v=g(!1),h=g(!0),N=function(){return y},y=function(){var e=function(e){return e.isNone()},t=function(e){return e()},n=function(e){return e},r={fold:function(e,t){return e()},is:v,isSome:v,isNone:h,getOr:n,getOrThunk:t,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:n,orThunk:t,map:N,ap:N,each:function(){},bind:N,flatten:N,exists:v,forall:h,filter:N,equals:e,equals_:e,toArray:function(){return[]},toString:g("none()")};return Object.freeze&&Object.freeze(r),r}(),O=function(e){var t=function(){return e},n=function(){return o},r=function(t){return t(e)},o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:h,isNone:v,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return O(t(e))},ap:function(t){return t.fold(N,function(t){return O(t(e))})},each:function(t){t(e)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(e)?o:y},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(v,function(t){return n(e,t)})},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o},C={some:O,none:N,from:function(e){return null===e||void 0===e?y:O(e)}},S=function(e){if(null===e)return"null";var t=typeof e;return"object"===t&&Array.prototype.isPrototypeOf(e)?"array":"object"===t&&String.prototype.isPrototypeOf(e)?"string":t},T=function(e){return function(t){return S(t)===e}},b=T("string"),L=T("boolean"),k=T("function"),D=T("number"),E=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o,e)}return r},B=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n,e)},w=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r,e)&&n.push(i)}return n},x=function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var s=e[i],a=t(s);a!==n&&(r.push(o),o=[]),n=a,o.push(s)}return 0!==o.length&&r.push(o),r},A=function(e,t,n){return B(e,function(e){n=t(n,e)}),n},I=function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];if(t(o,n,e))return C.some(o)}return C.none()},R=Array.prototype.push,P=function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!Array.prototype.isPrototypeOf(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);R.apply(t,e[n])}return t},_=function(e,t){var n=E(e,t);return P(n)},M=Array.prototype.slice,U=function(e){var t=M.call(e,0);return t.reverse(),t},F=function(e){return 0===e.length?C.none():C.some(e[0])},z=function(e){return 0===e.length?C.none():C.some(e[e.length-1])},j=(k(Array.from)&&Array.from,void 0!==e.window?e.window:Function("return this;")()),H=function(e,t){for(var n=void 0!==t&&null!==t?t:j,r=0;r<e.length&&void 0!==n&&null!==n;++r)n=n[e[r]];return n},$=function(e,t){var n=e.split(".");return H(n,t)},W=function(e,t){return $(e,t)},q={getOrDie:function(e,t){var n=W(e,t);if(void 0===n||null===n)throw e+" not available on this browser";return n}},K=function(e){return q.getOrDie("HTMLElement",e)},V={isPrototypeOf:function(e){var t=$("ownerDocument.defaultView",e);return K(t).prototype.isPrototypeOf(e)}},X=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),Q=function(e){var t=e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",ee(e,t))},Y=function(e,t){return e&&1===t.length&&t[0]===e},G=function(e){return u.grep(e.querySelectorAll("ol,ul,dl"),function(e){return c.isListNode(e)})},J=function(e,t){var n=u.map(t,function(t){var n=e.dom.getParent(t,"li,dd,dt",ee(e,t));return n||t});return X.unique(n)},Z=function(e){var t=e.selection.getSelectedBlocks();return u.grep(J(e,t),function(e){return c.isListItemNode(e)})},ee=function(e,t){var n=e.dom.getParents(t,"TD,TH");return n.length>0?n[0]:e.getBody()},te=function(e,t){var n=e.dom.getParents(t,"ol,ul",ee(e,t));return z(n)},ne=function(e){var t=te(e,e.selection.getStart()),n=w(e.selection.getSelectedBlocks(),c.isOlUlNode);return t.toArray().concat(n)},re=function(e,t){var n=E(t,function(t){return te(e,t).getOr(t)});return X.unique(n)},oe={isList:function(e){var t=Q(e);return V.isPrototypeOf(t)},getParentList:Q,getSelectedSubLists:function(e){var t=Q(e),n=e.selection.getSelectedBlocks();return Y(t,n)?G(t):u.grep(n,function(e){return c.isListNode(e)&&t!==e})},getSelectedListItems:Z,getClosestListRootElm:ee,getSelectedDlItems:function(e){return w(Z(e),c.isDlItemNode)},getSelectedListRoots:function(e){var t=ne(e);return re(e,t)}},ie=function(e){if(null===e||void 0===e)throw new Error("Node cannot be null or undefined");return{dom:g(e)}},ue={fromHtml:function(t,n){var r=(n||e.document).createElement("div");if(r.innerHTML=t,!r.hasChildNodes()||r.childNodes.length>1)throw e.console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return ie(r.childNodes[0])},fromTag:function(t,n){var r=(n||e.document).createElement(t);return ie(r)},fromText:function(t,n){var r=(n||e.document).createTextNode(t);return ie(r)},fromDom:ie,fromPoint:function(e,t,n){var r=e.dom();return C.from(r.elementFromPoint(t,n)).map(ie)}},se=function(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];if(!o.isSome())return C.none();n.push(o.getOrDie())}return C.some(t.apply(null,n))},ae=function(t,n){var r=(n||e.document).createDocumentFragment();return B(t,function(e){r.appendChild(e.dom())}),ue.fromDom(r)},ce=Object.keys,fe=function(e,t){for(var n=ce(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i,e)}},le=function(){return q.getOrDie("Node")},de=function(e,t,n){return 0!=(e.compareDocumentPosition(t)&n)},me={documentPositionPreceding:function(e,t){return de(e,t,le().DOCUMENT_POSITION_PRECEDING)},documentPositionContainedBy:function(e,t){return de(e,t,le().DOCUMENT_POSITION_CONTAINED_BY)}},ge=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}},pe=function(e,t){var n=ge(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return he(r(1),r(2))},ve=function(){return he(0,0)},he=function(e,t){return{major:e,minor:t}},Ne={nu:he,detect:function(e,t){var n=String(t).toLowerCase();return 0===e.length?ve():pe(e,n)},unknown:ve},ye=function(e,t){return function(){return t===e}},Oe=function(e){var t=e.current;return{current:t,version:e.version,isEdge:ye("Edge",t),isChrome:ye("Chrome",t),isIE:ye("IE",t),isOpera:ye("Opera",t),isFirefox:ye("Firefox",t),isSafari:ye("Safari",t)}},Ce={unknown:function(){return Oe({current:void 0,version:Ne.unknown()})},nu:Oe,edge:g("Edge"),chrome:g("Chrome"),ie:g("IE"),opera:g("Opera"),firefox:g("Firefox"),safari:g("Safari")},Se=function(e,t){return function(){return t===e}},Te=function(e){var t=e.current;return{current:t,version:e.version,isWindows:Se("Windows",t),isiOS:Se("iOS",t),isAndroid:Se("Android",t),isOSX:Se("OSX",t),isLinux:Se("Linux",t),isSolaris:Se("Solaris",t),isFreeBSD:Se("FreeBSD",t)}},be={unknown:function(){return Te({current:void 0,version:Ne.unknown()})},nu:Te,windows:g("Windows"),ios:g("iOS"),android:g("Android"),linux:g("Linux"),osx:g("OSX"),solaris:g("Solaris"),freebsd:g("FreeBSD")},Le=function(e,t,n){var r=e.isiOS()&&!0===/ipad/i.test(n),o=e.isiOS()&&!r,i=e.isAndroid()&&3===e.version.major,u=e.isAndroid()&&4===e.version.major,s=r||i||u&&!0===/mobile/i.test(n),a=e.isiOS()||e.isAndroid(),c=a&&!s,f=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(n);return{isiPad:g(r),isiPhone:g(o),isTablet:g(s),isPhone:g(c),isTouch:g(a),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:g(f)}},ke=function(e,t){var n=String(t).toLowerCase();return I(e,function(e){return e.search(n)})},De={detectBrowser:function(e,t){return ke(e,t).map(function(e){var n=Ne.detect(e.versionRegexes,t);return{current:e.name,version:n}})},detectOs:function(e,t){return ke(e,t).map(function(e){var n=Ne.detect(e.versionRegexes,t);return{current:e.name,version:n}})}},Ee=function(e,t){return-1!==e.indexOf(t)},Be=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,we=function(e){return function(t){return Ee(t,e)}},xe=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return Ee(e,"edge/")&&Ee(e,"chrome")&&Ee(e,"safari")&&Ee(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Be],search:function(e){return Ee(e,"chrome")&&!Ee(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return Ee(e,"msie")||Ee(e,"trident")}},{name:"Opera",versionRegexes:[Be,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:we("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:we("firefox")},{name:"Safari",versionRegexes:[Be,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(Ee(e,"safari")||Ee(e,"mobile/"))&&Ee(e,"applewebkit")}}],Ae=[{name:"Windows",search:we("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return Ee(e,"iphone")||Ee(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:we("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:we("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:we("linux"),versionRegexes:[]},{name:"Solaris",search:we("sunos"),versionRegexes:[]},{name:"FreeBSD",search:we("freebsd"),versionRegexes:[]}],Ie={browsers:g(xe),oses:g(Ae)},Re={detect:function(e){var t=Ie.browsers(),n=Ie.oses(),r=De.detectBrowser(t,e).fold(Ce.unknown,Ce.nu),o=De.detectOs(n,e).fold(be.unknown,be.nu);return{browser:r,os:o,deviceType:Le(o,r,e)}}},Pe={detect:function(e){var t,n=!1;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return n||(n=!0,t=e.apply(null,r)),t}}(function(){var t=e.navigator.userAgent;return Re.detect(t)})},_e=(e.Node.ATTRIBUTE_NODE,e.Node.CDATA_SECTION_NODE,e.Node.COMMENT_NODE,e.Node.DOCUMENT_NODE,e.Node.DOCUMENT_TYPE_NODE,e.Node.DOCUMENT_FRAGMENT_NODE,e.Node.ELEMENT_NODE),Me=(e.Node.TEXT_NODE,e.Node.PROCESSING_INSTRUCTION_NODE,e.Node.ENTITY_REFERENCE_NODE,e.Node.ENTITY_NODE,e.Node.NOTATION_NODE,_e),Ue=function(e,t){return e.dom()===t.dom()},Fe=Pe.detect().browser.isIE()?function(e,t){return me.documentPositionContainedBy(e.dom(),t.dom())}:function(e,t){var n=e.dom(),r=t.dom();return n!==r&&n.contains(r)},ze=function(e,t){var n=e.dom();if(n.nodeType!==Me)return!1;if(void 0!==n.matches)return n.matches(t);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(t);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(t);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},je=function(e){var t=e.dom();return C.from(t.parentNode).map(ue.fromDom)},He=function(e){var t=e.dom();return E(t.childNodes,ue.fromDom)},$e=function(e,t){var n=e.dom().childNodes;return C.from(n[t]).map(ue.fromDom)},We=function(e){return $e(e,0)},qe=function(e){return $e(e,e.dom().childNodes.length-1)},Ke=(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}("element","offset"),function(e,t){je(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})}),Ve=function(e,t){e.dom().appendChild(t.dom())},Xe=function(e,t){B(t,function(t){Ke(e,t)})},Qe=function(e,t){B(t,function(t){Ve(e,t)})},Ye=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},Ge=function(e){return e.dom().nodeName.toLowerCase()},Je=function(t,n,r){if(!(b(r)||L(r)||D(r)))throw e.console.error("Invalid call to Attr.set. Key ",n,":: Value ",r,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(n,r+"")},Ze=function(e,t){var n=e.dom();fe(t,function(e,t){Je(n,t,e)})},et=function(e){return A(e.dom().attributes,function(e,t){return e[t.name]=t.value,e},{})},tt=function(e){return void 0!==e.style},nt=function(t,n,r){if(!b(r))throw e.console.error("Invalid call to CSS.set. Property ",n,":: Value ",r,":: Element ",t),new Error("CSS value must be a string: "+r);tt(t)&&t.style.setProperty(n,r)},rt=function(e,t,n){var r=e.dom();nt(r,t,n)},ot=function(e,t){return ue.fromDom(e.dom().cloneNode(t))},it=function(e){return ot(e,!0)},ut=function(e,t){var n=ue.fromTag(t),r=et(e);return Ze(n,r),n},st=function(e,t){var n=ut(e,t);Ke(e,n);var r=He(e);return Qe(n,r),Ye(e),n},at=function(e,t){Ve(e.item,t.list)},ct=function(e){for(var t=1;t<e.length;t++)at(e[t-1],e[t])},ft=function(e,t){se([z(e),F(t)],at)},lt=function(e,t){var n={list:ue.fromTag(t,e),item:ue.fromTag("li",e)};return Ve(n.list,n.item),n},dt=function(e,t,n){for(var r=[],o=0;o<n;o++)r.push(lt(e,t.listType));return r},mt=function(e,t){for(var n=0;n<e.length-1;n++)rt(e[n].item,"list-style-type","none");z(e).each(function(e){Ze(e.list,t.listAttributes),Ze(e.item,t.itemAttributes),Qe(e.item,t.content)})},gt=function(e,t){Ge(e.list)!==t.listType&&(e.list=st(e.list,t.listType)),Ze(e.list,t.listAttributes)},pt=function(e,t,n){var r=ue.fromTag("li",e);return Ze(r,t),Qe(r,n),r},vt=function(e,t){Ve(e.list,t),e.item=t},ht=function(e,t,n){var r=t.slice(0,n.depth);return z(r).each(function(t){var r=pt(e,n.itemAttributes,n.content);vt(t,r),gt(t,n)}),r},Nt=function(e,t,n){var r=dt(e,n,n.depth-t.length);return ct(r),mt(r,n),ft(t,r),t.concat(r)},yt=function(e,t){var n=A(t,function(t,n){return n.depth>t.length?Nt(e,t,n):ht(e,t,n)},[]);return F(n).map(function(e){return e.list})},Ot=function(e){return ze(e,"OL,UL")},Ct=function(e){return We(e).map(Ot).getOr(!1)},St=function(e){return qe(e).map(Ot).getOr(!1)},Tt=function(e){return e.depth>0},bt=function(e){return e.isSelected},Lt=function(e){var t=He(e),n=St(e)?t.slice(0,-1):t;return E(n,it)},kt=function(e,t,n){return je(e).map(function(r){return{depth:t,isSelected:n,content:Lt(e),itemAttributes:et(e),listAttributes:et(r),listType:Ge(r)}})},Dt=function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}},Et=Object.prototype.hasOwnProperty,Bt=function(e){return function(){for(var t=new Array(arguments.length),n=0;n<t.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var i=t[o];for(var u in i)Et.call(i,u)&&(r[u]=e(r[u],i[u]))}return r}}(function(e,t){return t}),wt=function(e,t){e.listType=t.listType,e.listAttributes=Bt({},t.listAttributes)},xt=function(e,t){for(var n=e[t].depth,r=t-1;r>=0;r--){if(e[r].depth===n)return C.some(e[r]);if(e[r].depth<n)break}return C.none()},At=function(e){B(e,function(t,n){xt(e,n).each(function(e){wt(t,e)})})},It=function(e){var t=e,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return It(n())}}},Rt=function(e,t,n,r){return We(r).filter(Ot).fold(function(){t.each(function(e){Ue(e.start,r)&&n.set(!0)});var o=kt(r,e,n.get());t.each(function(e){Ue(e.end,r)&&n.set(!1)});var i=qe(r).filter(Ot).map(function(r){return Pt(e,t,n,r)}).getOr([]);return o.toArray().concat(i)},function(r){return Pt(e,t,n,r)})},Pt=function(e,t,n,r){return _(He(r),function(r){return(Ot(r)?Pt:Rt)(e+1,t,n,r)})},_t=function(e,t){var n=It(!1);return E(e,function(e){return{sourceList:e,entries:Pt(0,t,n,e)}})},Mt=tinymce.util.Tools.resolve("tinymce.Env"),Ut=function(e,t){var n,r,o,i,u=e.dom,s=e.schema.getBlockElements(),a=u.createFragment();if(e.settings.forced_root_block&&(o=e.settings.forced_root_block),o&&((r=u.create(o)).tagName===e.settings.forced_root_block&&u.setAttribs(r,e.settings.forced_root_block_attrs),c.isBlock(t.firstChild,s)||a.appendChild(r)),t)for(;n=t.firstChild;){var f=n.nodeName;i||"SPAN"===f&&"bookmark"===n.getAttribute("data-mce-type")||(i=!0),c.isBlock(n,s)?(a.appendChild(n),r=null):o?(r||(r=u.create(o),a.appendChild(r)),r.appendChild(n)):a.appendChild(n)}return e.settings.forced_root_block?i||Mt.ie&&!(Mt.ie>10)||r.appendChild(u.create("br",{"data-mce-bogus":"1"})):a.appendChild(u.create("br")),a},Ft=function(e,t){return E(t,function(t){var n=ae(t.content);return ue.fromDom(Ut(e,n.dom()))})},zt=function(e,t){return At(t),yt(e.contentDocument,t).toArray()},jt=function(e,t){return _(x(t,Tt),function(t){return F(t).map(Tt).getOr(!1)?zt(e,t):Ft(e,t)})},Ht=function(e,t){B(w(e,bt),function(e){return Dt(t,e)})},$t=function(e){var t=E(oe.getSelectedListItems(e),ue.fromDom);return se([I(t,p(Ct)),I(U(t),p(Ct))],function(e,t){return{start:e,end:t}})},Wt=function(e,t,n){var r=_t(t,$t(e));B(r,function(t){Ht(t.entries,n),Xe(t.sourceList,jt(e,t.entries)),Ye(t.sourceList)})},qt=s.DOM,Kt={splitList:function(e,t,n){var r,o,i,s,a;for(i=qt.select('span[data-mce-type="bookmark"]',t),a=Ut(e,n),(r=qt.createRng()).setStartAfter(n),r.setEndAfter(t),s=(o=r.extractContents()).firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){qt.remove(s);break}e.dom.isEmpty(o)||qt.insertAfter(o,t),qt.insertAfter(a,t),c.isEmpty(e.dom,n.parentNode)&&function(e){u.each(i,function(t){e.parentNode.insertBefore(t,n.parentNode)}),qt.remove(e)}(n.parentNode),qt.remove(n),c.isEmpty(e.dom,t)&&qt.remove(t)}},Vt=function(e,t){ze(t,"DD")?st(t,"DT"):ze(t,"DT")&&je(t).each(function(n){return Kt.splitList(e,n.dom(),t.dom())})},Xt=function(e){ze(e,"DT")&&st(e,"DD")},Qt=function(e,t,n){"Indent"===t?B(n,Xt):B(n,function(t){return Vt(e,t)})},Yt=function(e,t){var n=E(oe.getSelectedListRoots(e),ue.fromDom),r=E(oe.getSelectedDlItems(e),ue.fromDom),o=!1;if(n.length||r.length){var i=e.selection.getBookmark();Wt(e,n,t),Qt(e,t,r),e.selection.moveToBookmark(i),e.selection.setRng(l.normalizeRange(e.selection.getRng())),e.nodeChanged(),o=!0}return o},Gt=function(e){return Yt(e,"Indent")},Jt=function(e){return Yt(e,"Outdent")},Zt=function(e){return Yt(e,"Flatten")},en=function(e,t,n){var r=n["list-style-type"]?n["list-style-type"]:null;e.setStyle(t,"list-style-type",r)},tn=function(e,t){u.each(t,function(t,n){e.setAttribute(n,t)})},nn=function(e,t,n){tn(t,n["list-attributes"]),u.each(e.select("li",t),function(e){tn(e,n["list-item-attributes"])})},rn=function(e,t,n){en(e,t,n),nn(e,t,n)},on=function(e,t,n){u.each(n,function(n){var r;return e.setStyle(t,(r={},r[n]="",r))})},un=function(e,t,n,r){var o,i;for(o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"],1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&c.isBr(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(c.isTextBlock(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},sn=function(e,t,n){for(var r,o=[],s=e.dom,a=un(e,t,!0,n),f=un(e,t,!1,n),l=[],d=a;d&&(l.push(d),d!==f);d=d.nextSibling);return u.each(l,function(t){if(c.isTextBlock(e,t))return o.push(t),void(r=null);if(s.isBlock(t)||c.isBr(t))return c.isBr(t)&&s.remove(t),void(r=null);var u=t.nextSibling;i.isBookmarkNode(t)&&(c.isTextBlock(e,u)||!u&&t.parentNode===n)?r=null:(r||(r=s.create("p"),t.parentNode.insertBefore(r,t),o.push(r)),r.appendChild(t))}),o},an=function(e,t,n){var r=e.getStyle(t,"list-style-type"),o=n?n["list-style-type"]:"";return o=null===o?"":o,r===o},cn=function(e,t,n){void 0===n&&(n={});var r,o=e.selection.getRng(!0),i="LI",s=oe.getClosestListRootElm(e,e.selection.getStart(!0)),a=e.dom;"false"!==a.getContentEditable(e.selection.getNode())&&("DL"===(t=t.toUpperCase())&&(i="DT"),r=m.createBookmark(o),u.each(sn(e,o,s),function(r){var o,u;(u=r.previousSibling)&&c.isListNode(u)&&u.nodeName===t&&an(a,u,n)?(o=u,r=a.rename(r,i),u.appendChild(r)):(o=a.create(t),r.parentNode.insertBefore(o,r),o.appendChild(r),r=a.rename(r,i)),on(a,r,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),rn(a,o,n),gn(e.dom,o)}),e.selection.setRng(m.resolveBookmark(r)))},fn=function(e,t){return e&&t&&c.isListNode(e)&&e.nodeName===t.nodeName},ln=function(e,t,n){return e.getStyle(t,"list-style-type",!0)===e.getStyle(n,"list-style-type",!0)},dn=function(e,t){return e.className===t.className},mn=function(e,t,n){return fn(t,n)&&ln(e,t,n)&&dn(t,n)},gn=function(e,t){var n,r;if(n=t.nextSibling,mn(e,t,n)){for(;r=n.firstChild;)t.appendChild(r);e.remove(n)}if(n=t.previousSibling,mn(e,t,n)){for(;r=n.lastChild;)t.insertBefore(r,t.firstChild);e.remove(n)}},pn=function(e,t,n,r){if(t.nodeName!==n){var o=e.rename(t,n);rn(e,o,r)}else rn(e,t,r)},vn=function(e,t,n,r,o){if(t.nodeName!==r||hn(o)){var i=m.createBookmark(e.selection.getRng(!0));u.each([t].concat(n),function(t){pn(e.dom,t,r,o)}),e.selection.setRng(m.resolveBookmark(i))}else Zt(e)},hn=function(e){return"list-style-type"in e},Nn=function(e,t,n,r){if(t!==e.getBody())if(t)if(t.nodeName!==n||hn(r)){var o=m.createBookmark(e.selection.getRng(!0));rn(e.dom,t,r),gn(e.dom,e.dom.rename(t,n)),e.selection.setRng(m.resolveBookmark(o))}else Zt(e);else cn(e,n,r)},yn={toggleList:function(e,t,n){var r=oe.getParentList(e),o=oe.getSelectedSubLists(e);n=n||{},r&&o.length>0?vn(e,r,o,t,n):Nn(e,r,t,n)},mergeWithAdjacentLists:gn},On=s.DOM,Cn=function(e,t){var n,r=t.parentNode;"LI"===r.nodeName&&r.firstChild===t&&((n=r.previousSibling)&&"LI"===n.nodeName?(n.appendChild(t),c.isEmpty(e,r)&&On.remove(r)):On.setStyle(r,"listStyleType","none")),c.isListNode(r)&&(n=r.previousSibling)&&"LI"===n.nodeName&&n.appendChild(t)},Sn={normalizeList:Cn,normalizeLists:function(e,t){u.each(u.grep(e.select("ol,ul",t)),function(t){Cn(e,t)})}},Tn=function(e,t,o,i){var u,s,a=t.startContainer,f=t.startOffset;if(3===a.nodeType&&(o?f<a.data.length:f>0))return a;for(u=e.schema.getNonEmptyElements(),1===a.nodeType&&(a=n.getNode(a,f)),s=new r(a,i),o&&c.isBogusBr(e.dom,a)&&s.next();a=s[o?"next":"prev2"]();){if("LI"===a.nodeName&&!a.hasChildNodes())return a;if(u[a.nodeName])return a;if(3===a.nodeType&&a.data.length>0)return a}},bn=function(e,t){var n=t.childNodes;return 1===n.length&&!c.isListNode(n[0])&&e.isBlock(n[0])},Ln=function(e,t){bn(e,t)&&e.remove(t.firstChild,!0)},kn=function(e,t,n){var r,o;if(o=bn(e,n)?n.firstChild:n,Ln(e,t),!c.isEmpty(e,t,!0))for(;r=t.firstChild;)o.appendChild(r)},Dn=function(e,t,n){var r,o,i=t.parentNode;if(c.isChildOfBody(e,t)&&c.isChildOfBody(e,n)){c.isListNode(n.lastChild)&&(o=n.lastChild),i===n.lastChild&&c.isBr(i.previousSibling)&&e.remove(i.previousSibling),(r=n.lastChild)&&c.isBr(r)&&t.hasChildNodes()&&e.remove(r),c.isEmpty(e,n,!0)&&e.$(n).empty(),kn(e,t,n),o&&n.appendChild(o);var u=Fe(ue.fromDom(n),ue.fromDom(t))?e.getParents(t,c.isListNode,n):[];e.remove(t),B(u,function(t){c.isEmpty(e,t)&&t!==e.getRoot()&&e.remove(t)})}},En=function(e,t,n){e.dom.$(n).empty(),Dn(e.dom,t,n),e.selection.setCursorLocation(n)},Bn=function(e,t,n,r){var o=e.dom;if(o.isEmpty(r))En(e,n,r);else{var i=m.createBookmark(t);Dn(o,n,r),e.selection.setRng(m.resolveBookmark(i))}},wn=function(e,t,n,r){var o=m.createBookmark(t);Dn(e.dom,n,r);var i=m.resolveBookmark(o);e.selection.setRng(i)},xn=function(e,t){var n,r,o,i=e.dom,u=e.selection,s=u.getStart(),a=oe.getClosestListRootElm(e,s),f=i.getParent(u.getStart(),"LI",a);if(f){if((n=f.parentNode)===e.getBody()&&c.isEmpty(i,n))return!0;if(r=l.normalizeRange(u.getRng(!0)),(o=i.getParent(Tn(e,r,t,a),"LI",a))&&o!==f)return t?Bn(e,r,o,f):wn(e,r,f,o),!0;if(!o&&!t)return Zt(e),!0}return!1},An=function(e,t,n){var r=e.getParent(t.parentNode,e.isBlock,n);e.remove(t),r&&e.isEmpty(r)&&e.remove(r)},In=function(e,t){var n=e.dom,r=e.selection.getStart(),o=oe.getClosestListRootElm(e,r),i=n.getParent(r,n.isBlock,o);if(i&&n.isEmpty(i)){var u=l.normalizeRange(e.selection.getRng(!0)),s=n.getParent(Tn(e,u,t,o),"LI",o);if(s)return e.undoManager.transact(function(){An(n,i,o),yn.mergeWithAdjacentLists(n,s.parentNode),e.selection.select(s,!0),e.selection.collapse(t)}),!0}return!1},Rn=function(e,t){return xn(e,t)||In(e,t)},Pn=function(e){var t=e.selection.getStart(),n=oe.getClosestListRootElm(e,t);return!!(e.dom.getParent(t,"LI,DT,DD",n)||oe.getSelectedListItems(e).length>0)&&(e.undoManager.transact(function(){e.execCommand("Delete"),Sn.normalizeLists(e.dom,e.getBody())}),!0)},_n=function(e,t){return e.selection.isCollapsed()?Rn(e,t):Pn(e)},Mn={setup:function(e){e.on("keydown",function(t){t.keyCode===o.BACKSPACE?_n(e,!1)&&t.preventDefault():t.keyCode===o.DELETE&&_n(e,!0)&&t.preventDefault()})},backspaceDelete:_n},Un={get:function(e){return{backspaceDelete:function(t){Mn.backspaceDelete(e,t)}}}},Fn=function(e,t){return function(){var n=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return n&&n.nodeName===t}},zn={register:function(e){e.on("BeforeExecCommand",function(t){var n=t.command.toLowerCase();"indent"===n?Gt(e):"outdent"===n&&Jt(e)}),e.addCommand("InsertUnorderedList",function(t,n){yn.toggleList(e,"UL",n)}),e.addCommand("InsertOrderedList",function(t,n){yn.toggleList(e,"OL",n)}),e.addCommand("InsertDefinitionList",function(t,n){yn.toggleList(e,"DL",n)}),e.addCommand("RemoveList",function(){Zt(e)}),e.addQueryStateHandler("InsertUnorderedList",Fn(e,"UL")),e.addQueryStateHandler("InsertOrderedList",Fn(e,"OL")),e.addQueryStateHandler("InsertDefinitionList",Fn(e,"DL"))}},jn={shouldIndentOnTab:function(e){return e.getParam("lists_indent_on_tab",!0)}},Hn=function(e){e.on("keydown",function(t){t.keyCode!==o.TAB||o.metaKeyPressed(t)||e.undoManager.transact(function(){(t.shiftKey?Jt(e):Gt(e))&&t.preventDefault()})})},$n={setup:function(e){jn.shouldIndentOnTab(e)&&Hn(e),Mn.setup(e)}},Wn=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},qn=function(e,t){return function(n){var r=n.control;e.on("NodeChange",function(e){var n=Wn(e.parents,c.isTableCellNode),o=-1!==n?e.parents.slice(0,n):e.parents,i=u.grep(o,c.isListNode);r.active(i.length>0&&i[0].nodeName===t)})}},Kn={register:function(e){(function(e,t){var n=e.settings.plugins?e.settings.plugins:"";return-1!==u.inArray(n.split(/[ ,]/),t)})(e,"advlist")||(e.addButton("numlist",{active:!1,title:"Numbered list",cmd:"InsertOrderedList",onPostRender:qn(e,"OL")}),e.addButton("bullist",{active:!1,title:"Bullet list",cmd:"InsertUnorderedList",onPostRender:qn(e,"UL")})),e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent"})}};t.add("lists",function(e){return $n.setup(e),Kn.register(e),zn.register(e),Un.get(e)})}(window);